{
  "title": "Change origin for API requests",
  "content": "resource \"cloudflare_ruleset\" \"http_origin_example\" {\n  zone_id     = \"<ZONE_ID>\"\n  name        = \"Change origin\"\n  description = \"\"\n  kind        = \"zone\"\n  phase       = \"http_request_origin\"\n\nrules {\n    ref         = \"change_api_origin\"\n    description = \"Change origin of API requests\"\n    expression  = \"(http.request.uri.path matches \\\"^/api/\\\")\"\n    action      = \"route\"\n    action_parameters {\n      host_header = \"example.net\"\n      origin {\n        host = \"example.net\"\n        port = 8000\n      }\n    }\n  }\n}\ntxt\n   raw.http.request.uri.path matches \"^/uploads/.*\"\n   txt\n   regex_replace(raw.http.request.uri.path, \"^/uploads/\", \"/\")\n   txt\n   raw.http.request.uri.path matches \"^/uploads/.*\"\n   txt\n   example.com\n   txt\n   example.com\n   txt\n(http.request.uri.path wildcard \"/blog/*\")\ntxt\n   https://<YOUR_HOSTNAME>/blog/*\n   txt\n(http.request.uri.path wildcard \"/images/*\")\ntxt\n   https://<YOUR_HOSTNAME>/images/*\n   txt\nhttp://example.com/products\n\nhttp://www.example.com/products\n\nhttps://www.example.com/products\n\nhttps://blog.example.com/products\n\nhttps://www.blog.example.com/products\ntxt\nhttp://www.example.com/blog/products (extra directory)\nor\nhttp://www.example.comproducts (no trailing slash)\ntxt\nhttps://example.com/products\ntxt\nexample.com\ntxt\nhttp://www.example.com\ntxt\nwww.example.com\ntxt\nwww.example.com/some-particular-page.html\ntxt\nexample.com/*\ntxt\nhttp://www.example.com/$1\ntxt\nexample.com/some-particular-page.html\ntxt\nhttp://www.example.com/some-particular-page.html\ntxt\n(http.host eq \"<YOUR_HOSTNAME>\")\ntxt\n(http.host in {\"<YOUR_HOSTNAME_1>\" \"<YOUR_HOSTNAME_2>\"})\ntxt\nstarts_with(http.request.uri.path, \"/en/\")\ntxt\nstarts_with(http.request.uri.path, \"/en/\")\ntxt\n(cf.worker.upstream_zone != \"\" and cf.worker.upstream_zone != \"myappexample.com\")\ntxt\nstarts_with(http.request.uri.path, \"/en/\")\ntxt\n(lower(raw.http.request.full_uri) wildcard \"*%2f*\")\ntxt\nurl_decode(http.request.uri.path)\ntxt\nstarts_with(http.request.uri.path, \"/private/\")\ntxt\nstarts_with(http.request.uri.path, \"/private/\")\ntxt\nhttp.request.uri.path ~ \"^/posts/[0-9]+-[0-9]+-[0-9]+-.*\"\ntxt\nregex_replace(http.request.uri.path, \"^/posts/([0-9]+)-([0-9]+)-([0-9]+)-(.*)$\", \"/posts/${1}/${2}/${3}/${4}\")\ntxt\nhttp.request.uri.path ~ \"^/images/[^/]+/[^/]+/[^/]+$\"\ntxt\nregex_replace(http.request.uri.path, \"^/images/[^/]+/[^/]+/(.+)$\", \"/img/${1}\")\ntxt\nhttp.request.uri.path == \"/blog\"\ntxt\nsort-by=date\ntxt\nhttp.request.uri.path == \"/welcome.html\" && ip.src.country == \"GB\"\ntxt\n/welcome-gb.html\ntxt\nhttp.request.uri.path == \"/welcome.html\" && ip.src.country == \"PT\"\ntxt\n/welcome-pt.html\ntxt\nstarts_with(http.request.uri.path, \"/en/\")\ntxt\nstarts_with(http.request.uri.path, \"/en/\")\nbash\n  curl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/managed_headers\" \\\n    --request GET \\\n    --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\"\n  json\n  {\n    \"result\": {\n      \"managed_request_headers\": [\n        {\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"add_bot_protection_headers\"\n        },\n  32 collapsed lines\n        {\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"add_client_certificate_headers\"\n        },\n        {\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"add_visitor_location_headers\"\n        },\n        {\n          \"conflicts_with\": [\"remove_visitor_ip_headers\"],\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"add_true_client_ip_headers\"\n        },\n        {\n          \"conflicts_with\": [\"add_true_client_ip_headers\"],\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"remove_visitor_ip_headers\"\n        },\n        {\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"add_waf_credential_check_status_header\"\n        },\n        {\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"add_waf_content_scan_status_header\"\n        }\n      ],\n      \"managed_response_headers\": [\n        {\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"remove_x-powered-by_header\"\n        },\n  5 collapsed lines\n        {\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"add_security_headers\"\n        }\n      ]\n    },\n    \"success\": true,\n    \"errors\": [],\n    \"messages\": []\n  }\n  bash\n  curl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/managed_headers\" \\\n    --request PATCH \\\n    --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n    --json '{\n      \"managed_request_headers\": [\n          {\n              \"id\": \"add_visitor_location_headers\",\n              \"enabled\": true\n          }\n      ],\n      \"managed_response_headers\": [\n          {\n              \"id\": \"remove_x-powered-by_header\",\n              \"enabled\": true\n          }\n      ]\n    }'\n  json\n  {\n    \"result\": {\n      \"managed_request_headers\": [\n  10 collapsed lines\n        {\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"add_bot_protection_headers\"\n        },\n        {\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"add_client_certificate_headers\"\n        },\n        {\n          \"enabled\": true,\n          \"has_conflict\": false,\n          \"id\": \"add_visitor_location_headers\"\n        },\n  22 collapsed lines\n        {\n          \"conflicts_with\": [\"remove_visitor_ip_headers\"],\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"add_true_client_ip_headers\"\n        },\n        {\n          \"conflicts_with\": [\"add_true_client_ip_headers\"],\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"remove_visitor_ip_headers\"\n        },\n        {\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"add_waf_credential_check_status_header\"\n        },\n        {\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"add_waf_content_scan_status_header\"\n        }\n      ],\n      \"managed_response_headers\": [\n        {\n          \"enabled\": true,\n          \"has_conflict\": false,\n          \"id\": \"remove_x-powered-by_header\"\n        },\n  5 collapsed lines\n        {\n          \"enabled\": false,\n          \"has_conflict\": false,\n          \"id\": \"add_security_headers\"\n        }\n      ]\n    },\n    \"success\": true,\n    \"errors\": [],\n    \"messages\": []\n  }\n  tf\n  resource \"cloudflare_managed_headers\" \"tf_example\" {\n    zone_id = \"<ZONE_ID>\"\n\nmanaged_request_headers {\n      id      = \"add_visitor_location_headers\"\n      enabled = true\n    }\n\nmanaged_response_headers {\n      id      = \"remove_x-powered-by_header\"\n      enabled = true\n    }\n  }\n  bash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/rulesets/$RULESET_ID\" \\\n  --request PUT \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"rules\": [\n        {\n            \"ref\": \"add_header_source\",\n            \"expression\": \"(starts_with(http.request.uri.path, \\\"/en/\\\"))\",\n            \"description\": \"My first request header transform rule\",\n            \"action\": \"rewrite\",\n            \"action_parameters\": {\n                \"headers\": {\n                    \"X-Source\": {\n                        \"operation\": \"set\",\n                        \"value\": \"Cloudflare\"\n                    }\n                }\n            }\n        }\n    ]\n  }'\njson\n{\n  \"result\": {\n    \"id\": \"<RULESET_ID>\",\n    \"name\": \"Zone-level Late Transform Ruleset\",\n    \"description\": \"Zone-level ruleset that will execute Late Transform Rules.\",\n    \"kind\": \"zone\",\n    \"version\": \"2\",\n    \"rules\": [\n      {\n        \"ref\": \"add_header_source\",\n        \"id\": \"<RULE_ID>\",\n        \"version\": \"1\",\n        \"action\": \"rewrite\",\n        \"action_parameters\": {\n          \"headers\": {\n            \"X-Source\": {\n              \"operation\": \"set\",\n              \"value\": \"Cloudflare\"\n            }\n          }\n        },\n        \"expression\": \"(starts_with(http.request.uri.path, \\\"/en/\\\"))\",\n        \"description\": \"My first request header transform rule\",\n        \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n        \"ref\": \"<RULE_REF>\"\n      }\n    ],\n    \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n    \"phase\": \"http_request_late_transform\"\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/rulesets/$RULESET_ID\" \\\n  --request PUT \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"rules\": [\n        {\n            \"ref\": \"add_header_bot_score\",\n            \"expression\": \"(starts_with(http.request.uri.path, \\\"/en/\\\"))\",\n            \"description\": \"My first request header transform rule\",\n            \"action\": \"rewrite\",\n            \"action_parameters\": {\n                \"headers\": {\n                    \"X-Bot-Score\": {\n                        \"operation\": \"set\",\n                        \"expression\": \"to_string(cf.bot_management.score)\"\n                    }\n                }\n            }\n        }\n    ]\n  }'\njson\n{\n  \"result\": {\n    \"id\": \"<RULESET_ID>\",\n    \"name\": \"Zone-level Late Transform Ruleset\",\n    \"description\": \"Zone-level ruleset that will execute Late Transform Rules.\",\n    \"kind\": \"zone\",\n    \"version\": \"2\",\n    \"rules\": [\n      {\n        \"ref\": \"add_header_bot_score\",\n        \"id\": \"<RULE_ID>\",\n        \"version\": \"1\",\n        \"action\": \"rewrite\",\n        \"action_parameters\": {\n          \"headers\": {\n            \"X-Bot-Score\": {\n              \"operation\": \"set\",\n              \"expression\": \"to_string(cf.bot_management.score)\"\n            }\n          }\n        },\n        \"expression\": \"(starts_with(http.request.uri.path, \\\"/en/\\\"))\",\n        \"description\": \"My first request header transform rule\",\n        \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n        \"ref\": \"<RULE_REF>\"\n      }\n    ],\n    \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n    \"phase\": \"http_request_late_transform\"\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/rulesets/$RULESET_ID\" \\\n  --request PUT \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"rules\": [\n        {\n            \"ref\": \"remove_header_cf_connecting_ip\",\n            \"expression\": \"(starts_with(http.request.uri.path, \\\"/en/\\\"))\",\n            \"description\": \"My first request header transform rule\",\n            \"action\": \"rewrite\",\n            \"action_parameters\": {\n                \"headers\": {\n                    \"cf-connecting-ip\": {\n                        \"operation\": \"remove\"\n                    }\n                }\n            }\n        }\n    ]\n  }'\njson\n{\n  \"result\": {\n    \"id\": \"<RULESET_ID>\",\n    \"name\": \"Zone-level Late Transform Ruleset\",\n    \"description\": \"Zone-level ruleset that will execute Late Transform Rules.\",\n    \"kind\": \"zone\",\n    \"version\": \"2\",\n    \"rules\": [\n      {\n        \"ref\": \"remove_header_cf_connecting_ip\",\n        \"id\": \"<RULE_ID>\",\n        \"version\": \"1\",\n        \"action\": \"rewrite\",\n        \"action_parameters\": {\n          \"headers\": {\n            \"cf-connecting-ip\": {\n              \"operation\": \"remove\"\n            }\n          }\n        },\n        \"expression\": \"(starts_with(http.request.uri.path, \\\"/en/\\\"))\",\n        \"description\": \"My first request header transform rule\",\n        \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n        \"ref\": \"<RULE_REF>\"\n      }\n    ],\n    \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n    \"phase\": \"http_request_late_transform\"\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/rulesets/$RULESET_ID\" \\\n  --request PUT \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"rules\": [\n        {\n            \"ref\": \"set_resp_header_source\",\n            \"expression\": \"(starts_with(http.request.uri.path, \\\"/en/\\\"))\",\n            \"description\": \"My first response header transform rule\",\n            \"action\": \"rewrite\",\n            \"action_parameters\": {\n                \"headers\": {\n                    \"X-Source\": {\n                        \"operation\": \"set\",\n                        \"value\": \"Cloudflare\"\n                    }\n                }\n            }\n        }\n    ]\n  }'\njson\n{\n  \"result\": {\n    \"id\": \"<RULESET_ID>\",\n    \"name\": \"Zone-level Response Headers Transform Ruleset\",\n    \"description\": \"Zone-level ruleset that will execute Response Header Transform Rules.\",\n    \"kind\": \"zone\",\n    \"version\": \"2\",\n    \"rules\": [\n      {\n        \"ref\": \"set_resp_header_source\",\n        \"id\": \"<RULE_ID>\",\n        \"version\": \"1\",\n        \"action\": \"rewrite\",\n        \"action_parameters\": {\n          \"headers\": {\n            \"X-Source\": {\n              \"operation\": \"set\",\n              \"value\": \"Cloudflare\"\n            }\n          }\n        },\n        \"expression\": \"(starts_with(http.request.uri.path, \\\"/en/\\\"))\",\n        \"description\": \"My first response header transform rule\",\n        \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n        \"ref\": \"<RULE_REF>\"\n      }\n    ],\n    \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n    \"phase\": \"http_response_headers_transform\"\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/rulesets/$RULESET_ID\" \\\n  --request PUT \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"rules\": [\n        {\n            \"ref\": \"set_resp_header_bot_score\",\n            \"expression\": \"(starts_with(http.request.uri.path, \\\"/en/\\\"))\",\n            \"description\": \"My first response header transform rule\",\n            \"action\": \"rewrite\",\n            \"action_parameters\": {\n                \"headers\": {\n                    \"X-Bot-Score\": {\n                        \"operation\": \"set\",\n                        \"expression\": \"to_string(cf.bot_management.score)\"\n                    }\n                }\n            }\n        }\n    ]\n  }'\njson\n{\n  \"result\": {\n    \"id\": \"<RULESET_ID>\",\n    \"name\": \"Zone-level Response Headers Transform Ruleset\",\n    \"description\": \"Zone-level ruleset that will execute Response Header Transform Rules.\",\n    \"kind\": \"zone\",\n    \"version\": \"2\",\n    \"rules\": [\n      {\n        \"ref\": \"set_resp_header_bot_score\",\n        \"id\": \"<RULE_ID>\",\n        \"version\": \"1\",\n        \"action\": \"rewrite\",\n        \"action_parameters\": {\n          \"headers\": {\n            \"X-Bot-Score\": {\n              \"operation\": \"set\",\n              \"expression\": \"to_string(cf.bot_management.score)\"\n            }\n          }\n        },\n        \"expression\": \"(starts_with(http.request.uri.path, \\\"/en/\\\"))\",\n        \"description\": \"My first response header transform rule\",\n        \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n        \"ref\": \"<RULE_REF>\"\n      }\n    ],\n    \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n    \"phase\": \"http_response_headers_transform\"\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/rulesets/$RULESET_ID\" \\\n  --request PUT \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"rules\": [\n        {\n            \"ref\": \"add_resp_header_set_mycookie\",\n            \"expression\": \"(starts_with(http.request.uri.path, \\\"/en/\\\"))\",\n            \"description\": \"My first response header transform rule\",\n            \"action\": \"rewrite\",\n            \"action_parameters\": {\n                \"headers\": {\n                    \"set-cookie\": {\n                        \"operation\": \"add\",\n                        \"value\": \"mycookie=custom_value\"\n                    }\n                }\n            }\n        }\n    ]\n  }'\njson\n{\n  \"result\": {\n    \"id\": \"<RULESET_ID>\",\n    \"name\": \"Zone-level Response Headers Transform Ruleset\",\n    \"description\": \"Zone-level ruleset that will execute Response Header Transform Rules.\",\n    \"kind\": \"zone\",\n    \"version\": \"2\",\n    \"rules\": [\n      {\n        \"ref\": \"add_resp_header_set_mycookie\",\n        \"id\": \"<RULE_ID>\",\n        \"version\": \"1\",\n        \"action\": \"rewrite\",\n        \"action_parameters\": {\n          \"headers\": {\n            \"set-cookie\": {\n              \"operation\": \"add\",\n              \"value\": \"mycookie=custom_value\"\n            }\n          }\n        },\n        \"expression\": \"(starts_with(http.request.uri.path, \\\"/en/\\\"))\",\n        \"description\": \"My first response header transform rule\",\n        \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n        \"ref\": \"<RULE_REF>\"\n      }\n    ],\n    \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n    \"phase\": \"http_response_headers_transform\"\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/rulesets/$RULESET_ID\" \\\n  --request PUT \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"rules\": [\n        {\n            \"ref\": \"remove_resp_header_cf_connecting_ip\",\n            \"expression\": \"(starts_with(http.request.uri.path, \\\"/en/\\\"))\",\n            \"description\": \"My first response header transform rule\",\n            \"action\": \"rewrite\",\n            \"action_parameters\": {\n                \"headers\": {\n                    \"cf-connecting-ip\": {\n                        \"operation\": \"remove\"\n                    }\n                }\n            }\n        }\n    ]\n  }'\njson\n{\n  \"result\": {\n    \"id\": \"<RULESET_ID>\",\n    \"name\": \"Zone-level Response Headers Transform Ruleset\",\n    \"description\": \"Zone-level ruleset that will execute Response Header Transform Rules.\",\n    \"kind\": \"zone\",\n    \"version\": \"2\",\n    \"rules\": [\n      {\n        \"ref\": \"remove_resp_header_cf_connecting_ip\",\n        \"id\": \"<RULE_ID>\",\n        \"version\": \"1\",\n        \"action\": \"rewrite\",\n        \"action_parameters\": {\n          \"headers\": {\n            \"cf-connecting-ip\": {\n              \"operation\": \"remove\"\n            }\n          }\n        },\n        \"expression\": \"(starts_with(http.request.uri.path, \\\"/en/\\\"))\",\n        \"description\": \"My first response header transform rule\",\n        \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n        \"ref\": \"<RULE_REF>\"\n      }\n    ],\n    \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n    \"phase\": \"http_response_headers_transform\"\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/rulesets/$RULESET_ID\" \\\n  --request PUT \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"rules\": [\n        {\n            \"ref\": \"rewrite_eu_to_emea\",\n            \"expression\": \"(http.request.uri.query contains \\\"eu\\\")\",\n            \"description\": \"My first static URL rewrite rule\",\n            \"action\": \"rewrite\",\n            \"action_parameters\": {\n                \"uri\": {\n                    \"path\": {\n                        \"value\": \"/emea.html\"\n                    }\n                }\n            }\n        }\n    ]\n  }'\njson\n{\n  \"result\": {\n    \"ref\": \"rewrite_eu_to_emea\",\n    \"id\": \"<RULESET_ID>\",\n    \"name\": \"Zone-level Transform Ruleset\",\n    \"description\": \"Zone-level ruleset that will execute Transform Rules.\",\n    \"kind\": \"zone\",\n    \"version\": \"2\",\n    \"rules\": [\n      {\n        \"id\": \"<RULE_ID>\",\n        \"version\": \"1\",\n        \"action\": \"rewrite\",\n        \"action_parameters\": {\n          \"uri\": {\n            \"path\": {\n              \"value\": \"/emea.html\"\n            }\n          }\n        },\n        \"expression\": \"(http.request.uri.query contains \\\"eu\\\")\",\n        \"description\": \"My first static URL rewrite rule\",\n        \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n        \"ref\": \"<RULE_REF>\"\n      }\n    ],\n    \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n    \"phase\": \"http_request_transform\"\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/rulesets/$RULESET_ID\" \\\n  --request PUT \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"rules\": [\n        {\n            \"ref\": \"rewrite_2012_to_archive\",\n            \"expression\": \"starts_with(http.request.uri.path, \\\"/news/2012/\\\")\",\n            \"description\": \"My first dynamic URL rewrite rule\",\n            \"action\": \"rewrite\",\n            \"action_parameters\": {\n                \"uri\": {\n                    \"path\": {\n                        \"expression\": \"concat(\\\"/archive\\\", http.request.uri.path)\"\n                    }\n                }\n            }\n        }\n    ]\n  }'\njson\n{\n  \"result\": {\n    \"id\": \"<RULESET_ID>\",\n    \"name\": \"Zone-level Transform Ruleset\",\n    \"description\": \"Zone-level ruleset that will execute Transform Rules.\",\n    \"kind\": \"zone\",\n    \"version\": \"2\",\n    \"rules\": [\n      {\n        \"ref\": \"rewrite_2012_to_archive\",\n        \"id\": \"<RULE_ID>\",\n        \"version\": \"1\",\n        \"action\": \"rewrite\",\n        \"action_parameters\": {\n          \"uri\": {\n            \"path\": {\n              \"expression\": \"concat(\\\"/archive\\\", http.request.uri.path)\"\n            }\n          }\n        },\n        \"expression\": \"starts_with(http.request.uri.path, \\\"/news/2012/\\\")\",\n        \"description\": \"My first dynamic URL rewrite rule\",\n        \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n        \"ref\": \"<RULE_REF>\"\n      }\n    ],\n    \"last_updated\": \"2021-04-14T14:42:04.219025Z\",\n    \"phase\": \"http_request_transform\"\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\njs\nconst NAME = \"myExampleABTest\";\n\nexport default {\n  async fetch(request) {\n    // Clone the original URL\n    const url = new URL(request.url);\n\n// Enable Passthrough to allow direct access to control and test routes.\n    if (url.pathname.startsWith(\"/control\") || url.pathname.startsWith(\"/test\"))\n      return fetch(request);\n\n// Determine which group this requester is in.\n    const cookie = request.headers.get(\"cookie\");\n\nif (cookie && cookie.includes(`${NAME}=control`)) {\n      url.pathname = \"/control\" + url.pathname;\n    } else if (cookie && cookie.includes(`${NAME}=test`)) {\n      url.pathname = \"/test\" + url.pathname;\n    } else {\n      // If there is no cookie, this is a new client. Choose a group and set the cookie.\n      const group = Math.random() < 0.5 ? \"test\" : \"control\"; // 50/50 split\n      if (group === \"control\") {\n        url.pathname = \"/control\" + url.pathname;\n      } else {\n        url.pathname = \"/test\" + url.pathname;\n      }\n      // Reconstruct response to avoid immutability\n      let response = await fetch(url);\n      response = new Response(response.body, response);\n      // Set cookie to enable persistent A/B sessions.\n      response.headers.append(\"Set-Cookie\", `${NAME}=${group}; path=/`);\n      return response;\n    }\n    return fetch(url);\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    const response = await fetch(request);\n\n// Clone the response so that it is no longer immutable\n    const newResponse = new Response(response.body, response);\n\n// Define the dynamic expiry time. 24 h * 60 m * 60 s * 1000 ms = 86,400,000 ms\n    const expiry = new Date(Date.now() + 7 * 86400000).toUTCString();\n    // Define the group variable. \"A\" if the request header \"userGroup\" is \"premium\", \"B\" if otherwise.\n    const group = request.headers.get(\"userGroup\") == \"premium\" ? \"A\" : \"B\";\n\n// Append the custom header with the values\n    newResponse.headers.append(\n      \"Set-Cookie\",\n      `testGroup=${group}; Expires=${expiry}; Path=/`,\n    );\n\nreturn newResponse;\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    /**\n     * @param {string} PRESHARED_AUTH_HEADER_KEY Custom header to check for key\n     * @param {string} PRESHARED_AUTH_HEADER_VALUE Hard-coded key value\n     */\n    const PRESHARED_AUTH_HEADER_KEY = \"X-Custom-PSK\";\n    const PRESHARED_AUTH_HEADER_VALUE = \"mypresharedkey\";\n    const psk = request.headers.get(PRESHARED_AUTH_HEADER_KEY);\n\nif (psk === PRESHARED_AUTH_HEADER_VALUE) {\n      // Correct preshared header key supplied. Fetch request from origin.\n      return fetch(request);\n    }\n\n// Incorrect key supplied. Reject the request.\n    return new Response(\"Sorry, you have supplied an invalid key.\", {\n      status: 403,\n    });\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // Clone the original request to construct a new request\n    const newRequest = new Request(request);\n    // Set Bot Management headers on a new request to the origin: https://developers.cloudflare.com/bots/reference/bot-management-variables/#workers-variables\n    newRequest.headers.set(\"bot-score\", request.cf.botManagement.score); // bot score (integer)\n    newRequest.headers.set(\n      \"verified-bot\",\n      request.cf.botManagement.verifiedBot,\n    ); // verified bot (boolean)\n    newRequest.headers.set(\"ja4\", request.cf.botManagement.ja4); // JA4 fingerprint hash (string)\n    // Serve response to the new request from the origin\n    return await fetch(newRequest);\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    const response = await fetch(request);\n\n// Clone the response so that it is no longer immutable\n    const newResponse = new Response(response.body, response);\n\nif (request.cf.botManagement.score < 30) {\n      const honeypot = \"https://example.com/\";\n      return await fetch(honeypot, request);\n    } else {\n      return newResponse;\n    }\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // Define a variable with the hostname that needs to be redirected.\n    const externalHostname = \"example.com\";\n\n// Define the map object. Replace the sources (/pathX) and targets (/redirectX) with ones that apply to your case.\n    const redirectMap = new Map([\n      [\"/path1\", \"https://\" + externalHostname + \"/redirect1\"],\n      [\"/path2\", \"https://\" + externalHostname + \"/redirect2\"],\n      [\"/path3\", \"https://\" + externalHostname + \"/redirect3\"],\n      [\"/path4\", \"https://cloudflare.com\"],\n    ]);\n\n// Clone the original URL.\n    const requestURL = new URL(request.url);\n\n// Check the request path against the map and redirect accordingly.\n    const path = requestURL.pathname;\n    const location = redirectMap.get(path);\n\nif (location) {\n      return Response.redirect(location, 301);\n    }\n\n// If request path not in map, return the original request.\n    return fetch(request);\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    /**\n     * A map of the URLs to redirect to\n     * @param {Object} countryMap\n     */\n    const countryMap = {\n      // Replace the country codes and target URLs with ones that apply to your case.\n      US: \"https://example.com/us\",\n      EU: \"https://example.com/eu\",\n    };\n\n// Use the cf object to obtain the country of the request\n    // more on the cf object: https://developers.cloudflare.com/workers/runtime-apis/request#incomingrequestcfproperties\n    const country = request.cf.country;\n\n// If country is not null and is defined in the country map above, redirect.\n    if (country != null && country in countryMap) {\n      const url = countryMap[country];\n      // Remove this logging statement from your final output.\n      console.log(\n        `Based on ${country}-based request, your user would go to ${url}.`,\n      );\n      return Response.redirect(url);\n\n// If request country not in map, return another page.\n    } else {\n      return fetch(\"https://example.com\", request);\n    }\n  },\n};\njs\n// Define configurable cache duration in seconds (default: 30 days)\nconst CACHE_DURATION_SECONDS = 30 * 24 * 60 * 60;\n\n// Define which parts of the request to include in the cache key\nconst USE_PATH = true; // Include path in the cache key\nconst USE_QUERY_STRING = true; // Include query string in the cache key\nconst INCLUDE_HEADERS = [\"User-Agent\"]; // Headers to include in the cache key\n\nexport default {\n  async fetch(request, env, ctx) {\n    // Generate a custom cache key based on user preferences\n    const cacheKey = createCacheKey(request);\n    console.log(`Retrieving cache for: ${cacheKey.url}.`);\n\n// Access the default Cache API\n    const cache = caches.default;\n\n// Attempt to retrieve the cached response\n    let response = await cache.match(cacheKey);\n\nif (!response) {\n      // Cache miss: Fetch the asset from the origin\n      console.log(`Cache miss for: ${cacheKey.url}. Fetching from origin...`);\n      response = await fetch(request);\n\n// Wrap the origin response for caching\n      response = new Response(response.body, response);\n\n// Set Cache-Control headers to define the TTL\n      response.headers.set(\n        \"Cache-Control\",\n        `s-maxage=${CACHE_DURATION_SECONDS}`,\n      );\n      response.headers.set(\"x-snippets-cache\", \"stored\");\n\n// Store the response in the cache\n      await cache.put(cacheKey, response.clone());\n    } else {\n      // Cache hit: Return the cached response\n      console.log(`Cache hit for: ${cacheKey.url}.`);\n      response = new Response(response.body, response);\n      response.headers.set(\"x-snippets-cache\", \"hit\");\n\n// Optionally check if the cache should expire based on age\n      const ageHeader = response.headers.get(\"Age\");\n      if (ageHeader && parseInt(ageHeader, 10) > CACHE_DURATION_SECONDS) {\n        console.log(\n          `Cache expired for: ${cacheKey.url}. Deleting cached response...`,\n        );\n        await cache.delete(cacheKey);\n        response.headers.set(\"x-snippets-cache\", \"deleted\");\n      }\n    }\n\n// Return the response to the client\n    return response;\n  },\n};\n\n/**\n * Function to create a custom cache key based on request properties\n * @param {Request} request - The incoming request object\n * @returns {Request} - A valid cache key based on the URL\n */\nfunction createCacheKey(request) {\n  const url = new URL(request.url); // Use the request's base URL\n  const cacheKey = new URL(url.origin); // Start with the origin (scheme + hostname)\n\n// Optionally include the path\n  if (USE_PATH) {\n    cacheKey.pathname = url.pathname;\n  }\n\n// Optionally include the query string\n  if (USE_QUERY_STRING) {\n    cacheKey.search = url.search;\n  }\n\n// Optionally include specific headers\n  if (INCLUDE_HEADERS.length > 0) {\n    const headerParts = INCLUDE_HEADERS.map(\n      (header) => `${header}=${request.headers.get(header) || \"\"}`,\n    ).join(\"&\");\n    cacheKey.searchParams.append(\"headers\", headerParts);\n  }\n\n// Return the constructed URL as the cache key\n  return new Request(cacheKey.toString(), {\n    method: \"GET\",\n  });\n}\njs\n// Replace with your actual logging service endpoint\nconst loggingEndpoint = \"https://your-logging-endpoint\";\n\nexport default {\n  async fetch(request) {\n    try {\n      // Attempt to fetch the request from the origin server\n      const response = await fetch(request.clone());\n\n// Check if the response status indicates an error (for example, 4xx or 5xx)\n      if (!response.ok) {\n        // Prepare error details and context for logging\n        const errorDetails = {\n          status: response.status,\n          statusText: response.statusText,\n          url: request.url,\n          method: request.method,\n          headers: Object.fromEntries(request.headers),\n        };\n\n// Log error details to your logging service\n        await logError(errorDetails);\n\n// Return the original response with status and statusText intact\n        return new Response(response.body, {\n          status: response.status,\n          statusText: response.statusText,\n          headers: response.headers,\n        });\n      }\n\n// Return the successful response from the origin server\n      return response;\n    } catch (error) {\n      // Handle any exceptions that occur during fetch\n      const errorDetails = {\n        message: error.message,\n        stack: error.stack,\n        url: request.url,\n        method: request.method,\n        headers: Object.fromEntries(request.headers),\n      };\n\n// Log error details to your logging service\n      await logError(errorDetails);\n\n// Return a generic error response\n      return new Response(\"Internal Server Error\", {\n        status: 500,\n      });\n    }\n  },\n};\n\n// Function to log error details to your logging service\nasync function logError(details) {\n  try {\n    const response = await fetch(loggingEndpoint, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(details),\n    });\n\nif (!response.ok) {\n      console.error(\"Failed to log error:\", response.statusText);\n    }\n  } catch (error) {\n    console.error(\"Error logging error:\", error.message);\n  }\n}\njs\n// Define CORS headers\nconst corsHeaders = {\n  \"Access-Control-Allow-Origin\": \"*\", // Replace * with your allowed origin(s)\n  \"Access-Control-Allow-Methods\": \"GET, POST, PUT, DELETE, OPTIONS\", // Adjust allowed methods as needed\n  \"Access-Control-Allow-Headers\": \"Content-Type, Authorization\", // Adjust allowed headers as needed\n  \"Access-Control-Max-Age\": \"86400\", // Adjust max age (in seconds) as needed\n};\n\nexport default {\n  async fetch(request) {\n    // Make a copy of the request to modify its headers\n    const modifiedRequest = new Request(request);\n\n// Handle preflight requests (OPTIONS)\n    if (request.method === \"OPTIONS\") {\n      return new Response(null, {\n        headers: {\n          ...corsHeaders,\n        },\n        status: 200, // Respond with OK status for preflight requests\n      });\n    }\n\n// Pass the modified request through to the origin\n    const response = await fetch(modifiedRequest);\n\n// Make a copy of the response to modify its headers\n    const modifiedResponse = new Response(response.body, response);\n\n// Set CORS headers on the response\n    Object.keys(corsHeaders).forEach((header) => {\n      modifiedResponse.headers.set(header, corsHeaders[header]);\n    });\n\nreturn modifiedResponse;\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // Define fetch options to follow redirects\n    const fetchOptions = {\n      redirect: \"follow\", // Ensure fetch follows redirects automatically. Each subrequest in a redirect chain counts against the subrequest limit.\n    };\n\n// Make the fetch request to the origin\n    const response = await fetch(request, fetchOptions);\n\n// Log the final URL after redirects (optional, for debugging)\n    console.log(`Final URL after redirects: ${response.url}`);\n\n// Return the final response to the client\n    return response;\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // Get the current timestamp\n    const timestamp = Date.now();\n\n// Convert the timestamp to hexadecimal format\n    const hexTimestamp = timestamp.toString(16);\n\n// Clone the request and add the custom header\n    const modifiedRequest = new Request(request, {\n      headers: new Headers(request.headers),\n    });\n    modifiedRequest.headers.set(\"X-Hex-Timestamp\", hexTimestamp);\n\n// Log the custom header for debugging\n    console.log(`X-Hex-Timestamp: ${hexTimestamp}`);\n\n// Pass the modified request to the origin\n    const response = await fetch(modifiedRequest);\n\nreturn response;\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // Extract JWT token from \"Authorization: Bearer\" header\n    function getJWTToken(request) {\n      const authorizationHeader = request.headers.get(\"Authorization\");\n      if (authorizationHeader && authorizationHeader.startsWith(\"Bearer \")) {\n        return authorizationHeader.substring(7, authorizationHeader.length);\n      }\n      return null;\n    }\n\n// Validate that JWT token has correct format: header.payload.signature (for example: \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNjI0OTkyMDAwLCJleHAiOjE2MjI1MDAwMDB9.TldRGokRHJvG69SefbxIqAlQ6nnco6aLa3y7jsYXHMI\")\n    function validateJWT(token) {\n      const [header, payload, signature] = token.split(\".\");\n\nif (!header || !payload || !signature) {\n        throw new Error(\"Invalid JWT format\");\n      }\n\n// Decode the JWT payload and header to JSON\n      const decodedHeader = JSON.parse(atob(header));\n      const decodedPayload = JSON.parse(atob(payload));\n\n// Here you would implement the logic to verify the JWT signature.\n      // This example assumes a simple validation that just checks the payload.\n      // Replace the following lines with your actual validation logic.\n\n// Ensure that JWT token hasn't expired (to test, try sending a request with an expired token \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNjI0OTkyMDAwLCJleHAiOjE2MjI1MDAwMDB9.TldRGokRHJvG69SefbxIqAlQ6nnco6aLa3y7jsYXHMI\")\n      if (decodedPayload.exp < Math.floor(Date.now() / 1000)) {\n        throw new Error(\"JWT has expired\");\n      }\n\n// Optionally, you could add more validation checks here (issuer, audience, etc.).\n      // Also, implement actual signature validation with a custom function.\n\n// Execute the function to extract JWT token\n    const jwtToken = getJWTToken(request);\n\n// If the token is not provided, serve 401 Forbidden\n    if (!jwtToken) {\n      return new Response(\"Missing JWT token\", { status: 401 });\n    }\n\n// Execute the function to validate the token\n    try {\n      const validToken = await validateJWT(jwtToken);\n      if (validToken) {\n        // If the token is valid, serve actual response\n        // An example of a valid token that will expire in 2033 is \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNjI0OTkyMDAwLCJleHAiOjIwMDExMjAwMDB9._qgQ_TMrGfYgOoA8HtTZwEGoj8zAPWxsz8CT1jEAGzo\"\n        return fetch(request);\n      } else {\n        return new Response(\"Invalid JWT token\", { status: 401 });\n      }\n    } catch (error) {\n      return new Response(\"Error validating token: \" + error.message, {\n        status: 500,\n      });\n    }\n  },\n};\njs\n// Define your customizable inputs\nconst statusCode = 503;\nconst title = \"We'll Be Right Back!\";\nconst message =\n  \"Our site is currently undergoing scheduled maintenance. Weâ€™re working hard to bring you a better experience. Thank you for your patience and understanding.\";\nconst estimatedTime = \"1 hour\";\nconst contactEmail = \"support@example.com\";\nconst contactPhone = \"+1 234 567 89\";\n\nexport default {\n  async fetch(request) {\n    // Serve the maintenance page as a response\n    return new Response(generateMaintenancePage(), {\n      status: statusCode,\n      headers: {\n        \"Content-Type\": \"text/html\",\n        \"Retry-After\": \"3600\", // Suggest retry after 1 hour\n      },\n    });\n  },\n};\n\nfunction generateMaintenancePage() {\n  return `\n    <!DOCTYPE html>\n    <html lang=\"en\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>${title}</title>\n        <style>\n            body {\n                margin: 0;\n                font-family: Arial, sans-serif;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                height: 100vh;\n                background-color: #f4f4f4;\n                color: #333;\n                text-align: center;\n            }\n            .container {\n                max-width: 600px;\n                padding: 20px;\n            }\n            h1 {\n                font-size: 2rem;\n                color: #0056b3;\n                margin-bottom: 10px;\n            }\n            p {\n                font-size: 1rem;\n                margin-bottom: 20px;\n                line-height: 1.5;\n            }\n            .contact {\n                margin-top: 20px;\n                font-size: 0.9rem;\n                color: #666;\n            }\n            .contact a {\n                color: #0056b3;\n                text-decoration: none;\n            }\n            .contact a:hover {\n                text-decoration: underline;\n            }\n            .logo {\n                margin: 20px 0;\n                max-width: 150px;\n            }\n            .timer {\n                font-weight: bold;\n                color: #e63946;\n            }\n        </style>\n    </head>\n    <body>\n        <div class=\"container\">\n            <h1>${title}</h1>\n            <p>${message}</p>\n            <p>If all goes to plan, we'll be back online in <span class=\"timer\">${estimatedTime}</span>. ðŸš€</p>\n            <p class=\"contact\">\n                Need help? Reach out to us at <a href=\"mailto:${contactEmail}\">${contactEmail}</a>\n                or call us at <a href=\"tel:${contactPhone}\">${contactPhone}</a>.\n            </p>\n        </div>\n    </body>\n    </html>\n    `;\n}\ntxt\n(not ip.src in $admin_ips)\njs\nexport default {\n  async fetch(request) {\n    // Receive response from the origin\n    const response = await fetch(request);\n\n// Create a new Headers object to modify response headers\n    const newHeaders = new Headers(response.headers);\n\n// Get all Set-Cookie headers\n    const cookieArray = response.headers.getSetCookie();\n    if (cookieArray.length > 0) {\n      const updatedCookies = cookieArray.map((cookie) => {\n        // For example, replace the currency value with GBP\n        if (cookie.trim().startsWith(\"currency=\")) {\n          return cookie.replace(/currency=[^;]+/, \"currency=GBP\");\n        }\n        return cookie;\n      });\n\n// Delete the existing Set-Cookie headers\n      newHeaders.delete(\"Set-Cookie\");\n\n// Add the updated Set-Cookie headers individually\n      updatedCookies.forEach((cookie) => {\n        newHeaders.append(\"Set-Cookie\", cookie.trim());\n      });\n    }\n\n// Return the modified response with updated headers\n    return new Response(response.body, {\n      status: response.status,\n      headers: newHeaders,\n    });\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // Send original request to the origin\n    const response = await fetch(request);\n    // Check if origin responded with 403 status code\n    if (response.status == 403) {\n      // If so, redirect to this URL\n      const destinationURL = \"https://example.com\";\n      // With this status code\n      const statusCode = 301;\n      // Serve redirect\n      return Response.redirect(destinationURL, statusCode);\n    }\n    // Otherwise, serve origin's response\n    else {\n      return response;\n    }\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // Define variables to use in the response redirect.\n    const base = \"https://example.com\";\n    const statusCode = 301;\n\n// Clone the original URL.\n    const url = new URL(request.url);\n\n// Define a \"pathname\" and \"search\" variables, extracting their values from the cloned URL.\n    const { pathname, search } = url;\n\n// Define the destination URL using the variables you declared previously.\n    const destinationURL = `${base}${pathname}${search}`;\n    console.log(destinationURL);\n\n// Respond with the redirect.\n    return Response.redirect(destinationURL, statusCode);\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // Send original request to the origin\n    const response = await fetch(request);\n    // Check if origin responded with JSON\n    try {\n      // Parse API response as JSON\n      var api_response = response.json();\n      // Specify the fields you want to delete. For example, to delete \"botManagement\" array from parsed JSON:\n      delete api_response.botManagement;\n      // Serve modified API response\n      return Response.json(api_response);\n    } catch (err) {\n      // On failure, serve unmodified origin's response\n      return response;\n    }\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // Define the query strings you want to remove\n    const queryStringsToRemove = [\"utm_source\", \"utm_medium\", \"utm_campaign\"];\n\n// Get the URL from the request\n    const url = new URL(request.url);\n\n// Remove the specified query strings\n    queryStringsToRemove.forEach((query) => {\n      url.searchParams.delete(query);\n    });\n\n// Create a new request with the modified URL\n    const modifiedRequest = new Request(url, request);\n\n// Pass the modified request to the origin\n    const response = await fetch(modifiedRequest);\n\nreturn response;\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // Define the prefix of the headers you want to remove\n    const headerPrefix = \"x-header-\";\n\n// Receive response from the origin\n    const response = await fetch(request);\n\n// Create a new Headers object to modify response headers\n    const newHeaders = new Headers(response.headers);\n\n// Remove headers that start with the specified prefix\n    for (const [key] of newHeaders.entries()) {\n      if (key.startsWith(headerPrefix)) {\n        newHeaders.delete(key);\n      }\n    }\n\n// Return the modified response with updated headers\n    return new Response(response.body, {\n      status: response.status,\n      headers: newHeaders,\n    });\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // For any request, respond with JSON object containing all incoming request properties provided by Cloudflare network\n    return Response.json(request.cf, {\n      // Add new header to identify request was served by Snippets\n      headers: {\n        \"x-snippets-hello\": \"Hello from Cloudflare Snippets\",\n      },\n    });\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // Define the old hostname here.\n    const OLD_URL = \"oldsite.com\";\n    // Then add your new hostname that should replace the old one.\n    const NEW_URL = \"newsite.com\";\n\nclass AttributeRewriter {\n      constructor(attributeName) {\n        this.attributeName = attributeName;\n      }\n      element(element) {\n        const attribute = element.getAttribute(this.attributeName);\n        if (attribute) {\n          element.setAttribute(\n            this.attributeName,\n            attribute.replace(OLD_URL, NEW_URL),\n          );\n        }\n      }\n    }\n\nconst rewriter = new HTMLRewriter()\n      .on(\"a\", new AttributeRewriter(\"href\"))\n      .on(\"img\", new AttributeRewriter(\"src\"));\n\nconst res = await fetch(request);\n    if (!res.headers.has(\"Content-Type\")) {\n      return res;\n    }\n    const contentType = res.headers.get(\"Content-Type\");\n    if (typeof contentType !== \"string\") {\n      return res;\n    }\n\n// If the response is HTML, it can be transformed with\n    // HTMLRewriter -- otherwise, it should pass through\n    if (contentType.startsWith(\"text/html\")) {\n      return rewriter.transform(res);\n    } else {\n      return res;\n    }\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // Clone the original request to create a new request object\n    const newRequest = new Request(request);\n\n// Add a header to identify a rerouted request at the new origin\n    newRequest.headers.set(\"X-Rerouted\", \"1\");\n\n// Clone and parse the original URL\n    const url = new URL(request.url);\n\n// Step 1: Reroute to a different origin\n    url.hostname = \"example.com\"; // Change the hostname to the new origin\n\n// Step 2: Append a directory to the path\n    url.pathname = `/new-path${url.pathname}`; // Prepend \"/new-path\" to the current path\n\n// Step 3: Remove a specific segment from the path\n    url.pathname = url.pathname.replace(\"/remove-me\", \"\"); // Rewrite `/remove-me/something` to `/something`\n\n// Fetch the modified request from the updated URL\n    return await fetch(url, newRequest);\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // Define an object with the security headers you want to set.\n    // Refer to https://developers.cloudflare.com/rules/snippets/examples/security-headers/#other-common-security-headers for more options.\n    const DEFAULT_SECURITY_HEADERS = {\n      \"X-Content-Type-Options\": \"nosniff\",\n      \"Referrer-Policy\": \"strict-origin-when-cross-origin\",\n      \"Cross-Origin-Embedder-Policy\": 'require-corp; report-to=\"default\";',\n      \"Cross-Origin-Opener-Policy\": 'same-site; report-to=\"default\";',\n      \"Cross-Origin-Resource-Policy\": \"same-site\",\n    };\n\n// You can also define headers to be deleted.\n    const BLOCKED_HEADERS = [\n      \"Public-Key-Pins\",\n      \"X-Powered-By\",\n      \"X-AspNet-Version\",\n    ];\n\n// Receive response from the origin.\n    let response = await fetch(request);\n\n// Create a new Headers object to modify response headers\n    let newHeaders = new Headers(response.headers);\n\n// This sets the headers for HTML responses:\n    if (\n      newHeaders.has(\"Content-Type\") &&\n      !newHeaders.get(\"Content-Type\").includes(\"text/html\")\n    ) {\n      return new Response(response.body, {\n        status: response.status,\n        statusText: response.statusText,\n        headers: newHeaders,\n      });\n    }\n\n// Use DEFAULT_SECURITY_HEADERS object defined above to set the new security headers.\n    Object.keys(DEFAULT_SECURITY_HEADERS).map((name) => {\n      newHeaders.set(name, DEFAULT_SECURITY_HEADERS[name]);\n    });\n\n// Use the BLOCKED_HEADERS object defined above to delete headers you wish to block.\n    BLOCKED_HEADERS.forEach((name) => {\n      newHeaders.delete(name);\n    });\n\nreturn new Response(response.body, {\n      status: response.status,\n      statusText: response.statusText,\n      headers: newHeaders,\n    });\n  },\n};\njs\n\"Content-Security-Policy\": \"default-src 'self' example.com *.example.com\",\njs\n\"Strict-Transport-Security\" : \"max-age=63072000; includeSubDomains; preload\",\njs\n\"Permissions-Policy\": \"interest-cohort=()\",\njs\n\"X-XSS-Protection\": \"0\",\njs\n\"X-Frame-Options\": \"DENY\",\njs\nexport default {\n  async fetch(request) {\n    // Get the current timestamp\n    const timestamp = Date.now();\n\n// Convert the timestamp to hexadecimal format\n    const hexTimestamp = timestamp.toString(16);\n\n// Clone the request and add the custom header\n    const modifiedRequest = new Request(request, {\n      headers: new Headers(request.headers),\n    });\n    modifiedRequest.headers.set(\"X-Hex-Timestamp\", hexTimestamp);\n\n// Log the custom header for debugging\n    console.log(`X-Hex-Timestamp: ${hexTimestamp}`);\n\n// Pass the modified request to the origin\n    const response = await fetch(modifiedRequest);\n\nreturn response;\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // Send original request to the origin\n    const response = await fetch(request);\n\n// If response is not 200 OK or a redirect, send to another origin\n    if (!response.ok && !response.redirected) {\n      // First, clone the original request to construct a new request\n      const newRequest = new Request(request);\n      // Add a header to identify a re-routed request at the new origin\n      newRequest.headers.set(\"X-Rerouted\", \"1\");\n      // Clone the original URL\n      const url = new URL(request.url);\n      // Send request to a different origin / hostname\n      url.hostname = \"example.com\";\n      // Serve response to the new request from the origin\n      return await fetch(url, newRequest);\n    }\n\n// If response is 200 OK or a redirect, serve it\n    return response;\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    const secretKey = \"your_secret_key\"; // Replace with your actual secret key\n    const expiration = 60; // Expiration time in seconds (how long an HMAC token should be valid for)\n\nconst encoder = new TextEncoder();\n\n// Import the secret key for HMAC-SHA256 signing\n    const key = await crypto.subtle.importKey(\n      \"raw\",\n      encoder.encode(secretKey),\n      { name: \"HMAC\", hash: \"SHA-256\" },\n      false,\n      [\"sign\", \"verify\"],\n    );\n\nconst url = new URL(request.url);\n\n// Check if the request URL starts with /generate/\n    if (url.pathname.startsWith(\"/generate/\")) {\n      // Replace /generate/ with /\n      url.pathname = url.pathname.replace(\"/generate/\", \"/\");\n\nconst currentTimestamp = Math.floor(Date.now() / 1000); // Current timestamp in seconds\n\n// Data to authenticate: combine pathname and timestamp\n      const dataToAuthenticate = `${url.pathname}${currentTimestamp}`;\n\n// Sign the data with HMAC-SHA256\n      const signature = await crypto.subtle.sign(\n        \"HMAC\",\n        key,\n        encoder.encode(dataToAuthenticate),\n      );\n\n// Encode the timestamp and HMAC in a secure manner\n      const signatureBase64 = btoa(\n        String.fromCharCode(...new Uint8Array(signature)),\n      );\n      const signedData = `${currentTimestamp}-${signatureBase64}`;\n      const encodedSignedData = encodeURIComponent(signedData);\n\n// Create the signed URL\n      const signedURL = `${url}?verify=${encodedSignedData}`;\n\n// Return the signed URL in the response body\n      return new Response(signedURL, { status: 200 });\n    }\n\n// For all other request URLs, verify the signed URL\n    const params = new URLSearchParams(url.search);\n    const verifyParam = params.get(\"verify\");\n\nif (!verifyParam) {\n      return new Response(\"Verification parameter is missing\", { status: 403 });\n    }\n\n// Decode and split the verify parameter into timestamp and HMAC\n    const decodedVerifyParam = decodeURIComponent(verifyParam);\n    const [timestampStr, receivedMac] = decodedVerifyParam.split(\"-\");\n\n// Parse timestamp and ensure it's a valid number\n    const timestamp = parseInt(timestampStr, 10);\n    if (isNaN(timestamp)) {\n      return new Response(\"Invalid timestamp\", { status: 403 });\n    }\n\n// Check if the request has expired\n    const currentTimestamp = Math.floor(Date.now() / 1000);\n    if (currentTimestamp > timestamp + expiration) {\n      return new Response(\"Signed URL has expired\", { status: 403 });\n    }\n\n// Remove the verify parameter to verify the URL\n    params.delete(\"verify\");\n    url.search = params.toString();\n\n// Construct the data to authenticate for verification\n    const dataToVerify = `${url.pathname}${timestamp}`;\n\n// Verify the signature with HMAC-SHA256\n    const isValid = await crypto.subtle.verify(\n      \"HMAC\",\n      key,\n      new Uint8Array([...atob(receivedMac)].map((char) => char.charCodeAt(0))),\n      encoder.encode(dataToVerify),\n    );\n\nif (!isValid) {\n      return new Response(\"Invalid signature\", { status: 403 });\n    }\n\n// Continue processing the request if the signature is valid\n    return fetch(request);\n  },\n};\njs\nexport default {\n  async fetch(request) {\n    // Define delay\n    const delay_in_seconds = 5;\n    // Introduce a delay\n    await new Promise((resolve) =>\n      setTimeout(resolve, delay_in_seconds * 1000),\n    ); // Set delay in milliseconds\n\n// Pass the request to the origin\n    const response = await fetch(request);\n    return response;\n  },\n};\ntxt\n(cf.bot_management.score lt 10)\ntxt\nhttp.request.full_uri in $<LIST_NAME>\ntxt\nip.src.country == \"GB\" and http.request.full_uri in $<LIST_NAME>\nbash\ncurl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/rules/lists\" \\\n  --request POST \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"name\": \"my_redirect_list\",\n    \"description\": \"My redirect list.\",\n    \"kind\": \"redirect\"\n  }'\njson\n{\n  \"result\": {\n    \"id\": \"f848b6ccb07647749411f504d6f88794\",\n    \"name\": \"my_redirect_list\",\n    \"description\": \"My redirect list.\",\n    \"kind\": \"redirect\",\n    \"num_items\": 0,\n    \"num_referencing_filters\": 0,\n    \"created_on\": \"2021-10-28T09:11:42Z\",\n    \"modified_on\": \"2021-10-28T09:11:42Z\"\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/rules/lists/f848b6ccb07647749411f504d6f88794/items\" \\\n  --request POST \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '[\n    {\n        \"redirect\": {\n            \"source_url\": \"example.com/blog/\",\n            \"target_url\": \"https://example.com/blog/latest\"\n        }\n    },\n    {\n        \"redirect\": {\n            \"source_url\": \"example.net/\",\n            \"target_url\": \"https://example.net/under-construction.html\",\n            \"status_code\": 307\n        }\n    }\n  ]'\njson\n{\n  \"result\": {\n    \"operation_id\": \"92558f8b296d4dbe9d0419e0e53f6622\"\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/rules/lists/bulk_operations/92558f8b296d4dbe9d0419e0e53f6622\" \\\n  --request GET \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\"\njson\n{\n  \"result\": {\n    \"id\": \"92558f8b296d4dbe9d0419e0e53f6622\",\n    \"status\": \"completed\",\n    \"completed\": \"2021-10-28T09:15:42Z\"\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/rulesets\" \\\n  --request POST \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"name\": \"My redirect ruleset\",\n    \"kind\": \"root\",\n    \"phase\": \"http_request_redirect\",\n    \"rules\": [\n        {\n            \"ref\": \"enable_my_redirect_list\",\n            \"expression\": \"http.request.full_uri in $my_redirect_list\",\n            \"description\": \"Bulk Redirect rule.\",\n            \"action\": \"redirect\",\n            \"action_parameters\": {\n                \"from_list\": {\n                    \"name\": \"my_redirect_list\",\n                    \"key\": \"http.request.full_uri\"\n                }\n            }\n        }\n    ]\n  }'\njson\n{\n  \"result\": {\n    \"id\": \"528f4f03bf0da53a29907199625867be\",\n    \"name\": \"My redirect ruleset\",\n    \"kind\": \"root\",\n    \"version\": \"1\",\n    \"rules\": [\n      {\n        \"ref\": \"enable_my_redirect_list\",\n        \"id\": \"8da312df846b4258a05bcd454ea943be\",\n        \"version\": \"1\",\n        \"expression\": \"http.request.full_uri in $my_redirect_list\",\n        \"description\": \"Bulk Redirect rule.\",\n        \"action\": \"redirect\",\n        \"action_parameters\": {\n          \"from_list\": {\n            \"name\": \"my_redirect_list\",\n            \"key\": \"http.request.full_uri\"\n          }\n        },\n        \"last_updated\": \"2021-10-28T09:20:42Z\"\n      }\n    ],\n    \"last_updated\": \"2021-10-28T09:20:42Z\",\n    \"phase\": \"http_request_redirect\"\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/rulesets/$RULESET_ID\" \\\n  --request PUT \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"name\": \"My redirect ruleset\",\n    \"kind\": \"root\",\n    \"phase\": \"http_request_redirect\",\n    \"rules\": [\n        {\n            \"ref\": \"eval_redirects_list_1\",\n            \"expression\": \"http.request.full_uri in $my_redirect_list_1\",\n            \"description\": \"Bulk Redirect rule 1\",\n            \"action\": \"redirect\",\n            \"action_parameters\": {\n                \"from_list\": {\n                    \"name\": \"my_redirect_list_1\",\n                    \"key\": \"http.request.full_uri\"\n                }\n            }\n        },\n        {\n            \"ref\": \"eval_redirects_list_2\",\n            \"expression\": \"http.request.full_uri in $my_redirect_list_2\",\n            \"description\": \"Bulk Redirect rule 2\",\n            \"action\": \"redirect\",\n            \"action_parameters\": {\n                \"from_list\": {\n                    \"name\": \"my_redirect_list_2\",\n                    \"key\": \"http.request.full_uri\"\n                }\n            }\n        }\n    ]\n  }'\njson\n{\n  \"result\": {\n    \"id\": \"67013aa153df4e5fbda92f92bc979331\",\n    \"name\": \"default\",\n    \"description\": \"\",\n    \"kind\": \"root\",\n    \"version\": \"2\",\n    \"rules\": [\n      {\n        \"ref\": \"eval_redirects_list_1\",\n        \"id\": \"8be62ab2ef9a4a41af30c24ff8e73e41\",\n        \"version\": \"1\",\n        \"action\": \"redirect\",\n        \"action_parameters\": {\n          \"from_list\": {\n            \"name\": \"my_redirect_list_1\",\n            \"key\": \"http.request.full_uri\"\n          }\n        },\n        \"expression\": \"http.request.full_uri in $my_redirect_list_1\",\n        \"description\": \"Bulk Redirect rule 1\",\n        \"last_updated\": \"2021-12-03T15:38:51.658387Z\",\n        \"ref\": \"8be62ab2ef9a4a41af30c24ff8e73e41\",\n        \"enabled\": true\n      },\n      {\n        \"ref\": \"eval_redirects_list_2\",\n        \"id\": \"97e38797fb2b4b22a4919800f1318a5c\",\n        \"version\": \"1\",\n        \"action\": \"redirect\",\n        \"action_parameters\": {\n          \"from_list\": {\n            \"name\": \"my_redirect_list_2\",\n            \"key\": \"http.request.full_uri\"\n          }\n        },\n        \"expression\": \"http.request.full_uri in $my_redirect_list_2\",\n        \"description\": \"Bulk Redirect rule 2\",\n        \"last_updated\": \"2021-12-03T15:38:51.658387Z\",\n        \"ref\": \"97e38797fb2b4b22a4919800f1318a5c\",\n        \"enabled\": true\n      }\n    ],\n    \"last_updated\": \"2021-12-03T15:38:51.658387Z\",\n    \"phase\": \"http_request_redirect\"\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\ntf",
  "code_samples": [
    {
      "code": "Use the `ref` field to get stable rule IDs across updates when using Terraform. Adding this field prevents Terraform from recreating the rule on changes. For more information, refer to [Troubleshooting](https://developers.cloudflare.com/terraform/troubleshooting/rule-id-changes/#how-to-keep-the-same-rule-id-between-modifications) in the Terraform documentation.\n\n## Additional resources\n\nFor additional guidance on using Terraform with Cloudflare, refer to the following resources:\n\n* [Terraform documentation](https://developers.cloudflare.com/terraform/)\n* [Cloudflare Provider for Terraform](https://registry.terraform.io/providers/cloudflare/cloudflare/latest/docs) (reference documentation)\n\n</page>\n\n<page>\n---\ntitle: Change URI path and Host header Â· Cloudflare Rules docs\ndescription: This tutorial shows you how to modify both the URI path and the\n  Host header of incoming requests using Transform Rules and Origin Rules.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/origin-rules/tutorials/change-uri-path-and-host-header/\n  md: https://developers.cloudflare.com/rules/origin-rules/tutorials/change-uri-path-and-host-header/index.md\n---\n\nThis tutorial will instruct you how to modify both the URI path and the `Host` header of incoming requests using [Transform Rules](https://developers.cloudflare.com/rules/transform/) and Origin Rules.\n\nYour website visitors will be routed from `https://<YOUR_SOURCE_HOSTNAME>/uploads/*` to `https://<YOUR_TARGET_HOSTNAME>/*`.\n\nIn this tutorial you will do the following:\n\n1. Create a URL rewrite to remove `/uploads` from the path.\n2. Create an origin rule to modify the `Host` header to desired hostname.\n\nBy following these steps, you can effectively manage both URI paths and `Host` headers to route traffic appropriately and optimize request handling.\n\n## 1. Create a URL rewrite\n\n1. In the Cloudflare dashboard, go to the Rules **Overview** page.\n\n   [Go to **Overview**](https://dash.cloudflare.com/?to=/:account/:zone/rules/overview)\n\n2. Select **Create rule** > **URL Rewrite Rule**.\n\n3. Enter a descriptive name for the rule in **Rule name**.\n\n4. Under **If incoming requests match**, select **Custom filter expression**, select **Edit expression**, and enter the following expression:\n\n   Text in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "5. Under **Set Rewrite parameters**, select **Path** > **Rewrite to**, and select *Dynamic*.\n\n6. Define the action for your rewrite URL rule:\n\n   Text after **Path** > **Rewrite to** > *Dynamic*:",
      "language": "unknown"
    },
    {
      "code": "The [`regex_replace()`](https://developers.cloudflare.com/ruleset-engine/rules-language/functions/#regex_replace) function replaces the `/uploads/` part of the path with `/`, changing `/uploads/example.jpg` to `/example.jpg`.\n\n7. Select **Deploy**.\n\n## 2. Create an origin rule\n\nNote\n\nIf you are routing traffic to an object storage bucket, use [Cloud Connector](https://developers.cloudflare.com/rules/cloud-connector/) instead of an origin rule.\n\n1. In the Cloudflare dashboard, go to the Rules **Overview** page.\n\n   [Go to **Overview**](https://dash.cloudflare.com/?to=/:account/:zone/rules/overview)\n\n2. Select **Create rule** > **Origin Rule**.\n\n3. Enter a descriptive name for the rule in **Rule name**.\n\n4. Under **When incoming requests match**, define the rule expression:\n\n   Text in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "5. Under **Set origin parameters**, select **Host Header** > **Rewrite to**.\n\n6. Configure the rule to modify the `Host` header to desired hostname:\n\n   Text after **Host Header** > **Rewrite to**:",
      "language": "unknown"
    },
    {
      "code": "This will set the [`Host` header](https://developers.cloudflare.com/rules/origin-rules/features/#host-header) to `example.com` for matching requests. Make sure to replace `example.com` with your actual hostname.\n\n7. (Optional) To route requests to a different origin (DNS target), use [DNS override](https://developers.cloudflare.com/rules/origin-rules/features/#dns-record):\n\n   Text after **DNS Record** > **Override to**:",
      "language": "unknown"
    },
    {
      "code": "This will route requests to the DNS target of `example.com` instead of your default [DNS record](https://developers.cloudflare.com/dns/manage-dns-records/how-to/create-dns-records/).\n\n8. Select **Deploy**.\n\n## Final remarks\n\nAfter completing this tutorial, incoming traffic for `https://<YOUR_SOURCE_HOSTNAME>/uploads/*` will be routed to `https://<YOUR_TARGET_HOSTNAME>/*`.\n\nEnsure the filters for the [URL rewrite](https://developers.cloudflare.com/rules/transform/url-rewrite/) and the [origin rule](https://developers.cloudflare.com/rules/origin-rules/) (or [Cloud Connector](https://developers.cloudflare.com/rules/cloud-connector/) rule) are precise to avoid unintended rule executions.\n\nRemember that rules are evaluated [in sequence](https://developers.cloudflare.com/ruleset-engine/reference/phases-list/), so Transform Rules (including URL rewrites) run before Origin Rules or Cloud Connector.\n\n</page>\n\n<page>\n---\ntitle: Point to Pages with a custom domain Â· Cloudflare Rules docs\ndescription: This tutorial will instruct you how to configure an origin rule and\n  a DNS record to point to a Pages deployment with a custom domain.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/origin-rules/tutorials/point-to-pages-with-custom-domain/\n  md: https://developers.cloudflare.com/rules/origin-rules/tutorials/point-to-pages-with-custom-domain/index.md\n---\n\nThis tutorial will instruct you how to configure an origin rule and a DNS record to point to a Pages deployment with a custom domain.\n\nThe procedure will use the following example values:\n\n| | |\n| - | - |\n| URL that website visitors will access | `mycustomerexample.com/blog/*` |\n| Zone domain | `mycustomerexample.com` |\n| Cloudflare Pages subdomain | `myblog.pages.dev` |\n| Cloudflare Pages custom domain | `blogmirror.example.com` |\n\nWhen configuring your Pages custom domain, use a custom domain that you do not plan to use in production (`blogmirror.example.com` in this example).\n\n## 1. Configure custom domain in your Pages project\n\nTo add the custom domain to your Pages deployment:\n\n1. In the Cloudflare dashboard, go to the **Workers & Pages** page.\n\n   [Go to **Workers & Pages**](https://dash.cloudflare.com/?to=/:account/workers-and-pages)\n\n2. Select your Pages project.\n\n3. Go to **Custom domains**.\n\n4. Select **Set up a custom domain**.\n\n5. Enter `blogmirror.example.com` and select **Continue**.\n\nWhen you add the custom domain to your Pages deployment, Cloudflare automatically creates a `CNAME` DNS record for the custom domain.\n\n## 2. Create origin rule to rewrite host header and override DNS record\n\nIn your `mycustomerexample.com` zone, create an origin rule with the following configuration:\n\n**If incoming requests match**\n\n| Field | Operator | Value |\n| - | - | - |\n| URI Path | wildcard | `/blog/*` |\n\nIf using the Expression Editor, enter the following expression:",
      "language": "unknown"
    },
    {
      "code": "**Set origin parameters**\n\n* Value after **Host header** > **Rewrite to**: `blogmirror.example.com`\n* Value after **DNS record** > **Override to**: `blogmirror.example.com`\n\n## 3. (Optional) Configure URL rewrite\n\nIn this example, the URL that website visitors will access starts with `/blog`. However, the Pages deployment does not have this initial URL segment.\n\nUse a URL rewrite to remove the `/blog` segment from the URL path.\n\n1. Go to **Rules** > **Overview**.\n\n2. Select **Create rule** > **URL Rewrite Rule**.\n\n3. Enter a descriptive name for the rule in **Rule name**.\n\n4. In **If incoming requests match**, select **Wildcard pattern**.\n\n5. Enter the following value in **Request URL**:",
      "language": "unknown"
    },
    {
      "code": "In the current example, the value would be `https://mycustomerexample.com/blog/*`.\n\n6. In **Then rewrite the path and/or query**, enter the following values under **Path**:\n\n   | Target path | Rewrite to |\n   | - | - |\n   | \\[`/`] `blog/*` | \\[`/`] `${1}` |\n\n7. Select **Deploy**.\n\nNote\n\nCloudflare provides a rule template in the dashboard called **Rewrite Path for Object Storage Bucket** that you can use and adapt to configure the URL rewrite rule.\n\n## More resources\n\n* [Tutorial: Change URI Path and Host Header](https://developers.cloudflare.com/rules/origin-rules/tutorials/change-uri-path-and-host-header/)\n* [Cloudflare Pages: Custom domains](https://developers.cloudflare.com/pages/configuration/custom-domains/)\n* [DNS records](https://developers.cloudflare.com/dns/manage-dns-records/)\n\n</page>\n\n<page>\n---\ntitle: Point to R2 bucket with a custom domain Â· Cloudflare Rules docs\ndescription: This tutorial will instruct you how to configure an origin rule and\n  a DNS record to point to an R2 bucket configured with a custom domain.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/origin-rules/tutorials/point-to-r2-bucket-with-custom-domain/\n  md: https://developers.cloudflare.com/rules/origin-rules/tutorials/point-to-r2-bucket-with-custom-domain/index.md\n---\n\nThis tutorial will instruct you how to configure an origin rule and a DNS record to point to an R2 bucket configured with a custom domain.\n\nThe procedure will use the following example values:\n\n| | |\n| - | - |\n| URL that website visitors will access | `mycustomerexample.com/images/*` |\n| R2 bucket custom domain | `imagesbucket.example.com` |\n\nWhen configuring your R2 bucket's custom domain, use a custom domain that you do not plan to use in production (`imagesbucket.example.com` in this example).\n\n## 1. Configure custom domain in your Pages project\n\n1. In the Cloudflare dashboard, go to the **R2 object storage** page.\n\n   [Go to **Overview**](https://dash.cloudflare.com/?to=/:account/r2/overview)\n\n2. Select your bucket.\n\n3. On the bucket page, select **Settings**.\n\n4. Under **Public access** > **Custom Domains**, select **Connect Domain**.\n\n5. Enter the domain name you want to connect to â€” `imagesbucket.example.com` in this example â€” and select **Continue**.\n\n6. Review the new record that will be added to the DNS table and select **Connect Domain**.\n\nYour domain is now connected. The status takes a few minutes to change from **Initializing** to **Active**, and you may need to refresh to review the status update. If the status has not changed, select the **...** next to your bucket and select **Retry connection**.\n\nTo view the added DNS record, select **...** next to the connected domain and select **Manage DNS**.\n\nNote\n\nThe domain used must belong to the same account as the R2 bucket.\n\n## 2. Create origin rule to rewrite host header and override DNS record\n\nIn your `mycustomerexample.com` zone, create an origin rule with the following configuration:\n\n**If incoming requests match**\n\n| Field | Operator | Value |\n| - | - | - |\n| URI Path | wildcard | `/images/*` |\n\nIf using the Expression Editor, enter the following expression:",
      "language": "unknown"
    },
    {
      "code": "**Set origin parameters**\n\n* Value after **Host header** > **Rewrite to**: `imagesbucket.example.com`\n* Value after **DNS record** > **Override to**: `imagesbucket.example.com`\n\n## 3. (Optional) Configure URL rewrite\n\nIn our example, the URL that website visitors will access starts with `/images`. However, images stored in the example R2 bucket do not have this initial URL segment.\n\nUse a URL rewrite to remove the `/images` segment from the URL path. Cloudflare provides a rule template in the dashboard called **Rewrite Path for Object Storage Bucket** that you can use to configure the required rewrite.\n\n1. In the Cloudflare dashboard, go to the Rules **Overview** page.\n\n   [Go to **Overview**](https://dash.cloudflare.com/?to=/:account/:zone/rules/overview)\n\n2. Select **Create rule** > **URL Rewrite Rule**.\n\n3. Enter a descriptive name for the rule in **Rule name**.\n\n4. In **If incoming requests match**, select **Wildcard pattern**.\n\n5. Enter the following value in **Request URL**:",
      "language": "unknown"
    },
    {
      "code": "In the current example, the value would be `https://mycustomerexample.com/images/*`.\n\n6. In **Then rewrite the path and/or query**, enter the following values under **Path**:\n\n   | Target path | Rewrite to |\n   | - | - |\n   | \\[`/`] `images/*` | \\[`/`] `${1}` |\n\n7. Select **Deploy**.\n\nNote\n\nCloudflare provides a rule template in the dashboard called **Rewrite Path for Object Storage Bucket** that you can use and adapt to configure the URL rewrite rule.\n\n## More resources\n\n* [Tutorial: Change URI Path and Host Header](https://developers.cloudflare.com/rules/origin-rules/tutorials/change-uri-path-and-host-header/)\n* [Cloudflare R2: Public buckets](https://developers.cloudflare.com/r2/buckets/public-buckets/)\n* [DNS records](https://developers.cloudflare.com/dns/manage-dns-records/)\n\n</page>\n\n<page>\n---\ntitle: URL forwarding with Page Rules Â· Cloudflare Rules docs\ndescription: Page Rules allow you to forward or redirect traffic to a different\n  URL, though they are just one of the options provided by Cloudflare.\nlastUpdated: 2025-09-24T12:01:01.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/page-rules/how-to/url-forwarding/\n  md: https://developers.cloudflare.com/rules/page-rules/how-to/url-forwarding/index.md\n---\n\nPage Rules allow you to forward or redirect traffic to a different URL, though they are just one of the [options provided by Cloudflare](https://developers.cloudflare.com/fundamentals/reference/redirects/).\n\nNote\n\nConsider alternative [Rules](https://developers.cloudflare.com/rules/) options due to their enhanced configurability. Refer to the [migration guide](https://developers.cloudflare.com/rules/reference/page-rules-migration/) for details.\n\nFor more flexibility and customization, consider using [Snippets](https://developers.cloudflare.com/rules/snippets/).\n\n***\n\n## Redirect with Page Rules\n\nTo configure URL forwarding or redirects using Page Rules:\n\n1. In the Cloudflare dashboard, go to the **Page Rules** page.\n\n   [Go to **Page Rules**](https://dash.cloudflare.com/?to=/:account/:zone/rules/page-rules)\n\n2. Select **Create Page Rule**.\n\n3. Under **If the URL matches**, enter the URL or URL pattern that should match the rule.\n\n4. In **Pick a Setting**, choose **Forwarding URL** from the drop-down menu.\n\n5. For **Select status code**, choose *301 - Permanent Redirect* or *302 - Temporary Redirect*.\n\n6. Enter the destination URL.\n\n7. Select **Save and Deploy Page Rule**.\n\nNote\n\nPage Rules require a [proxied DNS record](https://developers.cloudflare.com/dns/proxy-status/) to work. Page Rules will not apply to subdomains that do not exist in DNS or are not being directed to Cloudflare.\n\n***\n\n## Forwarding examples\n\nImagine you want site visitors to reach your website for a variety of URL patterns.Â For instance, the page rule URL patterns `*www.example.com/products`Â andÂ `*example.com/products`Â match:",
      "language": "unknown"
    },
    {
      "code": "but do not match:",
      "language": "unknown"
    },
    {
      "code": "Once you have created the pattern that matches what you want, select theÂ **Forwarding**Â toggle. This will display a field where you can enter the address you want requests forwarded to.",
      "language": "unknown"
    },
    {
      "code": "If you enter the address above in the forwarding box and select **Add Rule**,Â within a few seconds any requests that match the pattern you entered will automatically be forwarded with an `HTTP 302` redirect status code to the new URL.\n\n***\n\n## Advanced forwarding options\n\nIf you use a basic redirect, such as forwarding the apex domain (`example.com`) to `www.example.com`, then you lose anything else in the URL.\n\nFor example, you could set up the pattern:",
      "language": "unknown"
    },
    {
      "code": "And have it forward to:",
      "language": "unknown"
    },
    {
      "code": "However, if someone entered `example.com/some-particular-page.html`, they would be redirected to:",
      "language": "unknown"
    },
    {
      "code": "Instead of:",
      "language": "unknown"
    },
    {
      "code": "The solution is to use variables. Each wildcard corresponds to a variable when can be referenced in the forwarding address. The variables are represented by a `$` (dollar sign) followed by a number. To refer to the first wildcard you would use `$1`, to refer to the second wildcard you would use `$2`, and so on.\n\nTo fix the forwarding from the apex to `www` in the above example, you could use the same pattern:",
      "language": "unknown"
    },
    {
      "code": "You would then set up the following URL for traffic to forward to:",
      "language": "unknown"
    },
    {
      "code": "In this case, if someone went to:",
      "language": "unknown"
    },
    {
      "code": "They would be redirected to:",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Additional reference for Page Rules Â· Cloudflare Rules docs\ndescription: This setting is available to Business and Enterprise customers.\nlastUpdated: 2025-11-11T11:19:11.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/page-rules/reference/additional-reference/\n  md: https://developers.cloudflare.com/rules/page-rules/reference/additional-reference/index.md\n---\n\nNote\n\nConsider alternative [Rules](https://developers.cloudflare.com/rules/) options due to their enhanced configurability. Refer to the [migration guide](https://developers.cloudflare.com/rules/reference/page-rules-migration/) for details.\n\nFor more flexibility and customization, consider using [Snippets](https://developers.cloudflare.com/rules/snippets/).\n\n## Bypass Cache on Cookie setting\n\nThis setting is available to Business and Enterprise customers.\n\nTheÂ **Bypass Cache on Cookie**Â setting supports basic regular expressions (regex) as follows:\n\n* A pipe operator (represented by `|`) to match multiple cookies using *OR* boolean logic. For example, `bypass=.*|PHPSESSID=.*` would bypass the cache if either a cookie called `bypass` or `PHPSESSID` were set, regardless of the cookie's value.\n* The wildcard operator (represented by `.*`), such that a rule value of `t.*st=` would match both a cookie called `test` and one called `teeest`.\n\nLimitations include:\n\n* 150 characters per cookie regex\n* 12 wildcards per cookie regex\n* 1 wildcard in between each `|` in the cookie regex\n\nTo learn how to configure **Bypass Cache on Cookie** with a cache rule, refer to [Bypass Cache on Cookie](https://developers.cloudflare.com/cache/how-to/cache-rules/examples/bypass-cache-on-cookie/).\n\nNote\n\nIf you add both this setting and the enterprise-onlyÂ *Cache On Cookie*Â setting to the same page rule,Â *Cache On Cookie*Â takes precedence overÂ *Bypass Cache on Cookie*.\n\n## Zone name occurrences must end with a slash\n\nWhen saving a page rule, Cloudflare will ensure that there is a slash after each occurrence of the current zone name in the **If the URL matches** field. For example, if the current zone name is `example.com`, then:\n\n* `example.com` will be saved as `example.com/`\n* `example.com/path/example.com` will be saved as `example.com/path/example.com/`\n\nNote that `example.com/some-path/cloudflare.com` will be saved *without* a final slash, since the zone name is not `cloudflare.com`.\n\n## Network ports supported by Page Rules\n\nIf you specify a port in the **If the URL matches** field of a page rule, it must be one of the following:\n\n* One of the HTTP/HTTPS ports [compatible with Cloudflareâ€™s proxy](https://developers.cloudflare.com/fundamentals/reference/network-ports/#network-ports-compatible-with-cloudflares-proxy).\n* A custom port of a [Cloudflare Spectrum](https://developers.cloudflare.com/spectrum/) HTTPS application.\n\n## Using Page Rules with Workers\n\nIf the URL of the current request matches both a page rule and a [Workers custom route](https://developers.cloudflare.com/workers/configuration/routing/routes/), some Pages Rules settings will not be applied. For more details, refer to [Workers and Page Rules](https://developers.cloudflare.com/workers/configuration/workers-with-page-rules/).\n\n## Page Rules are case-insensitive\n\nThe pattern entered underÂ **If the URL matches** will not consider upper and lower case differences â€” `example.com/path`, `example.com/Path`, and `example.com/PATH` will be triggered the same way.\n\nIf you need your rules to consider case sensitivity, you might want to use alternative [Rules](https://developers.cloudflare.com/rules/) options instead.\n\n</page>\n\n<page>\n---\ntitle: Recommended page rules Â· Cloudflare Rules docs\ndescription: Use Cloudflare Page Rules to improve the user experience of your\n  domain with hardened security and enhanced site performance, while increasing\n  reliability and minimizing bandwidth usage for your origin server.\nlastUpdated: 2025-09-11T15:31:26.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/page-rules/reference/recommended-rules/\n  md: https://developers.cloudflare.com/rules/page-rules/reference/recommended-rules/index.md\n---\n\nUse Cloudflare Page Rules to improve the user experience of your domain with hardened security and enhanced site performance, while increasing reliability and minimizing bandwidth usage for your origin server.\n\nNote\n\nConsider alternative [Rules](https://developers.cloudflare.com/rules/) options due to their enhanced configurability. Refer to the [migration guide](https://developers.cloudflare.com/rules/reference/page-rules-migration/) for details.\n\nFor more flexibility and customization, consider using [Snippets](https://developers.cloudflare.com/rules/snippets/).\n\nKeep in mind that not all rules will be right for everyone, but these are some of the most popular.\n\n* 301/302 Forwarding URL\n* Cache Level in specific paths\n* Edge Cache TTL, Always Online, and Browser Cache TTL\n\n### 301/302 Forwarding URL\n\nNote\n\nConsider using [Single Redirects](https://developers.cloudflare.com/rules/url-forwarding/single-redirects/) or [Bulk Redirects](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) to forward or redirect traffic to a different URL due to ease of use, maintenance, and cost. You should only use Page Rules when Dynamic or Bulk Redirects do not meet your use case.\n\nTwo common examples for using forwarding URLs are:\n\n* Defining the root as the canonical version of your domain.\n* Directing visitors to a specific page with an easy to remember URL.\n\nThis example page rule configuration defines the root as the canonical version of your domain:\n\n* **If the URL matches**: `*www.example.com/*`\n* **Setting**: *Forwarding URL* | **Select status code**: *301 Permanent Redirect*\n* **Enter destination URL**: `https://example.com/$2`\n\nThis example redirects visitors to a specific page with an easy to remember URL:\n\n* **If the URL matches**: `*www.example.com/fb*`\n* **Setting**: *Forwarding URL* | **Select status code**: *302 Temporary Redirect*\n* **Enter destination URL**: `https://www.facebook.com/username`\n\n### Cache Level in specific paths\n\nCertain sections of a website, like the login or admin section, have different security and performance requirements than your general public-facing pages.\n\nThe following example page rule configuration bypasses cache for requests targeting a specific path:\n\n* **If the URL matches**: `example.com/user*`\n* **Setting**: *Cache Level* | **Value**: *Bypass*\n\n### Edge Cache TTL and Browser Cache TTL\n\nCertain resources on your domain will likely not change often. For these resources, taking advantage of aggressive caching options can significantly reduce the load on your server and bandwidth utilization.\n\n#### Examples\n\nIn the following example page rule configuration, the target is a folder that holds the majority of the image assets as well as some other types of multimedia.\n\n* **If the URL matches**: `example.com/sites/default/files*`\n* **Setting**: *Browser Cache TTL* | **Value**: *a day*\n* **Setting**: *Cache Level |* **Value**: *Cache Everything*\n* **Setting**: *Edge Cache TTL |* **Value**: *7 days*\n\nThe following example page rule configuration applies unique rules for critical pages that do not change very often.\n\n* **If the URL matches**: `example.com/terms-of-service`\n* **Setting**: *Browser Cache TTL* | **Value**: *a day*\n* **Setting**: *Always Online |* **Value**: *On*\n* **Setting**: *Cache Level* | **Value**: *Cache Everything*\n* **Setting**: *Edge Cache TTL* | **Value**: *a month*\n\n</page>\n\n<page>\n---\ntitle: Page Rules settings Â· Cloudflare Rules docs\ndescription: Settings control the action Cloudflare takes once a request matches\n  the URL pattern defined in a page rule. You can use settings to enable and\n  disable multiple Cloudflare features across the dashboard.\nlastUpdated: 2025-09-15T16:47:39.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/page-rules/reference/settings/\n  md: https://developers.cloudflare.com/rules/page-rules/reference/settings/index.md\n---\n\nSettings control the action Cloudflare takes once a request matches the URL pattern defined in a page rule. You can use settings to enable and disable multiple Cloudflare features across the dashboard.\n\nNote\n\nConsider alternative [Rules](https://developers.cloudflare.com/rules/) options due to their enhanced configurability. Refer to the [migration guide](https://developers.cloudflare.com/rules/reference/page-rules-migration/) for details.\n\nFor more flexibility and customization, consider using [Snippets](https://developers.cloudflare.com/rules/snippets/).\n\nNote that:\n\n* Some settings require a Pro, Business, or Enterprise domain plan.\n* You can specify more than one setting to apply when the rule triggers.\n\nThe available Page Rules settings are the following:\n\n| **Setting** | **Description** | **Plans** |\n| - | - | - |\n| [Always Use HTTPS](https://developers.cloudflare.com/ssl/edge-certificates/additional-options/always-use-https/) | EnableÂ **Always Use HTTPS**Â feature. If enabled, anyÂ `http://`Â URL is converted toÂ `https://` through a 301 redirect. If this option does not appear, you do not have an activeÂ **Edge Certificate**. | All |\n| [Automatic HTTPS Rewrites](https://developers.cloudflare.com/ssl/edge-certificates/additional-options/automatic-https-rewrites/) | Turn on or off **Automatic HTTPS Rewrites**.NoteTo use this feature on specific hostnames - instead of across your entire zone - use a [configuration rule](https://developers.cloudflare.com/rules/configuration-rules/). | All |\n| [Browser Cache TTL](https://developers.cloudflare.com/cache/how-to/edge-browser-cache-ttl/) | Control how long resources cached by client browsers remain valid.Â The Cloudflare dashboard and the API both prohibit setting **Browser Cache TTL** to `0` for non-Enterprise domains. | All |\n| [Browser Integrity Check](https://developers.cloudflare.com/waf/tools/browser-integrity-check/) | Inspect the visitor's browser for headers commonly associated with spammers and certain bots.NoteTo use this feature on specific hostnames - instead of across your entire zone - use a [configuration rule](https://developers.cloudflare.com/rules/configuration-rules/).Â  | All |\n| Bypass Cache on Cookie | Bypass cache and fetch resources from the origin server if a regular expression matches against a cookie name present in the request. If you add both this setting and the *Cache On Cookie*Â setting to the same page rule,Â *Cache On Cookie*Â takes precedence overÂ *Bypass Cache on Cookie*. Refer to the [Additional details](https://developers.cloudflare.com/rules/page-rules/reference/additional-reference/#bypass-cache-on-cookie-setting) to learn about limited regular expression support. | Business and Enterprise |\n| [Cache By Device Type](https://developers.cloudflare.com/cache/how-to/cache-rules/examples/cache-device-type/) | Separate cached content based on the visitorâ€™s device type.Â  | Enterprise |\n| [Cache Deception Armor](https://developers.cloudflare.com/cache/cache-security/cache-deception-armor/) | Protect from web cache deception attacks while still allowing static assets to be cached. This setting verifies that the URL's extension matches the returnedÂ *Content-Type*.Â  | All |\n| Cache Level | Apply custom caching based on the option selected: â€“ **Bypass**: Cloudflare does not cache. â€“ **No Query String**:Â Delivers resources from cache when there is no query string. â€“ **Ignore Query String**: Delivers the same resource to everyone independent of the query string. â€“ **Standard**: Caches all static content that has a query string. â€“ **Cache Everything**: Treats all content as static and caches all file types beyond the [Cloudflare default cached content](https://developers.cloudflare.com/cache/concepts/default-cache-behavior/#default-cached-file-extensions). Respects cache headers from the origin web server unless **Edge Cache TTL** is also set in the Page Rule. WhenÂ combined with anÂ **Edge Cache TTL**Â > `0`,Â **Cache Everything**Â removes cookies from the origin web server response.Â  | All |\n| Cache on Cookie | Apply theÂ *Cache Everything*Â option (*Cache Level*Â setting) based on a regular expression match against a cookie name. If you add both this setting andÂ *Bypass Cache on Cookie*Â to the same page rule,Â *Cache On Cookie*Â takes precedence overÂ *Bypass Cache on Cookie*. | Business and above |\n| [Cache TTL by Status Code](https://developers.cloudflare.com/cache/how-to/configure-cache-status-code/) | Enterprise customers can set cache time-to-live (TTL) based on the response status from the origin web server. Cache TTL refers to the duration of a resource in the Cloudflare network before being marked as stale or discarded from cache. Status codes are returned by a resource's origin. Setting cache TTL based on response status overrides the default cache behavior (standard caching) for static files and overrides cache instructions sent by the origin web server. To cache non-static assets, set a Cache Level of Cache Everything using a Page Rule. Setting no-store Cache-Control or a low TTL (using `max-age`/`s-maxage`) increases requests to origin web servers and decreases performance. | Enterprise |\n| [Custom Cache Key](https://developers.cloudflare.com/cache/how-to/cache-keys/) | Control specifically what variables to include when deciding which resources to cache. This allows customers to determine what to cache based on something other than just the URL. | Enterprise |\n| Disable Zaraz | Turn off [Zaraz](https://developers.cloudflare.com/zaraz/).NoteTo use this feature on specific hostnames - instead of across your entire zone - use a [configuration rule](https://developers.cloudflare.com/rules/configuration-rules/). | All |\n| Edge Cache TTL | Specify how long to cache a resource in the Cloudflare global network.Â *Edge Cache TTL* is not visible in response headers. | All |\n| [Email Obfuscation](https://developers.cloudflare.com/waf/tools/scrape-shield/email-address-obfuscation/) | Turn on or off **Email Obfuscation**.NoteTo use this feature on specific hostnames - instead of across your entire zone - use a [configuration rule](https://developers.cloudflare.com/rules/configuration-rules/). | All |\n| Forwarding URL | Redirects one URL to another using anÂ `HTTP 301/302` redirect.Â Refer toÂ [Wildcard matching and referencing](https://developers.cloudflare.com/rules/page-rules/reference/wildcard-matching/). | All |\n| Host Header Override | Apply a specific host header.NoteYou can accomplish the same effect with an [origin rule](https://developers.cloudflare.com/rules/origin-rules/features/#host-header). | Enterprise |\n| IP Geolocation Header | Cloudflare adds aÂ `CF-IPCountry`Â HTTP header containing the country code that corresponds to the visitor. | All |\n| [Mirage](https://developers.cloudflare.com/speed/optimization/images/mirage/) | Turn on or offÂ **Mirage** (deprecated).NoteTo use this feature on specific hostnames - instead of across your entire zone - use a [configuration rule](https://developers.cloudflare.com/rules/configuration-rules/). | Pro and above |\n| [Opportunistic Encryption](https://developers.cloudflare.com/ssl/edge-certificates/additional-options/opportunistic-encryption/) | Turn on or off theÂ **Opportunistic Encryption**.NoteTo use this feature on specific hostnames - instead of across your entire zone - use a [configuration rule](https://developers.cloudflare.com/rules/configuration-rules/).Â  | All |\n| [Origin Cache Control](https://developers.cloudflare.com/cache/concepts/cache-control/) | Origin Cache Control is enabled by default for Free, Pro, and Business domains and disabled by default for Enterprise domains. | All |\n| Origin Error Page Pass-thru | Turn on or off Cloudflare error pages generated from issues sent from the origin server. If enabled, this setting triggers error pages issued by the origin. | Enterprise |\n| [Polish](https://developers.cloudflare.com/images/polish/) | Apply options from theÂ **Polish**Â feature of the CloudflareÂ **Speed**Â app.NoteTo use this feature on specific hostnames - instead of across your entire zone - use a [configuration rule](https://developers.cloudflare.com/rules/configuration-rules/). | Pro and above |\n| [Query String Sort](https://developers.cloudflare.com/cache/advanced-configuration/query-string-sort/) | Turn on or off the reordering of query strings. When query strings have the same structure, caching improves. | Enterprise |\n| Resolve Override | Change the origin address to the value specified in this setting.NoteYou can accomplish the same effect with an [origin rule](https://developers.cloudflare.com/rules/origin-rules/features/#dns-record). | Enterprise |\n| [Respect Strong ETags](https://developers.cloudflare.com/cache/reference/etag-headers/) | Turn on or off byte-for-byte equivalency checks between the Cloudflare cache and the origin server. | Enterprise |\n| Response Buffering | Turn on or off whether Cloudflare should wait for an entire file from the origin server before forwarding it to the site visitor. By default, Cloudflare sends packets to the client as they arrive from the origin server. | Enterprise |\n| [Rocket Loader](https://developers.cloudflare.com/speed/optimization/content/rocket-loader/) | Turn on or offÂ **Rocket Loader**Â inÂ the CloudflareÂ **Speed**Â app.NoteTo use this feature on specific hostnames - instead of across your entire zone - use a [configuration rule](https://developers.cloudflare.com/rules/configuration-rules/). | All |\n| [SSL](https://developers.cloudflare.com/ssl/origin-configuration/ssl-modes/) | Control options for theÂ **SSL**Â feature of the **Edge Certificates** tab in the CloudflareÂ **SSL/TLS**Â app.NoteTo use this feature on specific hostnames - instead of across your entire zone - use a [configuration rule](https://developers.cloudflare.com/rules/configuration-rules/). | All |\n| True Client IP Header | Turn on or off theÂ [**True-Client-IP Header**](https://developers.cloudflare.com/network/true-client-ip-header/)Â feature of the CloudflareÂ **Network**Â app.Â  | Enterprise |\n\n</page>\n\n<page>\n---\ntitle: Wildcard matching in Page Rules Â· Cloudflare Rules docs\ndescription: \"You can use the asterisk (*) in any URL segment to match certain\n  patterns. For example, example.com/t*st would match:\"\nlastUpdated: 2025-11-11T11:19:11.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/page-rules/reference/wildcard-matching/\n  md: https://developers.cloudflare.com/rules/page-rules/reference/wildcard-matching/index.md\n---\n\nYou can use the asterisk (`*`) in any URL segment to match certain patterns. For example, `example.com/t*st` would match:\n\n* `example.com/test`\n* `example.com/toast`\n* `example.com/trust`\n\n`example.com/foo/* `does not match `example.com/foo`, but `example.com/foo*` does match.\n\nNote\n\nConsider alternative [Rules](https://developers.cloudflare.com/rules/) options due to their enhanced configurability. Refer to the [migration guide](https://developers.cloudflare.com/rules/reference/page-rules-migration/) for details.\n\nFor more flexibility and customization, consider using [Snippets](https://developers.cloudflare.com/rules/snippets/).\n\n## Helpful tips\n\n* To match both `http` and `https`, write `example.com`. Writing `*example.com` is unnecessary.\n* To match every page on a domain, write `example.com/*`. Writing `example.com` will not work.\n* To match every page on a domain and its subdomains, write `*example.com/*`. Writing `example.com` will not work.\n* A wildcard (`*`) in a page rule URL will match even if no characters are present and may include any part of the URL, including the query string.\n\n## Reference wildcard matches\n\nYou can reference a matched wildcard later using the `$<X>` syntax, where `<X>` indicates the index of a glob pattern. For example, `$1` represents the first wildcard match and `$2` represents the second wildcard match.\n\nThe `$<X>` syntax is especially useful with the *Forwarding URL* setting. For example, you could forward `http://*.example.com/*` to `http://example.com/images/$1/$2.jpg`.\n\nThis rule would match `http://cloud.example.com/flare.jpg`, which would be forwarded to `http://example.com/images/cloud/flare.jpg`.\n\nTo add a `$` character in the forwarding URL, escape it by adding a backslash `\\` in front like `\\$`.\n\nWarning\n\nAvoid creating a redirect where the domain points to itself as the destination. A domain that points to itself can cause an [infinite redirect error](https://developers.cloudflare.com/ssl/troubleshooting/too-many-redirects/), which makes your site inaccessible to visitors.\n\n</page>\n\n<page>\n---\ntitle: Troubleshoot Page Rules - Billing and subscription Â· Cloudflare Rules docs\ndescription: No, you cannot buy additional Page Rules. You will need to migrate\n  to modern Rules features to benefit from increased quotas.\nlastUpdated: 2025-11-11T11:19:11.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/page-rules/troubleshooting/billing-and-subscription/\n  md: https://developers.cloudflare.com/rules/page-rules/troubleshooting/billing-and-subscription/index.md\n---\n\nNote\n\nConsider alternative [Rules](https://developers.cloudflare.com/rules/) options due to their enhanced configurability. Refer to the [migration guide](https://developers.cloudflare.com/rules/reference/page-rules-migration/) for details.\n\nFor more flexibility and customization, consider using [Snippets](https://developers.cloudflare.com/rules/snippets/).\n\n## If I run out of Page Rules, can I buy more?\n\nNo, you cannot buy additional Page Rules. You will need to [migrate to modern Rules features](https://developers.cloudflare.com/rules/reference/page-rules-migration/) to benefit from increased quotas.\n\n## How do I cancel my Page Rules purchase?\n\nTo cancel a purchase:\n\n1. In the Cloudflare dashboard, go to the **Billing** page.\n\n   [Go to **Billing**](https://dash.cloudflare.com/?to=/:account/billing)\n\n2. Go to **Subscriptions**.\n\n3. Find the associated website (listed in alphabetical order) and select **Edit**.\n\n4. For **Additional page rules**, change the amount to your previous value. If you are over your current limit, you may have to delete existing page rules (paused or active).\n\n5. Finish the updates to your subscription.\n\n## When I change plans will I keep my add-on subscriptions?\n\nWhen you change plans, you will keep your Page Rules add-on subscription.\n\n## What happens if I cancel Page Rules halfway through my billing cycle?\n\nYou will be billed for and have access to your additional Page Rules until the end of your current billing cycle.\n\nYour plan will adjust at the start of your next billing cycle. For more details, refer to our [billing policy](https://developers.cloudflare.com/billing/billing-policy/).\n\n</page>\n\n<page>\n---\ntitle: Troubleshoot Page Rules - General Â· Cloudflare Rules docs\ndescription: The most common reason that a page rule is not working â€” such as\n  URL forwarding â€” is that the page rule you created is on a record that is not\n  proxied by Cloudflare in yourÂ DNS settings.\nlastUpdated: 2025-11-11T11:19:11.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/page-rules/troubleshooting/general/\n  md: https://developers.cloudflare.com/rules/page-rules/troubleshooting/general/index.md\n---\n\nNote\n\nConsider alternative [Rules](https://developers.cloudflare.com/rules/) options due to their enhanced configurability. Refer to the [migration guide](https://developers.cloudflare.com/rules/reference/page-rules-migration/) for details.\n\nFor more flexibility and customization, consider using [Snippets](https://developers.cloudflare.com/rules/snippets/).\n\n## Why is a page rule not working?\n\nThe most common reason that a page rule is not working â€” such as URL forwarding â€” is that the page rule you created is on a record that is not proxied by Cloudflare in yourÂ [DNS settings](https://developers.cloudflare.com/dns/manage-dns-records/how-to/create-dns-records/).\n\nConsider an example where you have a page rule that redirects a subdomain (`subdomain.yoursitename.com`) back to your apex domain (`yoursitename.com`). If you do not have that record proxied in your DNS settings for the subdomain record, Cloudflare's proxy is not running over the record and a page rule will not work because it is going direct to your server.\n\n## Error 500 (Internal server error)\n\n### Root cause\n\nThis may be due to a configuration issue on a page rule. When creating a page rule that uses two wildcards, like a *Forwarding URL* rule, it is possible to create a rule that mentions the second wildcard with the `$2` placeholder. Refer to the example below:\n\n![Example Page Rule configuration with two wildcards. The forwarding URL contains a $2 placeholder, which will be replaced with the content matched by the second ](https://developers.cloudflare.com/_astro/page-rule-create.G2sl-mqe_1SWiA8.webp)\n\nWhen updating the same rule, you can remove one of the wildcard in the **If the URL matches** field and save it. Refer to the example below:\n\n![Incorrect Page Rule configuration with a single wildcard, but still using the $2 placeholder in the forwarding URL. This configuration causes ](https://developers.cloudflare.com/_astro/page-rule-update.C2mx06CJ_ZiaE7E.webp)\n\nIf you do so, the `$2` placeholder reference a wildcard that does not exist anymore, and as such, an `Error 500 (Internal server error)` is thrown when a URL triggers the page rule.\n\n### Resolution\n\nUpdate the page rule and remove the reference `$2` to the second wildcard. If there is only one wildcard, then you can only use `$1`.\n\n</page>\n\n<page>\n---\ntitle: Add a wildcard CORS response header Â· Cloudflare Rules docs\ndescription: Create a CORS response header transform rule to add an\n  `Access-Control-Allow-Origin` HTTP header to the response with wildcard as\n  static value. (`cookiename=value`).\nlastUpdated: 2025-12-10T15:28:49.000Z\nchatbotDeprioritize: false\ntags: Response modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/add-cors-header/\n  md: https://developers.cloudflare.com/rules/transform/examples/add-cors-header/index.md\n---\n\nThe following response header transform rule adds a header named `Access-Control-Allow-Origin` with a static wildcard value (`*`) to the HTTP response:\n\nText in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "Selected operation under **Modify response header**: *Set static*\n\n**Header name**: `Access-Control-Allow-Origin`\n\n**Value**: `*`\n\nYou can also use an expression similar to the following to apply the CORS header to several specific hostnames:",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Add a request header with the current bot score Â· Cloudflare Rules docs\ndescription: Create a request header transform rule to add a `X-Bot-Score` HTTP\n  header to the request with the current bot score.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Request modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/add-request-header-bot-score/\n  md: https://developers.cloudflare.com/rules/transform/examples/add-request-header-bot-score/index.md\n---\n\nThe following request header transform rule adds a header named `X-Bot-Score` with the current bot score to the HTTP request:\n\nText in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "Selected operation under **Modify request header**: *Set dynamic*\n\n**Header name**: `X-Bot-Score`\n\n**Value**: `to_string(cf.bot_management.score)`\n\n</page>\n\n<page>\n---\ntitle: Add request header with a static value Â· Cloudflare Rules docs\ndescription: Create a request header transform rule to add an `X-Source` HTTP\n  header to the request with a static value (`Cloudflare`).\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Request modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/add-request-header-static-value/\n  md: https://developers.cloudflare.com/rules/transform/examples/add-request-header-static-value/index.md\n---\n\nThe following request header transform rule adds a header named `X-Source` with a static value (`Cloudflare`) to the HTTP request:\n\nText in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "Selected operation under **Modify request header**: *Set static*\n\n**Header name**: `X-Source`\n\n**Value**: `Cloudflare`\n\n</page>\n\n<page>\n---\ntitle: Add a request header for subrequests from other zones Â· Cloudflare Rules docs\ndescription: Create a request header transform rule to add an HTTP header when\n  the Workers subrequest comes from a different zone.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Request modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/add-request-header-subrequest-other-zone/\n  md: https://developers.cloudflare.com/rules/transform/examples/add-request-header-subrequest-other-zone/index.md\n---\n\nThe following request header transform rule adds an HTTP header to Workers subrequests coming from a different zone:\n\nText in **Expression Editor** (replace `myappexample.com` with your domain):",
      "language": "unknown"
    },
    {
      "code": "Selected operation under **Modify request header**: *Set static*\n\n**Header name**: `X-External-Workers-Subrequest`\n\n**Value**: `1`\n\nThe [`cf.worker.upstream_zone`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.worker.upstream_zone/) field used in the rule expression is set to empty if the current request is not a Workers subrequest.\n\n</page>\n\n<page>\n---\ntitle: Add a response header with a static value Â· Cloudflare Rules docs\ndescription: Create a response header transform rule to add a `set-cookie` HTTP\n  header to the response with a static value (`cookiename=value`).\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Response modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/add-response-header-static-value/\n  md: https://developers.cloudflare.com/rules/transform/examples/add-response-header-static-value/index.md\n---\n\nThe following response header transform rule adds a header named `set-cookie` with a static value (`cookiename=value`) to the HTTP response:\n\nText in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "Selected operation under **Modify response header**: *Add*\n\n**Header name**: `set-cookie`\n\n**Value**: `cookiename=value`\n\nThis rule would keep any existing `set-cookie` headers already present in the HTTP response.\n\n</page>\n\n<page>\n---\ntitle: Normalize encoded slashes in URL path Â· Cloudflare Rules docs\ndescription: Create a URL rewrite rule (part of Transform Rules) to normalize\n  encoded forward slashes (`%2F`) in the request path to standard slashes (`/`).\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: URL rewrite\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/normalize-encoded-slash/\n  md: https://developers.cloudflare.com/rules/transform/examples/normalize-encoded-slash/index.md\n---\n\nDifferent web servers and applications handle encoded forward slashes (`%2F`) in URLs differently. Cloudflare follows [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986), which specifies that `%2F` **should not** be automatically normalized to `/` because `/` is a reserved character in URLs, and decoding it might change the intended meaning of the path.\n\nHowever, many origin servers **do** automatically decode `%2F` into `/` when processing requests. If your origin server behaves this way, you may want to apply the same normalization at Cloudflareâ€™s edge to ensure consistency in request handling, rule evaluation, and logging.\n\n## How to normalize `%2F`\n\nTo normalize encoded forward slashes (`%2F`) to standard slashes (`/`) in the request path before [subsequent](https://developers.cloudflare.com/ruleset-engine/reference/phases-list/) rule evaluation, create a new URL rewrite rule and define a dynamic URL path rewrite using [`url_decode()`](https://developers.cloudflare.com/ruleset-engine/rules-language/functions/#url_decode) function:\n\nText in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "Text after **Path** > **Rewrite to** > *Dynamic*:",
      "language": "unknown"
    },
    {
      "code": "This transformation ensures that `%2F` is always treated as `/` in the request path. This is particularly useful when setting up rules that depend on URL path matching, as it prevents discrepancies caused by differing normalization behaviors.\n\n</page>\n\n<page>\n---\ntitle: Remove a request header Â· Cloudflare Rules docs\ndescription: Create a request header transform rule (part of Transform Rules) to\n  remove the `cf-connecting-ip` HTTP header from the request.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Request modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/remove-request-header/\n  md: https://developers.cloudflare.com/rules/transform/examples/remove-request-header/index.md\n---\n\nThe following request header transform rule removes the `cf-connecting-ip` header from the HTTP request:\n\nText in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "Selected operation under **Modify request header**: *Remove*\n\n**Header name**: `cf-connecting-ip`\n\n</page>\n\n<page>\n---\ntitle: Remove a response header Â· Cloudflare Rules docs\ndescription: Create a response header transform rule (part of Transform Rules)\n  to remove the `cf-connecting-ip` HTTP header from the response.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Response modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/remove-response-header/\n  md: https://developers.cloudflare.com/rules/transform/examples/remove-response-header/index.md\n---\n\nThe following response header transform rule removes the `cf-connecting-ip` header from the HTTP response:\n\nText in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "Selected operation under **Modify response header**: *Remove*\n\n**Header name**: `cf-connecting-ip`\n\n</page>\n\n<page>\n---\ntitle: Rewrite blog archive URLs Â· Cloudflare Rules docs\ndescription: Create a transform rule to rewrite the URL format\n  `/posts/<YYYY>-<MM>-<DD>-<TITLE>` to the new format\n  `/posts/<YYYY>/<MM>/<DD>/<TITLE>`.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: URL rewrite\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/rewrite-archive-urls-new-format/\n  md: https://developers.cloudflare.com/rules/transform/examples/rewrite-archive-urls-new-format/index.md\n---\n\nTo rewrite the URLs of a blog archive that follow the URL format `/posts/<YYYY>-<MM>-<DD>-<TITLE>` to the new format `/posts/<YYYY>/<MM>/<DD>/<TITLE>`, create the following URL rewrite rule:\n\nText in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "Text after **Path** > **Rewrite to** > *Dynamic*:",
      "language": "unknown"
    },
    {
      "code": "The function `regex_replace()` also allows you to extract parts of the URL using regular expressions' capture groups. Create capture groups by putting part of the regular expression in parentheses. Then, reference a capture group using `${<NUMBER>}` in the replacement string, where `<NUMBER>` is the number of the capture group.\n\n</page>\n\n<page>\n---\ntitle: Rewrite path of moved section of a website Â· Cloudflare Rules docs\ndescription: Create a URL rewrite rule (part of Transform Rules) to rewrite\n  everything under `/blog/<PATH>` to `/marketing/<PATH>`.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: URL rewrite\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/rewrite-moved-section/\n  md: https://developers.cloudflare.com/rules/transform/examples/rewrite-moved-section/index.md\n---\n\nTo rewrite everything under `/blog/<PATH>` to `/marketing/<PATH>`, create a new URL rewrite rule and define a dynamic URL path rewrite using [wildcard pattern parameters](https://developers.cloudflare.com/rules/transform/url-rewrite/create-dashboard/#wildcard-pattern-parameters):\n\n**When incoming requests match**\n\n* **Wildcard pattern**\n  * **Request URL**: `https://<YOUR_HOSTNAME>/blog/*`\n\n**Then rewrite the path and/or query**\n\n* **Target path**: \\[`/`] `blog/*`\n* **Rewrite to**: \\[`/`] `marketing/${1}`\n\nMake sure to replace `<YOUR_HOSTNAME>` with your actual hostname and adjust the example paths according to your setup.\n\n</page>\n\n<page>\n---\ntitle: Rewrite path of archived blog posts Â· Cloudflare Rules docs\ndescription: Create a URL rewrite rule (part of Transform Rules) to rewrite any\n  requests for `/news/2012/...` URI paths to `/archive/news/2012/...`.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: URL rewrite\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/rewrite-path-archived-posts/\n  md: https://developers.cloudflare.com/rules/transform/examples/rewrite-path-archived-posts/index.md\n---\n\nTo rewrite all requests to `/news/2012/...` to `/archive/news/2012/...` you must add a reference to the content of the original URL. Create a new URL rewrite rule and define a dynamic URL path rewrite using [wildcard pattern parameters](https://developers.cloudflare.com/rules/transform/url-rewrite/create-dashboard/#wildcard-pattern-parameters):\n\n**When incoming requests match**\n\n* **Wildcard pattern**\n  * **Request URL**: `https://<YOUR_HOSTNAME>/news/2012/*`\n\n**Then rewrite the path and/or query**\n\n* **Target path**: \\[`/`] `news/2012/*`\n* **Rewrite to**: \\[`/`] `archive/news/2012/${1}`\n\nMake sure to replace `<YOUR_HOSTNAME>` with your actual hostname and adjust the example paths according to your setup.\n\n</page>\n\n<page>\n---\ntitle: Rewrite path for object storage bucket Â· Cloudflare Rules docs\ndescription: Create a URL rewrite rule (part of Transform Rules) to rewrite any\n  requests for `/files/...` URI paths to `/...`.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: URL rewrite\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/rewrite-path-object-storage/\n  md: https://developers.cloudflare.com/rules/transform/examples/rewrite-path-object-storage/index.md\n---\n\nTo remove `/files/` from URI paths before routing request to your object storage bucket, create a new URL rewrite rule and define a dynamic URL path rewrite using [wildcard pattern parameters](https://developers.cloudflare.com/rules/transform/url-rewrite/create-dashboard/#wildcard-pattern-parameters):\n\n**When incoming requests match**\n\n* **Wildcard pattern**\n  * **Request URL**: `https://<YOUR_HOSTNAME>/files/*`\n\n**Then rewrite the path and/or query**\n\n* **Target path**: \\[`/`] `files/*`\n* **Rewrite to**: \\[`/`] `${1}`\n\nMake sure to replace `<YOUR_HOSTNAME>` with your actual hostname and adjust the example paths according to your setup. Then, use [Cloud Connector](https://developers.cloudflare.com/rules/cloud-connector/) to route traffic to an object storage bucket.\n\n</page>\n\n<page>\n---\ntitle: Rewrite image paths with several URL segments Â· Cloudflare Rules docs\ndescription: Create a URL rewrite rule (part of Transform Rules) to rewrite any\n  requests for `/images/<FOLDER1>/<FOLDER2>/<FILENAME>` to `/img/<FILENAME>`.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: URL rewrite\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/rewrite-several-url-different-url/\n  md: https://developers.cloudflare.com/rules/transform/examples/rewrite-several-url-different-url/index.md\n---\n\nTo rewrite paths like `/images/<FOLDER1>/<FOLDER2>/<FILENAME>` â€” where `<FOLDER1>`, `<FOLDER2>`, and `<FILENAME>` can vary â€” to `/img/<FILENAME>`, create a URL rewrite rule with a dynamic rewrite of the path component:\n\nText in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "Text after **Path** > **Rewrite to** > *Dynamic*:",
      "language": "unknown"
    },
    {
      "code": "For example, this rule would rewrite the `/images/nature/animals/tiger.png` path to `/img/tiger.png`.\n\n</page>\n\n<page>\n---\ntitle: Rewrite URL query string Â· Cloudflare Rules docs\ndescription: Create a transform rule to rewrite the request path from `/blog` to\n  `/blog?sort-by=date`.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: URL rewrite\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/rewrite-url-string-visitors/\n  md: https://developers.cloudflare.com/rules/transform/examples/rewrite-url-string-visitors/index.md\n---\n\nTo rewrite a request to the `/blog` path to `/blog?sort-by=date`, create a URL rewrite rule with the following settings:\n\nText in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "Text after **Query** > **Rewrite to** > *Static*:",
      "language": "unknown"
    },
    {
      "code": "Additionally, set the path rewrite action of the same rule to *Preserve* so that the URL path does not change.\n\n</page>\n\n<page>\n---\ntitle: Rewrite page path for visitors in specific countries Â· Cloudflare Rules docs\ndescription: Create two URL rewrite rules (part of Transform Rules) to rewrite\n  the path of the welcome page for visitors in specific countries.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: URL rewrite\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/rewrite-welcome-for-countries/\n  md: https://developers.cloudflare.com/rules/transform/examples/rewrite-welcome-for-countries/index.md\n---\n\nTo have a welcome page in two languages, create two URL rewrite rules with a static rewrite of the path component:\n\n**URL rewrite rule #1**\n\nText in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "Text after **Path** > **Rewrite to** > *Static*:",
      "language": "unknown"
    },
    {
      "code": "**URL rewrite rule #2**\n\nText in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "Text after **Path** > **Rewrite to** > *Static*:",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Set a response header with the current bot score Â· Cloudflare Rules docs\ndescription: Create a response header transform rule (part of Transform Rules)\n  to set an `X-Bot-Score` HTTP header in the response with the current bot\n  score.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Response modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/set-response-header-bot-score/\n  md: https://developers.cloudflare.com/rules/transform/examples/set-response-header-bot-score/index.md\n---\n\nThe following response header transform rule sets a header named `X-Bot-Score` to the current bot score in the HTTP response:\n\nText in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "Selected operation under **Modify response header**: *Set dynamic*\n\n**Header name**: `X-Bot-Score`\n\n**Value**: `to_string(cf.bot_management.score)`\n\nThis rule would overwrite any existing `X-Bot-Score` headers already present in the HTTP response.\n\n</page>\n\n<page>\n---\ntitle: Set response header with a static value Â· Cloudflare Rules docs\ndescription: Create a response header transform rule (part of Transform Rules)\n  to set an `X-Bot-Score` HTTP header in the response to a static value\n  (`Cloudflare`).\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Response modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/examples/set-response-header-static-value/\n  md: https://developers.cloudflare.com/rules/transform/examples/set-response-header-static-value/index.md\n---\n\nThe following response header transform rule sets a header named `X-Source` to a static value (`Cloudflare`) in the HTTP response:\n\nText in **Expression Editor**:",
      "language": "unknown"
    },
    {
      "code": "Selected operation under **Modify response header**: *Set static*\n\n**Header name**: `X-Source`\n\n**Value**: `Cloudflare`\n\nThis rule would overwrite any existing `X-Source` headers already present in the HTTP response.\n\n</page>\n\n<page>\n---\ntitle: Configure Managed Transforms Â· Cloudflare Rules docs\ndescription: Learn how to configure Managed Transforms.\nlastUpdated: 2025-09-24T12:01:01.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/managed-transforms/configure/\n  md: https://developers.cloudflare.com/rules/transform/managed-transforms/configure/index.md\n---\n\n* Dashboard\n\n  1. In the Cloudflare dashboard, go to the Rules **Settings** page.\n\n     [Go to **Settings**](https://dash.cloudflare.com/?to=/:account/:zone/rules/settings)\n\n  2. In the **Managed Transforms** tab, enable or disable the [desired Managed Transforms](https://developers.cloudflare.com/rules/transform/managed-transforms/reference/) by selecting the toggle next to each entry. Some Managed Transforms may not be available in your Cloudflare plan or product subscriptions.\n\n* API\n\n  **1. Get list of available Managed Transforms**\n\n  Check the Managed Transform's current status and availability using the [List Managed Transforms](https://developers.cloudflare.com/api/resources/managed_transforms/methods/list/) operation.\n\n  The following example request obtains a list of available Managed Transforms, organized by request or response, with information about their current status (`enabled` field) and if you can update them, based on conflicts with other enabled Managed Transforms (`has_conflict` field).\n\n  Each Managed Transform item will optionally contain a `conflicts_with` array informing you about any Managed Transforms that will conflict with the current Managed Transform when enabled.\n\n  The response will only include available Managed Transforms according to your Cloudflare plan and product subscriptions.\n\n  Required API token permissions\n\n  At least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n  * `Response Compression Write`\n  * `Response Compression Read`\n  * `Config Settings Write`\n  * `Config Settings Read`\n  * `Dynamic URL Redirects Write`\n  * `Dynamic URL Redirects Read`\n  * `Cache Settings Write`\n  * `Cache Settings Read`\n  * `Custom Errors Write`\n  * `Custom Errors Read`\n  * `Origin Write`\n  * `Origin Read`\n  * `Managed headers Write`\n  * `Managed headers Read`\n  * `Zone Transform Rules Write`\n  * `Zone Transform Rules Read`\n  * `Mass URL Redirects Write`\n  * `Mass URL Redirects Read`\n  * `Magic Firewall Write`\n  * `Magic Firewall Read`\n  * `L4 DDoS Managed Ruleset Write`\n  * `L4 DDoS Managed Ruleset Read`\n  * `HTTP DDoS Managed Ruleset Write`\n  * `HTTP DDoS Managed Ruleset Read`\n  * `Sanitize Write`\n  * `Sanitize Read`\n  * `Transform Rules Write`\n  * `Transform Rules Read`\n  * `Select Configuration Write`\n  * `Select Configuration Read`\n  * `Bot Management Write`\n  * `Bot Management Read`\n  * `Zone WAF Write`\n  * `Zone WAF Read`\n  * `Account WAF Write`\n  * `Account WAF Read`\n  * `Account Rulesets Read`\n  * `Account Rulesets Write`\n  * `Logs Write`\n  * `Logs Read`\n  * `Logs Write`\n  * `Logs Read`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "**2. Change the status of Managed Transforms**\n\n  Change the status of the [desired Managed Transforms](https://developers.cloudflare.com/rules/transform/managed-transforms/reference/) using the [Update status of Managed Transforms](https://developers.cloudflare.com/api/resources/managed_transforms/methods/edit/) operation.\n\n  Add the Managed Transforms you wish to change to the request body, and update their status in the `enabled` field. You cannot enable a Managed Transform that has a conflict with a currently enabled Managed Transform (that is, an item where `has_conflict` is `true`).\n\n  Make sure you include the Managed Transforms you are updating in the correct JSON object (`managed_request_headers` or `managed_response_headers`).\n\n  The response will include all the available Managed Transforms and their new status after the update.\n\n  Required API token permissions\n\n  At least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n  * `Response Compression Write`\n  * `Config Settings Write`\n  * `Dynamic URL Redirects Write`\n  * `Cache Settings Write`\n  * `Custom Errors Write`\n  * `Origin Write`\n  * `Managed headers Write`\n  * `Zone Transform Rules Write`\n  * `Mass URL Redirects Write`\n  * `Magic Firewall Write`\n  * `L4 DDoS Managed Ruleset Write`\n  * `HTTP DDoS Managed Ruleset Write`\n  * `Sanitize Write`\n  * `Transform Rules Write`\n  * `Select Configuration Write`\n  * `Bot Management Write`\n  * `Zone WAF Write`\n  * `Account WAF Write`\n  * `Account Rulesets Write`\n  * `Logs Write`\n  * `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "* Terraform\n\n  Note\n\n  Terraform code snippets below refer to the v4 SDK only.\n\n  Use the `cloudflare_managed_headers` Terraform resource to configure Managed Transforms. For example:",
      "language": "unknown"
    },
    {
      "code": "Make sure you include the Managed Transforms you are updating in the correct object (`managed_request_headers` or `managed_response_headers`).\n\n</page>\n\n<page>\n---\ntitle: Available Managed Transforms Â· Cloudflare Rules docs\ndescription: Learn about Cloudflare's Managed Transforms for modifying HTTP\n  headers, including bot protection, TLS client auth, and leaked credentials\n  checks.\nlastUpdated: 2025-10-31T10:10:06.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/managed-transforms/reference/\n  md: https://developers.cloudflare.com/rules/transform/managed-transforms/reference/index.md\n---\n\nThis page lists the available Managed Transforms. They can modify HTTP request headers or response headers.\n\nFor more complex and customized header modifications, consider using [Snippets](https://developers.cloudflare.com/rules/snippets/).\n\n## Important remarks\n\n* Enabling a Managed Transform may cause issues in your website. You should test any changes in a staging environment. If you detect any undesired or unexpected behavior, consider disabling the Managed Transform and creating a partial implementation using your own transform rule.\n\n* The names of HTTP headers are case-insensitive. Cloudflare may use a capitalization different from the one presented in this page. Make sure that your origin server can handle HTTP request headers regardless of the exact capitalization of their names.\n\n## HTTP request headers\n\n### Add bot protection headers\n\nNote\n\nRequires an Enterprise plan with [Bot Management](https://developers.cloudflare.com/bots/plans/bm-subscription/) enabled.\n\nAdds HTTP headers with bot-related values to the request sent to the origin server:\n\n* `cf-bot-score`: Contains the [bot score](https://developers.cloudflare.com/bots/concepts/bot-score/) (for example, `30`).\n* `cf-verified-bot`: Contains `true` if the request comes from a [verified bot](https://developers.cloudflare.com/bots/concepts/bot/verified-bots/), or `false` otherwise.\n* `cf-ja3-hash`: Contains the [JA3 fingerprint](https://developers.cloudflare.com/bots/additional-configurations/ja3-ja4-fingerprint/).\n* `cf-ja4`: Contains the [JA4 fingerprint](https://developers.cloudflare.com/bots/additional-configurations/ja3-ja4-fingerprint/).\n\n### Add TLS client auth headers\n\nAdds HTTP headers with [Mutual TLS](https://developers.cloudflare.com/api-shield/security/mtls/) (mTLS) client authentication values to the request sent to the origin server:\n\n* `cf-cert-revoked`: Value from the [`cf.tls_client_auth.cert_revoked`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_revoked/) field.\n* `cf-cert-verified`: Value from the [`cf.tls_client_auth.cert_verified`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_verified/) field.\n* `cf-cert-presented`: Value from the [`cf.tls_client_auth.cert_presented`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_presented/) field.\n* `cf-cert-issuer-dn`: Value from the [`cf.tls_client_auth.cert_issuer_dn`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_issuer_dn/) field.\n* `cf-cert-subject-dn`: Value from the [`cf.tls_client_auth.cert_subject_dn`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_subject_dn/) field.\n* `cf-cert-issuer-dn-rfc2253`: Value from the [`cf.tls_client_auth.cert_issuer_dn_rfc2253`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_issuer_dn_rfc2253/) field.\n* `cf-cert-subject-dn-rfc2253`: Value from the [`cf.tls_client_auth.cert_subject_dn_rfc2253`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_subject_dn_rfc2253/) field.\n* `cf-cert-issuer-dn-legacy`: Value from the [`cf.tls_client_auth.cert_issuer_dn_legacy`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_issuer_dn_legacy/) field.\n* `cf-cert-subject-dn-legacy`: Value from the [`cf.tls_client_auth.cert_subject_dn_legacy`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_subject_dn_legacy/) field.\n* `cf-cert-serial`: Value from the [`cf.tls_client_auth.cert_serial`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_serial/) field.\n* `cf-cert-issuer-serial`: Value from the [`cf.tls_client_auth.cert_issuer_serial`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_issuer_serial/) field.\n* `cf-cert-fingerprint-sha256`: Value from the [`cf.tls_client_auth.cert_fingerprint_sha256`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_fingerprint_sha256/) field.\n* `cf-cert-fingerprint-sha1`: Value from the [`cf.tls_client_auth.cert_fingerprint_sha1`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_fingerprint_sha1/) field.\n* `cf-cert-not-before`: Value from the [`cf.tls_client_auth.cert_not_before`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_not_before/) field.\n* `cf-cert-not-after`: Value from the [`cf.tls_client_auth.cert_not_after`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_not_after/) field.\n* `cf-cert-ski`: Value from the [`cf.tls_client_auth.cert_ski`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_ski/) field.\n* `cf-cert-issuer-ski`: Value from the [`cf.tls_client_auth.cert_issuer_ski`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.tls_client_auth.cert_issuer_ski/) field.\n\n### Add visitor location headers\n\nAdds HTTP headers with location information for the visitor's IP address to the request sent to the origin server:\n\n* `cf-ipcity`: The visitor's city (value from the [`ip.src.city`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/ip.src.city/) field).\n* `cf-ipcountry`: The visitor's country (value from the [`ip.src.country`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/ip.src.country/) field).\n* `cf-ipcontinent`: The visitor's continent (value from the [`ip.src.continent`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/ip.src.continent/) field).\n* `cf-iplongitude`: The visitor's longitude (value from the [`ip.src.lon`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/ip.src.lon/) field).\n* `cf-iplatitude`: The visitor's latitude (value from the [`ip.src.lat`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/ip.src.lat/) field).\n* `cf-region`: The visitor's region (value from the [`ip.src.region`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/ip.src.region/) field).\n* `cf-region-code`: The visitor's region code (value from the [`ip.src.region_code`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/ip.src.region_code/) field).\n* `cf-metro-code`: The visitor's metro code (value from the [`ip.src.metro_code`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/ip.src.metro_code/) field).\n* `cf-postal-code`: The visitor's postal code (value from the [`ip.src.postal_code`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/ip.src.postal_code/) field).\n* `cf-timezone`: The name of the visitor's timezone (value from the [`ip.src.timezone.name`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/ip.src.timezone.name/) field).\n\nNote\n\nTurning on [IP geolocation](https://developers.cloudflare.com/network/ip-geolocation/) will send a `cf-ipcountry` HTTP header to your origin server even when **Add visitor location headers** is turned off.\n\n#### Encoding of non-ASCII header values\n\nCloudflare always converts non-ASCII characters to UTF-8 (using hexadecimal character representation) in HTTP request and response header values. This applies to location headers added by the **Add visitor location headers** managed transform.\n\nFor example, the header value `SÃ£o Paulo` would be encoded as `S\\u00c3\\u00a3o Paulo`.\n\n### Add \"True-Client-IP\" header\n\nNote\n\nOnly available on Enterprise plans.\n\nAdds a `true-client-ip` request header with the visitor's IP address.\n\nThis Managed Transform is unavailable when [**Remove visitor IP headers**](#remove-visitor-ip-headers) is enabled.\n\n### Remove visitor IP headers\n\nRemoves HTTP headers that may contain the visitor's IP address from the request sent to the origin server. Handles the following HTTP request headers:\n\n* `cf-connecting-ip`\n* `x-forwarded-for` (refer to the [notes](#visitor-ip-address-in-the-x-forwarded-for-http-header) below)\n* `true-client-ip`\n\nThis Managed Transform is unavailable when [**Add \"True-Client-IP\" header**](#add-true-client-ip-header) is enabled.\n\n#### Visitor IP address in the `x-forwarded-for` HTTP header\n\nFor the `x-forwarded-for` HTTP request header, enabling **Remove visitor IP headers** will only remove the visitor IP from the header value when Cloudflare receives a request proxied by at least another CDN (content delivery network). In this case, Cloudflare will only keep the IP address of the last proxy.\n\nFor example, consider an incoming request proxied by two CDNs (`CDN_1` and `CDN_2`) before reaching the Cloudflare network. The `x-forwarded-for` header would be similar to the following:\\\n`x-forwarded-for: <VISITOR_IP>, <THIRD_PARTY_CDN_1_IP>, <THIRD_PARTY_CDN_2_IP>`\n\nWith **Remove visitor IP headers** enabled, the `x-forwarded-for` header sent to the origin server will be:\\\n`x-forwarded-for: <THIRD_PARTY_CDN_2_IP>`\n\n### Add leaked credentials checks header\n\nAdds an `Exposed-Credential-Check` request header whenever the WAF detects leaked credentials in the incoming request.\n\nThe header can have these values:\n\n| Header + Value | Description | Availability |\n| - | - | - |\n| `Exposed-Credential-Check: 1` | Previously leaked username and password detected | Pro plan and above |\n| `Exposed-Credential-Check: 2` | Previously leaked username detected | Enterprise plan |\n| `Exposed-Credential-Check: 3` | Similar combination of previously leaked username and password detected | Enterprise plan |\n| `Exposed-Credential-Check: 4` | Previously leaked password detected | All plans |\n\nYou will only receive this managed header at your origin server if:\n\n* The [leaked credentials detection](https://developers.cloudflare.com/waf/detections/leaked-credentials/) in the WAF is turned on.\n* The **Add Leaked Credentials Checks Header** managed transform is turned on.\n* Your Cloudflare plan supports the type of credentials detection. For example, Free plans can only know if a password was previously leaked. In this situation, Cloudflare will add an `Exposed-Credential-Check: 4` header to the request.\n\n### Add malicious uploads detection header\n\nAdds a `Malicious-Uploads-Detection` request header indicating the outcome of scanning uploaded content for malicious signatures.\n\nThe header can have one of the following values:\n\n| Header + Value | Description |\n| - | - |\n| `Malicious-Uploads-Detection: 1` | The request contains at least one malicious content object ([`cf.waf.content_scan.has_malicious_obj`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.waf.content_scan.has_malicious_obj/) is `true`). |\n| `Malicious-Uploads-Detection: 2` | The file scanner was unable to scan all the content objects detected in the request ([`cf.waf.content_scan.has_failed`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.waf.content_scan.has_failed/) is `true`). |\n| `Malicious-Uploads-Detection: 3` | The request contains at least one content object ([`cf.waf.content_scan.has_obj`](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/cf.waf.content_scan.has_obj/) is `true`). |\n\nFor more information, refer to [Malicious uploads detection](https://developers.cloudflare.com/waf/detections/malicious-uploads/).\n\n## HTTP response headers\n\n### Remove \"X-Powered-By\" headers\n\nRemoves the `X-Powered-By` HTTP response header that provides information about the application at the origin server that handled the request.\n\n### Add security headers\n\nNote\n\nAdding the following security headers may have an impact on your website, such as blocking resources or triggering certificate errors. If you find any issues, try disabling the Managed Transform to isolate the possible cause.\n\nAdds several security-related HTTP response headers. The added response headers and values are the following:\n\n* `x-content-type-options: nosniff`\n* `x-xss-protection: 1; mode=block`\n* `x-frame-options: SAMEORIGIN`\n* `referrer-policy: same-origin`\n* `expect-ct: max-age=86400, enforce`\n\nTo increase protection, [enable HTTP Strict Transport Security (HSTS)](https://developers.cloudflare.com/ssl/edge-certificates/additional-options/http-strict-transport-security/) for your website.\n\n</page>\n\n<page>\n---\ntitle: Create a request header transform rule via API Â· Cloudflare Rules docs\ndescription: Use the Rulesets API to create Request Header Transform Rules via\n  API. Refer to the Rules examples gallery for common use cases.\nlastUpdated: 2025-08-22T14:24:45.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/request-header-modification/create-api/\n  md: https://developers.cloudflare.com/rules/transform/request-header-modification/create-api/index.md\n---\n\nUse the [Rulesets API](https://developers.cloudflare.com/ruleset-engine/rulesets-api/) to create Request Header Transform Rules via API. Refer to the [Rules examples gallery](https://developers.cloudflare.com/rules/transform/examples/?operation=Request+modification) for common use cases.\n\nIf you are using Terraform, refer to [Transform Rules configuration using Terraform](https://developers.cloudflare.com/terraform/additional-configurations/transform-rules/#create-a-request-header-transform-rule).\n\n## Basic rule settings\n\nWhen creating a request header transform rule via API, make sure you:\n\n* Set the rule action to `rewrite`.\n* Define the [header modification parameters](https://developers.cloudflare.com/rules/transform/request-header-modification/reference/parameters/) in the `action_parameters` field according to the operation to perform (set or remove header).\n* Deploy the rule to the `http_request_late_transform` phase at the zone level.\n\n## Procedure\n\nFollow this workflow to create a request header transform rule for a given zone via API:\n\n1. Use the [List zone rulesets](https://developers.cloudflare.com/api/resources/rulesets/methods/list/) operation to check if there is already a ruleset for the `http_request_late_transform` phase at the zone level.\n\n2. If the phase ruleset does not exist, create it using the [Create a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/create/) operation. In the new ruleset properties, set the following values:\n\n   * **kind**: `zone`\n   * **phase**: `http_request_late_transform`\n\n3. Use the [Update a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/update/) operation to add a request header transform rule to the list of ruleset rules. Alternatively, include the rule in the [Create a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/create/) request mentioned in the previous step.\n\nMake sure your API token has the [required permissions](#required-api-token-permissions) to perform the API operations.\n\n## Example requests\n\nExample: Add an HTTP request header with a static value\n\nThe following example sets the rules of an existing phase ruleset (`$RULESET_ID`) to a single request header transform rule â€” adding an HTTP request header with a static value â€” using the [Update a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/update/) operation. The response will contain the complete definition of the ruleset you updated.\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Response Compression Write`\n* `Config Settings Write`\n* `Dynamic URL Redirects Write`\n* `Cache Settings Write`\n* `Custom Errors Write`\n* `Origin Write`\n* `Managed headers Write`\n* `Zone Transform Rules Write`\n* `Mass URL Redirects Write`\n* `Magic Firewall Write`\n* `L4 DDoS Managed Ruleset Write`\n* `HTTP DDoS Managed Ruleset Write`\n* `Sanitize Write`\n* `Transform Rules Write`\n* `Select Configuration Write`\n* `Bot Management Write`\n* `Zone WAF Write`\n* `Account WAF Write`\n* `Account Rulesets Write`\n* `Logs Write`\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "Use the `ref` field to get stable rule IDs across updates when using Terraform. Adding this field prevents Terraform from recreating the rule on changes. For more information, refer to [Troubleshooting](https://developers.cloudflare.com/terraform/troubleshooting/rule-id-changes/#how-to-keep-the-same-rule-id-between-modifications) in the Terraform documentation.\n\nExample: Add an HTTP request header with a dynamic value\n\nThe following example sets the rules of an existing phase ruleset (`$RULESET_ID`) to a single request header transform rule â€” adding an HTTP request header with a dynamic value â€” using the [Update a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/update/) operation. The response will contain the complete definition of the ruleset you updated.\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Response Compression Write`\n* `Config Settings Write`\n* `Dynamic URL Redirects Write`\n* `Cache Settings Write`\n* `Custom Errors Write`\n* `Origin Write`\n* `Managed headers Write`\n* `Zone Transform Rules Write`\n* `Mass URL Redirects Write`\n* `Magic Firewall Write`\n* `L4 DDoS Managed Ruleset Write`\n* `HTTP DDoS Managed Ruleset Write`\n* `Sanitize Write`\n* `Transform Rules Write`\n* `Select Configuration Write`\n* `Bot Management Write`\n* `Zone WAF Write`\n* `Account WAF Write`\n* `Account Rulesets Write`\n* `Logs Write`\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "Use the `ref` field to get stable rule IDs across updates when using Terraform. Adding this field prevents Terraform from recreating the rule on changes. For more information, refer to [Troubleshooting](https://developers.cloudflare.com/terraform/troubleshooting/rule-id-changes/#how-to-keep-the-same-rule-id-between-modifications) in the Terraform documentation.\n\nExample: Remove an HTTP request header\n\nThe following example sets the rules of an existing phase ruleset (`$RULESET_ID`) to a single request header transform rule â€” removing an HTTP request header â€” using the [Update a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/update/). The response will contain the complete definition of the ruleset you updated.\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Response Compression Write`\n* `Config Settings Write`\n* `Dynamic URL Redirects Write`\n* `Cache Settings Write`\n* `Custom Errors Write`\n* `Origin Write`\n* `Managed headers Write`\n* `Zone Transform Rules Write`\n* `Mass URL Redirects Write`\n* `Magic Firewall Write`\n* `L4 DDoS Managed Ruleset Write`\n* `HTTP DDoS Managed Ruleset Write`\n* `Sanitize Write`\n* `Transform Rules Write`\n* `Select Configuration Write`\n* `Bot Management Write`\n* `Zone WAF Write`\n* `Account WAF Write`\n* `Account Rulesets Write`\n* `Logs Write`\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "Use the `ref` field to get stable rule IDs across updates when using Terraform. Adding this field prevents Terraform from recreating the rule on changes. For more information, refer to [Troubleshooting](https://developers.cloudflare.com/terraform/troubleshooting/rule-id-changes/#how-to-keep-the-same-rule-id-between-modifications) in the Terraform documentation.\n\n***\n\n## Required API token permissions\n\nThe API token used in API requests to manage Request Header Transform Rules must have at least the following permissions:\n\n* *Transform Rules* > *Edit*\n* *Account Rulesets* > *Read*\n\n</page>\n\n<page>\n---\ntitle: Create a request header transform rule in the dashboard Â· Cloudflare Rules docs\ndescription: Refer to the Rules examples gallery for examples of rule definitions.\nlastUpdated: 2025-09-24T12:01:01.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/request-header-modification/create-dashboard/\n  md: https://developers.cloudflare.com/rules/transform/request-header-modification/create-dashboard/index.md\n---\n\nRefer to the [Rules examples gallery](https://developers.cloudflare.com/rules/transform/examples/?operation=Request+modification) for examples of rule definitions.\n\nTo create a rule:\n\n1. In the Cloudflare dashboard, go to the Rules **Overview** page.\n\n   [Go to **Overview**](https://dash.cloudflare.com/?to=/:account/:zone/rules/overview)\n\n2. Select **Create rule** > **Request Header Transform Rule**.\n\n3. (Optional) Select one of the rule templates that address common use cases. Then, review and adjust the proposed rule configuration.\n\n4. Enter a descriptive name for the rule in **Rule name**.\n\n5. Under **When incoming requests match**, select if you wish to apply the rule to all incoming requests or only to requests that match a custom filter expression.\n\n6. (Optional) To define a custom expression, use the Expression Builder (specifying one or more values for **Field**, **Operator**, and **Value**) or manually enter an expression using the Expression Editor. For more information, refer to [Edit expressions in the dashboard](https://developers.cloudflare.com/ruleset-engine/rules-language/expressions/edit-expressions/).\n\n   Note\n\n   Check the [available fields and functions](https://developers.cloudflare.com/rules/transform/request-header-modification/reference/fields-functions/).\n\n7. For **Modify request header**, select one of the following options:\n\n   * *Set static* â€” Sets the value of an HTTP request header to a static string value. Overrides the value of an existing header with the same name or adds a new header if it does not exist.\n   * *Set dynamic* â€” Sets the value of an HTTP request header according to the provided expression. Overrides the value of an existing header with the same name or adds a new header if it does not exist.\n   * *Remove* â€” Removes the HTTP request header with the provided name, if it exists.\n\n8. Enter the name of the HTTP request header to modify in **Header name** and the static value or expression in **Value**, if you are setting the header value.\n\n9. To modify another HTTP request header in the same rule, select **Set new header**. You can modify up to 30 HTTP request headers in a single rule.\n\n   The following example includes the modification of three headers:\n\n   ![Example configuration performing three request header modifications: set a dynamic header value, set a static header value, and remove an existing header.](https://developers.cloudflare.com/_astro/request-header-modification-example.CKUUJ7cw_1AJD1c.webp)\n\n10. To save and deploy your rule, select **Deploy**. If you are not ready to deploy your rule, select **Save as Draft**.\n\n    If you are matching a hostname in your rule expression, you may be prompted to create a proxied DNS record for that hostname. Refer to [Troubleshooting](https://developers.cloudflare.com/rules/reference/troubleshooting/#this-rule-may-not-apply-to-your-traffic) for more information.\n\n</page>\n\n<page>\n---\ntitle: Create a rule using Terraform Â· Cloudflare Rules docs\nlastUpdated: 2025-04-15T11:19:33.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/request-header-modification/link-create-terraform/\n  md: https://developers.cloudflare.com/rules/transform/request-header-modification/link-create-terraform/index.md\n---\n\n\n</page>\n\n<page>\n---\ntitle: Reference Â· Cloudflare Rules docs\ndescription: This section contains reference information for Request Header Transform Rules.\nlastUpdated: 2025-04-15T11:19:33.000Z\nchatbotDeprioritize: true\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/request-header-modification/reference/\n  md: https://developers.cloudflare.com/rules/transform/request-header-modification/reference/index.md\n---\n\nThis section contains reference information for Request Header Transform Rules.\n\n* [Format of HTTP request header names and values](https://developers.cloudflare.com/rules/transform/request-header-modification/reference/header-format/)\n* [Available fields and functions](https://developers.cloudflare.com/rules/transform/request-header-modification/reference/fields-functions/)\n* [API parameter reference](https://developers.cloudflare.com/rules/transform/request-header-modification/reference/parameters/)\n\n</page>\n\n<page>\n---\ntitle: Create a response header transform rule via API Â· Cloudflare Rules docs\ndescription: Use the Rulesets API to create Response Header Transform Rules via\n  API. Refer to the Rules examples gallery for common use cases.\nlastUpdated: 2025-08-22T14:24:45.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/response-header-modification/create-api/\n  md: https://developers.cloudflare.com/rules/transform/response-header-modification/create-api/index.md\n---\n\nUse the [Rulesets API](https://developers.cloudflare.com/ruleset-engine/rulesets-api/) to create Response Header Transform Rules via API. Refer to the [Rules examples gallery](https://developers.cloudflare.com/rules/transform/examples/?operation=Response+modification) for common use cases.\n\nIf you are using Terraform, refer to [Transform Rules configuration using Terraform](https://developers.cloudflare.com/terraform/additional-configurations/transform-rules/#create-a-response-header-transform-rule).\n\n## Basic rule settings\n\nWhen creating a response header transform rule via API, make sure you:\n\n* Set the rule action to `rewrite`.\n* Define the [header modification parameters](https://developers.cloudflare.com/rules/transform/request-header-modification/reference/parameters/) in the `action_parameters` field according to the operation to perform (set, add, or remove header).\n* Deploy the rule to the `http_response_headers_transform` phase at the zone level.\n\n## Procedure\n\nFollow this workflow to create a response header transform rule for a given zone via API:\n\n1. Use the [List zone rulesets](https://developers.cloudflare.com/api/resources/rulesets/methods/list/) operation to check if there is already a ruleset for the `http_response_headers_transform` phase at the zone level.\n\n2. If the phase ruleset does not exist, create it using the [Create a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/create/) operation. In the new ruleset properties, set the following values:\n\n   * **kind**: `zone`\n   * **phase**: `http_response_headers_transform`\n\n3. Use the [Update a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/update/) operation to add a response header transform rule to the list of ruleset rules. Alternatively, include the rule in the [Create a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/create/) request mentioned in the previous step.\n\nMake sure your API token has the [required permissions](#required-api-token-permissions) to perform the API operations.\n\n## Example requests\n\nExample: Set an HTTP response header to a static value\n\nThe following example configures the rules of an existing phase ruleset (`$RULESET_ID`) to a single response header transform rule â€” setting an HTTP response header to a static value â€” using the [Update a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/update/) operation. The response will contain the complete definition of the ruleset you updated.\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Response Compression Write`\n* `Config Settings Write`\n* `Dynamic URL Redirects Write`\n* `Cache Settings Write`\n* `Custom Errors Write`\n* `Origin Write`\n* `Managed headers Write`\n* `Zone Transform Rules Write`\n* `Mass URL Redirects Write`\n* `Magic Firewall Write`\n* `L4 DDoS Managed Ruleset Write`\n* `HTTP DDoS Managed Ruleset Write`\n* `Sanitize Write`\n* `Transform Rules Write`\n* `Select Configuration Write`\n* `Bot Management Write`\n* `Zone WAF Write`\n* `Account WAF Write`\n* `Account Rulesets Write`\n* `Logs Write`\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "Use the `ref` field to get stable rule IDs across updates when using Terraform. Adding this field prevents Terraform from recreating the rule on changes. For more information, refer to [Troubleshooting](https://developers.cloudflare.com/terraform/troubleshooting/rule-id-changes/#how-to-keep-the-same-rule-id-between-modifications) in the Terraform documentation.\n\nExample: Set an HTTP response header to a dynamic value\n\nThe following example configures the rules of an existing phase ruleset (`$RULESET_ID`) to a single response header transform rule â€” setting an HTTP response header to a dynamic value â€” using the [Update a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/update/) operation. The response will contain the complete definition of the ruleset you updated.\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Response Compression Write`\n* `Config Settings Write`\n* `Dynamic URL Redirects Write`\n* `Cache Settings Write`\n* `Custom Errors Write`\n* `Origin Write`\n* `Managed headers Write`\n* `Zone Transform Rules Write`\n* `Mass URL Redirects Write`\n* `Magic Firewall Write`\n* `L4 DDoS Managed Ruleset Write`\n* `HTTP DDoS Managed Ruleset Write`\n* `Sanitize Write`\n* `Transform Rules Write`\n* `Select Configuration Write`\n* `Bot Management Write`\n* `Zone WAF Write`\n* `Account WAF Write`\n* `Account Rulesets Write`\n* `Logs Write`\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "Use the `ref` field to get stable rule IDs across updates when using Terraform. Adding this field prevents Terraform from recreating the rule on changes. For more information, refer to [Troubleshooting](https://developers.cloudflare.com/terraform/troubleshooting/rule-id-changes/#how-to-keep-the-same-rule-id-between-modifications) in the Terraform documentation.\n\nExample: Add a `set-cookie` HTTP response header with a static value\n\nThe following example configures the rules of an existing phase ruleset (`$RULESET_ID`) to a single response header transform rule â€” adding a `set-cookie` HTTP response header with a static value â€” using the [Update a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/update/) operation. By configuring the rule with the `add` operation you will keep any existing `set-cookie` headers that may already exist in the response. The response will contain the complete definition of the ruleset you updated.\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Response Compression Write`\n* `Config Settings Write`\n* `Dynamic URL Redirects Write`\n* `Cache Settings Write`\n* `Custom Errors Write`\n* `Origin Write`\n* `Managed headers Write`\n* `Zone Transform Rules Write`\n* `Mass URL Redirects Write`\n* `Magic Firewall Write`\n* `L4 DDoS Managed Ruleset Write`\n* `HTTP DDoS Managed Ruleset Write`\n* `Sanitize Write`\n* `Transform Rules Write`\n* `Select Configuration Write`\n* `Bot Management Write`\n* `Zone WAF Write`\n* `Account WAF Write`\n* `Account Rulesets Write`\n* `Logs Write`\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "Use the `ref` field to get stable rule IDs across updates when using Terraform. Adding this field prevents Terraform from recreating the rule on changes. For more information, refer to [Troubleshooting](https://developers.cloudflare.com/terraform/troubleshooting/rule-id-changes/#how-to-keep-the-same-rule-id-between-modifications) in the Terraform documentation.\n\nExample: Remove an HTTP response header\n\nThe following example sets the rules of an existing phase ruleset (`$RULESET_ID`) to a single response header transform rule â€” removing an HTTP response header â€” using the [Update a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/update/) operation. The response will contain the complete definition of the ruleset you updated.\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Response Compression Write`\n* `Config Settings Write`\n* `Dynamic URL Redirects Write`\n* `Cache Settings Write`\n* `Custom Errors Write`\n* `Origin Write`\n* `Managed headers Write`\n* `Zone Transform Rules Write`\n* `Mass URL Redirects Write`\n* `Magic Firewall Write`\n* `L4 DDoS Managed Ruleset Write`\n* `HTTP DDoS Managed Ruleset Write`\n* `Sanitize Write`\n* `Transform Rules Write`\n* `Select Configuration Write`\n* `Bot Management Write`\n* `Zone WAF Write`\n* `Account WAF Write`\n* `Account Rulesets Write`\n* `Logs Write`\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "Use the `ref` field to get stable rule IDs across updates when using Terraform. Adding this field prevents Terraform from recreating the rule on changes. For more information, refer to [Troubleshooting](https://developers.cloudflare.com/terraform/troubleshooting/rule-id-changes/#how-to-keep-the-same-rule-id-between-modifications) in the Terraform documentation.\n\n***\n\n## Required API token permissions\n\nThe API token used in API requests to manage Response Header Transform Rules must have at least the following permissions:\n\n* *Transform Rules* > *Edit*\n* *Account Rulesets* > *Read*\n\n</page>\n\n<page>\n---\ntitle: Create a response header transform rule in the dashboard Â· Cloudflare\n  Rules docs\ndescription: Refer to the Rules examples gallery for examples of rule definitions.\nlastUpdated: 2025-09-24T12:01:01.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/response-header-modification/create-dashboard/\n  md: https://developers.cloudflare.com/rules/transform/response-header-modification/create-dashboard/index.md\n---\n\nRefer to the [Rules examples gallery](https://developers.cloudflare.com/rules/transform/examples/?operation=Response+modification) for examples of rule definitions.\n\nTo create a rule:\n\n1. In the Cloudflare dashboard, go to the Rules **Overview** page.\n\n   [Go to **Overview**](https://dash.cloudflare.com/?to=/:account/:zone/rules/overview)\n\n2. Select **Create rule** > **Response Header Transform Rule**.\n\n3. (Optional) Select one of the rule templates that address common use cases. Then, review and adjust the proposed rule configuration.\n\n4. Enter a descriptive name for the rule in **Rule name**.\n\n5. Under **When incoming requests match**, select if you wish to apply the rule to all incoming requests or only to requests that match a custom filter expression.\n\n6. (Optional) To define a custom expression, use the Expression Builder (specifying one or more values for **Field**, **Operator**, and **Value**) or manually enter an expression using the Expression Editor. For more information, refer to [Edit expressions in the dashboard](https://developers.cloudflare.com/ruleset-engine/rules-language/expressions/edit-expressions/).\n\n   Note\n\n   Check the [available fields and functions](https://developers.cloudflare.com/rules/transform/response-header-modification/reference/fields-functions/).\n\n7. For **Modify response header**, select one of the following operations:\n\n   * *Add static* â€” Adds an HTTP response header with a static string value. This operation will not remove any existing response headers with the same name.\n   * *Add dynamic* â€” Adds an HTTP response header according to the provided expression. This operation will not remove any existing response headers with the same name.\n   * *Set static* â€” Sets the value of an HTTP response header to a static string value. Overrides the value of any existing headers with the same name or adds a new header if it does not exist.\n   * *Set dynamic* â€” Sets the value of an HTTP response header according to the provided expression. Overrides the value of any existing headers with the same name or adds a new header if it does not exist.\n   * *Remove* â€” Removes the HTTP response header with the provided name, if it exists.\n\n8. Enter the name of the HTTP response header to modify in **Header name** and the static value or expression in **Value**, if you are setting the header value.\n\n9. To modify another HTTP response header in the same rule, select **Set new header**. You can modify up to 30 HTTP response headers in a single rule.\n\n   The following example includes the modification of three response headers:\n\n   ![Example configuration performing three response header modifications: set a dynamic header value, set a static header value, and remove an existing header.](https://developers.cloudflare.com/_astro/response-header-modification-example.DTGup8MQ_Z1Ddrr.webp)\n\n10. To save and deploy your rule, select **Deploy**. If you are not ready to deploy your rule, select **Save as Draft**.\n\n    If you are matching a hostname in your rule expression, you may be prompted to create a proxied DNS record for that hostname. Refer to [Troubleshooting](https://developers.cloudflare.com/rules/reference/troubleshooting/#this-rule-may-not-apply-to-your-traffic) for more information.\n\n</page>\n\n<page>\n---\ntitle: Create a rule using Terraform Â· Cloudflare Rules docs\nlastUpdated: 2025-04-15T11:19:33.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/response-header-modification/link-create-terraform/\n  md: https://developers.cloudflare.com/rules/transform/response-header-modification/link-create-terraform/index.md\n---\n\n\n</page>\n\n<page>\n---\ntitle: Reference Â· Cloudflare Rules docs\ndescription: This section contains reference information for Response Header\n  Transform Rules.\nlastUpdated: 2025-04-15T11:19:33.000Z\nchatbotDeprioritize: true\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/response-header-modification/reference/\n  md: https://developers.cloudflare.com/rules/transform/response-header-modification/reference/index.md\n---\n\nThis section contains reference information for Response Header Transform Rules.\n\n* [Format of HTTP response header names and values](https://developers.cloudflare.com/rules/transform/response-header-modification/reference/header-format/)\n* [Available fields and functions](https://developers.cloudflare.com/rules/transform/response-header-modification/reference/fields-functions/)\n* [API parameter reference](https://developers.cloudflare.com/rules/transform/response-header-modification/reference/parameters/)\n\n</page>\n\n<page>\n---\ntitle: Create a URL rewrite rule via API Â· Cloudflare Rules docs\ndescription: Use the Rulesets API to create URL Rewrite Rules via API. Refer to\n  the Rules examples gallery for common use cases.\nlastUpdated: 2025-08-22T14:24:45.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/url-rewrite/create-api/\n  md: https://developers.cloudflare.com/rules/transform/url-rewrite/create-api/index.md\n---\n\nUse the [Rulesets API](https://developers.cloudflare.com/ruleset-engine/rulesets-api/) to create URL Rewrite Rules via API. Refer to the [Rules examples gallery](https://developers.cloudflare.com/rules/transform/examples/?operation=Rewrite+URL) for common use cases.\n\nIf you are using Terraform, refer to [Transform Rules configuration using Terraform](https://developers.cloudflare.com/terraform/additional-configurations/transform-rules/#create-a-url-rewrite-rule).\n\n## Basic rule settings\n\nWhen creating a URL rewrite rule via API, make sure you:\n\n* Set the rule action to `rewrite`.\n* Define the [URL rewrite parameters](https://developers.cloudflare.com/rules/transform/url-rewrite/reference/parameters/#api-information) in the `action_parameters` field according to the type of URL rewrite (static or dynamic).\n* Deploy the rule to the `http_request_transform` phase at the zone level.\n\n## Procedure\n\nFollow this workflow to create a URL rewrite rule for a given zone via API:\n\n1. Use the [List zone rulesets](https://developers.cloudflare.com/api/resources/rulesets/methods/list/) operation to check if there is already a ruleset for the `http_request_transform` phase at the zone level.\n\n2. If the phase ruleset does not exist, create it using the [Create a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/create/) operation. In the new ruleset properties, set the following values:\n\n   * **kind**: `zone`\n   * **phase**: `http_request_transform`\n\n3. Use the [Update a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/update/) operation to add a URL rewrite rule to the list of ruleset rules. Alternatively, include the rule in the [Create a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/create/) request mentioned in the previous step.\n\nMake sure your API token has the [required permissions](#required-api-token-permissions) to perform the API operations.\n\n## Example requests\n\nExample: Add a rule that performs a static URL rewrite\n\nThe following example sets the rules of an existing phase ruleset (`$RULESET_ID`) to a single URL rewrite rule â€” performing a static rewrite of the URI path â€” using the [Update a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/update/) operation. The response will contain the complete definition of the ruleset you updated.\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Response Compression Write`\n* `Config Settings Write`\n* `Dynamic URL Redirects Write`\n* `Cache Settings Write`\n* `Custom Errors Write`\n* `Origin Write`\n* `Managed headers Write`\n* `Zone Transform Rules Write`\n* `Mass URL Redirects Write`\n* `Magic Firewall Write`\n* `L4 DDoS Managed Ruleset Write`\n* `HTTP DDoS Managed Ruleset Write`\n* `Sanitize Write`\n* `Transform Rules Write`\n* `Select Configuration Write`\n* `Bot Management Write`\n* `Zone WAF Write`\n* `Account WAF Write`\n* `Account Rulesets Write`\n* `Logs Write`\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "Use the `ref` field to get stable rule IDs across updates when using Terraform. Adding this field prevents Terraform from recreating the rule on changes. For more information, refer to [Troubleshooting](https://developers.cloudflare.com/terraform/troubleshooting/rule-id-changes/#how-to-keep-the-same-rule-id-between-modifications) in the Terraform documentation.\n\nExample: Add a rule that performs a dynamic URL rewrite\n\nThe following example sets the rules of an existing phase ruleset (`$RULESET_ID`) to a single URL rewrite rule â€” performing a dynamic rewrite of the URI path â€” using the [Update a zone ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/update/) operation. The response will contain the complete definition of the ruleset you updated.\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Response Compression Write`\n* `Config Settings Write`\n* `Dynamic URL Redirects Write`\n* `Cache Settings Write`\n* `Custom Errors Write`\n* `Origin Write`\n* `Managed headers Write`\n* `Zone Transform Rules Write`\n* `Mass URL Redirects Write`\n* `Magic Firewall Write`\n* `L4 DDoS Managed Ruleset Write`\n* `HTTP DDoS Managed Ruleset Write`\n* `Sanitize Write`\n* `Transform Rules Write`\n* `Select Configuration Write`\n* `Bot Management Write`\n* `Zone WAF Write`\n* `Account WAF Write`\n* `Account Rulesets Write`\n* `Logs Write`\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "Use the `ref` field to get stable rule IDs across updates when using Terraform. Adding this field prevents Terraform from recreating the rule on changes. For more information, refer to [Troubleshooting](https://developers.cloudflare.com/terraform/troubleshooting/rule-id-changes/#how-to-keep-the-same-rule-id-between-modifications) in the Terraform documentation.\n\n***\n\n## Required API token permissions\n\nThe API token used in API requests to manage URL Rewrite Rules must have at least the following permissions:\n\n* *Account* > *Transform Rules* > *Edit*\n* *Account* > *Account Rulesets* > *Read*\n\n</page>\n\n<page>\n---\ntitle: Create a URL rewrite rule in the dashboard Â· Cloudflare Rules docs\ndescription: Refer to the Rules examples gallery for examples of rule definitions.\nlastUpdated: 2025-09-24T12:01:01.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/url-rewrite/create-dashboard/\n  md: https://developers.cloudflare.com/rules/transform/url-rewrite/create-dashboard/index.md\n---\n\nRefer to the [Rules examples gallery](https://developers.cloudflare.com/rules/transform/examples/?operation=Rewrite+URL) for examples of rule definitions.\n\nTo create a rule:\n\n1. In the Cloudflare dashboard, go to the Rules **Overview** page.\n\n   [Go to **Overview**](https://dash.cloudflare.com/?to=/:account/:zone/rules/overview)\n\n2. Select **Create rule** > **URL Rewrite Rule**.\n\n3. (Optional) Select one of the rule templates that address common use cases. Then, review and adjust the proposed rule configuration.\n\n4. Enter a descriptive name for the rule in **Rule name**.\n\n   ![The URL rewrite rule creation page in the Cloudflare dashboard.](https://developers.cloudflare.com/_astro/create-url-rewrite-rule.DIgpB8IB_2nQIvF.webp)\n\n5. Under **If incoming requests match**, select one of the following options:\n\n   * **Wildcard pattern**: The rule will only apply to traffic matching the wildcard pattern in **Request URL**. Refer to [Wildcard pattern parameters](#wildcard-pattern-parameters) for details.\n\n   * **Custom filter expression**: The rule will only apply to traffic matching a custom expression. Define the [rule expression](https://developers.cloudflare.com/ruleset-engine/rules-language/expressions/edit-expressions/) to configure which requests should be rewritten. Use either the Expression Builder or the Expression Editor to define the custom expression. For more information, refer to [Edit expressions in the dashboard](https://developers.cloudflare.com/ruleset-engine/rules-language/expressions/edit-expressions/).\n\n     Note\n\n     Check the [fields and functions](https://developers.cloudflare.com/rules/transform/url-rewrite/reference/fields-functions/) you can use in filter expressions of URL rewrite rules.\n\n   * **All incoming requests**: The rule will apply to all traffic.\n\n6. (Optional) Define the action for your URL rewrite rule by selecting one of the available options displayed as radio buttons, and then a value from the drop-down list, depending on the action:\n\n   * If you select **Rewrite to** > *Static*, enter the string that will replace the original URL path (or query string). For example, enter `welcome-gb.html` to rewrite the original URL path to `/welcome-gb.html`.\n\n   * If you select **Rewrite to** > *Dynamic*, enter a [rewrite expression](https://developers.cloudflare.com/rules/transform/url-rewrite/reference/fields-functions/#rewrite-expressions) that defines the dynamic URL rewrite to perform.\n\n   * If you do not want to change the value of a component of the original request (the URL path or the URL query string), choose *Preserve* for that component.\n\n   For more information, refer to [URL rewrite parameters](https://developers.cloudflare.com/rules/transform/url-rewrite/reference/parameters/).\n\n7. (Optional) Under **Place at**, define where to place the rule in the rules list: first rule in the list, last rule in the list, or in a custom position (after a given rule).\n\n8. To save and deploy your rule, select **Deploy**. If you are not ready to deploy your rule, select **Save as Draft**.\n\n   If you are matching a hostname in your rule expression, you may be prompted to create a proxied DNS record for that hostname. Refer to [Troubleshooting](https://developers.cloudflare.com/rules/reference/troubleshooting/#this-rule-may-not-apply-to-your-traffic) for more information.\n\n## Wildcard pattern parameters\n\nThe Cloudflare dashboard offers a simplified user interface for creating URL rewrites based on wildcard matching and replacement. When you select **Wildcard pattern**, you will have the following parameters available:\n\n* **Request URL**: Enter the [wildcard pattern](https://developers.cloudflare.com/ruleset-engine/rules-language/operators/#wildcard-matching) using the asterisk (`*`) character to match multiple requests. For example, `http*://*.example.com/*`.\n\n* **Then rewrite the path and/or query**: Define the [URL rewrite settings](https://developers.cloudflare.com/rules/transform/url-rewrite/reference/parameters/) including:\n\n  * **Path** > **Target path**: Enter the URI path to match, which can include wildcards (for example, `/oldpath/*`).\n  * **Path** > **Rewrite to**: Enter the new URI path. You can use [wildcard replacement](https://developers.cloudflare.com/ruleset-engine/rules-language/functions/#wildcard_replace) such as `${1}` and `${2}` to define a dynamic target path (for example, `/newpath/${1}`). Leave this field empty to remove the URI path.\n  * **Query** > **Target query**: Enter the query string to match, which can include wildcards (for example, `?sort=*`).\n  * **Query** > **Rewrite to**: Enter the new query string. You can use [wildcard replacement](https://developers.cloudflare.com/ruleset-engine/rules-language/functions/#wildcard_replace) such as `${1}` and `${2}` to define a dynamic query string (for example, `?order=${1}`). Leave this field empty to remove the query string.\n\nRefer to [URL rewrite parameters](https://developers.cloudflare.com/rules/transform/url-rewrite/reference/parameters/#wildcard-matching-and-replacement) for the equivalent rule configuration when using the API.\n\nNotes\n\nThe **Request URL** value is only used to match the incoming request with a rule. It will not be used for capturing URL patterns for rewrites. If you are matching the URL path or query string in **Target path** or **Target query**, respectively, make sure that the **Request URL** pattern also matches the incoming request, or else the rule will not trigger.\n\nTo validate URL rewrite rule matches, use [Cloudflare Trace](https://developers.cloudflare.com/rules/trace-request/). To validate rewritten URLs, check your origin server.\n\n</page>\n\n<page>\n---\ntitle: Create a rule using Terraform Â· Cloudflare Rules docs\nlastUpdated: 2025-04-15T11:19:33.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/url-rewrite/link-create-terraform/\n  md: https://developers.cloudflare.com/rules/transform/url-rewrite/link-create-terraform/index.md\n---\n\n\n</page>\n\n<page>\n---\ntitle: Reference Â· Cloudflare Rules docs\ndescription: This section contains reference information for URL Rewrite Rules.\nlastUpdated: 2025-04-15T11:19:33.000Z\nchatbotDeprioritize: true\nsource_url:\n  html: https://developers.cloudflare.com/rules/transform/url-rewrite/reference/\n  md: https://developers.cloudflare.com/rules/transform/url-rewrite/reference/index.md\n---\n\nThis section contains reference information for URL Rewrite Rules.\n\n* [URL rewrite parameters](https://developers.cloudflare.com/rules/transform/url-rewrite/reference/parameters/)\n* [Available fields and functions](https://developers.cloudflare.com/rules/transform/url-rewrite/reference/fields-functions/)\n\n</page>\n\n<page>\n---\ntitle: A/B testing with same-URL direct access Â· Cloudflare Rules docs\ndescription: Set up an A/B test by controlling what response is served based on cookies.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: A/B testing,Cookies,URL rewrite\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/ab-testing-same-url/\n  md: https://developers.cloudflare.com/rules/snippets/examples/ab-testing-same-url/index.md\n---\n\nThis version passes through requests for `/test/*` and `/control/*` URI paths to the origin server, bypassing random assignment.",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Append dates to cookies to use with A/B testing Â· Cloudflare Rules docs\ndescription: Dynamically set a cookie expiration and test group.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: A/B testing,Cookies\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/append-dates-to-cookies/\n  md: https://developers.cloudflare.com/rules/snippets/examples/append-dates-to-cookies/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Auth with headers Â· Cloudflare Rules docs\ndescription: Allow or deny a request based on a known pre-shared key in a\n  header. This is not meant to replace the [WebCrypto\n  API](/workers/runtime-apis/web-crypto/).\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Authentication,Request modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/auth-with-headers/\n  md: https://developers.cloudflare.com/rules/snippets/examples/auth-with-headers/index.md\n---\n\nCaution when using in production\n\nThe example code contains a generic header key and value of `X-Custom-PSK` and `mypresharedkey`. To best protect your resources, change the header key and value in the Snippets editor before saving your code.",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Send Bot Management information to origin Â· Cloudflare Rules docs\ndescription: Send [Bots](/bots/) information to your origin. Refer to [Bot\n  Managenent variables](/bots/reference/bot-management-variables/) for a full\n  list of available fields.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Headers,Request modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/bot-data-to-origin/\n  md: https://developers.cloudflare.com/rules/snippets/examples/bot-data-to-origin/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Send suspect bots to a honeypot Â· Cloudflare Rules docs\ndescription: Use the [bot score\n  field](/workers/runtime-apis/request/#incomingrequestcfproperties) to send\n  bots to a honeypot.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Redirects\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/bots-to-honeypot/\n  md: https://developers.cloudflare.com/rules/snippets/examples/bots-to-honeypot/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Bulk redirect based on a map object Â· Cloudflare Rules docs\ndescription: Redirect requests to certain URLs based on a mapped object to the\n  request's URL.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Redirects\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/bulk-redirect-map/\n  md: https://developers.cloudflare.com/rules/snippets/examples/bulk-redirect-map/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Country code redirect Â· Cloudflare Rules docs\ndescription: Redirect a response based on the country code in the header of a visitor.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Localization,Redirects\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/country-code-redirect/\n  md: https://developers.cloudflare.com/rules/snippets/examples/country-code-redirect/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Custom cache Â· Cloudflare Rules docs\ndescription: Store, retrieve, and remove assets from cache programmatically. Use\n  this template to optimize performance and implement custom caching strategies.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Caching\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/custom-cache/\n  md: https://developers.cloudflare.com/rules/snippets/examples/custom-cache/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Debugging logs Â· Cloudflare Rules docs\ndescription: Send debugging information in an errored response to a logging service.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Logging,Response modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/debugging-logs/\n  md: https://developers.cloudflare.com/rules/snippets/examples/debugging-logs/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Define CORS headers Â· Cloudflare Rules docs\ndescription: Adjust [Cross-Origin Resource Sharing\n  (CORS)](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS) headers and\n  handle preflight requests.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Headers,Request modification,Response modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/define-cors-headers/\n  md: https://developers.cloudflare.com/rules/snippets/examples/define-cors-headers/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Follow redirects from the origin Â· Cloudflare Rules docs\ndescription: Modify the fetch request to follow redirects from the origin,\n  ensuring the client receives the final response.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Redirects\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/follow-redirects/\n  md: https://developers.cloudflare.com/rules/snippets/examples/follow-redirects/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "This template is ready for use and should fit most redirect-following scenarios.\n\nIt ensures the Snippet transparently follows redirects issued by the origin server. The `redirect: \"follow\"` option of the [Fetch API](https://developers.cloudflare.com/workers/runtime-apis/fetch/) ensures automatic handling of `3xx` redirects, returning the final response. If the origin response is not a redirect, the original content is returned.\n\nNote\n\nSnippets have a [maximum number of subrequests per invocation](https://developers.cloudflare.com/rules/snippets/#availability) which depends on your plan. If the origin server issues multiple redirects, each redirect subrequest will count towards this limit. When the number of subrequests exceeds the limit for your Cloudflare plan, you will receive a [1202 error](https://developers.cloudflare.com/rules/snippets/errors/#error-1202-snippets-exceeded-subrequests-limit). Ensure your origin configuration minimizes unnecessary redirects.\n\n</page>\n\n<page>\n---\ntitle: Add HEX timestamp to a request header Â· Cloudflare Rules docs\ndescription: Add a custom header to requests sent to the origin server with the\n  current timestamp in hexadecimal format for debugging, tracking, or custom\n  routing purposes.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Headers,Request modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/hex-timestamp/\n  md: https://developers.cloudflare.com/rules/snippets/examples/hex-timestamp/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Validate JSON web tokens (JWT) Â· Cloudflare Rules docs\ndescription: Extract the JWT token from a header, decode it, and implement\n  validation checks to verify it.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Authentication,Request modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/jwt-validation/\n  md: https://developers.cloudflare.com/rules/snippets/examples/jwt-validation/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Maintenance page Â· Cloudflare Rules docs\ndescription: Serve a custom maintenance page instead of fetching content from\n  the origin server or cache. Ideal for downtime notifications, planned\n  maintenance, or emergency messages.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Redirects\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/maintenance/\n  md: https://developers.cloudflare.com/rules/snippets/examples/maintenance/index.md\n---\n\n## Snippet code",
      "language": "unknown"
    },
    {
      "code": "## Snippet rule\n\nConfigure a custom filter expression:\n\n| Field | Operator | Value |\n| - | - | - |\n| IP Source Address | is not in list | `admin_ips` |\n\nIf you are using the Expression Editor, enter the following expression:",
      "language": "unknown"
    },
    {
      "code": "The [IP list](https://developers.cloudflare.com/waf/tools/lists/custom-lists/#ip-lists) `admin_ips` was previously created and contains the list of IP addresses of the site administrators, which will be able to access the site during the maintenance period.\n\n</page>\n\n<page>\n---\ntitle: Override a Set-Cookie header with a certain value Â· Cloudflare Rules docs\ndescription: Get a specific `Set-Cookie` header and update it with a certain value.\nlastUpdated: 2025-11-03T15:20:24.000Z\nchatbotDeprioritize: false\ntags: Headers,Cookies,Response modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/override-set-cookies-value/\n  md: https://developers.cloudflare.com/rules/snippets/examples/override-set-cookies-value/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Redirect 403 Forbidden to a different page Â· Cloudflare Rules docs\ndescription: If origin responded with `403 Forbidden` error code, redirect to\n  different page.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Redirects\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/redirect-forbidden-status/\n  md: https://developers.cloudflare.com/rules/snippets/examples/redirect-forbidden-status/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Redirect from one domain to another Â· Cloudflare Rules docs\ndescription: Redirect all requests from one domain to another domain.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Redirects\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/redirect-replaced-domain/\n  md: https://developers.cloudflare.com/rules/snippets/examples/redirect-replaced-domain/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Remove fields from API response Â· Cloudflare Rules docs\ndescription: If origin responds with `JSON`, parse the response and delete\n  fields to return a modified response.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Response modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/remove-fields-api-response/\n  md: https://developers.cloudflare.com/rules/snippets/examples/remove-fields-api-response/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Remove query strings before sending request to origin Â· Cloudflare Rules docs\ndescription: Remove certain query strings from a request before passing to the origin.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Request modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/remove-query-strings/\n  md: https://developers.cloudflare.com/rules/snippets/examples/remove-query-strings/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Remove response headers Â· Cloudflare Rules docs\ndescription: Remove from response all headers that start with a certain name.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Response modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/remove-response-headers/\n  md: https://developers.cloudflare.com/rules/snippets/examples/remove-response-headers/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Return information about the incoming request Â· Cloudflare Rules docs\ndescription: Respond with information about the incoming request provided by\n  Cloudflareâ€™s global network.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Logging,Response modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/return-incoming-request-properties/\n  md: https://developers.cloudflare.com/rules/snippets/examples/return-incoming-request-properties/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Rewrite links on HTML pages Â· Cloudflare Rules docs\ndescription: Dynamically rewrite links in HTML responses. This is useful for\n  site migrations and branding updates.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Response modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/rewrite-site-links/\n  md: https://developers.cloudflare.com/rules/snippets/examples/rewrite-site-links/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Change origin and modify paths Â· Cloudflare Rules docs\ndescription: Route requests to a different origin, prepend a directory to the\n  URL path, and remove specific segments.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: URL rewrite\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/route-and-rewrite/\n  md: https://developers.cloudflare.com/rules/snippets/examples/route-and-rewrite/index.md\n---\n\nThis example demonstrates how to use Cloudflare Snippets to:\n\n* Reroute incoming requests to a different origin.\n* Prepend a directory to the URL path.\n* Remove specific segments from the URL path.",
      "language": "unknown"
    },
    {
      "code": "This configuration will perform the following rewrites:\n\n| Request URL | URL after rewrite |\n| - | - |\n| `https://subdomain.example.com/foo` | `https://example.com/new-path/foo` |\n| `https://example.com/remove-me/bar` | `https://example.com/new-path/bar` |\n| `https://example.net/remove-me` | `https://example.com/new-path` |\n\n</page>\n\n<page>\n---\ntitle: Set security headers Â· Cloudflare Rules docs\ndescription: Set common security headers such as X-XSS-Protection,\n  X-Frame-Options, and X-Content-Type-Options.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Headers,Response modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/security-headers/\n  md: https://developers.cloudflare.com/rules/snippets/examples/security-headers/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "## Other common security headers\n\n* Content-Security-Policy headers: Enabling these headers will permit content from a trusted domain and all its subdomains. Refer to [Content-Security-Policy](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Content-Security-Policy) for details.",
      "language": "unknown"
    },
    {
      "code": "* Strict-Transport-Security headers: These are not automatically set because your website might get added to Chrome's HSTS preload list.",
      "language": "unknown"
    },
    {
      "code": "* Permissions-Policy header: Allow or deny the use of browser features, such as opting out of FLoC.",
      "language": "unknown"
    },
    {
      "code": "* X-XSS-Protection header: Prevents a page from loading if an XSS attack is detected. Refer to [X-XSS-Protection](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/X-XSS-Protection) for details.",
      "language": "unknown"
    },
    {
      "code": "* X-Frame-Options header: Prevents click-jacking attacks. Refer to [X-Frame-Options](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/X-Frame-Options).",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Send timestamp to origin as a custom header Â· Cloudflare Rules docs\ndescription: Convert timestamp to hexadecimal format and send it as a custom\n  header to the origin.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Headers,Request modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/send-timestamp-to-origin/\n  md: https://developers.cloudflare.com/rules/snippets/examples/send-timestamp-to-origin/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Route to a different origin based on origin response Â· Cloudflare Rules docs\ndescription: If response to the original request is not `200 OK` or a redirect,\n  send to another origin.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Redirects\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/serve-different-origin/\n  md: https://developers.cloudflare.com/rules/snippets/examples/serve-different-origin/index.md\n---",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Sign requests Â· Cloudflare Rules docs\ndescription: Verify a signed request using the HMAC and SHA-256 algorithms or return a 403.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Authentication,Request modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/signing-requests/\n  md: https://developers.cloudflare.com/rules/snippets/examples/signing-requests/index.md\n---\n\nThe following Snippet will:\n\n* For request URLs beginning with `/generate/`, replace `/generate/` with `/`, sign the resulting path with its timestamp, and return the full, signed URL in the response body.\n\n* For all other request URLs, verify the signed URL and allow the request through.",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Slow down suspicious requests Â· Cloudflare Rules docs\ndescription: Define a delay to be used when incoming requests match a rule you\n  consider suspicious based on the bot score.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: Request modification\nsource_url:\n  html: https://developers.cloudflare.com/rules/snippets/examples/slow-suspicious-requests/\n  md: https://developers.cloudflare.com/rules/snippets/examples/slow-suspicious-requests/index.md\n---\n\n## Snippet code",
      "language": "unknown"
    },
    {
      "code": "## Snippet rule\n\nConfigure a custom filter expression:\n\n| Field | Operator | Value |\n| - | - | - |\n| Bot Score | less than | `10` |\n\nIf you are using the Expression Editor, enter the following expression:",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Bulk Redirects concepts Â· Cloudflare Rules docs\ndescription: Bulk Redirects work through a combination of URL redirects, a Bulk\n  Redirect list, and a Bulk Redirect rule.\nlastUpdated: 2025-11-11T11:19:11.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/concepts/\n  md: https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/concepts/index.md\n---\n\nBulk Redirects involve the following elements:\n\n* **URL redirect**: A simple object with a source URL, a target URL, a status code, and redirect parameters. URL redirects are the list items of Bulk Redirect Lists.\n\n* **Bulk Redirect List**: A list, similar to an IP list, containing one or more URL redirects. To enable all the URL redirects in a Bulk Redirect List, reference the list in a Bulk Redirect Rule. Different Bulk Redirect Rules can reference the same Bulk Redirect List.\n\n* **Bulk Redirect Rule**: A rule powered by the Ruleset Engine, similar to a [Transform Rule](https://developers.cloudflare.com/rules/transform/). A Bulk Redirect Rule has an associated Bulk Redirect List.\n\nA Bulk Redirect Rule enables a Bulk Redirect List, which contains one or more URL redirects.\n\n![Diagram outlining the hierarchy relationship between Bulk Redirect Rules, Bulk Redirect Lists, and URL redirects](https://developers.cloudflare.com/_astro/concepts-diagram.e1YY6ejJ_ZiJXPv.webp)\n\nThe following example defines a Bulk Redirect List named `list_b` with two URL redirects:\n\n**`list_b` Bulk Redirect List**\n\n| Source URL | Target URL | Status code |\n| - | - | - |\n| `example.com/about` | `https://example.com/news` | `301` (the default) |\n| `example.com/new_feature` | `https://example.com/soon` | `302` |\n\nThe following Bulk Redirect Rule, named `Rule 2`, enables the URL redirects in the `list_b` Bulk Redirect List:\n\n**`Rule 2` Bulk Redirect Rule**\n\n* **Rule name**: `Rule 2`\n* **Associated list**: `list_b`\n\n## URL redirects\n\nA URL redirect allows you to configure a source URL, a target URL, a status code, and redirect parameters.\n\nWhen specifying the source URL, use the available redirect parameters instead of wildcards, which are not supported. For example, the **Include subdomains** parameter allows you to configure a single URL redirect that applies both to subdomains (for example, `https://b.example.com` and `https://a.b.example.com`) and to the apex domain (`https://example.com`). Other parameters allow you to specify how the source URLâ€™s path and query string are handled. For more information, refer to [How it works](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/how-it-works/).\n\nURL redirects are the list items of Bulk Redirect Lists.\n\n## Bulk Redirect Lists\n\nBulk Redirect Lists allow you to create distinct groups of URL redirects for different purposes. You can use a Bulk Redirect List in one or more Bulk Redirect Rules.\n\nA Bulk Redirect List does not perform any redirects on its own â€” you must reference the list in a Bulk Redirect Rule to enable the redirects in the list.\n\nA Bulk Redirect List cannot contain several URL redirects with the exact same source URL.\n\nFor details on the CSV format for importing items to a Bulk Redirect List, refer to [CSV file format](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/reference/csv-file-format/).\n\nNote\n\nYou can only reference Bulk Redirect Lists in Bulk Redirect Rules. Other types of rules powered by the Ruleset Engine do not support Bulk Redirect Lists.\n\n## Bulk Redirect Rules\n\nBulk Redirect Rules are rules powered by the Ruleset Engine that enable one or more URL redirects through a Bulk Redirect List.\n\nWhen you configure a Bulk Redirect Rule, you associate a Bulk Redirect List to it, which enables all the URL redirects in that list. You can create a rule for each list, or have many Bulk Redirect Rules referencing the same Bulk Redirect List.\n\nA Bulk Redirect Rule, like all rules powered by the Ruleset Engine, has an action and an expression. Besides these two properties, it also has a name, an optional description, an associated Bulk Redirect List, and a key.\n\n### Expression\n\nThe rule expression, or filter expression, specifies the conditions that must be met for the rule to run. By default, all URL redirects of the specified list will apply.\n\nThe default expression of a Bulk Redirect Rule is the following:",
      "language": "unknown"
    },
    {
      "code": "This expression means that the request URL, after some basic normalization (if [URL normalization](https://developers.cloudflare.com/rules/normalization/) is enabled), should match the source URL of a URL redirect in the list `<LIST_NAME>` for the redirect to be applied.\n\nYou can use an expression different from the default one to increase the specificity of URL redirect matches. For example, if you set the expression of a Bulk Redirect Rule to the following expression, there will only be a match for requests coming from the United Kingdom:",
      "language": "unknown"
    },
    {
      "code": "For more information on the available fields, refer to [Available fields and functions](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/reference/fields-functions/).\n\nNote\n\nAt the left of the `in` operator you can only use fields directly and not values returned by a function. In most situations, you will want to use one of the following fields with the `in` operator:\n\n* `http.request.full_uri`\n* `raw.http.request.full_uri`\n\nRefer to the [Fields reference](https://developers.cloudflare.com/ruleset-engine/rules-language/fields/reference/) for more information.\n\n### Key\n\nThe rule key is used in combination with the Bulk Redirect List associated with the rule to select the URL redirect to apply.\n\nWhen there is a match for the rule expression, Cloudflare compares the value of the rule key with the source URL of each URL redirect in the associated Bulk Redirect List, searching for a match.\n\nThe key should be either `http.request.full_uri` or `raw.http.request.full_uri`. Use `raw.http.request.full_uri` to compare the URI received by the web server, before normalization, with the source URLs in the Bulk Redirect List.\n\nThe URI field used in the key must be the same as the URI field used in the expression. Otherwise, you may have a match for the rule expression, but no match for any of the source URLs in the list. For example, if you set the key to `http.request.full_uri`, the field used in the rule expression must also be `http.request.full_uri`. Conversely, if you set the key to `raw.http.request.full_uri`, the field used in the expression must be `raw.http.request.full_uri`.\n\n</page>\n\n<page>\n---\ntitle: Create Bulk Redirects via API Â· Cloudflare Rules docs\ndescription: Learn how to create Bulk Redirects using the Cloudflare API.\nlastUpdated: 2025-09-08T13:42:03.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/create-api/\n  md: https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/create-api/index.md\n---\n\nTo create Bulk Redirects via API, you must:\n\n1. Create a Bulk Redirect List via API.\n2. Add items (URL redirects) to the list created in step 1.\n3. Create a Bulk Redirect Rule via API, which enables the list created in step 1.\n\nNote\n\nBulk Redirects require that the incoming traffic for the hostname referenced in visitors' requests is [proxied by Cloudflare](https://developers.cloudflare.com/dns/proxy-status/).\n\n## 1. Create a Bulk Redirect List via API\n\nUse the [Create a list](https://developers.cloudflare.com/api/resources/rules/subresources/lists/methods/create/) operation to create a new Bulk Redirect List. The list `kind` must be `redirect`.\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Account Filter Lists Edit`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "Take note of the list ID â€” you will need it in the next step.\n\nFor more information on list operations, refer to the [Lists API](https://developers.cloudflare.com/waf/tools/lists/lists-api/) documentation.\n\n## 2. Add items to the list\n\nUse the [Create list items](https://developers.cloudflare.com/api/resources/rules/subresources/lists/subresources/items/methods/create/) operation to add URL redirect items to the list. Enter the list ID from the previous step in the endpoint URL:\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Account Filter Lists Edit`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "This is an asynchronous operation. The response will contain an `operation_id` which you will use to check if the operation completed successfully using the [Get bulk operation status](https://developers.cloudflare.com/api/resources/rules/subresources/lists/subresources/bulk_operations/methods/get/) operation:\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Account Filter Lists Edit`\n* `Account Filter Lists Read`",
      "language": "unknown"
    },
    {
      "code": "Once the operation has completed successfully, the response will be similar to the following:",
      "language": "unknown"
    },
    {
      "code": "## 3. Create a Bulk Redirect Rule via API\n\nSince Bulk Redirect Lists are essentially containers of URL redirects, you have to enable the URL redirects in the list by creating a Bulk Redirect Rule.\n\nAdd Bulk Redirect Rules to the [entry point ruleset](https://developers.cloudflare.com/ruleset-engine/about/rulesets/#entry-point-ruleset) of the `http_request_redirect` phase at the account level. Refer to the [Rulesets API](https://developers.cloudflare.com/ruleset-engine/rulesets-api/) documentation for more information on [creating a ruleset](https://developers.cloudflare.com/ruleset-engine/rulesets-api/create/) and supplying a list of rules for the ruleset.\n\nA Bulk Redirect Rule must have:\n\n* `action` set to `redirect`\n* An `action_parameters` object with additional configuration settings â€” refer to [API JSON objects: Bulk Redirect Rule](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/reference/json-objects/#bulk-redirect-rule) for details.\n\nThe following request of the [Create an account ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/create/) operation creates a phase entry point ruleset for the `http_request_redirect` phase at the account level, and defines a single redirect rule. Use this operation if you have not created a phase entry point ruleset for the `http_request_redirect` phase yet.\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Mass URL Redirects Write`\n* `Magic Firewall Write`\n* `L4 DDoS Managed Ruleset Write`\n* `Transform Rules Write`\n* `Select Configuration Write`\n* `Account WAF Write`\n* `Account Rulesets Write`\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "Use the `ref` field to get stable rule IDs across updates when using Terraform. Adding this field prevents Terraform from recreating the rule on changes. For more information, refer to [Troubleshooting](https://developers.cloudflare.com/terraform/troubleshooting/rule-id-changes/#how-to-keep-the-same-rule-id-between-modifications) in the Terraform documentation.\n\nIf there is already a phase entry point ruleset for the `http_request_redirect` phase, use the [Update an account ruleset](https://developers.cloudflare.com/api/resources/rulesets/methods/update/) operation instead, like in the following example:\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Mass URL Redirects Write`\n* `Magic Firewall Write`\n* `L4 DDoS Managed Ruleset Write`\n* `Transform Rules Write`\n* `Select Configuration Write`\n* `Account WAF Write`\n* `Account Rulesets Write`\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "***\n\n## Required API token permissions\n\nThe API token used in API requests to manage Bulk Redirects objects (lists, list items, and rules) must have at least the following permissions:\n\n* *Account* > *Account Rulesets* > *Edit*\n* *Account* > *Account Filter Lists* > *Edit*\n\n</page>\n\n<page>\n---\ntitle: Create Bulk Redirects in the dashboard Â· Cloudflare Rules docs\ndescription: \"To create Bulk Redirects in the Cloudflare dashboard you must:\"\nlastUpdated: 2025-09-08T13:42:03.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/create-dashboard/\n  md: https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/create-dashboard/index.md\n---\n\nTo create Bulk Redirects in the Cloudflare dashboard you must:\n\n1. Create a Bulk Redirect List with one or more URL redirects.\n2. Create a Bulk Redirect Rule to enable the URL redirects in the list.\n\nYou can create Bulk Redirect Lists and Bulk Redirect Rules in the Cloudflare dashboard:\n\n* At the account level, in **Bulk redirects**.\n* At the zone level, go to **Rules** > **Settings** and select the **Bulk Redirects** tab.\n\nHowever, the lists and rules only exist at the account level and every zone in the same account will show the same items.\n\nNote\n\nBulk Redirects require that the incoming traffic for the hostname referenced in visitors' requests is [proxied by Cloudflare](https://developers.cloudflare.com/dns/proxy-status/).\n\n## 1. Create a Bulk Redirect List\n\n1. In the Cloudflare dashboard, go to the **Bulk redirects** page.\n\n   [Go to **Bulk redirects**](https://dash.cloudflare.com/?to=/:account/bulk-redirects)\n\n2. Under **Bulk Redirect Lists**, select **Create Bulk Redirect List**.\n\n3. Enter a list name and description, and select **Next**.\n\n4. You can import a CSV file containing several URL redirects or enter URL redirects one at a time in the dashboard.\n\n   Note\n\n   The source URL of each redirect cannot include a query string. For more information, refer to the [supported URL components](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/reference/url-components/).\n\n   Import a CSV file\n\n   1. Drag and drop a CSV file containing URL redirects or select **browse** and select a CSV file. For more information on the file format, refer to [CSV file format](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/reference/csv-file-format/).\n\n   2. The dashboard will display the URL redirects that were successfully imported from the file. You can manually adjust the displayed records or add/remove URL redirects before proceeding.\n\n   3. Select **Next**.\n\n   Add URL redirects manually\n\n   1. Select **Or, manually add URL redirects**.\n\n   2. Enter the URL redirects you wish to add to the list. You must enter at least the following three fields: **Source URL**, **Target URL**, and **Status**. To set additional options, expand **Edit parameters**.\n\n   3. Add more URL redirects, if required.\n\n   4. Select **Next**.\n\n5. Review and edit the URL redirects you imported or created, and select **Next**.\n\n6. Select **Continue to Redirect Rules** to go to the rule creation page, and follow the instructions in the next section. You must create a Bulk Redirect Rule to enable the URL redirects you defined.\n\nNotes\n\nCloudflare will apply the following rules when you add items to an existing list (either manually or via CSV file):\n\n* Do not remove any existing list items before updating/adding items.\n* Update items that were already in the list.\n* Add items that were not present in the list.\n\n## 2. Create a Bulk Redirect Rule\n\n1. (Optional) If you are not using the Bulk Redirect List creation wizard according to the instructions in the previous section:\n\n   1. In the Cloudflare dashboard, go to the **Bulk redirects** page.\n\n      [Go to **Bulk redirects**](https://dash.cloudflare.com/?to=/:account/bulk-redirects)\n\n   2. Select **Create Bulk Redirect Rule**.\n\n2. In **Rule name**, enter a descriptive name for the rule.\n\n3. Select the Bulk Redirect List you previously created.\n\n4. (Optional) If necessary, select **Or use the expression editor** to edit the [rule expression](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/concepts/#expression) or the [rule key](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/concepts/#key).\n\n5. To save and deploy the Bulk Redirect Rule, select **Save and Deploy**. If you are not ready to deploy your rule, select **Save as Draft**.\n\n   If you are matching a hostname in your rule expression, you may be prompted to create a proxied DNS record for that hostname. Refer to [Troubleshooting](https://developers.cloudflare.com/rules/reference/troubleshooting/#this-rule-may-not-apply-to-your-traffic) for more information.\n\n</page>\n\n<page>\n---\ntitle: Bulk Redirects FAQ Â· Cloudflare Rules docs\ndescription: Below you will find answers to the most commonly asked questions\n  regarding Bulk Redirects.\nlastUpdated: 2025-09-11T15:31:26.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/faq/\n  md: https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/faq/index.md\n---\n\nBelow you will find answers to the most commonly asked questions regarding Bulk Redirects.\n\nTo troubleshoot errors related to Bulk Redirects:\n\n* Refer to [Troubleshooting Cloudflare 10XXX Errors](https://developers.cloudflare.com/support/troubleshooting/http-status-codes/cloudflare-10xxx-errors/) for more information on runtime errors.\n* Use [Cloudflare Trace](https://developers.cloudflare.com/rules/trace-request/) to determine if a rule is triggering for a specific URL.\n\n## What happens if the same source URL appears in two different Bulk Redirect Lists?\n\nIn this situation, Cloudflare will use the URL redirect of the first rule that triggers. This will be determined by the order of the Bulk Redirect Rules enabling each Bulk Redirect List in the `http_request_redirect` phase entry point ruleset.\n\n## How can I solve the following error: \"This account has reached the limit on the number of URL matching items on the same hostname/path\"?\n\nYou may get this error when adding items to a Bulk Redirect List.\n\nYou can have any number of URL redirects with the same source hostname (with different paths) or same source path (with different hostnames). However, you can have a maximum of 16 source URLs with the same hostname and path across all lists, either enabled by a Bulk Redirect Rule or not.\n\nIf you receive this error, check if you have any unused Bulk Redirect Lists with the source hostname and path that caused the error, and remove such items from the list.\n\n## How many URL redirects can I have in a single Bulk Redirect List?\n\nEach account has a maximum number of URL redirects across all lists which depends on your Cloudflare plan. If you wish, you can use all the URL redirects available in your plan in a single Bulk Redirect List, but you will not be able to create any other URL redirects in a different list. Refer to [Availability](https://developers.cloudflare.com/rules/url-forwarding/#availability) for more information.\n\n## How can I redirect based on the non-normalized version of a URL?\n\nUse the `raw.http.request.full_uri` field both in the rule expression and in the key, instead of the default field `http.request.full_uri`. This will take the raw version of the URL into account, that is, the URL received on the Cloudflare global network before applying normalization. Refer to [Concepts: Bulk Redirect Rules](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/concepts/#bulk-redirect-rules) for more information on using a custom rule expression and a custom key.\n\n## Do Bulk Redirects take precedence over Page Rules?\n\nYes. Bulk Redirects take precedence over Page Rules redirects. For more information on the execution order of Rules products, refer to [Execution order](https://developers.cloudflare.com/rules/url-forwarding/#execution-order).\n\n## Can I purge an entire Bulk Redirect List in one API call?\n\nIf your [Bulk Redirect List](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/concepts/#bulk-redirect-lists) contains 500,001 or more items, you will not be able to purge the entire list in a single API call. Instead, you must make multiple calls to [Delete List Items](https://developers.cloudflare.com/api/resources/rules/subresources/lists/subresources/items/methods/delete/) API end-point, deleting a maximum of 100,000 items per request.\n\nFor example, to delete a list with 1,000,000 items, you would need to issue at least 10 API requests.\n\n</page>\n\n<page>\n---\ntitle: How Bulk Redirects work Â· Cloudflare Rules docs\ndescription: For each incoming request, Cloudflare evaluates all URL redirects\n  of each Bulk Redirect List that is enabled by a Bulk Redirect Rule.\nlastUpdated: 2024-11-28T17:42:11.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/how-it-works/\n  md: https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/how-it-works/index.md\n---\n\nFor each incoming request, Cloudflare evaluates all URL redirects of each Bulk Redirect List that is enabled by a Bulk Redirect Rule.\n\nIf there is a match for a URL redirect according to the URL matching algorithm, the redirect action is performed immediately, according to the URL redirect configuration parameters. Cloudflare performs no further processing once a redirect action has been executed.\n\n## Matching the source URL of redirects\n\nThe following URL redirect parameters control the matching behavior between the request URL and source URLs of the configured (and enabled) URL redirects:\n\n* **Subpath matching** (default: false)\n\n  * If `true`, the URL redirect will apply to all paths under the given source path. For example, consider the following source and target URLs of a URL redirect:\n\n    * Source URL: `https://example.com/foo/`\n    * Target URL: `https://example.com/qux/`\n\n  * With this configuration and **Subpath matching** enabled, an incoming request to `example.com/foo/bar` will be redirected to `https://example.com/qux/bar`.\n\n  Note\n\n  URL redirects with **Subpath matching** enabled cannot contain more than 16 `/` (slash) characters in the source URL path.\n\n* **Include subdomains** (default: false)\n\n  * If `true`, the source URL hostname of the URL redirect will also apply to all its subdomains. For example, consider the following source and target URLs of a URL redirect:\n\n    * Source URL: `https://example.com/about`\n    * Target URL: `https://example.com/newpage`\n\n  * With this configuration and **Includes subdomains** enabled, incoming requests to `http://a.example.com/about` and `http://a.b.example.com/about` would also match, in addition to the specified domain with no subdomain (`https://example.com/about`).\n\nFor detailed information on these parameters, refer to [URL redirect parameters](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/reference/parameters/).\n\n## Configuring the path and query string behavior\n\nThe following parameters configure how Cloudflare determines the path and query string of the final target URL:\n\n* **Preserve query string** (default: false)\n\n  * If `true`, the final target URL will keep the query string of the original request. For example, consider the following source and target URLs of a URL redirect:\n\n    * Source URL: `https://example.com/about`\n    * Target URL: `https://example.com/newpage`\n\n  * With this configuration and **Preserve query string** enabled, an incoming request to `http://example.com/about?q=term` would be redirected to `https://example.com/newpage?q=term`. If **Preserve query string** is disabled, the same incoming request would be redirected to `https://example.com/newpage`.\n\n* **Preserve path suffix** (default: true)\n\n  * Defines if the final target URL will include the parts of the request path that did not match the URL redirect's source URL.\n\n  * When **Subpath matching** is enabled, the path that was not matched is copied over to the final target URL. For example, consider the following source and target URLs of a URL redirect:\n\n    * Source URL: `https://example.com/a/`\n    * Target URL: `https://example.com/b/`\n\n  * An incoming request to `https://example.com/a/foo` will be redirected to `https://example.com/b/foo`.\n\n  * If you set **Preserve path suffix** to `false`, the same request will still match the redirect, but it will be redirected to `https://example.com/b/`.\n\nFor detailed information on these parameters, refer to [URL redirect parameters](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/reference/parameters/).\n\n## URL matching algorithm\n\nThe URL of an incoming request matches a URL redirect in a list if:\n\n1. The scheme (`http` or `https`) is the same as the source URL of the URL redirect definition. Source URLs with no scheme will match both `http` and `https`.\n\n2. The hostname is the same as the hostname in the source URL of the URL redirect definition. If **Include subdomains** is enabled, the subdomains of the hostname in the redirect definition will also match.\n\n3. The path is the same as the source URL. If **Subpath matching** is enabled, Cloudflare also considers the subpaths of the path in the URL redirect's source URL when determining if there is a match. For example, a URL redirect with its source URL defined as `example.com/blog` will also match requests to `example.com/blog/foo` and `example.com/blog/bar`.\n\n### Determining the URL redirect to apply\n\nIf multiple URL redirects can apply, then the redirect that wins is determined by the following rules:\n\n1. Given two URL redirects with **Subpath matching** enabled, the URL redirect with the most specific path wins over the other URL redirect.\\\n   If there are two URL redirects with source URL paths `/folder` and `/folder/subfolder`, an incoming request for the `/folder/subfolder/item` URL path will match the second redirect (`/folder/subfolder`) because it is more specific.\n\n2. URL redirects with the exact hostname win over URL redirects with the **Include subdomains** option enabled.\n\n3. Given two URL redirects with **Include subdomains** enabled, the URL with the most specific domain wins over the other URL redirect.\\\n   If there are two URL redirects with source URL hostnames `bar.com` and `foo.bar.com`, an incoming request to `qux.foo.bar.com` will match the second redirect (`foo.bar.com`) because it is more specific.\n\n4. URL redirects with a concrete scheme win over URL redirects that match both `http` and `https` schemes.\n\n</page>\n\n<page>\n---\ntitle: Bulk Redirects reference Â· Cloudflare Rules docs\ndescription: \"Refer to the following pages for more information about Bulk Redirects:\"\nlastUpdated: 2024-09-06T15:21:19.000Z\nchatbotDeprioritize: true\nsource_url:\n  html: https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/reference/\n  md: https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/reference/index.md\n---\n\nRefer to the following pages for more information about Bulk Redirects:\n\n* [URL redirect parameters](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/reference/parameters/)\n* [Supported URL components in Bulk Redirects](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/reference/url-components/)\n* [Available fields and functions](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/reference/fields-functions/)\n* [CSV file format for Bulk Redirects](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/reference/csv-file-format/)\n* [Bulk Redirects API JSON objects](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/reference/json-objects/)\n\n</page>\n\n<page>\n---\ntitle: Configure Bulk Redirects using Terraform Â· Cloudflare Rules docs\ndescription: This Terraform example configures account-level Bulk Redirects. It\n  creates a Bulk Redirect List populated with URL redirects and a corresponding\n  Bulk Redirect Rule to activate them.\nlastUpdated: 2025-08-20T20:59:04.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/terraform-example/\n  md: https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/terraform-example/index.md\n---\n\nNote\n\nTerraform code snippets below refer to the v4 SDK only.\n\nThis Terraform example configures account-level Bulk Redirects. It creates a [Bulk Redirect List](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/concepts/#bulk-redirect-lists) populated with [URL redirects](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/concepts/#url-redirects) and a corresponding [Bulk Redirect Rule](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/concepts/#bulk-redirect-rules) to activate them.",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Additional resources",
      "id": "additional-resources"
    },
    {
      "level": "h2",
      "text": "1. Create a URL rewrite",
      "id": "1.-create-a-url-rewrite"
    },
    {
      "level": "h2",
      "text": "2. Create an origin rule",
      "id": "2.-create-an-origin-rule"
    },
    {
      "level": "h2",
      "text": "Final remarks",
      "id": "final-remarks"
    },
    {
      "level": "h2",
      "text": "1. Configure custom domain in your Pages project",
      "id": "1.-configure-custom-domain-in-your-pages-project"
    },
    {
      "level": "h2",
      "text": "2. Create origin rule to rewrite host header and override DNS record",
      "id": "2.-create-origin-rule-to-rewrite-host-header-and-override-dns-record"
    },
    {
      "level": "h2",
      "text": "3. (Optional) Configure URL rewrite",
      "id": "3.-(optional)-configure-url-rewrite"
    },
    {
      "level": "h2",
      "text": "More resources",
      "id": "more-resources"
    },
    {
      "level": "h2",
      "text": "1. Configure custom domain in your Pages project",
      "id": "1.-configure-custom-domain-in-your-pages-project"
    },
    {
      "level": "h2",
      "text": "2. Create origin rule to rewrite host header and override DNS record",
      "id": "2.-create-origin-rule-to-rewrite-host-header-and-override-dns-record"
    },
    {
      "level": "h2",
      "text": "3. (Optional) Configure URL rewrite",
      "id": "3.-(optional)-configure-url-rewrite"
    },
    {
      "level": "h2",
      "text": "More resources",
      "id": "more-resources"
    },
    {
      "level": "h2",
      "text": "Redirect with Page Rules",
      "id": "redirect-with-page-rules"
    },
    {
      "level": "h2",
      "text": "Forwarding examples",
      "id": "forwarding-examples"
    },
    {
      "level": "h2",
      "text": "Advanced forwarding options",
      "id": "advanced-forwarding-options"
    },
    {
      "level": "h2",
      "text": "Bypass Cache on Cookie setting",
      "id": "bypass-cache-on-cookie-setting"
    },
    {
      "level": "h2",
      "text": "Zone name occurrences must end with a slash",
      "id": "zone-name-occurrences-must-end-with-a-slash"
    },
    {
      "level": "h2",
      "text": "Network ports supported by Page Rules",
      "id": "network-ports-supported-by-page-rules"
    },
    {
      "level": "h2",
      "text": "Using Page Rules with Workers",
      "id": "using-page-rules-with-workers"
    },
    {
      "level": "h2",
      "text": "Page Rules are case-insensitive",
      "id": "page-rules-are-case-insensitive"
    },
    {
      "level": "h3",
      "text": "301/302 Forwarding URL",
      "id": "301/302-forwarding-url"
    },
    {
      "level": "h3",
      "text": "Cache Level in specific paths",
      "id": "cache-level-in-specific-paths"
    },
    {
      "level": "h3",
      "text": "Edge Cache TTL and Browser Cache TTL",
      "id": "edge-cache-ttl-and-browser-cache-ttl"
    },
    {
      "level": "h2",
      "text": "Helpful tips",
      "id": "helpful-tips"
    },
    {
      "level": "h2",
      "text": "Reference wildcard matches",
      "id": "reference-wildcard-matches"
    },
    {
      "level": "h2",
      "text": "If I run out of Page Rules, can I buy more?",
      "id": "if-i-run-out-of-page-rules,-can-i-buy-more?"
    },
    {
      "level": "h2",
      "text": "How do I cancel my Page Rules purchase?",
      "id": "how-do-i-cancel-my-page-rules-purchase?"
    },
    {
      "level": "h2",
      "text": "When I change plans will I keep my add-on subscriptions?",
      "id": "when-i-change-plans-will-i-keep-my-add-on-subscriptions?"
    },
    {
      "level": "h2",
      "text": "What happens if I cancel Page Rules halfway through my billing cycle?",
      "id": "what-happens-if-i-cancel-page-rules-halfway-through-my-billing-cycle?"
    },
    {
      "level": "h2",
      "text": "Why is a page rule not working?",
      "id": "why-is-a-page-rule-not-working?"
    },
    {
      "level": "h2",
      "text": "Error 500 (Internal server error)",
      "id": "error-500-(internal-server-error)"
    },
    {
      "level": "h3",
      "text": "Root cause",
      "id": "root-cause"
    },
    {
      "level": "h3",
      "text": "Resolution",
      "id": "resolution"
    },
    {
      "level": "h2",
      "text": "How to normalize `%2F`",
      "id": "how-to-normalize-`%2f`"
    },
    {
      "level": "h2",
      "text": "Important remarks",
      "id": "important-remarks"
    },
    {
      "level": "h2",
      "text": "HTTP request headers",
      "id": "http-request-headers"
    },
    {
      "level": "h3",
      "text": "Add bot protection headers",
      "id": "add-bot-protection-headers"
    },
    {
      "level": "h3",
      "text": "Add TLS client auth headers",
      "id": "add-tls-client-auth-headers"
    },
    {
      "level": "h3",
      "text": "Add visitor location headers",
      "id": "add-visitor-location-headers"
    },
    {
      "level": "h3",
      "text": "Add \"True-Client-IP\" header",
      "id": "add-\"true-client-ip\"-header"
    },
    {
      "level": "h3",
      "text": "Remove visitor IP headers",
      "id": "remove-visitor-ip-headers"
    },
    {
      "level": "h3",
      "text": "Add leaked credentials checks header",
      "id": "add-leaked-credentials-checks-header"
    },
    {
      "level": "h3",
      "text": "Add malicious uploads detection header",
      "id": "add-malicious-uploads-detection-header"
    },
    {
      "level": "h2",
      "text": "HTTP response headers",
      "id": "http-response-headers"
    },
    {
      "level": "h3",
      "text": "Remove \"X-Powered-By\" headers",
      "id": "remove-\"x-powered-by\"-headers"
    },
    {
      "level": "h3",
      "text": "Add security headers",
      "id": "add-security-headers"
    },
    {
      "level": "h2",
      "text": "Basic rule settings",
      "id": "basic-rule-settings"
    },
    {
      "level": "h2",
      "text": "Procedure",
      "id": "procedure"
    },
    {
      "level": "h2",
      "text": "Example requests",
      "id": "example-requests"
    },
    {
      "level": "h2",
      "text": "Required API token permissions",
      "id": "required-api-token-permissions"
    },
    {
      "level": "h2",
      "text": "Basic rule settings",
      "id": "basic-rule-settings"
    },
    {
      "level": "h2",
      "text": "Procedure",
      "id": "procedure"
    },
    {
      "level": "h2",
      "text": "Example requests",
      "id": "example-requests"
    },
    {
      "level": "h2",
      "text": "Required API token permissions",
      "id": "required-api-token-permissions"
    },
    {
      "level": "h2",
      "text": "Basic rule settings",
      "id": "basic-rule-settings"
    },
    {
      "level": "h2",
      "text": "Procedure",
      "id": "procedure"
    },
    {
      "level": "h2",
      "text": "Example requests",
      "id": "example-requests"
    },
    {
      "level": "h2",
      "text": "Required API token permissions",
      "id": "required-api-token-permissions"
    },
    {
      "level": "h2",
      "text": "Wildcard pattern parameters",
      "id": "wildcard-pattern-parameters"
    },
    {
      "level": "h2",
      "text": "Snippet code",
      "id": "snippet-code"
    },
    {
      "level": "h2",
      "text": "Snippet rule",
      "id": "snippet-rule"
    },
    {
      "level": "h2",
      "text": "Other common security headers",
      "id": "other-common-security-headers"
    },
    {
      "level": "h2",
      "text": "Snippet code",
      "id": "snippet-code"
    },
    {
      "level": "h2",
      "text": "Snippet rule",
      "id": "snippet-rule"
    },
    {
      "level": "h2",
      "text": "URL redirects",
      "id": "url-redirects"
    },
    {
      "level": "h2",
      "text": "Bulk Redirect Lists",
      "id": "bulk-redirect-lists"
    },
    {
      "level": "h2",
      "text": "Bulk Redirect Rules",
      "id": "bulk-redirect-rules"
    },
    {
      "level": "h3",
      "text": "Expression",
      "id": "expression"
    },
    {
      "level": "h3",
      "text": "Key",
      "id": "key"
    },
    {
      "level": "h2",
      "text": "1. Create a Bulk Redirect List via API",
      "id": "1.-create-a-bulk-redirect-list-via-api"
    },
    {
      "level": "h2",
      "text": "2. Add items to the list",
      "id": "2.-add-items-to-the-list"
    },
    {
      "level": "h2",
      "text": "3. Create a Bulk Redirect Rule via API",
      "id": "3.-create-a-bulk-redirect-rule-via-api"
    },
    {
      "level": "h2",
      "text": "Required API token permissions",
      "id": "required-api-token-permissions"
    },
    {
      "level": "h2",
      "text": "1. Create a Bulk Redirect List",
      "id": "1.-create-a-bulk-redirect-list"
    },
    {
      "level": "h2",
      "text": "2. Create a Bulk Redirect Rule",
      "id": "2.-create-a-bulk-redirect-rule"
    },
    {
      "level": "h2",
      "text": "What happens if the same source URL appears in two different Bulk Redirect Lists?",
      "id": "what-happens-if-the-same-source-url-appears-in-two-different-bulk-redirect-lists?"
    },
    {
      "level": "h2",
      "text": "How can I solve the following error: \"This account has reached the limit on the number of URL matching items on the same hostname/path\"?",
      "id": "how-can-i-solve-the-following-error:-\"this-account-has-reached-the-limit-on-the-number-of-url-matching-items-on-the-same-hostname/path\"?"
    },
    {
      "level": "h2",
      "text": "How many URL redirects can I have in a single Bulk Redirect List?",
      "id": "how-many-url-redirects-can-i-have-in-a-single-bulk-redirect-list?"
    },
    {
      "level": "h2",
      "text": "How can I redirect based on the non-normalized version of a URL?",
      "id": "how-can-i-redirect-based-on-the-non-normalized-version-of-a-url?"
    },
    {
      "level": "h2",
      "text": "Do Bulk Redirects take precedence over Page Rules?",
      "id": "do-bulk-redirects-take-precedence-over-page-rules?"
    },
    {
      "level": "h2",
      "text": "Can I purge an entire Bulk Redirect List in one API call?",
      "id": "can-i-purge-an-entire-bulk-redirect-list-in-one-api-call?"
    },
    {
      "level": "h2",
      "text": "Matching the source URL of redirects",
      "id": "matching-the-source-url-of-redirects"
    },
    {
      "level": "h2",
      "text": "Configuring the path and query string behavior",
      "id": "configuring-the-path-and-query-string-behavior"
    },
    {
      "level": "h2",
      "text": "URL matching algorithm",
      "id": "url-matching-algorithm"
    },
    {
      "level": "h3",
      "text": "Determining the URL redirect to apply",
      "id": "determining-the-url-redirect-to-apply"
    }
  ],
  "url": "llms-txt#change-origin-for-api-requests",
  "links": []
}