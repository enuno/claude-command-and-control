{
  "title": "Test with version affinity - both requests should hit the same version",
  "content": "curl -H \"Cookie: session_id=test123\" https://your-worker.example.com/\ncurl -H \"Cookie: session_id=test123\" https://your-worker.example.com/assets/index.js\njsonc\n  {\n    \"$schema\": \"./node_modules/wrangler/config-schema.json\",\n    \"name\": \"assets-on-a-path-example\",\n    \"main\": \"src/index.js\",\n    \"route\": \"example.com/blog/*\",\n    \"assets\": {\n      \"directory\": \"dist\"\n    }\n  }\n  toml\n  name = \"assets-on-a-path-example\"\n  main = \"src/index.js\"\n  route = \"example.com/blog/*\"\n\n[assets]\n  directory = \"dist\"\n  jsonc\n  {\n    \"name\": \"my-worker\",\n    \"compatibility_date\": \"2025-12-31\",\n    \"assets\": {\n      \"directory\": \"./dist/\",\n      \"html_handling\": \"auto-trailing-slash\"\n    }\n  }\n  toml\n  name = \"my-worker\"\n  compatibility_date = \"2025-12-31\"\n\n[assets]\n  directory = \"./dist/\"\n  html_handling = \"auto-trailing-slash\"\n  jsonc\n  {\n    \"name\": \"my-worker\",\n    \"compatibility_date\": \"2025-12-31\",\n    \"assets\": {\n      \"directory\": \"./dist/\",\n      \"html_handling\": \"force-trailing-slash\"\n    }\n  }\n  toml\n  name = \"my-worker\"\n  compatibility_date = \"2025-12-31\"\n\n[assets]\n  directory = \"./dist/\"\n  html_handling = \"force-trailing-slash\"\n  jsonc\n  {\n    \"name\": \"my-worker\",\n    \"compatibility_date\": \"2025-12-31\",\n    \"assets\": {\n      \"directory\": \"./dist/\",\n      \"html_handling\": \"drop-trailing-slash\"\n    }\n  }\n  toml\n  name = \"my-worker\"\n  compatibility_date = \"2025-12-31\"\n\n[assets]\n  directory = \"./dist/\"\n  html_handling = \"drop-trailing-slash\"\n  jsonc\n  {\n    \"name\": \"my-worker\",\n    \"compatibility_date\": \"2025-12-31\",\n    \"assets\": {\n      \"directory\": \"./dist/\",\n      \"html_handling\": \"none\"\n    }\n  }\n  toml\n  name = \"my-worker\"\n  compatibility_date = \"2025-12-31\"\n\n[assets]\n  directory = \"./dist/\"\n  html_handling = \"none\"\n  sh\nnpm uninstall -g @cloudflare/wrangler\nsh\ncargo uninstall wrangler\nsh\nnpm install -g wrangler\nsh\nnpx wrangler --version\nsh\nnpx wrangler dev\nbash\n ‚õÖÔ∏è wrangler 2.x\n-------------------------------------------------------\n‚ñ≤ [WARNING] Processing wrangler.toml configuration:\n  - üò∂ Ignored: \"type\":\n    Most common features now work out of the box with wrangler, including modules, jsx,\n  typescript, etc. If you need anything more, use a custom build.\n  - Deprecation: \"zone_id\":\n    This is unnecessary since we can deduce this from routes directly.\n  - Deprecation: \"build.upload.format\":\n    The format is inferred automatically from the code.\n\n‚úò [ERROR] Processing wrangler.toml configuration:\n  - Expected \"route\" to be either a string, or an object with shape { pattern, zone_id | zone_name }, but got \"\".\nsh\n  npm i -D webpack@^4.46.0 webpack-cli wranglerjs-compat-webpack-plugin\n  sh\n  yarn add -D webpack@^4.46.0 webpack-cli wranglerjs-compat-webpack-plugin\n  sh\n  pnpm add -D webpack@^4.46.0 webpack-cli wranglerjs-compat-webpack-plugin\n  json\n{\n  \"name\": \"my-worker\",\n  \"version\": \"x.y.z\",\n  // ...\n  \"devDependencies\": {\n    // ...\n    \"wranglerjs-compat-webpack-plugin\": \"^x.y.z\",\n    \"webpack\": \"^4.46.0\",\n    \"webpack-cli\": \"^x.y.z\"\n  }\n}\njs\nconst {\n  WranglerJsCompatWebpackPlugin,\n} = require(\"wranglerjs-compat-webpack-plugin\");\n\nmodule.exports = {\n  // ...\n  plugins: [new WranglerJsCompatWebpackPlugin()],\n};\njson\n{\n  \"name\": \"my-worker\",\n  \"version\": \"2.0.0\",\n  // ...\n  \"scripts\": {\n    \"build\": \"webpack\" // <-- Add this line!\n    // ...\n  }\n}\njsonc\n  {\n    \"$schema\": \"./node_modules/wrangler/config-schema.json\",\n    \"type\": \"webpack\",\n    \"webpack_config\": \"webpack.config.js\"\n  }\n  toml\n  # Remove these!\n  type = \"webpack\"\n  webpack_config = \"webpack.config.js\"\n  jsonc\n  {\n    \"$schema\": \"./node_modules/wrangler/config-schema.json\",\n    \"main\": \"./worker/script.js\",\n    \"build\": {\n      \"command\": \"npm run build\"\n    }\n  }\n  toml\n  main = \"./worker/script.js\" # by default, or whatever file webpack outputs\n  [build]\n  command = \"npm run build\" # or \"yarn build\"\n  # ...\n  sh\n  npm i @cloudflare/ai-utils\n  sh\n  yarn add @cloudflare/ai-utils\n  sh\n  pnpm add @cloudflare/ai-utils\n  js\n  import { runWithTools } from \"@cloudflare/ai-utils\";\n\nexport default {\n    async fetch(request, env, ctx) {\n      // Define function\n      const sum = (args) => {\n        const { a, b } = args;\n        return Promise.resolve((a + b).toString());\n      };\n      // Run AI inference with function calling\n      const response = await runWithTools(\n        env.AI,\n        // Model with function calling support\n        \"@hf/nousresearch/hermes-2-pro-mistral-7b\",\n        {\n          // Messages\n          messages: [\n            {\n              role: \"user\",\n              content: \"What the result of 123123123 + 10343030?\",\n            },\n          ],\n          // Definition of available tools the AI model can leverage\n          tools: [\n            {\n              name: \"sum\",\n              description: \"Sum up two numbers and returns the result\",\n              parameters: {\n                type: \"object\",\n                properties: {\n                  a: { type: \"number\", description: \"the first number\" },\n                  b: { type: \"number\", description: \"the second number\" },\n                },\n                required: [\"a\", \"b\"],\n              },\n              // reference to previously defined function\n              function: sum,\n            },\n          ],\n        },\n      );\n      return new Response(JSON.stringify(response));\n    },\n  };\n  ts\n  import { runWithTools } from \"@cloudflare/ai-utils\";\n\ntype Env = {\n    AI: Ai;\n  };\n\nexport default {\n    async fetch(request, env, ctx) {\n      // Define function\n      const sum = (args: { a: number; b: number }): Promise<string> => {\n        const { a, b } = args;\n        return Promise.resolve((a + b).toString());\n      };\n      // Run AI inference with function calling\n      const response = await runWithTools(\n        env.AI,\n        // Model with function calling support\n        \"@hf/nousresearch/hermes-2-pro-mistral-7b\",\n        {\n          // Messages\n          messages: [\n            {\n              role: \"user\",\n              content: \"What the result of 123123123 + 10343030?\",\n            },\n          ],\n          // Definition of available tools the AI model can leverage\n          tools: [\n            {\n              name: \"sum\",\n              description: \"Sum up two numbers and returns the result\",\n              parameters: {\n                type: \"object\",\n                properties: {\n                  a: { type: \"number\", description: \"the first number\" },\n                  b: { type: \"number\", description: \"the second number\" },\n                },\n                required: [\"a\", \"b\"],\n              },\n              // reference to previously defined function\n              function: sum,\n            },\n          ],\n        },\n      );\n      return new Response(JSON.stringify(response));\n    },\n  } satisfies ExportedHandler<Env>;\n  mermaid\nsequenceDiagram\n    participant Worker as Worker\n    participant WorkersAI as Workers AI\n\nWorker->>+WorkersAI: Send messages, function calling prompt, and available tools\n    WorkersAI->>+Worker: Select tools and arguments for function calling\n    Worker-->>-Worker: Execute function\n    Worker-->>+WorkersAI: Send messages, function calling prompt and function result\n    WorkersAI-->>-Worker: Send response incorporating function output\nts\nexport default {\n  async fetch(request, env, ctx) {\n    const sum = (args: { a: number; b: number }): Promise<string> => {\n      const { a, b } = args;\n      // Logging from within embedded function invocations\n      console.log(`The sum function has been invoked with the arguments a: ${a} and b: ${b}`)\n      return Promise.resolve((a + b).toString());\n    };\n    ...\n  }\n}\nts\nconst response = await runWithTools(\n  env.AI,\n  '@hf/nousresearch/hermes-2-pro-mistral-7b',\n  {\n    messages: [\n      ...\n    ],\n    tools: [\n      ...\n    ],\n  },\n  // Enable verbose mode\n  { verbose: true }\n);\nts\nasync fetch(request, env, ctx) {\n  const response = (await runWithTools(\n    env.AI,\n    '@hf/nousresearch/hermes-2-pro-mistral-7b',\n    {\n      messages: [\n        ...\n      ],\n      tools: [\n        ...\n      ],\n    },\n    {\n      // Enable response streaming\n      streamFinalResponse: true,\n    }\n  )) as ReadableStream;\n\n// Set response headers for streaming\n  return new Response(response, {\n    headers: {\n      'content-type': 'text/event-stream',\n    },\n  });\n}\nbash\nrequest_body=$(< <(cat <<EOF\n{\n  \"country\": \"US\",\n  \"state\": \"MA\",\n  \"locality\": \"Boston\",\n  \"organization\": \"City of Boston\",\n  \"organizational_unit\": \"Championship Parade Detail\",\n  \"common_name\": \"app.example.com\",\n  \"sans\": [\n    \"app.example.com\",\n    \"www.example.com\",\n    \"blog.example.com\",\n    \"example.com\"\n  ],\n  \"key_type\": \"p256v1\"\n}\nEOF\n))\nbash\ncurl https://api.cloudflare.com/client/v4/zones/{zone_id}/custom_csrs \\\n--header \"X-Auth-Email: <EMAIL>\" \\\n--header \"X-Auth-Key: <API_KEY>\" \\\n--header \"Content-Type: application/json\" \\\n--data \"$request_body\"",
  "code_samples": [
    {
      "code": "During gradual rollouts, monitor your Worker's analytics for increased 404 response rates, especially for asset files (`.js`, `.css`, `.png`). Use [Analytics Engine](https://developers.cloudflare.com/analytics/analytics-engine/) or [Logpush](https://developers.cloudflare.com/workers/observability/logs/logpush/) to track these metrics and catch asset mismatch issues early.\n\n## Best practices\n\nWhen deploying applications with fingerprinted assets using gradual rollouts:\n\n* Use version affinity (preferably session-based) to ensure consistent asset loading\n* Test asset loading using version overrides before increasing rollout percentages\n* Monitor 404 rates during deployments to catch issues quickly\n* Have rollback procedures ready in case asset problems arise\n* Choose session-based or user-based affinity depending on your application's authentication model\n\nWith proper version affinity configuration, you can safely perform gradual deployments of applications that use modern build tools and asset optimization without worrying about broken user experiences from missing assets.\n\n</page>\n\n<page>\n---\ntitle: Serving a subdirectory ¬∑ Cloudflare Workers docs\ndescription: How to configure a Worker with static assets on a subpath.\nlastUpdated: 2025-05-01T19:25:08.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/workers/static-assets/routing/advanced/serving-a-subdirectory/\n  md: https://developers.cloudflare.com/workers/static-assets/routing/advanced/serving-a-subdirectory/index.md\n---\n\nNote\n\nThis feature requires Wrangler v3.98.0 or later.\n\nLike with any other Worker, [you can configure a Worker with assets to run on a path of your domain](https://developers.cloudflare.com/workers/configuration/routing/routes/). Assets defined for a Worker must be nested in a directory structure that mirrors the desired path.\n\nFor example, to serve assets from `example.com/blog/*`, create a `blog` directory in your asset directory.\n\nWith a [Wrangler configuration file](https://developers.cloudflare.com/workers/wrangler/configuration/) like so:\n\n* wrangler.jsonc",
      "language": "unknown"
    },
    {
      "code": "* wrangler.toml",
      "language": "unknown"
    },
    {
      "code": "In this example, requests to `example.com/blog/` will serve the `index.html` file, and requests to `example.com/blog/posts/post1` will serve the `post1.html` file.\n\nIf you have a file outside the configured path, it will not be served, unless it is part of the `assets.not_found_handling` for [Single Page Applications](https://developers.cloudflare.com/workers/static-assets/routing/single-page-application/) or [custom 404 pages](https://developers.cloudflare.com/workers/static-assets/routing/static-site-generation/). For example, if you have a `home.html` file in the root of your asset directory, it will not be served when requesting `example.com/blog/home`. However, if needed, these files can still be manually fetched over [the binding](https://developers.cloudflare.com/workers/static-assets/binding/#binding).\n\n</page>\n\n<page>\n---\ntitle: HTML handling ¬∑ Cloudflare Workers docs\ndescription: How to configure a HTML handling and trailing slashes for the\n  static assets of your Worker.\nlastUpdated: 2025-05-08T19:08:59.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/workers/static-assets/routing/advanced/html-handling/\n  md: https://developers.cloudflare.com/workers/static-assets/routing/advanced/html-handling/index.md\n---\n\nForcing or dropping trailing slashes on request paths (for example, `example.com/page/` vs. `example.com/page`) is often something that developers wish to control for cosmetic reasons. Additionally, it can impact SEO because search engines often treat URLs with and without trailing slashes as different, separate pages. This distinction can lead to duplicate content issues, indexing problems, and overall confusion about the correct canonical version of a page.\n\nThe [`assets.html_handling` configuration](https://developers.cloudflare.com/workers/wrangler/configuration/#assets) determines the redirects and rewrites of requests for HTML content. It is used to specify the pattern for canonical URLs, thus where Cloudflare serves HTML content from, and additionally, where Cloudflare redirects non-canonical URLs to.\n\nTake the following directory structure:\n\n## Automatic trailing slashes (default)\n\nThis will usually give you the desired behavior automatically: individual files (e.g. `foo.html`) will be served *without* a trailing slash and folder index files (e.g. `foo/index.html`) will be served *with* a trailing slash.\n\n* wrangler.jsonc",
      "language": "unknown"
    },
    {
      "code": "* wrangler.toml",
      "language": "unknown"
    },
    {
      "code": "Based on the incoming requests, the following assets would be served:\n\n| Incoming Request | Response | Asset Served |\n| - | - | - |\n| /file | 200 | /dist/file.html |\n| /file.html | 307 to /file | - |\n| /file/ | 307 to /file | - |\n| /file/index | 307 to /file | - |\n| /file/index.html | 307 to /file | - |\n| /folder | 307 to /folder/ | - |\n| /folder.html | 307 to /folder | - |\n| /folder/ | 200 | /dist/folder/index.html |\n| /folder/index | 307 to /folder | - |\n| /folder/index.html | 307 to /folder | - |\n\n## Force trailing slashes\n\nAlternatively, you can force trailing slashes (`force-trailing-slash`).\n\n* wrangler.jsonc",
      "language": "unknown"
    },
    {
      "code": "* wrangler.toml",
      "language": "unknown"
    },
    {
      "code": "Based on the incoming requests, the following assets would be served:\n\n| Incoming Request | Response | Asset Served |\n| - | - | - |\n| /file | 307 to /file/ | - |\n| /file.html | 307 to /file/ | - |\n| /file/ | 200 | /dist/file.html |\n| /file/index | 307 to /file/ | - |\n| /file/index.html | 307 to /file/ | - |\n| /folder | 307 to /folder/ | - |\n| /folder.html | 307 to /folder/ | - |\n| /folder/ | 200 | /dist/folder/index.html |\n| /folder/index | 307 to /folder/ | - |\n| /folder/index.html | 307 to /folder/ | - |\n\n## Drop trailing slashes\n\nOr you can drop trailing slashes (`drop-trailing-slash`).\n\n* wrangler.jsonc",
      "language": "unknown"
    },
    {
      "code": "* wrangler.toml",
      "language": "unknown"
    },
    {
      "code": "Based on the incoming requests, the following assets would be served:\n\n| Incoming Request | Response | Asset Served |\n| - | - | - |\n| /file | 200 | /dist/file.html |\n| /file.html | 307 to /file | - |\n| /file/ | 307 to /file | - |\n| /file/index | 307 to /file | - |\n| /file/index.html | 307 to /file | - |\n| /folder | 200 | /dist/folder/index.html |\n| /folder.html | 307 to /folder | - |\n| /folder/ | 307 to /folder | - |\n| /folder/index | 307 to /folder | - |\n| /folder/index.html | 307 to /folder | - |\n\n## Disable HTML handling\n\nAlternatively, if you have bespoke needs, you can disable the built-in HTML handling entirely (`none`).\n\n* wrangler.jsonc",
      "language": "unknown"
    },
    {
      "code": "* wrangler.toml",
      "language": "unknown"
    },
    {
      "code": "Based on the incoming requests, the following assets would be served:\n\n| Incoming Request | Response | Asset Served |\n| - | - | - |\n| /file | Depends on `not_found_handling` | Depends on `not_found_handling` |\n| /file.html | 200 | /dist/file.html |\n| /file/ | Depends on `not_found_handling` | Depends on `not_found_handling` |\n| /file/index | Depends on `not_found_handling` | Depends on `not_found_handling` |\n| /file/index.html | Depends on `not_found_handling` | Depends on `not_found_handling` |\n| /folder | Depends on `not_found_handling` | Depends on `not_found_handling` |\n| /folder.html | Depends on `not_found_handling` | Depends on `not_found_handling` |\n| /folder/ | Depends on `not_found_handling` | Depends on `not_found_handling` |\n| /folder/index | Depends on `not_found_handling` | Depends on `not_found_handling` |\n| /folder/index.html | 200 | /dist/folder/index.html |\n\n</page>\n\n<page>\n---\ntitle: 2. Update to Wrangler v2 ¬∑ Cloudflare Workers docs\ndescription: This document describes the steps to migrate a project from\n  Wrangler v1 to Wrangler v2. Before updating your Wrangler version, review and\n  complete Migrate webpack projects from Wrangler version 1 if it applies to\n  your project.\nlastUpdated: 2025-02-12T13:41:31.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/workers/wrangler/migration/v1-to-v2/update-v1-to-v2/\n  md: https://developers.cloudflare.com/workers/wrangler/migration/v1-to-v2/update-v1-to-v2/index.md\n---\n\nThis document describes the steps to migrate a project from Wrangler v1 to Wrangler v2. Before updating your Wrangler version, review and complete [Migrate webpack projects from Wrangler version 1](https://developers.cloudflare.com/workers/wrangler/migration/v1-to-v2/eject-webpack/) if it applies to your project.\n\nWrangler v2 ships with new features and improvements that may require some changes to your configuration.\n\nThe CLI itself will guide you through the upgrade process.\n\nNote\n\nTo learn more about the improvements to Wrangler, refer to [Wrangler v1 and v2 comparison](https://developers.cloudflare.com/workers/wrangler/deprecations/#wrangler-v1-and-v2-comparison-tables).\n\n## Update Wrangler version\n\n### 1. Uninstall Wrangler v1\n\nIf you had previously installed Wrangler v1 globally using npm, you can uninstall it with:",
      "language": "unknown"
    },
    {
      "code": "If you used Cargo to install Wrangler v1, you can uninstall it with:",
      "language": "unknown"
    },
    {
      "code": "### 2. Install Wrangler\n\nNow, install the latest version of Wrangler.",
      "language": "unknown"
    },
    {
      "code": "### 3. Verify your install\n\nTo check that you have installed the correct Wrangler version, run:",
      "language": "unknown"
    },
    {
      "code": "## Test Wrangler v2 on your previous projects\n\nNow you will test that Wrangler v2 can build your Wrangler v1 project. In most cases, it will build just fine. If there are errors, the command line should instruct you with exactly what to change to get it to build.\n\nIf you would like to read more on the deprecated [Wrangler configuration file](https://developers.cloudflare.com/workers/wrangler/configuration/) fields that cause Wrangler v2 to error, refer to [Deprecations](https://developers.cloudflare.com/workers/wrangler/deprecations/).\n\nRun the `wrangler dev` command. This will show any warnings or errors that should be addressed. Note that in most cases, the messages will include actionable instructions on how to resolve the issue.",
      "language": "unknown"
    },
    {
      "code": "* Errors need to be fixed before Wrangler can build your Worker.\n* In most cases, you will only see warnings. These do not stop Wrangler from building your Worker, but consider updating the configuration to remove them.\n\nHere is an example of some warnings and errors:",
      "language": "unknown"
    },
    {
      "code": "## Deprecations\n\nRefer to [Deprecations](https://developers.cloudflare.com/workers/wrangler/deprecations/) for more details on what is no longer supported.\n\n</page>\n\n<page>\n---\ntitle: 1. Migrate webpack projects ¬∑ Cloudflare Workers docs\ndescription: This guide describes the steps to migrate a webpack project from\n  Wrangler v1 to Wrangler v2. After completing this guide, update your Wrangler\n  version.\nlastUpdated: 2025-05-16T16:37:37.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/workers/wrangler/migration/v1-to-v2/eject-webpack/\n  md: https://developers.cloudflare.com/workers/wrangler/migration/v1-to-v2/eject-webpack/index.md\n---\n\nThis guide describes the steps to migrate a webpack project from Wrangler v1 to Wrangler v2. After completing this guide, [update your Wrangler version](https://developers.cloudflare.com/workers/wrangler/migration/v1-to-v2/update-v1-to-v2/).\n\nPrevious versions of Wrangler offered rudimentary support for [webpack](https://webpack.js.org/) with the `type` and `webpack_config` keys in the [Wrangler configuration file](https://developers.cloudflare.com/workers/wrangler/configuration/). Starting with Wrangler v2, Wrangler no longer supports the `type` and `webpack_config` keys, but you can still use webpack with your Workers.\n\nAs a developer using webpack with Workers, you may be in one of four categories:\n\n1. [I use `[build]` to run webpack (or another bundler) external to `wrangler`.](#i-use-build-to-run-webpack-or-another-bundler-external-to-wrangler).\n\n2. [I use `type = webpack`, but do not provide my own configuration and let Wrangler take care of it.](#i-use-type--webpack-but-do-not-provide-my-own-configuration-and-let-wrangler-take-care-of-it).\n\n3. [I use `type = webpack` and `webpack_config = <path/to/webpack.config.js>` to handle JSX, TypeScript, WebAssembly, HTML files, and other non-standard filetypes.](#i-use-type--webpack-and-webpack_config--pathtowebpackconfigjs-to-handle-jsx-typescript-webassembly-html-files-and-other-non-standard-filetypes).\n\n4. [I use `type = webpack` and `webpack_config = <path/to/webpack.config.js>` to perform code-transforms and/or other code-modifying functionality.](#i-use-type--webpack-and-webpack_config--pathtowebpackconfigjs-to-perform-code-transforms-andor-other-code-modifying-functionality).\n\nIf you do not see yourself represented, [file an issue](https://github.com/cloudflare/workers-sdk/issues/new/choose) and we can assist you with your specific situation and improve this guide for future readers.\n\n### I use `[build]` to run webpack (or another bundler) external to Wrangler.\n\nWrangler v2 supports the `[build]` key, so your Workers will continue to build using your own setup.\n\n### I use `type = webpack`, but do not provide my own configuration and let Wrangler take care of it.\n\nWrangler will continue to take care of it. Remove `type = webpack` from your Wrangler file.\n\n### I use `type = webpack` and `webpack_config = <path/to/webpack.config.js>` to handle JSX, TypeScript, WebAssembly, HTML files, and other non-standard filetypes.\n\nAs of Wrangler v2, Wrangler has built-in support for this use case. Refer to [Bundling](https://developers.cloudflare.com/workers/wrangler/bundling/) for more details.\n\nThe Workers runtime handles JSX and TypeScript. You can `import` any modules you need into your code and the Workers runtime includes them in the built Worker automatically.\n\nYou should remove the `type` and `webpack_config` keys from your Wrangler file.\n\n### I use `type = webpack` and `webpack_config = <path/to/webpack.config.js>` to perform code-transforms and/or other code-modifying functionality.\n\nWrangler v2 drops support for project types, including `type = webpack` and configuration via the `webpack_config` key. If your webpack configuration performs operations beyond adding loaders (for example, for TypeScript) you will need to maintain your custom webpack configuration. In the long term, you should [migrate to an external `[build]` process](https://developers.cloudflare.com/workers/wrangler/custom-builds/). In the short term, it is still possible to reproduce Wrangler v1's build steps in newer versions of Wrangler by following the instructions below.\n\n1. Add [wranglerjs-compat-webpack-plugin](https://www.npmjs.com/package/wranglerjs-compat-webpack-plugin) as a `devDependency`.\n\n[wrangler-js](https://www.npmjs.com/package/wrangler-js), shipped as a separate library from [Wrangler v1](https://www.npmjs.com/package/@cloudflare/wrangler/v/1.19.11), is a Node script that configures and executes [webpack 4](https://unpkg.com/browse/wrangler-js@0.1.11/package.json) for you. When you set `type = webpack`, Wrangler v1 would execute this script for you. We have ported the functionality over to a new package, [wranglerjs-compat-webpack-plugin](https://www.npmjs.com/package/wranglerjs-compat-webpack-plugin), which you can use as a [webpack plugin](https://v4.webpack.js.org/configuration/plugins/).\n\nTo do that, you will need to add it as a dependency:\n\n* npm",
      "language": "unknown"
    },
    {
      "code": "* yarn",
      "language": "unknown"
    },
    {
      "code": "* pnpm",
      "language": "unknown"
    },
    {
      "code": "You should see this reflected in your `package.json` file:",
      "language": "unknown"
    },
    {
      "code": "1. Add `wranglerjs-compat-webpack-plugin` to `webpack.config.js`.\n\nModify your `webpack.config.js` file to include the plugin you just installed.",
      "language": "unknown"
    },
    {
      "code": "1. Add a build script your `package.json`.",
      "language": "unknown"
    },
    {
      "code": "1. Remove unsupported entries from your [Wrangler configuration file](https://developers.cloudflare.com/workers/wrangler/configuration/).\n\nRemove the `type` and `webpack_config` keys from your Wrangler file, as they are not supported anymore.\n\n* wrangler.jsonc",
      "language": "unknown"
    },
    {
      "code": "* wrangler.toml",
      "language": "unknown"
    },
    {
      "code": "1. Tell Wrangler how to bundle your Worker.\n\nWrangler no longer has any knowledge of how to build your Worker. You will need to tell it how to call webpack and where to look for webpack's output. This translates into two fields:\n\n* wrangler.jsonc",
      "language": "unknown"
    },
    {
      "code": "* wrangler.toml",
      "language": "unknown"
    },
    {
      "code": "1. Test your project.\n\nTry running `npx wrangler deploy` to test that your configuration works as expected.\n\n</page>\n\n<page>\n---\ntitle: Wrangler v1 (legacy) ¬∑ Cloudflare Workers docs\ndescription: The following documentation applied to Wrangler v1 usage.\nlastUpdated: 2025-08-20T18:47:44.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/workers/wrangler/migration/v1-to-v2/wrangler-legacy/\n  md: https://developers.cloudflare.com/workers/wrangler/migration/v1-to-v2/wrangler-legacy/index.md\n---\n\nThe following documentation applied to Wrangler v1 usage.\n\nWarning\n\nThis page is for Wrangler v1, which has been deprecated. [Learn how to update to the latest version of Wrangler](https://developers.cloudflare.com/workers/wrangler/migration/v1-to-v2/).\n\n* [Install / Update](https://developers.cloudflare.com/workers/wrangler/migration/v1-to-v2/wrangler-legacy/install-update/)\n* [Authentication](https://developers.cloudflare.com/workers/wrangler/migration/v1-to-v2/wrangler-legacy/authentication/)\n* [Commands](https://developers.cloudflare.com/workers/wrangler/migration/v1-to-v2/wrangler-legacy/commands/)\n* [Configuration](https://developers.cloudflare.com/workers/wrangler/migration/v1-to-v2/wrangler-legacy/configuration/)\n* [Webpack](https://developers.cloudflare.com/workers/wrangler/migration/v1-to-v2/wrangler-legacy/webpack/)\n\n</page>\n\n<page>\n---\ntitle: API Reference - Embedded function calling ¬∑ Cloudflare Workers AI docs\ndescription: Learn more about the API reference for embedded function calling.\nlastUpdated: 2025-04-03T16:21:18.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/workers-ai/features/function-calling/embedded/api-reference/\n  md: https://developers.cloudflare.com/workers-ai/features/function-calling/embedded/api-reference/index.md\n---\n\nLearn more about the API reference for [embedded function calling](https://developers.cloudflare.com/workers-ai/features/function-calling/embedded).\n\n## runWithTools\n\nThis wrapper method enables you to do embedded function calling. You pass it the AI binding, model, inputs (`messages` array and `tools` array), and optional configurations.\n\n* `AI Binding`Ai\n  * The AI binding, such as `env.AI`.\n\n* `model`BaseAiTextGenerationModels\n  * The ID of the model that supports function calling. For example, `@hf/nousresearch/hermes-2-pro-mistral-7b`.\n\n* `input`Object\n\n  * `messages`RoleScopedChatInput\\[]\n  * `tools`AiTextGenerationToolInputWithFunction\\[]\n\n* `config`Object\n\n  * `streamFinalResponse`boolean optional\n  * `maxRecursiveToolRuns`number optional\n  * `strictValidation`boolean optional\n  * `verbose`boolean optional\n  * `trimFunction`boolean optional - For the `trimFunction`, you can pass it `autoTrimTools`, which is another helper method we've devised to automatically choose the correct tools (using an LLM) before sending it off for inference. This means that your final inference call will have fewer input tokens.\n\n## createToolsFromOpenAPISpec\n\nThis method lets you automatically create tool schemas based on OpenAPI specs, so you don't have to manually write or hardcode the tool schemas. You can pass the OpenAPI spec for any API in JSON or YAML format.\n\n`createToolsFromOpenAPISpec` has a config input that allows you to perform overrides if you need to provide headers like Authentication or User-Agent.\n\n* `spec`string\n  * The OpenAPI specification in either JSON or YAML format, or a URL to a remote OpenAPI specification.\n\n* `config`Config optional - Configuration options for the createToolsFromOpenAPISpec function\n\n  * `overrides`ConfigRule\\[] optional\n  * `matchPatterns`RegExp\\[] optional\n  * `options` Object optional { `verbose` boolean optional }\n\n</page>\n\n<page>\n---\ntitle: Examples ¬∑ Cloudflare Workers AI docs\nlastUpdated: 2025-04-03T16:21:18.000Z\nchatbotDeprioritize: true\nsource_url:\n  html: https://developers.cloudflare.com/workers-ai/features/function-calling/embedded/examples/\n  md: https://developers.cloudflare.com/workers-ai/features/function-calling/embedded/examples/index.md\n---\n\n* [Use fetch() handler](https://developers.cloudflare.com/workers-ai/features/function-calling/embedded/examples/fetch/)\n* [Tools based on OpenAPI Spec](https://developers.cloudflare.com/workers-ai/features/function-calling/embedded/examples/openapi/)\n* [Use KV API](https://developers.cloudflare.com/workers-ai/features/function-calling/embedded/examples/kv/)\n\n</page>\n\n<page>\n---\ntitle: Get Started ¬∑ Cloudflare Workers AI docs\ndescription: This guide will instruct you through setting up and deploying your\n  first Workers AI project with embedded function calling. You will use Workers,\n  a Workers AI binding, the ai-utils package, and a large language model (LLM)\n  to deploy your first AI-powered application on the Cloudflare global network\n  with embedded function calling.\nlastUpdated: 2025-05-16T16:37:37.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/workers-ai/features/function-calling/embedded/get-started/\n  md: https://developers.cloudflare.com/workers-ai/features/function-calling/embedded/get-started/index.md\n---\n\nThis guide will instruct you through setting up and deploying your first Workers AI project with embedded function calling. You will use Workers, a Workers AI binding, the [`ai-utils package`](https://github.com/cloudflare/ai-utils), and a large language model (LLM) to deploy your first AI-powered application on the Cloudflare global network with embedded function calling.\n\n## 1. Create a Worker project with Workers AI\n\nFollow the [Workers AI Get Started Guide](https://developers.cloudflare.com/workers-ai/get-started/workers-wrangler/) until step 2.\n\n## 2. Install additional npm package\n\nNext, run the following command in your project repository to install the Worker AI utilities package.\n\n* npm",
      "language": "unknown"
    },
    {
      "code": "* yarn",
      "language": "unknown"
    },
    {
      "code": "* pnpm",
      "language": "unknown"
    },
    {
      "code": "## 3. Add Workers AI Embedded function calling\n\nUpdate the `index.ts` file in your application directory with the following code:\n\n* JavaScript",
      "language": "unknown"
    },
    {
      "code": "* TypeScript",
      "language": "unknown"
    },
    {
      "code": "This example imports the utils with `import { runWithTools} from \"@cloudflare/ai-utils\"` and follows the API reference below.\n\nMoreover, in this example we define and describe a list of tools that the LLM can leverage to respond to the user query. Here, the list contains of only one tool, the `sum` function.\n\nAbstracted by the `runWithTools` function, the following steps occur:",
      "language": "unknown"
    },
    {
      "code": "The `ai-utils package` is also open-sourced on [Github](https://github.com/cloudflare/ai-utils).\n\n## 4. Local development & deployment\n\nFollow steps 4 and 5 of the [Workers AI Get Started Guide](https://developers.cloudflare.com/workers-ai/get-started/workers-wrangler/) for local development and deployment.\n\nWorkers AI Embedded Function Calling charges\n\nEmbedded function calling runs Workers AI inference requests. Standard charges for inference (e.g. tokens) usage will be charged. Resources consumed (e.g. CPU time) during embedded functions' code execution will be charged just as any other Worker's code execution.\n\n## API reference\n\nFor more details, refer to [API reference](https://developers.cloudflare.com/workers-ai/features/function-calling/embedded/api-reference/).\n\n</page>\n\n<page>\n---\ntitle: Troubleshooting ¬∑ Cloudflare Workers AI docs\ndescription: This section will describe tools for troubleshooting and address common errors.\nlastUpdated: 2025-04-03T16:21:18.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/workers-ai/features/function-calling/embedded/troubleshooting/\n  md: https://developers.cloudflare.com/workers-ai/features/function-calling/embedded/troubleshooting/index.md\n---\n\nThis section will describe tools for troubleshooting and address common errors.\n\n## Logging\n\nGeneral [logging](https://developers.cloudflare.com/workers/observability/logs/) capabilities for Workers also apply to embedded function calling.\n\n### Function invocations\n\nThe invocations of tools can be logged as in any Worker using `console.log()`:",
      "language": "unknown"
    },
    {
      "code": "### Logging within `runWithTools`\n\nThe `runWithTools` function has a `verbose` mode that emits helpful logs for debugging of function calls as well input and output statistics.",
      "language": "unknown"
    },
    {
      "code": "## Performance\n\nTo respond to a LLM prompt with embedded function, potentially multiple AI inference requests and function invocations are needed, which can have an impact on user experience.\n\nConsider the following to improve performance:\n\n* Shorten prompts (to reduce time for input processing)\n* Reduce number of tools provided\n* Stream the final response to the end user (to minimize the time to interaction). See example below:",
      "language": "unknown"
    },
    {
      "code": "## Common Errors\n\nIf you are getting a `BadInput` error, your inputs may exceed our current context window for our models. Try reducing input tokens to resolve this error.\n\n</page>\n\n<page>\n---\ntitle: Build an AI Image Generator Playground (Part 1) ¬∑ Cloudflare Workers AI docs\ndescription: The new flux models on Workers AI are our most powerful\n  text-to-image AI models yet. Using Workers AI, you can get access to the best\n  models in the industry without having to worry about inference, ops, or\n  deployment.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: AI,TypeScript\nsource_url:\n  html: https://developers.cloudflare.com/workers-ai/guides/tutorials/image-generation-playground/image-generator-flux/\n  md: https://developers.cloudflare.com/workers-ai/guides/tutorials/image-generation-playground/image-generator-flux/index.md\n---\n\nThe new flux models on Workers AI are our most powerful text-to-image AI models yet. In this video, we show you how to deploy your own Workers AI Image Playground in just a few minutes.\n\nThere are many businesses being built on top of AI image generation models. Using Workers AI, you can get access to the best models in the industry without having to worry about inference, ops, or deployment. We provide the API for AI image generation, and in a couple of seconds get an image back.\n\nRefer to the AI Image Playground [GitHub repository](https://github.com/kristianfreeman/workers-ai-image-playground) to follow along locally.\n\nVideo series\n\n* [Build an AI Image Generator Playground (Part 1)](https://developers.cloudflare.com/workers-ai/guides/tutorials/image-generation-playground/image-generator-flux/)\n* [Add New AI Models to your Playground (Part 2)](https://developers.cloudflare.com/workers-ai/guides/tutorials/image-generation-playground/image-generator-flux-newmodels/)\n* [Store and Catalog AI Generated Images with R2 (Part 3)](https://developers.cloudflare.com/workers-ai/guides/tutorials/image-generation-playground/image-generator-store-and-catalog/)\n\n</page>\n\n<page>\n---\ntitle: Add New AI Models to your Playground (Part 2) ¬∑ Cloudflare Workers AI docs\ndescription: In part 2, Kristian expands upon the existing environment built in\n  part 1, by showing you how to integrate new AI models and introduce new\n  parameters that allow you to customize how images are generated.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: AI,TypeScript\nsource_url:\n  html: https://developers.cloudflare.com/workers-ai/guides/tutorials/image-generation-playground/image-generator-flux-newmodels/\n  md: https://developers.cloudflare.com/workers-ai/guides/tutorials/image-generation-playground/image-generator-flux-newmodels/index.md\n---\n\nIn part 2, Kristian expands upon the existing environment built in part 1, by showing you how to integrate new AI models and introduce new parameters that allow you to customize how images are generated.\n\nRefer to the AI Image Playground [GitHub repository](https://github.com/kristianfreeman/workers-ai-image-playground) to follow along locally.\n\nVideo series\n\n* [Build an AI Image Generator Playground (Part 1)](https://developers.cloudflare.com/workers-ai/guides/tutorials/image-generation-playground/image-generator-flux/)\n* [Add New AI Models to your Playground (Part 2)](https://developers.cloudflare.com/workers-ai/guides/tutorials/image-generation-playground/image-generator-flux-newmodels/)\n* [Store and Catalog AI Generated Images with R2 (Part 3)](https://developers.cloudflare.com/workers-ai/guides/tutorials/image-generation-playground/image-generator-store-and-catalog/)\n\n</page>\n\n<page>\n---\ntitle: Store and Catalog AI Generated Images with R2 (Part 3) ¬∑ Cloudflare\n  Workers AI docs\ndescription: In the final part of the AI Image Playground series, Kristian\n  teaches how to utilize Cloudflare's R2 object storage.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\ntags: AI,TypeScript\nsource_url:\n  html: https://developers.cloudflare.com/workers-ai/guides/tutorials/image-generation-playground/image-generator-store-and-catalog/\n  md: https://developers.cloudflare.com/workers-ai/guides/tutorials/image-generation-playground/image-generator-store-and-catalog/index.md\n---\n\nIn the final part of the AI Image Playground series, Kristian teaches how to utilize Cloudflare's [R2](https://developers.cloudflare.com/r2) object storage in order to maintain and keep track of each AI generated image.\n\nRefer to the AI Image Playground [GitHub repository](https://github.com/kristianfreeman/workers-ai-image-playground) to follow along locally.\n\nVideo series\n\n* [Build an AI Image Generator Playground (Part 1)](https://developers.cloudflare.com/workers-ai/guides/tutorials/image-generation-playground/image-generator-flux/)\n* [Add New AI Models to your Playground (Part 2)](https://developers.cloudflare.com/workers-ai/guides/tutorials/image-generation-playground/image-generator-flux-newmodels/)\n* [Store and Catalog AI Generated Images with R2 (Part 3)](https://developers.cloudflare.com/workers-ai/guides/tutorials/image-generation-playground/image-generator-store-and-catalog/)\n\n</page>\n\n<page>\n---\ntitle: Certificate signing requests (CSRs) ‚Äî Cloudflare for SaaS ¬∑ Cloudflare\n  for Platforms docs\ndescription: Cloudflare for SaaS allows you to generate a Certificate Signing\n  Request (CSR) A CSR contains information about your domain, common name, and\n  Subject Alternative Names.\nlastUpdated: 2025-10-09T15:47:46.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/cloudflare-for-platforms/cloudflare-for-saas/security/certificate-management/custom-certificates/certificate-signing-requests/\n  md: https://developers.cloudflare.com/cloudflare-for-platforms/cloudflare-for-saas/security/certificate-management/custom-certificates/certificate-signing-requests/index.md\n---\n\nGenerate a Certificate Signing Request (CSR) to get a custom certificate from the Certificate Authority (CA) of your choice while maintaining control of the private key on Cloudflare. The private key associated with the CSR will be generated by Cloudflare and will never leave our network.\n\nA CSR contains information about your domain: your organization name and address, the common name (domain name), and Subject Alternative Names (SANs).\n\nOnce the CSR has been generated, provide it to your customer. Your customer will then pass it along to their preferred CA to obtain a certificate and return it to you. After you receive the certificate, you should upload it to Cloudflare and reference the unique CSR ID that was provided to you during CSR creation.\n\nNote\n\nOnly certain customers have access to this feature. For more details, see the [Plans page](https://developers.cloudflare.com/cloudflare-for-platforms/cloudflare-for-saas/plans/).\n\n***\n\n## Generate the private key and CSR\n\n### 1. Build the CSR payload\n\nAll fields except for organizational\\_unit and key\\_type are required. If you do not specify a `key_type`, the default of `rsa2048` (RSA 2048 bit) will be used; the other option is `p256v1` (NIST P-256).\n\nCommon names are restricted to 64 characters and subject alternative names (SANs) are limited to 255 characters, [per RFC 5280](https://tools.ietf.org/html/rfc5280). You must specify at least one SAN, and the list of SANs should include the common name.",
      "language": "unknown"
    },
    {
      "code": "### 2. Generate a CSR\n\nNow, you want to generate a CSR that you can provide to your customer.",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Best practices",
      "id": "best-practices"
    },
    {
      "level": "h2",
      "text": "Automatic trailing slashes (default)",
      "id": "automatic-trailing-slashes-(default)"
    },
    {
      "level": "h2",
      "text": "Force trailing slashes",
      "id": "force-trailing-slashes"
    },
    {
      "level": "h2",
      "text": "Drop trailing slashes",
      "id": "drop-trailing-slashes"
    },
    {
      "level": "h2",
      "text": "Disable HTML handling",
      "id": "disable-html-handling"
    },
    {
      "level": "h2",
      "text": "Update Wrangler version",
      "id": "update-wrangler-version"
    },
    {
      "level": "h3",
      "text": "1. Uninstall Wrangler v1",
      "id": "1.-uninstall-wrangler-v1"
    },
    {
      "level": "h3",
      "text": "2. Install Wrangler",
      "id": "2.-install-wrangler"
    },
    {
      "level": "h3",
      "text": "3. Verify your install",
      "id": "3.-verify-your-install"
    },
    {
      "level": "h2",
      "text": "Test Wrangler v2 on your previous projects",
      "id": "test-wrangler-v2-on-your-previous-projects"
    },
    {
      "level": "h2",
      "text": "Deprecations",
      "id": "deprecations"
    },
    {
      "level": "h3",
      "text": "I use `[build]` to run webpack (or another bundler) external to Wrangler.",
      "id": "i-use-`[build]`-to-run-webpack-(or-another-bundler)-external-to-wrangler."
    },
    {
      "level": "h3",
      "text": "I use `type = webpack`, but do not provide my own configuration and let Wrangler take care of it.",
      "id": "i-use-`type-=-webpack`,-but-do-not-provide-my-own-configuration-and-let-wrangler-take-care-of-it."
    },
    {
      "level": "h3",
      "text": "I use `type = webpack` and `webpack_config = <path/to/webpack.config.js>` to handle JSX, TypeScript, WebAssembly, HTML files, and other non-standard filetypes.",
      "id": "i-use-`type-=-webpack`-and-`webpack_config-=-<path/to/webpack.config.js>`-to-handle-jsx,-typescript,-webassembly,-html-files,-and-other-non-standard-filetypes."
    },
    {
      "level": "h3",
      "text": "I use `type = webpack` and `webpack_config = <path/to/webpack.config.js>` to perform code-transforms and/or other code-modifying functionality.",
      "id": "i-use-`type-=-webpack`-and-`webpack_config-=-<path/to/webpack.config.js>`-to-perform-code-transforms-and/or-other-code-modifying-functionality."
    },
    {
      "level": "h2",
      "text": "runWithTools",
      "id": "runwithtools"
    },
    {
      "level": "h2",
      "text": "createToolsFromOpenAPISpec",
      "id": "createtoolsfromopenapispec"
    },
    {
      "level": "h2",
      "text": "1. Create a Worker project with Workers AI",
      "id": "1.-create-a-worker-project-with-workers-ai"
    },
    {
      "level": "h2",
      "text": "2. Install additional npm package",
      "id": "2.-install-additional-npm-package"
    },
    {
      "level": "h2",
      "text": "3. Add Workers AI Embedded function calling",
      "id": "3.-add-workers-ai-embedded-function-calling"
    },
    {
      "level": "h2",
      "text": "4. Local development & deployment",
      "id": "4.-local-development-&-deployment"
    },
    {
      "level": "h2",
      "text": "API reference",
      "id": "api-reference"
    },
    {
      "level": "h2",
      "text": "Logging",
      "id": "logging"
    },
    {
      "level": "h3",
      "text": "Function invocations",
      "id": "function-invocations"
    },
    {
      "level": "h3",
      "text": "Logging within `runWithTools`",
      "id": "logging-within-`runwithtools`"
    },
    {
      "level": "h2",
      "text": "Performance",
      "id": "performance"
    },
    {
      "level": "h2",
      "text": "Common Errors",
      "id": "common-errors"
    },
    {
      "level": "h2",
      "text": "Generate the private key and CSR",
      "id": "generate-the-private-key-and-csr"
    },
    {
      "level": "h3",
      "text": "1. Build the CSR payload",
      "id": "1.-build-the-csr-payload"
    },
    {
      "level": "h3",
      "text": "2. Generate a CSR",
      "id": "2.-generate-a-csr"
    }
  ],
  "url": "llms-txt#test-with-version-affinity---both-requests-should-hit-the-same-version",
  "links": []
}