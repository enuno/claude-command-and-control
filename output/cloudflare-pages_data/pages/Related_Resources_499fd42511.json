{
  "title": "Related Resources",
  "content": "* [Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/)\n* [Magic WAN](https://developers.cloudflare.com/magic-wan/)\n* [Cloudflare servers don't own IPs anymore](https://blog.cloudflare.com/cloudflare-servers-dont-own-ips-anymore/)\n\n<page>\n---\ntitle: Protect data center networks · Cloudflare Reference Architecture docs\ndescription: This document focuses on the reference architecture of using\n  Cloudflare's Magic WAN, Magic Firewall, and Cloudflare Gateway services.\nlastUpdated: 2025-10-22T21:11:06.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/network/protect-data-center-networks/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/network/protect-data-center-networks/index.md\n---\n\nNetwork security teams have traditionally used various network firewalls or security appliances at the perimeter to protect their data center networks against both external and internal threats, for example, DDoS attacks, malware, ransomware, phishing, leaking of sensitive information, etc. In addition, the same or additional firewall or security appliances are deployed at the [DMZ](https://en.wikipedia.org/wiki/DMZ_\\(computing\\)) or core layer of the data center networks to control and secure internal private network traffic routed between multiple data center sites across their wide-area network (WAN).\n\nBut these firewalls and security appliances are often expensive, complex to configure and manage, difficult to scale to handle large attacks, and require upgrades and patches to defend against newly discovered threats and vulnerabilities.\n\n[Cloudflare Magic Transit](https://developers.cloudflare.com/magic-transit/), [Magic WAN](https://developers.cloudflare.com/magic-wan/), [Magic Firewall](https://developers.cloudflare.com/magic-firewall/) and [Cloudflare Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/) services running natively on [Cloudflare's massive global network](https://www.cloudflare.com/network/) provide solutions to all the shortcomings described above and more. These services offer in-line, scalable and performant global protection for your data center networks, all from a single cloud network platform.\n\n* [Magic Transit](https://www.cloudflare.com/network-services/products/magic-transit/) provides instant detection and mitigation against network-layer DDoS attacks on your public, Internet-facing networks.\n* [Magic WAN](https://www.cloudflare.com/network-services/products/magic-wan/) provides any-to-any, hybrid/multi-cloud secure connectivity between your private, enterprise networks.\n* [Magic Firewall](https://developers.cloudflare.com/magic-firewall/) is a cloud-native network firewall service that can be used to filter traffic that is routed to and from your networks that are protected by Magic Transit. It also supports functionalities such as [Intrusion Detection](https://developers.cloudflare.com/magic-firewall/about/ids/) (IDS) and [packet capture](https://developers.cloudflare.com/magic-firewall/packet-captures/).\n* [Gateway](https://www.cloudflare.com/zero-trust/products/gateway/) is a secure web gateway (SWG) service that allows you to inspect and control both Internet-bound traffic that is originated from your networks, as well as private network-to-private network traffic (that is, east-west), by proxying such traffic through Cloudflare's global network while applying DNS, network and HTTP based [policies](https://developers.cloudflare.com/cloudflare-one/traffic-policies/).\n\nThis document focuses specifically on the reference architectures of using Cloudflare Magic Transit, Magic WAN, Magic Firewall and Cloudflare Gateway services to protect both external and internal communications to your data center networks. For details of how Magic Transit, Magic WAN, Magic Firewall and Cloudflare Gateway works and how it can be architected for various use cases, see the linked resources at the end of the document.\n\nTo illustrate the architecture and how it works, the following diagrams visualize an example corporation with a set of data center networks that are either public-facing, connecting to users on the Internet or private, internal facing, used for communication within the enterprise. These networks are deployed at two on-premises locations. The prefixes of the public-facing networks are to be protected by Cloudflare Magic Transit.\n\n| Data center 1 | Data center 2 |\n| - | - |\n| Public-facing network: `192.0.2.0/24` | Public-facing network: `203.0.113.0/24` |\n| Private network: `192.168.1.0/24` | Private network: `172.16.2.0/24` |\n\nThe edge router(s) at each data center is connected to Cloudflare network via two Direct [Cloudflare Network Interconnect](https://developers.cloudflare.com/network-interconnect/) (CNI) connections, which are direct, private connections between your network and Cloudflare network. One of the Direct CNI connections is for carrying public-facing network traffic, while the other is for carrying private network traffic. Optionally, you can choose to carry both public and private network traffic over a single CNI connection but many organizations do desire to transport external and internal network traffic over separate connections in their security practice.\n\n* For data center 1, CNI connection 1 is used to transport public-facing network traffic and connection 2 is used to transport private network traffic.\n* For data center 2, CNI connection 3 is used to transport public-facing network traffic and connection 4 is used to transport private network traffic.\n\n## Protect inbound traffic to public-facing networks\n\nThe reference architecture diagram below illustrates how Cloudflare Magic Transit and Magic Firewall can be used to protect the data centers' public-facing networks from inbound traffic originating from the Internet.\n\n![Figure 1. Protect Public-facing Networks from Inbound Traffic.](https://developers.cloudflare.com/_astro/figure1.ByCLqfND_27Cs8B.svg)\n\n1. Using Border Gateway Protocol ([BGP](https://www.cloudflare.com/learning/security/glossary/what-is-bgp/)) and [IP anycast](https://www.cloudflare.com/learning/cdn/glossary/anycast-network/), Cloudflare advertises the customer's protected IP prefixes to the Internet from all of [Cloudflare's global data centers](https://www.cloudflare.com/network/). At the same time, on-premises network(s) would stop advertising the same exact prefixes from their respective on-premises border routers. This ensures that all traffic passes through Cloudflare for Magic Transit DDoS protection and policy enforcement before being delivered to the customer's data center. Internet traffic destined to these protected IP prefixes will always be routed to the Cloudflare data center that is closest to the source of the traffic. Optionally, you could advertise less-specific IP prefixes from the border routers to the Internet. This way, in the unlikely event of a Magic Transit service failure, traffic can be quickly re-routed directly to network locations from the Internet.\n2. Traffic originating from the Internet and destined to the protected IP prefixes is ingested into the global Cloudflare network.\n3. All DDoS attack traffic is mitigated in-line, close to the sources, at every Cloudflare data center using advanced and automated [DDoS mitigation](https://developers.cloudflare.com/ddos-protection/) technologies.\n4. Traffic that passes DDoS mitigation is subjected to additional network firewall filtering using [Magic Firewall](https://developers.cloudflare.com/magic-firewall/).\n5. Clean, filtered traffic is routed to the protected networks through Direct [Cloudflare Network Interconnect](https://developers.cloudflare.com/network-interconnect/) (CNI) connections.\n6. There are two ways to route server return traffic back to the clients. One way is to route it natively out of the data center and onto the Internet, bypassing Cloudflare network. This method is called Direct Server Return (DSR). It results in asymmetric routing for the bi-directional traffic, which may cause problems with network security and traffic filtering when there are stateful firewalls or NAT devices in the network path, either through other parts of the data center or between the data center and the Internet. Caution needs to be taken in ensuring such an issue does not exist in your network. The other way is to symmetrically route server return traffic back through the Cloudflare network, over the same connection that carries the client-to-server traffic, using [Magic Transit Egress](https://developers.cloudflare.com/magic-transit/reference/egress/). This method is depicted in the diagram above, where the server return traffic is routed to the Cloudflare network via the same CNIs that transport public-facing network traffic from Cloudflare to the data center, using routing techniques such as policy-based routing (PBR) at your sites.\n7. Magic Transit Egress traffic is subject to Magic Firewall filtering before being routed out to the Internet towards the users.\n\n## Protect Internet access from public-facing networks\n\nThe reference architecture diagram below illustrates how Cloudflare services - Magic Transit (Egress), Magic Firewall, and Cloudflare Gateway can be used to protect outbound Internet traffic originating from the data centers' public-facing networks (that is, servers with public IP addresses).\n\n![Figure 2. Protect outbound traffic from public-facing networks.](https://developers.cloudflare.com/_astro/figure2.CWqDwBZ8_Z6CAdb.svg)\n\n1. Each site network routes outbound Internet traffic originating from the public-facing networks to Cloudflare, via the same CNIs that inbound traffic traverses. This can be done at your site through routing techniques of your choice, such as policy based routing (PBR).\n2. Upon entering the Cloudflare network, outbound Internet traffic is first routed through Magic Firewall where it is subject to any configured network firewall policies.\n3. Outbound Internet traffic is subsequently sent to [Cloudflare Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/), our secure web gateway service where various [policies](https://developers.cloudflare.com/cloudflare-one/traffic-policies/) enforce a comprehensive set of security and control measures on the outbound traffic, ensuring the utmost protection for your networks. For example, Gateway DNS and HTTP policies can both be configured to prevent your servers from connecting to questionable Internet sites and from downloading malware or other malicious content.\n4. Once traffic clears inspection, Gateway proxies the outbound traffic to their destinations on the Internet. The source IP addresses of the outbound traffic are the Cloudflare owned IP addresses associated with the Gateway service, which if you want you can purchase and set your [own egress IP](https://developers.cloudflare.com/cloudflare-one/traffic-policies/egress-policies/dedicated-egress-ips/)\n5. Return traffic from the Internet, destined to Cloudflare's IP addresses linked to the Gateway service, is routed into Cloudflare's global network.\n6. Traffic is inspected against Gateway policies.\n7. Return traffic that passes Gateway inspection is routed to Magic Firewall for further packet filtering.\n8. Return traffic that passes Magic Firewall filtering is routed from Cloudflare to your network locations via CNIs that transport public-facing network traffic.\n\n## Protect site-to-site, inter-data center, private network traffic\n\nThe reference architecture diagrams below illustrate how Cloudflare services — Magic WAN, Magic Firewall and Cloudflare Gateway — can be used to protect site-to-site, inter-data center traffic between your private networks.\n\n**Site to Site Private Network Traffic Connectivity**\n\nFirst, let us examine the use case where you do not intend to subject site-to-site private network traffic to Cloudflare Gateway proxy firewall service and simply route it using Magic WAN service.\n\n![Figure 3.1. Protect inter-data center non-gateway-proxied traffic between private networks.](https://developers.cloudflare.com/_astro/figure3.1.Bcrim4pP_Z26Llze.svg)\n\n1. Each site routes site-to-site private network traffic, destined to the other data center location, to Cloudflare Magic WAN via the corresponding CNI connections. This can be done at your site through routing techniques of your choice, such as policy based routing (PBR).\n2. Upon entering the Cloudflare network, traffic is routed through Magic Firewall.\n3. Magic Firewall subjects traffic to any configured network firewall policies.\n4. Traffic that clears the Magic Firewall rules and is not intended to be further proxied by Cloudflare Gateway service, is routed back to the destination network via the corresponding CNI.\n\n**Site to Site Private Network Traffic with Application Level Security Controls**\n\nFor the use case where you do want to apply application level policy for fine-grain control and security on certain private network traffic, you can route and proxy such traffic through Magic WAN and Cloudflare Gateway service. The following diagram illustrates the architecture and packet flow of such use cases.\n\n![Figure 3.2: Figure 3.2. Protect inter-data center gateway-proxied traffic between private networks.](https://developers.cloudflare.com/_astro/figure3.2.D9WLCVnf_Z1VopTw.svg)\n\n1. Each site routes private network traffic destined to the other data center location to Cloudflare Magic WAN via the corresponding CNI connections. This can be done at your site through routing techniques of your choice, such as policy based routing (PBR).\n2. Upon entering the Cloudflare network, traffic is routed through Magic Firewall where it is subject to any configured network firewall policies.\n3. After clearing Magic Firewall, traffic is subsequently routed to [Cloudflare Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/), our secure web gateway service.\n4. Cloudflare Gateway subjects traffic to any configured L3-7 [policies](https://developers.cloudflare.com/cloudflare-one/traffic-policies/) that enforce a comprehensive set of security and control measures, ensuring the utmost protection for your networks. Once traffic clears inspection, Gateway proxies the traffic to its destination private network. The source IP addresses of the proxied traffic are the Cloudflare owned IP addresses associated with the Gateway service.\n5. The proxied traffic, en-route to its destination private network, is routed through Magic Firewall once again for further packet filtering.\n6. Traffic that passes Magic Firewall filtering is routed from Cloudflare to your network locations via the corresponding CNIs that transport private network traffic.\n\n## Protect outbound Internet traffic from private networks\n\nThe reference architecture diagram below illustrates how Cloudflare services — Magic WAN, Magic Firewall and Cloudflare Gateway — can be used to protect outbound Internet traffic originating from the data centers' private networks. The use cases and the protection provided to the servers on the private networks are very similar to those described in the previous section about protecting Internet access from public-facing networks. The differences are that the servers have private IP addresses and that Magic WAN service is used in this section, as opposed to the previous section where servers are assigned with public IP addresses and Magic Transit server is used.\n\n![Figure 4. Protect outbound traffic from private networks.](https://developers.cloudflare.com/_astro/figure4.Chl4DAXi_1MuKn9.svg)\n\n1. Each site routes outbound Internet traffic originating from its private networks to Cloudflare Magic WAN via the corresponding CNI connections. This can be done at your site through routing techniques of your choice, such as policy based routing (PBR).\n2. Upon entering the Cloudflare network, outbound Internet traffic is first routed through Magic Firewall where it is subject to any configured network firewall policies.\n3. Traffic that clears Magic Firewall is subsequently sent to [Cloudflare Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/), our secure web gateway service where any configured L3-7 [policies](https://developers.cloudflare.com/cloudflare-one/traffic-policies/) enforce a comprehensive set of security and control measures on the outbound traffic, ensuring the utmost protection for your networks.\n4. Once traffic clears inspection, Gateway proxies the outbound traffic to their destinations on the Internet. The source IP addresses of the outbound traffic are the Cloudflare owned IP addresses associated with the Gateway service.\n5. Return traffic from the Internet, destined to Cloudflare's IP addresses linked to the Gateway service, is routed into Cloudflare's global network.\n6. Traffic is inspected against Gateway policies.\n7. Return traffic that passes Gateway inspection is routed to Magic Firewall for further packet filtering.\n8. Return traffic that passes Magic Firewall filtering is routed from Cloudflare to your network locations via CNIs that transport private network traffic.\n\n* [Cloudflare Magic Transit](https://developers.cloudflare.com/magic-transit/)\n* [Cloudflare DDoS Protection](https://developers.cloudflare.com/ddos-protection/)\n* [Magic Transit Reference Architecture](https://developers.cloudflare.com/reference-architecture/architectures/magic-transit/)\n* [Cloudflare Network Interconnect](https://developers.cloudflare.com/network-interconnect/)\n* [Cloudflare Magic Firewall](https://developers.cloudflare.com/magic-firewall/)\n* [Cloudflare Magic WAN](https://developers.cloudflare.com/magic-wan/)\n* [Cloudflare Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/)\n* [Integration of Cloudflare Magic services and Cloudflare Gateway](https://developers.cloudflare.com/magic-wan/zero-trust/cloudflare-gateway/)\n\n<page>\n---\ntitle: Protect hybrid cloud networks with Cloudflare Magic Transit · Cloudflare\n  Reference Architecture docs\ndescription: Cloudflare Magic Transit provides cloud-native, in-line DDoS\n  protection, and traffic acceleration for all Internet-facing networks.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/network/protect-hybrid-cloud-networks-with-cloudflare-magic-transit/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/network/protect-hybrid-cloud-networks-with-cloudflare-magic-transit/index.md\n---\n\nProtecting network infrastructure from DDoS attacks demands a unique combination of strength and speed. Volumetric attacks can easily overwhelm on-premise hardware-based DDoS protection appliances and their bandwidth-constrained Internet links.\n\nA cloud-based DDoS protection solution is more agile, efficient and scalable but most solutions on the market lack the global network footprint and scrubbing center density required to maintain good network performance. DDoS protection solutions with such shortcomings require redirecting customer traffic through sparsely located scrubbing centers that are often thousands of miles away from where the traffic was originally ingested into the network, adding significant latency that inevitably impacts the end-to-end network performance and throughput.\n\nCloudflare Magic Transit provides cloud-native, in-line DDoS protection and traffic acceleration for all your Internet-facing networks that serve incoming user traffic from the Internet, regardless of where they are deployed, whether on-premise, in the cloud, or a combination of the two (that is, hybrid architecture). With data centers spanning hundreds of cities and with hundreds of Tbps in DDoS mitigation capacity, Magic Transit can detect and mitigate attacks close to their source of origin in under 3 seconds globally.\n\nThe details of how Magic Transit works and how it can be architected for various use cases are documented in the related resources at the end of this document - [Cloudflare Magic Transit](https://developers.cloudflare.com/magic-transit/) and [Magic Transit Reference Architecture](https://developers.cloudflare.com/reference-architecture/architectures/magic-transit/).\n\nThis document will focus specifically on, for a few common scenarios, the reference architectures of using Magic Transit to protect a hybrid cloud based network infrastructure.\n\n## Scenario 1 - Customer BYOIP for both on-premise and cloud network deployments\n\nIn this scenario, there are multiple /24 or larger network prefixes that need to be protected by Magic Transit. These networks are deployed at on-premise locations as well as across multiple cloud providers’ regions.\n\nFor illustration purposes, below is an example list of the locations of Internet-facing networks and their respective IP prefixes.\n\n![Figure 1: Customer BYOIP for all Cloud and on-premises networks.](https://developers.cloudflare.com/_astro/figure-1.TMcvFAT6_fEeGc.svg)\n\n1. Using Border Gateway Protocol ([BGP](https://www.cloudflare.com/learning/security/glossary/what-is-bgp/)), Cloudflare advertises customer’s protected IP prefixes to the Internet from all of Cloudflare’s global data centers, enabling [IP Anycast](https://www.cloudflare.com/learning/cdn/glossary/anycast-network/), so that Internet traffic destined to these protected IP prefixes will always be routed to the Cloudflare data center that is closest to the source of the traffic.\n\nAt the same time, on-premise network(s) and cloud provider network(s) would stop advertising the same exact prefixes from their respective on-premises border routers and cloud border routers. This ensures all Internet traffic destined to the Magic Transit protected IP prefixes will be routed through the Cloudflare network.\n\nYou can instead advertise less-specific IP prefixes from their border routers to the Internet. This way, if the Magic Transit service ever experiences a failure in a very unlikely event, traffic can be quickly re-routed directly to network locations from the Internet.\n\n1. Traffic originated from the Internet and destined to the protected IP prefixes is ingested into Cloudflare network globally.\n2. All traffic is scrubbed, that is, DDoS attack traffic is removed and mitigated in-line at every Cloudflare data center using advanced and automated [DDoS mitigation](https://developers.cloudflare.com/ddos-protection/) technologies.\n3. Traffic that passes DDoS mitigation is subjected to additional network firewall filtering using the included [Magic Firewall](https://developers.cloudflare.com/magic-firewall/) service.\n4. Clean, filtered traffic is routed to the protected networks either through private connections called [Cloudflare Network Interconnect](https://developers.cloudflare.com/network-interconnect/) (CNI), or through the public Internet using standard IP tunnels such as GRE or IPsec tunnels. More specific details on Magic Transit IP tunnels can be found in the [Magic Transit Tunnels and Encapsulation documentation](https://developers.cloudflare.com/magic-transit/reference/gre-ipsec-tunnels/).\n5. The server return traffic from protected IP prefixes to the Internet users are routed directly over the Internet from the hybrid cloud locations, bypassing the Cloudflare network. This is called direct server return (DSR). Note you must have BYOIP with your Cloud Service Provider to use DSR.\n\nWith Magic Transit service being the single, consolidated cloud-native network protection solution running globally on the Cloudflare network, your global, hybrid cloud based Internet-facing networks are well protected from DDoS and other malicious attacks, regardless where and what environments they are deployed in.\n\nOne other added benefit of using such consolidated, cloud-native network protection solutions is that you can easily migrate or relocate Internet-facing networks between the various hybrid cloud environments without ever losing protection to these networks. They can do so by simply changing routes in the Magic Transit configuration to route traffic to the new location.\n\n## Scenario 2 - Customer lease IP address from Cloudflare for both on-premise and cloud network deployments\n\nIn the case where you do not own any network prefixes that are equal to or larger than /24, but would still like to use Magic Transit to protect their networks, you can [lease IPs](https://developers.cloudflare.com/magic-transit/cloudflare-ips/) from Cloudflare to assign to these smaller networks. The following diagram illustrates the architecture of such a deployment. Similar to the previous scenario, these customer networks are deployed at on-premise locations as well as across multiple cloud providers’ regions.\n\nFor illustration purposes, below is an example list of the locations of Internet-facing networks and their respective IP prefixes.\n\n![Figure 2: Customer lease IPs from Cloudflare for both on-premise and cloud network deployments.](https://developers.cloudflare.com/_astro/figure-2.DGu8Lrrt_Z1Sbhhb.svg)\n\n1. Using Border Gateway Protocol (BGP), Cloudflare advertises its owned IP prefixes to the Internet, which includes the IP addresses that you lease.\n\n\\[Steps 2 through 5 are the same as those of scenario 1 above]\n\n1. The server return traffic, with leased Cloudflare IP addresses as their source IP addresses, cannot be routed to the Internet directly via the various sites’ border routers. This traffic has to be routed back through Cloudflare network to reach the Internet, using [Magic Transit Egress](https://developers.cloudflare.com/magic-transit/reference/egress/) functionality. It can be sent to the Cloudflare network via the same CNIs or IP tunnels that the Ingress traffic traversed, using routing techniques such as policy-based routing (PBR) at your sites.\n2. Magic Transit Egress traffic is subject to Magic Firewall filtering before being routed out to the Internet towards the users.\n\n## Scenario 3 - Customer BYOIP for on-premise networks and lease IP address from Cloudflare for cloud network deployments\n\nIn this scenario, you can deploy larger on-premise networks and smaller cloud-based networks. You assign your own /24 IP prefixes to the on-premise networks while leasing IPs from Cloudflare for your cloud-based networks.\n\nFor illustration purposes, below is an example list of the locations of Internet-facing networks and their respective IP prefixes.\n\n![Figure 3: Customer BYOIP for on-premise networks and lease IP from Cloudflare for cloud network deployments.](https://developers.cloudflare.com/_astro/figure-3.h9hJOj7g_Z1JFgXK.svg)\n\n1. Using Border Gateway Protocol (BGP), Cloudflare advertises both customer-owned and Cloudflare-owned IP prefixes to the Internet.\n\n\\[Steps 2 through 5 are the same as those of scenario 1 above]\n\n1. The server return traffic from your cloud-based networks is routed back through Cloudflare network to reach the Internet, using Magic Transit Egress functionality. It can be sent to the Cloudflare network via the same CNIs or IP tunnels that the Ingress traffic traversed, using routing techniques such as policy-based routing (PBR) at your physical sites.\n2. This Magic Transit Egress traffic is subject to Magic Firewall filtering before being routed out to the Internet towards the users.\n3. The server return traffic from on-premises networks to the Internet users are direct server returned (DSR), bypassing the Cloudflare network.\n\n*Note*: Alternatively, customers can choose to also route the on-premise networks’ server return traffic through Cloudflare via policy-based routing and Magic Transit Egress functionality. This adds an additional layer of security and control for the egress traffic with Magic Firewall filtering. For example, it can block traffic destined to questionable IP addresses and sites, prohibited destinations, or countries.\n\n* [Magic Transit Reference Architecture](https://developers.cloudflare.com/reference-architecture/architectures/magic-transit/)\n* [Cloudflare Magic Transit](https://developers.cloudflare.com/magic-transit/)\n* [Cloudflare Network Interconnect](https://developers.cloudflare.com/network-interconnect/)\n* [Cloudflare DDoS Protection](https://developers.cloudflare.com/ddos-protection/)\n* [Cloudflare Magic Firewall](https://developers.cloudflare.com/magic-firewall/)\n* [Cloudflare Magic IPsec Device Compatibility Matrix](https://developers.cloudflare.com/magic-wan/reference/device-compatibility/)\n* [Cloudflare Magic Transit Leased IP](https://developers.cloudflare.com/magic-transit/cloudflare-ips/)\n\n<page>\n---\ntitle: Protect public networks with Cloudflare · Cloudflare Reference\n  Architecture docs\ndescription: This document explains how Cloudflare Magic Transit, Magic\n  Firewall, and Gateway work. The products offer in-line, automatic, scalable\n  network protection for all Internet-facing networks. The architecture is\n  designed to protect public networks across multiple clouds and on-premises.\nlastUpdated: 2025-10-22T21:11:06.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/network/protect-public-networks-with-cloudflare/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/network/protect-public-networks-with-cloudflare/index.md\n---\n\nNetwork security teams have traditionally used various network firewalls or security appliances at the perimeter of their network to protect their public-facing networks against both external and internal threats like DDoS attacks, malware, ransomware, phishing, and leaking of sensitive information. However, these firewalls and security appliances are often expensive, complex to configure and manage, difficult to scale to handle large attacks, and lack the flexibility to quickly incorporate upgrades and patches to defend against newly discovered threats and vulnerabilities.\n\n[Cloudflare Magic Transit](https://developers.cloudflare.com/magic-transit/), [Magic Firewall](https://developers.cloudflare.com/magic-firewall/), and [Cloudflare Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/) services running natively on [Cloudflare's massive global network](https://www.cloudflare.com/network/) provide solutions to all the shortcomings described above and more. These services offer in-line, automatic, scalable network protection for all your Internet-facing networks, without slowing down performance, regardless of where they are deployed, whether on-premises, in the cloud, or a combination of the two (that is, a hybrid architecture).\n\n* [Magic Transit](https://www.cloudflare.com/network-services/products/magic-transit/) provides instant detection and mitigation against network-layer DDoS attacks on your public, Internet-facing networks.\n* [Magic Firewall](https://developers.cloudflare.com/magic-firewall/) is a cloud-native network firewall service that can be used to filter traffic that is routed to and from your networks that are protected by Magic Transit. It also supports functionalities such as [Intrusion Detection](https://developers.cloudflare.com/magic-firewall/about/ids/) (IDS) and [packet capture](https://developers.cloudflare.com/magic-firewall/packet-captures/).\n* [Gateway](https://www.cloudflare.com/zero-trust/products/gateway/) is a secure web gateway (SWG) service that allows you to inspect and control Internet bound traffic originating from your network by proxying this traffic through Cloudflare's global network while applying DNS, network and HTTP based [policies](https://developers.cloudflare.com/cloudflare-one/traffic-policies/).\n\nThe details of how Magic Transit, Magic Firewall, and Gateway work and how these products can be architected for various use cases can be found in the linked resources at the end of the document. This document will focus specifically on the reference architectures of using Cloudflare Magic Transit, Magic Firewall, and Cloudflare Gateway services to protect public, Internet-facing network infrastructure.\n\nTo illustrate the architecture and how it works, the following diagrams visualize an example corporation with a set of public facing networks. These networks are deployed at 5 distinct locations, both on-premises and across multiple public clouds.\n\n## Protect inbound network traffic\n\nThe reference architecture diagram below illustrates how Cloudflare Magic Transit and Magic Firewall can be used to protect the public networks from inbound traffic originating from the Internet.\n\n![Figure 1: Protect the public networks from inbound traffic originating from the Internet.](https://developers.cloudflare.com/_astro/figure-1.ChNCzrbx_Z1SflsR.svg)\n\n1. Using Border Gateway Protocol ([BGP](https://www.cloudflare.com/learning/security/glossary/what-is-bgp/)) and [IP anycast](https://www.cloudflare.com/learning/cdn/glossary/anycast-network/), Cloudflare advertises customer's protected IP prefixes to the Internet from all of Cloudflare's global data centers. Internet traffic destined to these protected IP prefixes will always be routed to the Cloudflare data center that is closest to the source of the traffic.\n\nAt the same time, on-premises network(s) and cloud provider network(s) would stop advertising the same exact prefixes from their respective on-premises border routers and cloud border routers. This ensures all Internet traffic destined to the Magic Transit protected IP prefixes will be routed through the Cloudflare network.\n\nYou can instead advertise less-specific IP prefixes from the border routers to the Internet. This way, in the unlikely event of a Magic Transit service failure, traffic can be quickly re-routed directly to network locations from the Internet.\n\n2. Traffic originating from the Internet and destined to the protected IP prefixes is ingested into the global Cloudflare network.\n\n3. All DDoS attack traffic is mitigated in-line at every Cloudflare data center using advanced and automated [DDoS mitigation](https://developers.cloudflare.com/ddos-protection/) technologies.\n\n4. Traffic that passes DDoS mitigation is subjected to additional network firewall filtering using the included [Magic Firewall](https://developers.cloudflare.com/magic-firewall/) service.\n\n5. Clean, filtered traffic is routed to the protected networks either through private [Cloudflare Network Interconnect](https://developers.cloudflare.com/network-interconnect/) (CNI) connections, or the public Internet using GRE or IPsec tunnels. More specific details on Magic Transit IP tunnels can be found in the [Magic Transit Tunnels and Encapsulation documentation](https://developers.cloudflare.com/magic-transit/reference/gre-ipsec-tunnels/).\n\n6. The server return traffic is routed back through the Cloudflare network to reach the Internet, using [Magic Transit Egress](https://developers.cloudflare.com/magic-transit/reference/egress/). It can be routed to the Cloudflare network via the same CNIs or GRE, IPsec tunnels that the ingress traffic traversed, using routing techniques such as policy-based routing (PBR) at your sites.\n\n7. Magic Transit Egress traffic is subject to Magic Firewall filtering before being routed out to the Internet towards the users.\n\n## Protect outbound network traffic\n\nThe reference architecture diagram below illustrates how Cloudflare services - Magic Transit (Egress), Magic Firewall and Cloudflare Gateway, can be used to protect outbound Internet traffic originating from the public networks.\n\n![Figure 2: Protect outbound Internet traffic originating from the public networks.](https://developers.cloudflare.com/_astro/figure-2.wsXd5oJY_Z1Sbhhb.svg)\n\n1. Each site network routes outbound Internet traffic originating from the public networks to Cloudflare, via the same CNIs and IP tunnels that inbound traffic traverses. This can be done at your site through routing techniques of your choice, such as policy based routing (PBR).\n2. Upon entering the Cloudflare network, outbound Internet traffic is first routed through Magic Firewall where it is subject to any configured network firewall policies.\n3. Outbound Internet traffic is subsequently sent to [Cloudflare Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/), our secure web gateway service where various [policies](https://developers.cloudflare.com/cloudflare-one/traffic-policies/) enforce a comprehensive set of security and control measures on the outbound traffic, ensuring the utmost protection for your networks.\n4. Once traffic clears inspection, Gateway proxies the outbound traffic to their destinations on the Internet. The source IP addresses of the outbound traffic are the Cloudflare owned IP addresses associated with the Gateway service.\n5. Return traffic from the Internet, destined to Cloudflare's IP addresses linked to the Gateway service, is routed into Cloudflare's global network.\n6. Traffic is inspected against Gateway policies.\n7. Return traffic that passes Gateway inspection is routed to Magic Firewall for further packet filtering, if any.\n8. Return traffic that passes Magic Firewall filtering is routed from Cloudflare to your network locations via CNIs or IP Tunnels over the Internet.\n\n* [Cloudflare Magic Transit](https://developers.cloudflare.com/magic-transit/)\n* [Cloudflare DDoS Protection](https://developers.cloudflare.com/ddos-protection/)\n* [Magic Transit Reference Architecture](https://developers.cloudflare.com/reference-architecture/architectures/magic-transit/)\n* [Cloudflare Network Interconnect](https://developers.cloudflare.com/network-interconnect/)\n* [Cloudflare Magic Firewall](https://developers.cloudflare.com/magic-firewall/)\n* [Cloudflare Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/)\n* [Integration of Cloudflare Magic services and Cloudflare Gateway](https://developers.cloudflare.com/magic-wan/zero-trust/cloudflare-gateway/)\n\n<page>\n---\ntitle: Protect ISP and telecommunications networks from DDoS attacks ·\n  Cloudflare Reference Architecture docs\ndescription: Learn how Internet service providers (ISPs) and telecommunications\n  companies (such as T-Mobile or British Telecom) can protect themselves from\n  DDoS attacks.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/network/protecting-sp-networks-from-ddos/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/network/protecting-sp-networks-from-ddos/index.md\n---\n\nInternet service providers (ISPs) and telecommunications companies (such as T-Mobile or British Telecom) are vulnerable to network DDoS attacks, which are often focused on the end customer - for example, trying to attack a company or remote worker connected to the internet via a broadband internet service provider. Historically to protect these customers, service providers have relied on hosting their own on-premises mitigation systems. This approach necessitates significant investment to effectively combat the constantly evolving attacks, with capacity being finite in the face of escalating attack sizes.\n\nCloudflare is well known for its DDoS mitigation services protecting public websites and APIs, and the same technologies can also be used to protect entire networks. At Cloudflare, we have [witnessed a surge in hyper-volumetric](https://blog.cloudflare.com/cloudflare-mitigates-record-breaking-71-million-request-per-second-ddos-attack) and highly sophisticated attacks, as highlighted in our quarterly [DDoS attack reports](https://radar.cloudflare.com/reports/ddos/). These attacks, due to their sheer volume, can overwhelm and outmanoeuvre on-premises DDoS mitigation systems. As a result, these on-premises mitigation systems require constant maintenance and upgrades to keep up with larger attacks, leading to ongoing investments and, with the unpredictable attack size, open-ended costs.\n\n[Cloudflare Magic Transit](https://developers.cloudflare.com/magic-transit/) offers cloud-based network DDoS mitigation as a service. Service providers are using [Cloudflare Magic Transit on-demand](https://developers.cloudflare.com/magic-transit/on-demand/), either as a supplementary solution or as a replacement for their existing setup, to safeguard their network infrastructure against this evolving threat.\n\n## Protecting service provider networks from attack\n\nThere are two main steps to deploying this solution. Firstly, setting up Cloudflare to [monitor](https://blog.cloudflare.com/flow-based-monitoring-for-magic-transit) and detect DDoS attacks on the network. Then, when a DDoS event is observed, reroute traffic through Cloudflare where DDoS mitigation takes place.\n\n![Figure 1: Overall solution of user access controls to, and the discovery of, sensitive data.](https://developers.cloudflare.com/_astro/protecting-sp-networks-from-ddos-fig1.BXZ5xvR3_ZzXd47.svg)\n\nThe first step is to gain visibility into the attacks taking place against the service provider network. The above diagram shows:\n\n1. Cloudflare is made aware of the networks to be protected. Service providers identify the prefixes (i.e. 203.0.113.0/24) they wish to protect and initiate a one-off task to onboard these prefixes onto the Cloudflare Magic Transit service; this step is a prerequisite and doesn’t affect the actual network traffic flow. Cloudflare recommends onboarding more specific prefixes compared to those the service providers advertise to the Internet. As in this example, if 203.0.113.0/24 is the protected prefix that is onboarded to Cloudflare, then the less specific 203.0.112.0/23 that encompasses both 112.0/24 and 113.0/24 prefixes, can be advertised to your upstream ISP.\n2. Service provider network devices send all traffic flow data (Netflow, IPFIX or sFlow) to the [Cloudflare Magic Network Monitoring](https://developers.cloudflare.com/magic-network-monitoring/) service. Cloudflare analyses this flow data to detect DDoS attacks.\n3. Cloudflare recommends, when possible, to connect to the Cloudflare network by setting up redundant [Cloudflare Network Interconnect](https://developers.cloudflare.com/network-interconnect/) (CNI) at our [Interconnection facilities](https://www.peeringdb.com/net/4224), this allows adherence to the 1500 Bytes maximum transmission unit (MTU) for routed user traffic. Alternatively you can connect to the Cloudflare network using [Generic Routing Encapsulation (GRE) tunnels](https://developers.cloudflare.com/magic-transit/reference/gre-ipsec-tunnels/) over the Internet.\n4. In peacetime, traffic flows as usual between the ISP network and their upstream transit and peer networks, bypassing the Cloudflare network.\n\n![Figure 1: Overall solution of user access controls to, and the discovery of, sensitive data.](https://developers.cloudflare.com/_astro/protecting-sp-networks-from-ddos-fig2.mhCca2XR_ZrWX4u.svg)\n\nThe above diagram shows how Cloudflare monitors service provider traffic and, upon detecting a possible volumetric DDoS attack, automatically advertises the most specific protected prefix from the Cloudflare global network to the Internet. This ensures that all traffic to this protected prefix is rerouted through the Cloudflare network, where malicious traffic is mitigated.\n\n1. Upon detecting a possible volumetric DDoS attack, Cloudflare automatically generates an alert. Service providers can receive the alert notifications via email and/or webhook. Additionally, the alert can trigger [automatic prefix announcement](https://developers.cloudflare.com/magic-network-monitoring/magic-transit-integration/#activate-ip-auto-advertisement) from the Cloudflare network to the Internet, as per the Magic Transit configuration by the service provider.\n2. Cloudflare advertises the protected prefix from all Cloudflare points-of-presence. Since Cloudflare advertises a more specific prefix, only the traffic destined for the attacked prefix is rerouted through the Cloudflare network.\n3. Cloudflare's network mitigates the attack traffic while letting legitimate traffic through to the service provider network. Service providers receive the original packets with an MTU of 1500 Bytes when using [Cloudflare Network Interconnect](https://developers.cloudflare.com/network-interconnect/) (CNI).\n4. Outbound traffic of the protected prefix, as well as the traffic of other prefixes, remains unaffected and continues to be routed to the Internet via the service provider's upstream links.\n5. Private peering with trusted networks is unaffected and traffic from these content providers (such as Facebook, Netflix, YouTube) will not be rerouted via Cloudflare.\n\n* [Magic Transit Reference Architecture](https://developers.cloudflare.com/reference-architecture/architectures/magic-transit/)\n* [Cloudflare Network Interconnect](https://developers.cloudflare.com/reference-architecture/architectures/magic-transit/)\n* [Flow-based monitoring for Magic Transit](https://blog.cloudflare.com/flow-based-monitoring-for-magic-transit)\n\n<page>\n---\ntitle: FIPS 140 level 3 compliance with Cloudflare Application Services ·\n  Cloudflare Reference Architecture docs\ndescription: This document outlines a reference architecture for achieving\n  Federal Information Processing Standard (FIPS) 140 Level 3 compliance using\n  Cloudflare's Application Services.\nlastUpdated: 2025-10-21T14:33:19.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/security/fips-140-3/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/security/fips-140-3/index.md\n---\n\nThis document outlines a reference architecture for achieving Federal Information Processing Standard (FIPS) 140 Level 3 compliance using Cloudflare's Application Services. FIPS 140 is a U.S. government standard that specifies security requirements for cryptographic modules protecting sensitive information in computer and telecommunication systems.\n\nFIPS 140 defines four security levels, with Level 3 being the most stringent for non-military applications. It mandates physical tamper-resistance to prevent unauthorized access to cryptographic keys and critical security parameters. This includes measures like robust enclosures, tamper-evident seals, and identity-based authentication.\n\nAchieving FIPS 140 compliance, particularly Level 3, is crucial for organizations handling sensitive data, especially those in regulated industries like:\n\n* **Government**: Federal agencies and contractors processing sensitive government information.\n* **Healthcare**: Organizations handling protected health information (PHI) under HIPAA.\n* **Financial** Services: Institutions dealing with financial transactions and customer data.\n* **Defense**: Contractors working on defense projects requiring stringent security measures.\n\nFIPS 140 compliance demonstrates a strong commitment to data security, builds trust with customers and partners, and ensures adherence to regulatory requirements. This reference architecture provides a comprehensive guide to leveraging Cloudflare's robust security features to meet these stringent standards.\n\nOrganizations use the FIPS 140-3 standard to ensure that the hardware they select meets specific security requirements. The FIPS certification standard defines four increasing, qualitative levels of security.\n\nRequires production-grade equipment and externally tested algorithms.\n\nAdds requirements for physical tamper-evidence and role-based authentication.\n\nAdds requirements for physical tamper-resistance and identity-based authentication. There must also be physical or logical separation between the interfaces by which critical security parameters enter and leave the module. Private keys can only enter or leave in encrypted form. Level 3 also requires the module to detect and react to out-of-range voltage or temperature (environmental failure protection, or EFP), or alternatively undergo environmental failure testing (EFT).\n\nThis level makes the physical security requirements more stringent, requiring the ability to be tamper-active, erasing the contents of the device if it detects various forms of environmental attack. EFP and protection against fault injection is required as well as multi-factor authentication.\n\n* **Cloudflare Keyless SSL**: A service that allows organizations to use Cloudflare's SSL/TLS protection while keeping their private keys securely stored in their own infrastructure, ensuring private keys remain under their control and never leave their premises, while still benefiting from Cloudflare's DDoS protection and performance optimization features.\n* **Cloudflare Tunnel**: Provides a secure, encrypted connection between Cloudflare's global network and the private infrastructure hosting CloudHSM, protecting data in transit.\n* **Hardware Security module**: A FIPS 140-2 Level 3 compliant HSM that securely manages cryptographic keys. Cloudflare supports a handful of HSMs, including AWS CloudHSM, Azure Key Vault, and Google Cloud KMS.\n\n## Architecture overview\n\nThe architecture diagram below illustrates the key components and data flow for achieving FIPS 140 Level 3 compliance with Cloudflare Application Services and all its required components.\n\n1. **User/Client**: Initiates an HTTPS request to a domain protected by Cloudflare. The Server Name Indication (SNI) extension in the request specifies the domain name like, for example, `keyless.example.com`. That domain is mapped to a certificate declared as [keyless](https://developers.cloudflare.com/ssl/keyless-ssl/), which means that only the public is being imported to Cloudflare, but a keyless listener is also declared, for subsequent key operations.\n2. **Cloudflare secure tunnel establishment**: The Cloudflare [tunnel](https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/) component is used to establish a secure and reliable connection with Cloudflare's global network. Only outgoing traffic is leaving the perimeter and the traffic can be narrowed down by a firewall. That secure connectivity will be used as a secured overlay for the key operations.\n3. **Key Operations**: Cloudflare [SSL](https://developers.cloudflare.com/ssl/)detects that a keyless operation is necessary and then sends all the key operations towards the keyless module installed on the private infrastructure. All the traffic is flowing through the previously established secured tunnel.\n4. **Keyless Module**: The [keyless module](https://developers.cloudflare.com/ssl/keyless-ssl/configuration/cloudflare-tunnel/#install) is responsible for forwarding the key operations to the Hardware Security Module (HSM) for cryptographic operations. The keyless module is a software component that acts as a proxy between Cloudflare and the HSM, ensuring that the private key never leaves the HSM.\n5. **Key operations via PKCS11**: The HSM performs cryptographic operations using the private key stored securely within the HSM. The HSM is a tamper-resistant device that securely manages cryptographic keys and performs cryptographic operations, ensuring the highest level of security for sensitive data.\n\n* [Cloudflare Keyless SSL](https://developers.cloudflare.com/ssl/keyless-ssl)\n\n* [Cloudflare Tunnel](https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/)\n\n* [Keyless SSL with secured Tunnel](https://developers.cloudflare.com/ssl/keyless-ssl/configuration/cloudflare-tunnel/)\n\n* [AWS cloud HSM ](https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/aws-cloud-hsm/): Learn how to use Keyless SSL with AWS CloudHSM.\n  * [Azure Dedicated HSM ](https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/azure-dedicated-hsm/): Learn how to use Keyless SSL with Azure Dedicated HSM.\n  * [Azure Managed HSM ](https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/azure-managed-hsm/): This tutorial uses Microsoft Azure’s Managed HSM to deploy a VM with the Keyless SSL daemon. Follow these instructions to deploy your keyless server.\n  * [Entrust nShield Connect ](https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/entrust-nshield-connect/): Learn how to use Keyless SSL with Entrust nShield Connect.\n  * [Configuration](https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/configuration/)\n  * [Fortanix Data Security Manager](https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/fortanix-dsm/)\n  * [Google Cloud HSM ](https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/google-cloud-hsm/): Learn how to use Keyless SSL with Google Cloud HSM.\n  * [IBM Cloud HSM ](https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/ibm-cloud-hsm/): Learn how to use Keyless SSL with IBM Cloud HSM.\n  * [SoftHSMv2 ](https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/softhsmv2/): Learn how to use Keyless SSL with SoftHSMv2.\n\n<page>\n---\ntitle: Securing data at rest · Cloudflare Reference Architecture docs\ndescription: Learn how Cloudflare's API-driven Cloud Access Security Broker\n  (CASB) works and secures data at rest.\nlastUpdated: 2025-10-24T15:44:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/security/securing-data-at-rest/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/security/securing-data-at-rest/index.md\n---\n\nData at rest refers to data that is stored in a fixed location, such as on a local hard drive, on-premises server, or cloud storage. Many businesses today are using SaaS platforms that store a lot of business data in structured forms (like databases) and unstructured forms (files like documents, images, spreadsheets). The security of the actual storage of the data, such as encryption and reliable backups, is usually abstracted from your control. But the SaaS applications allow you to manage user accounts, define what data they have access to, and also provide an ability to share access to data.\n\nWhile Cloudflare mostly secures data in transit as it travels over our network, we also have the ability to connect to your SaaS applications and use our DLP profiles to examine data at rest that might not be adequately secured and then provide recommendations for you to take action.\n\n## Protecting data with Cloudflare CASB\n\nCloudflare's API-driven [Cloud Access Security Broker](https://developers.cloudflare.com/cloudflare-one/integrations/cloud-and-saas/) (CASB) works by integrating with SaaS APIs and discovering both unstructured data at rest (documents, spreadsheets, and so on) and also examining general configuration of the application and user accounts to ensure data access controls are correctly configured.\n\n[DLP profiles](https://developers.cloudflare.com/cloudflare-one/cloud-and-saas-findings/casb-dlp/) are used to discover if files stored in your SaaS application contain sensitive data. Matches are then compared with access controls and findings are generated, such as findings to alert you to a spreadsheet that contains credit card information that is accessible by anyone on the Internet.\n\nWhen Cloudflare CASB is combined with Cloudflare's [Secure Web Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/) service, which inspects all the traffic going to and from a SaaS application, customers can achieve comprehensive visibility into both data in transit and data at rest for SaaS applications.\n\n![Figure 1: Overall solution of user access controls to, and the discovery of, sensitive data.](https://developers.cloudflare.com/_astro/securing-data-at-rest-fig1.BdIkDfSv_ZdGGxt.svg)\n\n## Securing user access to data at rest\n\n1. Cloudflare authenticates users attempting to access SaaS applications, whether they are initiating the request from managed or unmanaged endpoints.\n\n1. For managed endpoints, we recommend deploying our [device agent](https://developers.cloudflare.com/cloudflare-one/team-and-resources/devices/warp/) to maximize visibility and control of all traffic between the end user’s device and the resources being requested.\n   2. For unmanaged endpoints, we have [client-less solutions](https://developers.cloudflare.com/reference-architecture/diagrams/sase/sase-clientless-access-private-dns/) which all you to still have visibility over and inspection into the data accessed by users.\n\n2. Cloudflare's [Zero Trust Network Access](https://developers.cloudflare.com/cloudflare-one/access-controls/policies/) (ZTNA) service can integrate directly with your [SaaS applications](https://developers.cloudflare.com/cloudflare-one/access-controls/applications/http-apps/saas-apps/) using standard protocols (e.g. SAML or OIDC) to become the initial enforcement point for user access. Access calls your [identity provider](https://developers.cloudflare.com/cloudflare-one/integrations/identity-providers/) (IdP) of choice and uses additional security signals about your users and devices to make policy decisions.\n\n3. As an extension of what was covered in Securing data in use, Cloudflare [Remote Browser Isolation](https://developers.cloudflare.com/cloudflare-one/remote-browser-isolation/) (RBI) can also be used with [dedicated egress IPs](https://developers.cloudflare.com/cloudflare-one/traffic-policies/egress-policies/dedicated-egress-ips/), so that even remote clientless user’s traffic can arrive at the requested SaaS application from predictable and consistent IP addresses.\n\n## Discovering and protecting the data at rest\n\n1. In addition to what we covered in Securing data in transit, Cloudflare Data Loss Prevention (DLP) can be used to discover files that reside in your SaaS applications that contain sensitive data. CASB will scan every shared and/or publicly accessible file in the SaaS app for sensitive text that matches the DLP profile and alert you with recommended actions to take.\n\n2. To complement the dedicated egress IP option mentioned above, SaaS providers enable the ability to restrict access to your organization's resources by only permitting access when traffic is sourced from specific IP addresses.\n\n3. When you integrate a third-party SaaS application with Cloudflare CASB, CASB makes routine, out-of-band API calls that analyze the associated metadata of your configurations, users, files, and other SaaS ‘objects’. Security issues, or ‘Findings’, are then detected based on whether the metadata indicates any insecure or potentially hazardous configurations exist within the integrated SaaS applications. This can include application misconfigurations, exposed and/or sensitive data, and users accounts with poor security.\n\n* [Securing data in transit](https://developers.cloudflare.com/reference-architecture/diagrams/security/securing-data-in-transit/)\n* [Securing data in use](https://developers.cloudflare.com/reference-architecture/diagrams/security/securing-data-in-use/)\n\n<page>\n---\ntitle: \"Reference Architecture Diagram: Securing data in transit · Cloudflare\n  Reference Architecture docs\"\ndescription: Data in transit is often considered vulnerable to interception or\n  tampering during transmission. Data Loss Prevention (DLP) technologies can be\n  used to inspect the contents of network traffic and block sensitive data from\n  going to a risky destination.\nlastUpdated: 2025-11-21T18:29:21.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/security/securing-data-in-transit/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/security/securing-data-in-transit/index.md\n---\n\nData in transit typically means when it's traveling over the network. Because the Internet is made up of many thousands of networks, it is important to ensure your data is secure as it moves from device to server and back. These days, most common activities that generate data in transit are related to:\n\n* Browsing online and uploading/download data to/from cloud applications\n* Sending texts, pictures and emails\n* Applications exposing and consuming data through APIs\n\nData in transit is often considered vulnerable to interception or tampering during transmission, so it is important to secure it through encryption techniques such as [QUIC](https://cloudflare-quic.com/), Transport Layer Security (TLS) or Secure Sockets Layer (SSL). This helps to ensure that the data remains confidential and protected from unauthorized access during its journey. There are other methods of inspecting data as it passes network boundaries to make decisions on if that data should continue to travel or not, Data Loss Prevention (DLP) technologies can be used to inspect the contents of network traffic and block sensitive data from going to a risky destination. This document outlines the methods Cloudflare has available to protect data in transit.\n\n## Securing network connectivity\n\nCloudflare is one of the leading providers of cloud network security services. There are two main use cases Cloudflare is used to secure network traffic.\n\n* Providing secure connectivity to public websites and APIs using SSL/TLS\n* Creating secure tunnels to private networks and applications which are hosted either in the cloud or on-premises\n\nCloudflare's [SSL services](https://developers.cloudflare.com/ssl/) are used by millions of websites and are easily implemented by making changes to DNS entries, so that all connections to public websites and APIs are terminated on Cloudflare's edge network. Connectivity from Cloudflare to the destination website or API can also be secured using the same SSL technologies. To ensure the strongest security, Cloudflare uses [post quantum cryptography](https://blog.cloudflare.com/post-quantum-to-origins).\n\n![Figure 1: Securing data from the user device, all the way to the website/API](https://developers.cloudflare.com/_astro/securing-data-in-transit-fig1.BeOrOaHa_ZYwhG7.svg)\n\n1. Connection between user browser and Cloudflare secured by TLS/SSL\n2. Connection from Cloudflare to destination server secured by TLS/SSL\n\nPrivate resources, usually self hosted applications on private networks with no direct public Internet connection, require a different method of securing data in transit. There are a variety of different methods by which tunnels can be created from private networks to Cloudflare, more details on which can be found in the [SASE reference architecture](https://developers.cloudflare.com/reference-architecture/architectures/sase/), but the following diagram does a good job of summarizing the methods.\n\n![Figure 2: Various methods of connecting and routing traffic to Cloudflare to secure private traffic.](https://developers.cloudflare.com/_astro/cf1-ref-arch-14.BMsYJBWD_155tSw.svg)\n\nOnce private applications and networks have been connected to Cloudflare, devices can then be connected securely via our device agent such that data from a user device, all the way across the network to an application can be secured.\n\nWhen traffic from the device, to the hosted application, all flows via Cloudflare, it's possible for us to inspect the traffic and apply further security based on the content of the data.\n\n## Inspecting traffic with Cloudflare DLP\n\nA common challenge is trying to determine what data is sensitive and requires policy intervention. Data Loss Prevention services are used to inspect the contents of a piece of traffic, and then provide metadata to the policy to impact enforcement.\n\nFor example, when a user attempts to upload a file to a SaaS application and the traffic route has been configured to always go via the Cloudflare network, [Cloudflare DLP](https://developers.cloudflare.com/cloudflare-one/data-loss-prevention/) inspects the file by using DLP profiles assigned to a Gateway policy. After a DLP profile matches, the Gateway policy will allow or block the traffic, and the activity will be written to the logs. A DLP profile is a collection of regular expressions (also known as detection entries) that define the data patterns you want to detect. Cloudflare DLP provides [predefined profiles](https://developers.cloudflare.com/cloudflare-one/data-loss-prevention/dlp-profiles/#configure-a-predefined-profile) for common detections, or you can build [custom profiles](https://developers.cloudflare.com/cloudflare-one/data-loss-prevention/dlp-profiles/#build-a-custom-profile) specific to your data, and even the ability to leverage [Exact Data Match](https://developers.cloudflare.com/cloudflare-one/data-loss-prevention/detection-entries/#exact-data-match) (EDM).\n\nDLP profiles are then used in combination with other policy attributes to specifically identify the traffic, such as only enforcing the policy when sensitive data is being uploaded to approved Cloud based storage services.\n\n![Figure 3: Example of a Cloudflare policy blocking confidential data uploaded to approved cloud storage.](https://developers.cloudflare.com/_astro/cf1-ref-arch-29.BGL4hCeF_Znjbgg.svg)\n\nThe following diagram shows a common flow for how Cloudflare inspects a request and enforces access based on a DLP based policy.\n\n![Figure 4: Upload of file containing sensitive data blocked by Cloudflare DLP](https://developers.cloudflare.com/_astro/securing-data-in-transit-fig4.D-8KKTj8_2e5eUD.svg)\n\n1. User attempts to upload a file to a SaaS application (via a secure tunnel to Cloudflare created by our [device agent](https://developers.cloudflare.com/cloudflare-one/team-and-resources/devices/warp/download-warp/)). [Clientless](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/) options are supported as well.\n2. Cloudflare's [Secure Web Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/) (SWG) will first verify that the user is permitted to use the requested SaaS application, and then scrutinize the file's payload for [malicious code](https://developers.cloudflare.com/cloudflare-one/traffic-policies/http-policies/antivirus-scanning/) and [sensitive data](https://developers.cloudflare.com/cloudflare-one/data-loss-prevention/).\n3. The DLP profile determines the file contains national identifiers like US Social Security Numbers (SSN).\n4. The Gateway policy is configured with a [Block action](https://developers.cloudflare.com/cloudflare-one/traffic-policies/http-policies/#block), so the attempt is [logged](https://developers.cloudflare.com/cloudflare-one/data-loss-prevention/dlp-policies/logging-options/#log-the-payload-of-matched-rules) and a [block page](https://developers.cloudflare.com/cloudflare-one/reusable-components/custom-pages/gateway-block-page/) returned to the end user's web browser.\n\n* [Securing data in use](https://developers.cloudflare.com/reference-architecture/diagrams/security/securing-data-in-use/)\n* [Securing data at rest](https://developers.cloudflare.com/reference-architecture/diagrams/security/securing-data-at-rest/)\n\n<page>\n---\ntitle: Securing data in use · Cloudflare Reference Architecture docs\ndescription: Learn how Cloudflare's Remote Browser Isolation (RBI) works and\n  secures data in use.\nlastUpdated: 2025-11-21T18:29:21.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/security/securing-data-in-use/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/security/securing-data-in-use/index.md\n---\n\nData in use refers to data that is being actively interacted with, processed, or manipulated by applications, systems, or users. For organizations, protecting data in use can be a challenge as it must remain accessible and usable by applications and users who need it to fulfill their duties, yet still protected against unauthorized access or tampering.\n\nToday, a vast majority of a user’s interactions with operationally-critical data takes place inside a modern Internet browser, which today enables entire client applications, such as email clients, word processors, and spreadsheets, to be served to an end-user. This also means no software needs to be installed on the device, and also makes user interactions, such as copy and paste, and downloading sensitive data, relatively easy. Such interactions can pose a persistent risk to organizations whose employees and contractors are working with critical and/or sensitive data every day.\n\nOne method to secure data in use is to leverage greater control over the browsers themselves, and how employees use them to access applications and data. Cloudflare has approached this by building a headless browser solution on top of our massive global edge network, called [Remote Browser Isolation](https://developers.cloudflare.com/cloudflare-one/remote-browser-isolation/) (RBI). When a user attempts to access, for example, a privately hosted resource, or a resource on the public Internet, instead of directly serving it to the user’s browser without any other safeguards, Cloudflare first renders the resource in a sandboxed environment hosted on the Cloudflare global network. Then, without any perceptible difference to the end-user, a small Javascript client is run within their local browser to safely and securely retrieve and render the remotely loaded web content using a novel, patented technology unique to Cloudflare, called Network Vector Rendering (NVR).\n\n## Protecting data in use with Cloudflare RBI\n\nCloudflare RBI effectively creates an invisible “gap” between the web content a user is accessing and their device, in effect protecting the device and the network it is connected to from exploits and attacks. Unlike secure web gateways, antivirus software, or firewalls which rely on known threat patterns or signatures, RBI is a genuine zero trust mechanism. Because all requests made within a remotely loaded RBI instance go through the Cloudflare Secure Web Gateway, it's possible to enforce access policies to data and also inspect the traffic itself to enforce any data in transit policies.\n\nEven more, organizations can enforce specific data in use access controls, like blocking the ability to download/upload, copy and paste, and print data.\n\nCommon policies used with RBI:\n\n* Content category - [Social Networks](https://developers.cloudflare.com/cloudflare-one/traffic-policies/domain-categories/) (e.g. Facebook): Given the large volumes of data that popular social media platforms collect, these apps are an attractive target and yet another attack vector for malicious entities. RBI allows for limiting what data, especially if that data matches a DLP profile, from being pasted into these applications.\n* Application - [Artificial Intelligence](https://developers.cloudflare.com/cloudflare-one/traffic-policies/application-app-types/) (e.g. ChatGPT): Generative AI tools can boost employee productivity, but understanding who is using them and for what is imperative at this stage of the generative AI evolution. Again, DLP profiles here can be applied to prevent the copy and pasting of sensitive data into public AI tools.\n* Application - [SaaS](https://developers.cloudflare.com/cloudflare-one/traffic-policies/application-app-types/) (e.g. Salesforce, Zendesk, etc): These applications can often contain highly confidential data. RBI can be used to really lock down access for risky users that require some access, such as contractors or partners. Controls such as preventing printing, or even preventing any keyboard input at all, can result in third party users only looking at a read only view of the application, as if RBI is a pane of glass between the user and the data.\n\nThe following diagram visualizes a typical interaction between a user, RBI and a website such as ChatGPT.\n\n![Figure 1: Text copy/paste blocked by Cloudflare RBI.](https://developers.cloudflare.com/_astro/securing-data-in-use-fig1.DERWxOEQ_Z17px9m.svg)\n\n1. User attempts to login to ChatGPT, and the request goes via Cloudflare since the user is running our [device agent](https://developers.cloudflare.com/cloudflare-one/team-and-resources/devices/warp/download-warp/) to maximize visibility and control of all traffic between the end user’s device and the resources being requested. [Clientless](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/) options are supported as well.\n2. Cloudflare’s [Secure Web Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/) (SWG) will first verify that the user is permitted to access ChatGPT.\n3. Cloudflare’s patented Network Vector Rendering (NVR) process begins as a headless browser on our edge network starts and rasterizes the web app, which involves writing SKIA draw commands.\n4. NVR intercepts those draw commands > tokenizes them > compresses them > encrypts them > and sends them to the local web browser.\n5. Because this request is running isolated, the policy also enforces preventing the user from [copying and pasting](https://developers.cloudflare.com/cloudflare-one/remote-browser-isolation/isolation-policies/#copy-from-remote-to-client) sensitive content to ChatGPT from their local machine. Additional [policy settings](https://developers.cloudflare.com/cloudflare-one/remote-browser-isolation/isolation-policies/#policy-settings), such as ‘Disable printing’, ‘Disable upload / download’, and more are available as well.\n\n* [Securing data in transit](https://developers.cloudflare.com/reference-architecture/diagrams/security/securing-data-in-transit/)\n* [Securing data at rest](https://developers.cloudflare.com/reference-architecture/diagrams/security/securing-data-at-rest/)\n\n<page>\n---\ntitle: Extend ZTNA with external authorization and serverless computing ·\n  Cloudflare Reference Architecture docs\ndescription: Cloudflare's ZTNA enhances access policies using external API calls\n  and Workers for robust security. It verifies user authentication and\n  authorization, ensuring only legitimate access to protected resources.\nlastUpdated: 2025-10-24T20:47:24.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/sase/augment-access-with-serverless/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/sase/augment-access-with-serverless/index.md\n---\n\nCompanies using Zero Trust Network Access (ZTNA) services build policies to determine if a user can access a protected resource such as a privately hosted Wiki server or source code repository. Policies typically use group membership, authentication methods, device security posture to determine which users can access which resources.\n\nSecure access requires a range of attributes being available to the policy engine for evaluation. With Cloudflare's ZTNA service, [Access](https://developers.cloudflare.com/cloudflare-one/access-controls/policies/), it is possible to include in the policy an external request to another API that provides part of the data required for the access decision.\n\nFor example, you might have a policy which states all members of the group \"Engineers\", who have authenticated with credentials that required a hard token, can have access to the self-hosted source code repository. But you also want to only allow engineers who have completed security training. That data might be available in another system, so Cloudflare allows you to, as part of the policy check, make a call using [Workers](https://workers.cloudflare.com/) to the training system to determine if this user has passed security training.\n\nAdditionally, once authentication and the policy checks are successful Cloudflare passes traffic to the protected origin. It is important to note that the origin should, too, verify that the incoming requests are authenticated by Cloudflare in order to avoid any illegitimate access. Cloudflare inserts a JWT token in the traffic destined to the origin to prove cryptographically that the request was successfully authenticated, and the origin can use this data as part of its authorization logic.\n\nTo help integrate these types of use cases, Cloudflare has an [entire development platform](https://developers.cloudflare.com/workers/) on which you can design and run your own business logic. This means you spend less time trying to piece a solution together and more time getting the integration done.\n\nThis document outlines how to combine both solutions to enhance Cloudflare Access capabilities in terms of [authorization and authentication](https://www.cloudflare.com/learning/access-management/what-is-access-control/).\n\n## Showcased products\n\n**[Workers](https://developers.cloudflare.com/workers/)**\n\nBuild serverless applications and deploy instantly across the globe for exceptional performance, reliability, and scale.\n\n**[Access](https://developers.cloudflare.com/cloudflare-one/)**\n\nCloudflare Zero Trust replaces legacy security perimeters with Cloudflare's global network, making the Internet faster and safer for teams around the world\n\n* **Custom authorization logic**: Access External evaluation using Workers as a backend (for example, using your own implementation of [Open Policy Agent aka OPA](https://www.openpolicyagent.org/integrations/cloudflare-worker/)])\n* **Augmented [JSON Web Token (JWT)](https://developers.cloudflare.com/cloudflare-one/access-controls/applications/http-apps/authorization-cookie/validating-json/)**: Using Cloudflare's own authentication JWT material, for example, adding posture details as part of an incoming request.\n* **Serverless augmented apps protected with Zero-trust**: Allowing anyone building serverless applications to benefit from native ZTNA features\n\n![Figure 1: Showing a request to a private resource and where  Access can be customized for AuthZ and AuthN](https://developers.cloudflare.com/_astro/diagram1.D2YkG0lA_Z1A0w9m.svg)\n\nThe following outlines how organizations can run their own custom business logic, allowing them to tailor authentication and authorization processes to meet almost any requirement. Each use case below refers to a step in the above diagram.\n\n### 1. Custom authorization process using your own rules\n\nDuring policy evaluation, the [external evaluation](https://developers.cloudflare.com/cloudflare-one/access-controls/policies/external-evaluation/) rule allows for executing your own code during access policy evaluation. In this example an API exposed by Cloudflare Workers receives data about the user making the request, the important part being their username.\n\nThe code typically makes calls to either a [database](https://developers.cloudflare.com/d1/) or another API to evaluate if the passed username has access to the application. The external evaluation rule requires that the call returns either a True or False, and this is combined with the policy to determine access.\n\n[Learn more ](https://developers.cloudflare.com/cloudflare-one/access-controls/policies/external-evaluation/)External authorization with Cloudflare's external evaluation functionality\n\n### 2. Analyze and validate the authentication material (JWT)\n\nWhen a user successfully authenticates and is authorized to access a protected application, Cloudflare inserts a [JSON Web Token (JWT)](https://developers.cloudflare.com/cloudflare-one/access-controls/applications/http-apps/authorization-cookie/validating-json/) into the HTTP traffic sent to the origin. This token serves as a valuable asset for expanding custom business logic through secure processing. The format for that JWT is deterministic and rather lightweight to avoid overloading the requests towards origin unnecessarily.\n\nHere is an example of a JWT sent to an origin (use [JWT.io](http://jwt.io) to read the contents of a JWT)\n\nCloudflare exposes a specific [endpoint](https://developers.cloudflare.com/cloudflare-one/access-controls/applications/http-apps/authorization-cookie/validating-json/#_top) to allow anyone to validate and expand a Cloudflare signed JWT.\n\nCloudflare's Workers are a great candidate for interacting with incoming JSON Web Tokens (JWTs), enabling additional processing directly within the serverless platform without introducing any added latency.\n\n[Learn more ](https://developers.cloudflare.com/cloudflare-one/access-controls/applications/http-apps/authorization-cookie/application-token/#user-identity)How to validate and visualize Cloudflare Access JWTs\n\n### 3. Augment the authentication material (JWT) with extra authentication details\n\nIn some situations, it is beneficial to elaborate on this JWT in order to execute additional processing on the protected destination application (for example, adding device [posture details](https://developers.cloudflare.com/cloudflare-one/reusable-components/posture-checks/) as part of an incoming request).\n\nIn the following example, we want to make sure the exposed application is aware of the status of the device's firewall and disk encryption (Note that the WARP client needs to be installed on the client machine for these signals to be collected).\n\n![Figure 2: Modified origin request including posture details](https://developers.cloudflare.com/_astro/diagram2.DPpYfIXE_18FDaW.svg)\n\nWhen a JSON Web Token (JWT) is expanded, the details of the attached authentication event become visible. This expansion reveals much more information than what is provided by default within the JWT itself, an example is below.\n\nUsing the details in the JWT, you can use a Worker to extract the details of the device posture and then reinsert them into HTTP headers which the application uses for its own authorization logic. Below is a guided tutorial explaining how this request modification can be performed with Cloudflare Developer platform.\n\n[Tutorial ](https://developers.cloudflare.com/cloudflare-one/tutorials/extend-sso-with-workers)How to augment Cloudflare Access JWT with Cloudflare's Workers\n\n* [External Evaluation rules](https://developers.cloudflare.com/cloudflare-one/access-controls/policies/external-evaluation/)\n* [SASE reference architecture](https://developers.cloudflare.com/reference-architecture/architectures/sase/)\n* [External Evaluation blog post](https://blog.cloudflare.com/access-external-validation-rules/)\n\n<page>\n---\ntitle: Deploy self-hosted VoIP services for hybrid users · Cloudflare Reference\n  Architecture docs\ndescription: Learn how Cloudflare improves over traditional VPN solutions by\n  leveraging its global network.\nlastUpdated: 2025-12-02T20:21:17.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/sase/deploying-self-hosted-voip-services-for-hybrid-users/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/sase/deploying-self-hosted-voip-services-for-hybrid-users/index.md\n---\n\nTraditional VPN solutions create several problems for VoIP deployments, primarily due to their inefficiencies in handling real-time traffic protocols such as [SIP](https://en.wikipedia.org/wiki/Session_Initiation_Protocol) and [RTP](https://en.wikipedia.org/wiki/Real-time_Transport_Protocol). Legacy VPN deployments introduce high latency and jitter, which negatively impact voice call quality. Additionally, they often struggle with [NAT](https://en.wikipedia.org/wiki/Network_address_translation) traversal, leading to connection issues for VoIP calls.\n\nCloudflare improves over traditional VPN solutions by leveraging its [global network](https://www.cloudflare.com/network/) of data centers in over 330 cities to significantly reduce latency for remote users. When using our device agent, remote users are automatically connected to the nearest Cloudflare data center, thus reducing latency.\n\nThis document explains how to architect access to a self-hosted VoIP service using Cloudflare. Note the solution below uses our [WARP Connector](https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/private-net/warp-connector/), a small piece of software deployed on a server in the same subnet as the VoIP servers and creates bi-directional traffic flow through Cloudflare to users.\n\n## Bi-directional VoIP traffic flow\n\n![Figure 1: Cloudflare facilitates secure connectivity from user devices to the network where the SIP server is running.](https://developers.cloudflare.com/_astro/figure1.lv12Z4R7_S2e8p.svg)\n\nThe diagram above shows the WARP Connector and our device agent deployed to establish highly performant, reliable connectivity for private VoIP services. Note that Cloudflare will assign remote users an address from the CGNAT range, which is used for the private network created between device agents. The WARP Connector ensures secure, bidirectional communication between remote users and the on-premise SIP server, without exposing the server to the public Internet. This shields the VoIP infrastructure from potential attacks while maintaining a seamless, encrypted connection for real-time communications.\n\n1. VoIP server resides on a private network with no public IP.\n2. WARP Connector creates a secure tunnel to Cloudflare and is configured as a virtual router in the private network.\n3. Allow traffic from Cloudflare to reach the VoIP server, but also allow private network initiated traffic, such as an outbound VoIP call from the server, to route over the Cloudflare tunnel. In the above diagram, we add a static route on the default gateway of `100.96.0.0/12` (the WARP CGNAT range) via `10.0.50.10` (the WARP Connector virtual router).\n4. Traffic passes through our [Secure Web Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/) (SWG), which applies network level firewall rules to both inbound and outbound traffic.\n5. A device agent is installed on remote user devices. The agent establishes a secure tunnel to Cloudflare, which allows VoIP software to both receive and make calls.\n\n## Call flow examples\n\nVoIP software running on the remote user's device registers with the VoIP server using SIP. The Cloudflare device agent will be assigned an address from the CGNAT IP range, `100.96.0.0/12`. As routing has been established to Cloudflare for `100.96.0.0/12` and to the on-premise network of `10.0.50.0/24`, call flows will work as normal – both direct and indirect media are supported.\n\n### Remote user calling another remote user\n\nWhen calls are made from user to user, some traffic flows from user devices through Cloudflare to the on-premise server, while other traffic flows through Cloudflare directly to the other user. Note that the device agent is creating a secure tunnel through which the CGNAT addresses are routed. Both users in this flow have registered their SIP clients with the server.\n\n![Figure 2: For remote user to remote user, not all traffic flows over the WARP Connector to the SIP server.](https://developers.cloudflare.com/_astro/figure2.DATzV5BV_Z1krIAt.svg)\n\nThe above diagram shows the high level signaling and media paths.\n\n1. Alice registers directly with the SIP server (`10.0.50.60`) with a Cloudflare assigned CGNAT IP of `100.96.0.12`.\n2. Bob also registers directly with the SIP server (`10.0.50.60`) with their CGNAT IP of `100.96.0.13`.\n3. When Alice calls Bob, the SIP server will send a SIP INVITE message to Bob at `100.96.0.13`.\n4. The default gateway for the SIP server is `10.50.0.1`, but we have defined a static route such that for destination `100.96.0.0/12`, the next hop is the WARP Connector interface (`10.0.50.10`).\n5. The SIP INVITE message will be routed across the WARP Connector to the Cloudflare network and then received by Bob.\n6. Bob accepts and the SIP server will send SIP/SDP messages to both Alice and Bob specifying which parameters to use for the RTP (audio) data.\n7. For Direct Media paths where the SIP server is not in the audio path and the RTP streams are directly between Alice and Bob, ensure that [**Allow all Cloudflare One traffic to reach enrolled devices**](https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/private-net/warp-to-warp/#enable-warp-to-warp) has been enabled in Cloudflare. Audio streams in the Direct Media use case will not need to route over the WARP Connector.\n\n### Remote user to on-premise user\n\nCalls between remote and on-premise users are very similar, but RTP audio will be sent over the WARP Connector in addition to the SIP signaling.\n\n![Figure 3: Remote user to on-premise user has all traffic routed via Cloudflare to SIP server and client.](https://developers.cloudflare.com/_astro/figure3.Bnu64MY9_Z1i39Dm.svg)\n\nThe high-level signaling and media paths are shown below:\n\n![Figure 4: Both signaling and media (audio, video etc) travel via secured tunnels from remote devices to on-premise clients.](https://developers.cloudflare.com/_astro/figure4.pvAsOncQ_pPYt5.svg)\n\n1. Alice registers directly with the SIP server (`10.0.50.60`) with her CGNAT IP of `100.96.0.12`.\n2. Bob also registers directly with the SIP server (`10.0.50.60`) with their LAN IP of `10.0.50.101`.\n3. When Alice calls Bob, the SIP server will send a SIP INVITE message to Bob at `10.0.50.101`.\n4. The default gateway for the SIP server is `10.50.0.1`, but we have defined a static route such that for destination `100.96.0.0/12`, the next hop is the WARP Connector interface (`10.0.50.10`).\n5. The SIP INVITE message will be sent on the local network to Bob.\n6. Bob accepts and the SIP server will send SIP/SDP messages to both Alice and Bob specifying which parameters to use for the RTP (audio) data.\n7. Bob will send audio to Alice at `100.96.0.12`, which will be routed across the WARP Connector to Cloudflare, and Alice will send audio to Bob at `10.0.50.101`, which will be sent from Cloudflare across the WARP Connector to the on-premise local network.\n\nWith Cloudflare's WARP Connector, remote users communicating with other remote users or on-premise users via on-premise SIP servers will have a seamless and secure experience for both ends. Key benefits include:\n\n1. **Bidirectional connectivity**: WARP Connector supports bidirectional traffic, which is crucial for remote users communicating with on-premise users. Both signaling and media traffic (SIP/RTP) flow securely between the two, regardless of where the user is physically located. This is done via Cloudflare's global network, using an encrypted tunnel, ensuring data integrity and encryption​.\n\n2. **Private communication over CGNAT**: The WARP Connector assigns Carrier-Grade NAT (CGNAT) IPs to devices, which allows remote users to securely communicate with on-premise users over private networks. This ensures that communication remains isolated from the public Internet, enhancing security. The CGNAT functionality means that remote and on-premise users can communicate as though they are on the same network​.\n\n3. **No NAT traversal issues**: NAT traversal often poses a challenge in VoIP scenarios, but because WARP Connector preserves source IP addresses and handles bidirectional traffic without additional NAT boundaries, remote and on-premise users can communicate without issues typically caused by firewalls or NAT devices, improving the overall call setup and quality​.\n\n* [Set up WARP Connector](https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/private-net/warp-connector/)\n* [Enable WARP-to-WARP connectivity](https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/private-net/warp-to-warp/#enable-warp-to-warp)\n* [About Cloudflare WARP](https://developers.cloudflare.com/cloudflare-one/team-and-resources/devices/warp/)\n\n<page>\n---\ntitle: DNS filtering solution for Internet service providers · Cloudflare\n  Reference Architecture docs\ndescription: Learn how to use Cloudflare Gateway as a DNS filtering solution for\n  Internet service providers.\nlastUpdated: 2025-11-21T18:29:21.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/sase/gateway-dns-for-isp/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/sase/gateway-dns-for-isp/index.md\n---\n\nInternet service providers are constantly exploring new revenue opportunities to expand their business, and many are now turning to security as a value-added service alongside their connectivity offerings. Traditionally, integrating security with connectivity posed significant challenges due to the reliance on legacy solutions that required costly on-premises hardware. This makes it difficult to deploy and manage and introduces post-deployment struggles with scalability and availability.\n\nToday these limitations can be addressed through cloud-based solutions like [Cloudflare Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/), our Secure Web Gateway service. Cloudflare Gateway's DNS filtering capabilities allow service providers to offer enhanced security as a value-added service for residential and mobile subscribers or B2B clients. With easy-to-create policies backed by Cloudflare's [extensive threat intelligence](https://www.cloudflare.com/en-gb/security/), service providers can effectively safeguard their customers from accessing potentially [harmful domains](https://developers.cloudflare.com/cloudflare-one/traffic-policies/domain-categories/#security-categories).\n\nMoreover, Cloudflare Gateway eliminates concerns around availability, performance, and scalability, as it is built on [Cloudflare's 1.1.1.1 public DNS resolver](https://developers.cloudflare.com/1.1.1.1/), one of the [fastest](https://www.dnsperf.com/#!dns-providers) and most widely-used DNS resolvers in the world.\n\nFurthermore, this solution opens up opportunities for developing additional services beyond security, such as parental controls or tailored filtering profiles for B2B clients.\n\nProviding DNS security to the service providers' end customers with Cloudflare is straightforward. Service providers simply forward their public DNS requests to their Cloudflare tenant, and Cloudflare will filter DNS queries in accordance with the configured DNS filtering policies.\n\n![Figure 1: The service provider subscribers send DNS queries to the service provider DNS server, which will forward them to Cloudflare Gateway to apply DNS filtering policies.](https://developers.cloudflare.com/_astro/gateway-dns-for-isp-image-01.CA9DVOGS_Z2rYjI6.svg)\n\nCloudflare Gateway, like all Cloudflare services, utilizes [anycast technology](https://www.cloudflare.com/learning/cdn/glossary/anycast-network/), ensuring that all service provider DNS queries are directed to the nearest Cloudflare point of presence.\n\nTo distinguish queries originating from the service provider from those coming from other customers, admins configure a [location](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/dns/locations/) in their Cloudflare tenant dashboard. When a DNS location is created, Gateway assigns IPv4/IPv6 addresses and DoT/DoH hostnames for that location. These assigned IP addresses and hostnames are then used by the service provider to send DNS queries for resolution. In turn, the service provider configures the location object with the public IP addresses of their on-premises DNS servers, allowing Cloudflare to accurately associate queries with the corresponding location.\n\nIf stable and defined source IPv4 addresses cannot be assigned to the on-premises DNS servers, service providers can instead use unique destination location endpoints. Each location is assigned a distinct [DoT](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/dns/locations/dns-resolver-ips/#dns-over-tls-dot) and [DoH](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/dns/locations/dns-resolver-ips/#dns-over-https-doh) hostname, as well as a unique [destination IPv6 address](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/dns/locations/dns-resolver-ips/#ipv4ipv6-address). Additionally, Cloudflare can provide unique [destination IPv4 addresses upon request](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/dns/locations/dns-resolver-ips/#dns-resolver-ip).\n\nDNS filtering is then enforced through DNS policies set up by the service provider to detect domains linked to [security risks](https://developers.cloudflare.com/cloudflare-one/traffic-policies/domain-categories/#security-categories). Cloudflare continuously updates the list of risky domains using [its extensive threat intelligence](https://www.cloudflare.com/en-gb/security/). When a DNS query matches a flagged domain, the corresponding action specified in the DNS policy is executed. This action can be a '[Block](https://developers.cloudflare.com/cloudflare-one/traffic-policies/dns-policies/#block),' where Gateway responds with `0.0.0.0` for IPv4 queries or `::` for IPv6 queries, or displays a [custom block page hosted by Cloudflare](https://developers.cloudflare.com/cloudflare-one/reusable-components/custom-pages/gateway-block-page/). Alternatively, an `[Override](/cloudflare-one/traffic-policies/dns-policies/#override)` action or [block page URL redirect](https://developers.cloudflare.com/cloudflare-one/reusable-components/custom-pages/gateway-block-page/#redirect-to-a-block-page) can redirect the DNS query to a block page hosted by the service provider.\n\n![Figure 2: A DNS policy to prevent users from navigating to malicious domains. The action is to override and redirect the DNS query to a block page hosted by the service provider.](https://developers.cloudflare.com/_astro/gateway-dns-for-isp-image-02.BLGXVL4a_Z1k0Gds.svg)\n\nTo achieve more precise control over which domains are allowed or blocked, the service provider can configure additional Allowed Domain and Blocked Domains policies. By setting these policies with [lower precedence](https://developers.cloudflare.com/cloudflare-one/traffic-policies/order-of-enforcement/#order-of-precedence) than the Security Risks policy, the service provider can override the Security Risks policy for specific domains.\n\nTo streamline the management of allowed and blocked domains, use [lists](https://developers.cloudflare.com/cloudflare-one/reusable-components/lists/). Lists are easily updated through the dashboard or via [APIs](https://developers.cloudflare.com/api/resources/zero_trust/subresources/gateway/subresources/lists/methods/update/), making policy adjustments more efficient.\n\n![Figure 3: DNS policies are applied according to their order of precedence. In this example, the 'Allow List Policy' and 'Block List Policy' will be considered before the 'Security List' policy.](https://developers.cloudflare.com/_astro/gateway-dns-for-isp-image-03.Dy2ZZQ-9_kXzu5.svg)\n\nAdditionally, all DNS queries forwarded to Cloudflare Gateway are logged and can be exported to external systems using [Logpush](https://developers.cloudflare.com/cloudflare-one/insights/logs/logpush/).\n\nMiscategorization of domains\n\nIn cases of a miscategorization of domains, raise a [categorization change request](https://developers.cloudflare.com/security-center/investigate/change-categorization/#via-the-cloudflare-dashboard) directly from the Cloudflare dashboard.\n\n## Additional offerings based on DNS filtering capabilities\n\nService providers can enhance their offerings by using Cloudflare Gateway DNS policies to deliver additional value-added services alongside the base DNS security service. By using the same solution, service providers can develop customized content category filtering services. These services can be easily constructed using Cloudflare's built-in [content categories](https://developers.cloudflare.com/cloudflare-one/traffic-policies/domain-categories/#content-categories) and [application types](https://developers.cloudflare.com/cloudflare-one/traffic-policies/application-app-types/), as well as the service provider's own custom allow and block lists.\n\nSome potential applications include:\n\n* **Parental Control Services**: This service can block categories such as adult themes, child abuse, violence, and questionable content to ensure a safer online environment for children.\n* **Educational Services**: Designed for schools and educational organizations, this service can extend beyond parental controls by blocking additional categories like CIPA, gambling, and entertainment, thereby promoting a focused learning atmosphere.\n* **Enterprise Services**: This offering allows businesses to easily restrict access to non-work-related domains, including categories such as entertainment, social networking, gambling, shopping & auctions, society & lifestyle, and sports.\n\nTo differentiate these additional services from the core DNS security offering, the service provider would create additional DNS locations, one for each service. Cloudflare would be able to distinguish DNS queries for these services if the service provider sends them to one of the unique identifiers of a location. Each location has a unique [DoH](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/dns/locations/dns-resolver-ips/#dns-over-https-doh) and [DoT](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/dns/locations/dns-resolver-ips/#dns-over-tls-dot) hostname and a unique [destination IPv6 address](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/dns/locations/dns-resolver-ips/#ipv4ipv6-address). Cloudflare can also provision [dedicated destination IPv4 addresses](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/dns/locations/dns-resolver-ips/#dns-resolver-ip) per location.\n\n* [Cloudflare Gateway DNS policies](https://developers.cloudflare.com/cloudflare-one/traffic-policies/dns-policies/)\n* [Cloudflare Blog: Using the power of Cloudflare's global network to detect malicious domains using machine learning](https://blog.cloudflare.com/threat-detection-machine-learning-models/)\n* [Protect ISP and telecommunications networks from DDoS attacks](https://developers.cloudflare.com/reference-architecture/diagrams/network/protecting-sp-networks-from-ddos/)\n\n<page>\n---\ntitle: Protective DNS for governments · Cloudflare Reference Architecture docs\ndescription: Learn how to use Cloudflare Gateway as a Protective DNS service for\n  governments.\nlastUpdated: 2025-11-21T18:29:21.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/sase/gateway-for-protective-dns/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/sase/gateway-for-protective-dns/index.md\n---\n\nProtective DNS services are security services that analyze DNS queries and block access to malicious websites and other harmful online content. As technology becomes increasingly vital for public sector operations, government departments are looking to adopt these cybersecurity services to bolster incident detection and response, and to build more resilient enterprise networks. Traditionally, deploying this type of solution posed significant challenges due to the reliance on legacy systems that required costly on-premises hardware. This makes it difficult to deploy and manage, and introduces post-deployment struggles with scalability and availability.\n\nToday, these limitations can be addressed through cloud-based solutions like [Cloudflare Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/), our Secure Web Gateway service. Cloudflare Gateway's DNS filtering capabilities allow administrators to offer enhanced security. With easy-to-create policies backed by Cloudflare's [extensive threat intelligence](https://www.cloudflare.com/en-gb/security/), government agencies can effectively safeguard their end users from accessing potentially [harmful domains](https://developers.cloudflare.com/cloudflare-one/traffic-policies/domain-categories/#security-categories). Additionally, agencies can further strengthen these defenses by [integrating their own threat intelligence data](https://developers.cloudflare.com/security-center/indicator-feeds/) into the policies.\n\nFinally, Cloudflare Gateway eliminates concerns around availability, performance, and scalability, as it is built on [Cloudflare's 1.1.1.1 public DNS resolver](https://developers.cloudflare.com/1.1.1.1/), one of the [fastest](https://www.dnsperf.com/#!dns-providers) and most widely used DNS resolvers in the world.\n\nCloudflare provides flexible DNS deployment models, delivering robust protection for every user, regardless of location. The service supports both office-based and remote users, offering the adaptability needed to address diverse operational requirements.\n\n### Office or site based users\n\nIT administrators forward public DNS requests to Cloudflare where they are filtered and logged in accordance with the configured DNS filtering policies. DNS forwarders can either be the agency's private DNS infrastructure or networking appliances, such as routers deployed at remote sites and configured as local DNS servers.\n\n![Figure 1: DNS requests can be forwarded to Cloudflare via a variety of different methods.](https://developers.cloudflare.com/_astro/gateway-for-protective-dns-image-01.CM-gqunL_Z1rajzU.svg)\n\nTo distinguish queries originating from the government departments and agencies they are responsible for, admins configure a location in the Cloudflare dashboard. When a DNS location is created, Gateway assigns IPv4/IPv6 addresses and DNS over TLS/HTTPS (DoT/DoH) hostnames for that location. These IP addresses and hostnames are then used by the admins to send DNS queries for resolution. In turn, the administrator configures the location object with the public IP addresses of their on-premises DNS servers, allowing Cloudflare to accurately associate queries with the corresponding location.\n\nDNS filtering is then enforced through policies set up by the administrator to detect domains linked to [security risks](https://developers.cloudflare.com/cloudflare-one/traffic-policies/domain-categories/#security-categories). Cloudflare continuously updates the list of high risk domains using [its extensive threat intelligence](https://www.cloudflare.com/security/). When a DNS query matches a flagged domain, the corresponding action specified in the DNS policy is executed. This action can be a '[Block](https://developers.cloudflare.com/cloudflare-one/traffic-policies/dns-policies/#block),' where Gateway responds with `0.0.0.0` for IPv4 queries or `::` for IPv6 queries, or displays a [custom block page hosted by Cloudflare](https://developers.cloudflare.com/cloudflare-one/reusable-components/custom-pages/gateway-block-page/). Alternatively, an [Override](https://developers.cloudflare.com/cloudflare-one/traffic-policies/dns-policies/#override) action or [block page URL redirect](https://developers.cloudflare.com/cloudflare-one/reusable-components/custom-pages/gateway-block-page/#redirect-to-a-block-page) can redirect the DNS query to a block page hosted by the government agency.\n\nCloudflare's own threat intelligence can be seamlessly integrated with threat intelligence data provided by the agency or third-party sources. In this setup, the agency or the third-party entity acts as a [threat feed provider](https://developers.cloudflare.com/security-center/indicator-feeds/) to Cloudflare. This enables IT admins to create DNS policies that combine Cloudflare's security risk categories with the data sourced by the agency, for a unified and enhanced security posture (see diagram below). Additionally, [publicly available custom indicator feeds](https://developers.cloudflare.com/security-center/indicator-feeds/#publicly-available-feeds) can be accessed by eligible public and private sector organizations without the need to establish a provider relationship, further expanding security capabilities.\n\n![Figure 2: Example DNS policy showing the use of a custom threat intel feed.](https://developers.cloudflare.com/_astro/gateway-for-protective-dns-image-02.CWdOzGbA_Z2nvrI.svg)\n\nFor users not connected to an agency network, you can redirect DNS requests to Cloudflare by using the DNS over HTTPS ([DoH](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/dns/dns-over-https/)) hostname provided by a [location](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/dns/locations/). This requires [configuration on each device](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/dns/dns-over-https/#filter-doh-requests-by-location), which can be done using existing management solutions. This approach can be enhanced by incorporating [a user-specific authentication token](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/dns/dns-over-https/#filter-doh-requests-by-user). These tokens enable Cloudflare to attribute DNS queries to individual users, providing granular visibility and facilitating the application of user-specific policies.\n\nFor more advanced identity-based DNS policies, Cloudflare's device agent can be deployed. In this setup, users authenticate to the device agent via [an identity provider integrated with Cloudflare](https://developers.cloudflare.com/cloudflare-one/integrations/identity-providers/). The agent is then configured in [Gateway with DoH mode](https://developers.cloudflare.com/cloudflare-one/team-and-resources/devices/warp/configure-warp/warp-modes/#gateway-with-doh), ensuring that all public DNS queries from the device are forwarded to Cloudflare. These queries include the user identity from the device, enabling identity-based policy enforcement.\n\n![Figure 3: Showing how remote users can also redirect DNS requests for protection via Cloudflare.](https://developers.cloudflare.com/_astro/gateway-for-protective-dns-image-03.CNrab47I_ZDF7x3.svg)\n\nThe following policy shows how group information from the Identity provider can be used to apply specific protective DNS policies.\n\n![Figure 4: An example of a DNS policy for users with the device agent. The policy uses group information from the identity provider so that it applies to a specific audience of users.](https://developers.cloudflare.com/_astro/gateway-for-protective-dns-image-04.Dz-unZHM_1qV7Bb.svg)\n\nThe device agent is compatible with the [leading desktop and mobile operating systems](https://developers.cloudflare.com/cloudflare-one/team-and-resources/devices/warp/download-warp/), making it a solution for both managed and unmanaged devices. This versatility enables DNS security services to be extended, for example, to personal devices of high-risk individuals, ensuring a consistent level of protection regardless of location or device. For managed IT devices, our agent supports [managed deployments tools](https://developers.cloudflare.com/cloudflare-one/team-and-resources/devices/warp/deployment/mdm-deployment/), for ease of deployment and upgrades.\n\n### Additional controls\n\nTo achieve more precise control over which domains are allowed or blocked, the administrator can configure additional Allowed Domain and Blocked Domain policies. By setting these policies with [lower precedence](https://developers.cloudflare.com/cloudflare-one/traffic-policies/order-of-enforcement/#order-of-precedence) than the Security Risks policy, the agency can override the Security Risks policy for specific domains.\n\nTo streamline the management of allowed and blocked domains, use [lists](https://developers.cloudflare.com/cloudflare-one/reusable-components/lists/). Lists are easily updated through the dashboard or via [APIs](https://developers.cloudflare.com/api/operations/zero-trust-lists-update-zero-trust-list), making policy adjustments more efficient.\n\n![Figure 5: Show how lists can be used to provide custom hostname lists in the policy.](https://developers.cloudflare.com/_astro/gateway-for-protective-dns-image-05.DhzPgkVx_nKPCs.svg)\n\nOne of the key advantages of adopting Cloudflare Gateway as a protective DNS service is the enhanced visibility it provides IT administrators into existing and emerging threats impacting governmental departments and agencies. All DNS queries sent to Cloudflare Gateway are logged, and when an identity is associated with a query, it is mapped to the corresponding user in the logs.\n\nThe ability to view personally identifiable information (PII) in Cloudflare Gateway logs is a [role-based permission](https://developers.cloudflare.com/cloudflare-one/roles-permissions/#cloudflare-zero-trust-pii) that can be selectively assigned to IT administrators.\n\nThese logs are accessible directly through [Cloudflare's dashboard](https://developers.cloudflare.com/cloudflare-one/insights/logs/gateway-logs/) or can be exported to external systems for further analysis via [Logpush](https://developers.cloudflare.com/cloudflare-one/insights/logs/logpush/). Cloudflare also offers robust analytics capabilities, empowering IT administrators to detect trends and identify indicators of compromise. A built-in analytics dashboard is available in [Cloudflare's dashboard](https://developers.cloudflare.com/cloudflare-one/insights/analytics/gateway/), and custom dashboards can be created using any GraphQL-compatible tool using [Cloudflare's GraphQL API](https://developers.cloudflare.com/analytics/graphql-api/).\n\n## Additional capabilities\n\nCloudflare Gateway offers a comprehensive suite of services that go beyond protective DNS, functioning as a full-featured [Secure Web Gateway](https://www.cloudflare.com/learning/access-management/what-is-a-secure-web-gateway/). It supports HTTP inspection, providing deeper visibility into user traffic, and expands the scope of threat protection and data security capabilities available to users.\n\nWhen inspecting HTTP traffic, Cloudflare prevents interference by decrypting, inspecting, and re-encrypting HTTPS requests in our data centers. Cloudflare Gateway only stores eligible cache content at rest and all cache disks are encrypted at rest. Furthermore, it is also possible to configure the geographical region of the servers where TLS decryption takes place with [Regional Services](https://developers.cloudflare.com/data-localization/regional-services/) in the Cloudflare [Data Localization Suite](https://developers.cloudflare.com/data-localization/) (DLS) and organizations have the ability to choose between adding a Cloudflare certificate on devices or [using their own certificate](https://developers.cloudflare.com/cloudflare-one/team-and-resources/devices/user-side-certificates/custom-certificate/) (BYOPKI) for user traffic decryption and inspection.\n\n### Threat protection\n\nWhen Cloudflare Gateway is performing HTTP inspection, it extends protection beyond DNS security by enabling additional capabilities to safeguard users as they browse the Internet:\n\n* **Anti-virus scanning (AV):** Users are protected when downloading or uploading files to or from the Internet. [Files are scanned](https://developers.cloudflare.com/cloudflare-one/traffic-policies/http-policies/antivirus-scanning/) in real time to detect malicious content.\n* **Sandboxing:** For files not previously seen, Cloudflare Gateway can [quarantine them in a secure sandbox environment for analysis](https://developers.cloudflare.com/cloudflare-one/traffic-policies/http-policies/file-sandboxing/). In this sandbox, Cloudflare monitors the file's actions and compares them against known malware patterns. Files are only released to users if no malicious content is detected.\n* **Remote Browser Isolation (RBI):** [Isolation policies](https://developers.cloudflare.com/cloudflare-one/remote-browser-isolation/) can be configured to safeguard users when accessing potentially risky websites. For example, [if a user attempts to visit a newly seen domain that triggers an isolation policy](https://developers.cloudflare.com/cloudflare-one/remote-browser-isolation/isolation-policies/), the website's active content is executed in a secure, isolated browser hosted in the nearest Cloudflare data center. This ensures that zero-day attacks and malware are mitigated before they can impact the user. This remote browsing experience is seamless and transparent, allowing users to continue using their preferred browsers and workflows. Every browser tab and window is automatically isolated, and sessions are deleted when closed.\n\nIn addition to threat protection, Cloudflare Gateway enables the implementation of robust data protection policies during HTTP inspection, including:\n\n* **File upload controls:** Administrators can enforce policies that monitor and [restrict file uploads](https://developers.cloudflare.com/cloudflare-one/traffic-policies/http-policies/#download-and-upload-file-types) to the Internet, preventing the inadvertent sharing of sensitive data.\n* **Data Loss Prevention (DLP):** [DLP policies](https://developers.cloudflare.com/cloudflare-one/data-loss-prevention/) can be deployed to identify and block unauthorized sharing of confidential or classified information. For more details, see [securing data in transit](https://developers.cloudflare.com/reference-architecture/diagrams/security/securing-data-in-transit/).\n* **Remote Browser Isolation (RBI):** Beyond threat protection, [isolation policies](https://developers.cloudflare.com/cloudflare-one/remote-browser-isolation/) can enforce [user action restrictions](https://developers.cloudflare.com/cloudflare-one/remote-browser-isolation/isolation-policies/#policy-settings), such as disabling copy/paste functionality or keyboard inputs, to safeguard sensitive information. For additional information, refer to [securing data in use](https://developers.cloudflare.com/reference-architecture/diagrams/security/securing-data-in-use/).\n\n## Adopting Cloudflare Gateway as Secure Web Gateway\n\nExpanding Cloudflare Gateway from a protective DNS service to a full-featured Secure Web Gateway is a straightforward process. Using Cloudflare's dashboard, IT administrators would configure [HTTP policies](https://developers.cloudflare.com/cloudflare-one/traffic-policies/http-policies/) in addition to existing DNS policies. These HTTP policies would enable the additional protections, namely, Antivirus Scanning, Sandboxing, Remote Browser Isolation (RBI), and Data Loss Prevention (DLP).\n\nFrom the user's perspective, remote Workers would continue using the same device agent. To leverage these enhanced protections, they simply need to switch the device agent mode to [Gateway with WARP](https://developers.cloudflare.com/cloudflare-one/team-and-resources/devices/warp/configure-warp/warp-modes/#gateway-with-warp-default). This mode can also be enforced when using device management to deploy the agent.\n\nFor office and site-based users, a network appliance can be configured to establish an [IPsec or GRE tunnel to Cloudflare](https://developers.cloudflare.com/magic-wan/). This setup routes all Internet-bound traffic through Cloudflare Gateway, ensuring that security policies are applied before the traffic exits to the internet. Alternatively, [Proxy Auto-Configuration files (PAC)](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/proxy-endpoints/) can be used to forward DNS and HTTP/S traffic towards Cloudflare.\n\n![Figure 6: The different options available to use Cloudflare Gateway as a full-featured Secure Web Gateway.](https://developers.cloudflare.com/_astro/gateway-for-protective-dns-image-06.C-pVIjaU_Z1PBOlM.svg)\n\n* [Evolving to a SASE architecture with Cloudflare](https://developers.cloudflare.com/reference-architecture/architectures/sase/)\n* [Using a zero trust framework to secure SaaS applications](https://developers.cloudflare.com/reference-architecture/design-guides/zero-trust-for-saas/)\n* [Learning path: Secure your Internet traffic and SaaS apps](https://developers.cloudflare.com/learning-paths/secure-internet-traffic/concepts/)\n\n<page>\n---\ntitle: Magic WAN Connector deployment options · Cloudflare Reference Architecture docs\ndescription: Learn how to deploy Magic WAN Connector and evaluate your various\n  deployment options.\nlastUpdated: 2025-10-22T21:11:06.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/sase/magic-wan-connector-deployment/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/sase/magic-wan-connector-deployment/index.md\n---\n\nCloudflare helps organizations transform their networks by providing secure, high-performance connectivity for on-premises networks, virtual cloud networks and access to SaaS applications. As applications migrate to the cloud, [Cloudflare's SASE](https://www.cloudflare.com/zero-trust/) platform enables businesses to replace traditional on-premise solutions, ensuring secure access, low latency, and automated scalability across distributed environments. This approach reduces reliance on legacy hardware, simplifies IT management, and improves user experience for cloud-based services.\n\nMagic WAN Connector is a physical, or virtual (deployed as a VM on a hypervisor) device which, using [Zero Touch Provisioning](https://en.wikipedia.org/wiki/Zero-touch_provisioning), automatically on-ramps traffic for a local network to Cloudflare, and replaces existing, difficult to manage edge hardware.\n\nEvery organization and network is different, and as such there is no one-size-fits-all when it comes to how a Magic WAN Connector can be deployed. Therefore, the purpose of this document is to provide a high-level explanation of the deployment options that would make sense to most environments, while also describing the support of a few advanced use cases.\n\n## Deployment locations\n\nThe first decision for a Magic WAN Connector deployment is its location in the network, and this relates to whether the organization wants to keep the existing Customer Premises Equipment (CPE, edge router or firewall at a site), and if so, for what reason. Experience shows that this decision usually leads to three different topologies:\n\n* **Connector replacing the CPE** (Figure 1a): When the link is an Internet connection and the organization does not have any real use of existing equipment since the Connector supports all the required networking features such as DHCP, DNS, NAT, Trunking (801.1Q), IP access lists, breakout traffic, etc. Examples could be:\n\n* The transition from MPLS to Internet-based connectivity, where the MPLS router probably does not add any value in the deployment.\n  * An Internet-facing CPE reaching, or already having exceeded, its end of life.\n  * An Internet-facing CPE that is redundant with Magic WAN Connector and can be removed for simplicity's sake.\n\n* **Connector north of the CPE** (Figure 1b): This option might be preferred when the existing CPE is a firewall, and the organization wants to keep it for:\n\n* Additional LAN protection as a result of a defense-in-depth approach.\n  * Advanced segmentation requirements, for example allowing/blocking traffic between segments based on various Layer 3 to Layer 7 rules, since Magic WAN Connector supports segmentation only on layers 3 and 4 of the OSI model.\n\n* **Connector south of the CPE** (Figure 1c): Reasons for installing Magic WAN Connector south of an existing Internet-facing CPE might be:\n\n* CPE cannot be replaced because it connects to a broadband service with a presentation (for example RJ-11) or protocol (for example PPPoE) that Magic WAN Connector does not support.\n  * CPE cannot be replaced because it is part of a fiber service that only works with that specific hardware, such as an ISP-provided ONT (Optical Network Terminal).\n  * CPE cannot be replaced (yet) because it is part of an active managed service.\n  * CPE cannot be replaced because it is a firewall that the organization wants to keep in place for other reasons (technical or contractual).\n\n![Figure 1: Connector location options: (a) replacing CPE, (b) north of CPE , (c) south of CPE.](https://developers.cloudflare.com/_astro/figure01.Dcrrl27C_Oooga.svg)\n\nIn Wide Area Network (WAN) environments, where remote offices, data centers, and cloud services are interconnected, any downtime can lead to loss of access to critical applications, communication disruptions, and productivity losses. To avoid such downtimes, WAN networks are mostly designed with High Availability (HA) principles in mind. Deploying redundant hardware and uplink circuits, as well as failover mechanisms, ensures that if one component fails, another can immediately take over. This resilience is key to maintaining seamless connectivity, reliability, and service continuity in distributed networks.\n\nMagic WAN Connector can use two or more WAN ports for uplinks, and therefore it can connect to multiple different ISPs for circuit resiliency. One option for a basic level of HA is to use a single Magic WAN Connector with two uplinks, while traffic can be load-balanced between them (Figure 2 below). This approach could be used for non-critical branches, small offices, and other similar types of locations, or as an intermediate step towards a full HA deployment.\n\n![Figure 2. Uplink high-availability deployment.](https://developers.cloudflare.com/_astro/figure02.BGru8RdY_Z12Hkz6.svg)\n\nIn this type of setup, a redundant device is configured to take over in case of a failure in the primary device, allowing seamless traffic failover and ensuring uninterrupted access to applications, data, and services. This approach enhances network resilience, improves service reliability, and helps maintain productivity by reducing the risk of single points of failure.\n\nFigure 3 below illustrates the deployment topology where Magic WAN Connector supports full HA. Using an election process, one device becomes active and the other becomes passive. To achieve this, the two Connectors must connect to a LAN switch on the same Layer 2 domain (like a VLAN) for heartbeat messages to be sent between them. Active/passive means that the active Connector is the only device that propagates traffic at any point in time.\n\n![Figure 3. Full HA with dual Connectors and dual uplinks.](https://developers.cloudflare.com/_astro/figure03.CgaueUuZ_Z18Oyvu.svg)\n\nEach Magic WAN Connector connects to the same two ISPs using dual uplinks, and automatically creates one IPsec tunnel per WAN port. This requires each ISP to support multiple ports on their on-site Network Termination Unit (or their CPE, if there is one present). In this HA deployment there are four tunnels in total, two per Connector, while traffic can be load-balanced between the two tunnels on the active device. When either the active Connector, or its IPsec tunnels go down, the other Connector takes over and propagates traffic, holding the active role until it fails (preemption is not used to avoid unnecessary failover delays).\n\n## Advanced use cases\n\nThis section describes how the Magic WAN Connector can be deployed to support a few advanced use cases, that is, use cases beyond the typical scenarios where the Connector acts as a simple CPE that on-ramps traffic to Cloudflare for site-to-site, or site-to-Internet, connectivity and protection.\n\n### Protecting local Internet breakout (LIBO)\n\nThe main use case for this type of deployment is based on the fact that many organizations today require local Internet breakout to improve the performance of Cloud and SaaS applications, while they probably continue to use their private MPLS connectivity for self-hosted applications, or site-to-site connectivity, until they decide to further modernize their architectures at a later stage. Reasons behind such a decision might be:\n\n* MPLS service is still in contract, but it is planned to be replaced by Internet connectivity everywhere when the term ends\n* Self-hosted applications might require low latency with agreed SLAs, so a hybrid MPLS/Internet architecture might be required\n\n![Figure 4. Hybrid MPLS/Internet use case.](https://developers.cloudflare.com/_astro/figure04.B7yWVURB_Z2wnrHq.svg)\n\nThis type of hybrid architecture requires the MPLS Customer Edge router (CE) or some other L3 device in the LAN to route traffic via different interfaces depending on the destination. Traffic flows in this scenario as follows:\n\n1. Devices on the local network use the MPLS CE (or some other local L3 device) as their default gateway\n2. Private traffic is sent towards the MPLS network. For example, the MPLS CE knows how to route these because it receives RFC1918 ranges via BGP from the MPLS network.\n3. Internet traffic from the LAN network is forwarded towards the Magic WAN Connector (MPLS CE/L3 gateway points a static default route towards the Connector)\n\nAll traffic towards internal locations and self-hosted applications follows the MPLS path, while traffic to cloud-based and SaaS applications follows the local Internet breakout path, protected by Cloudflare security services.\n\nIn some deployments, customers might want to protect only specific protocols using Cloudflare security services such as our [secure web gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/), while the rest of the traffic routes through the existing edge device (router or firewall). Figure 5 illustrates such a use case.\n\n![Figure 5. 'Split Tunneling' use case.](https://developers.cloudflare.com/_astro/figure05.BDoVf7qZ_Z2ubbnH.svg)\n\nIn this example, the organization wants Cloudflare to protect all Internet web traffic (HTTP/HTTPS), while the rest of the traffic flows out via the existing firewall. The latter could be traffic towards existing VPNs, or non-web traffic exiting the site, but protected by the on-premises firewall. This method could take advantage of local device policy-based routing (PBR) capabilities, for example:\n\n1. Local devices use the on-premises firewall as their default gateway\n2. Firewall uses PBR to direct appropriate traffic to the right destination\n3. Web traffic (TCP 80/443) is sent towards Cloudflare via the Magic WAN Connector\n4. All other traffic exits via the on-premises firewall\n\nAs long as PBR capability exists locally, and the ISP provides at least two public IP addresses to the organization, the possibilities of splitting traffic towards the Magic WAN Connector are endless, and really depend on each organization's unique environment and use cases.\n\n### Protecting segments / segmentation\n\nAnother advanced group of use cases that Magic WAN Connector can support is local segmentation, and protection of specific local networks. To achieve that, and depending on an organization's current architecture, line of business, security policies, and compliance requirements, Magic WAN Connector can be installed in any location south of the site edge device to provide more granular network security, as illustrated in figure 6 and described in the following paragraphs.\n\n![Figure 6. Segmentation-related use cases.](https://developers.cloudflare.com/_astro/figure06.NzTDAI8s_Z1DFigs.svg)\n\nIn this example, the Magic WAN Connector will create an IPsec tunnel to Cloudflare through the on premises firewall and local Internet connection. Subnet A and B are both connected to the Magic WAN Connector, but have no direct connection with each other. This will enable a couple of use cases:\n\n* **Internet security**: Segment 1 adheres to Cloudflare security policies, bypassing the local firewall policy.\n* **Site-to-site connectivity**: Segment 1 can connect to local segments in other locations (or entire sites, for example Site 2), depending on the organization's policy.\n\nThe example also shows how Magic WAN Connector can be used to provide two types of local network segmentation:\n\n* **Intra-segment**: Traffic between LAN ports on the same Connector is blocked by default, hence, Subnet A and Subnet B in Segment 1 cannot talk to each other. The administrator would have to explicitly allow this traffic flow by using configuration logic similar to IP access lists. This ability to hairpin local traffic via the Connector's LAN ports, avoids traffic tromboning via the Cloudflare platform (that is, travel out and back in via the Magic WAN tunnel), which could result in those segments losing connectivity to each other in the event of Internet circuit outage. Therefore, this capability allows local nodes that do not necessarily require Internet access to function, for example printers, file servers, network attached storage (NAS) nodes, and various Internet of Things (IoT) devices, to continue being accessible by local hosts in different segments during Internet outages.\n* **Inter-segment**: Magic WAN Connector does not allow any inbound traffic on its WAN ports. Therefore, Segments 1 and 2 cannot talk to each other.\n\nTo summarize, Magic WAN Connector is a Zero-Touch Provisioning (ZTP) device that organizations can use to connect to Cloudflare and consume advanced security and connectivity services, while keeping operational costs low.\n\n* [Magic WAN - Cloud-delivered enterprise networking](https://www.cloudflare.com/en-gb/network-services/products/magic-wan/)\n* [Announcing the Magic WAN Connector: the easiest on-ramp to your next generation network](https://blog.cloudflare.com/magic-wan-connector/)\n* [Configuring Magic WAN Connector](https://developers.cloudflare.com/magic-wan/configuration/connector/)\n\n<page>\n---\ntitle: Access to private apps without having to deploy client agents ·\n  Cloudflare Reference Architecture docs\ndescription: Learn how to provide access to private apps without having to\n  deploy client agents.\nlastUpdated: 2025-10-22T21:11:06.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/sase/sase-clientless-access-private-dns/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/sase/sase-clientless-access-private-dns/index.md\n---\n\nUsing Cloudflare to access private resources - such as applications, servers, and networks that are not exposed directly to the internet - usually involves deploying an ([agent](https://developers.cloudflare.com/cloudflare-one/team-and-resources/devices/warp/)) to devices and then using a server-side agent ([cloudflared](https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/private-net/cloudflared/), [WARP Connector](https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/private-net/warp-connector/)), to connect the private network or application to Cloudflare. This document describes an alternative approach which removes the need to deploy software to the user's device, making it easier for allowing third party access such as contractors and partners.\n\nTypically, to provide access to internal resources, you use Cloudflare Zero Trust Network Access [ZTNA](https://www.cloudflare.com/learning/access-management/what-is-ztna/) which supports two methods for how the user device accesses a private resource.\n\n* A CNAME in public DNS, that resolves to a hostname representing the Cloudflare tunnel which proxies the request to the internal application.\n\n* An IP address exposed by Cloudflare tunnel, that again, proxies traffic direct to that IP address.\n\n## Accessing private applications\n\nSome organizations don't like the idea of public DNS records which reference internal services, even though the ZTNA services provide strong access security, sometimes just the existence of a service name in public DNS is not desired. Exposing IP addresses directly to users is also a bad idea, they are hard to remember, and IP addresses can change. Unlike accessing a web application via a public DNS record through our proxy, applications exposed via private IP addresses also require the user to install an agent on their device to capture and route the traffic to Cloudflare which in turn routes it to the application. Installing this agent can be a challenge with third parties like partners or contractors.\n\nSo how do you allow access to private resources, without creating public DNS records and without requiring the user install software on their device? Cloudflare solved this challenge with [Resolver Policies](https://developers.cloudflare.com/cloudflare-one/traffic-policies/resolver-policies/) where internal DNS services can be used. When combined with agentless [Remote Browser Isolation](https://developers.cloudflare.com/cloudflare-one/remote-browser-isolation/), it is possible to create Zero Trust access to private web applications with only a modern web browser. Policies to control access to apps are then written in our Secure Web Gateway (SWG) service as [network firewall](https://developers.cloudflare.com/cloudflare-one/traffic-policies/network-policies/) policies. This method supports HTTP based applications, although Cloudflare does provide a browser rendering service for SSH and VNC services.\n\nFollow this [tutorial](https://developers.cloudflare.com/cloudflare-one/tutorials/clientless-access-private-dns/) for information on how to configure secure access to private web-based resources without having to deploy client agents.\n\n![Figure 1: Remote Access Internal Hostname](https://developers.cloudflare.com/_astro/diagram1.CgnmLabJ_1Obud1.svg)\n\n1. Users start their access by authenticating to the [Cloudflare Browser Isolation](https://your_team_domain.cloudflareaccess.com/browser) service. Note this is a browser running on Cloudflare’s edge network, therefore all requests will by default be handled by Cloudflare. The contents are rendered back to the users’ browser via secure encrypted vector streams that use HTTPS and WebRTC channels.\n2. Once the user has authenticated to the remote browser, they make a request to an internal hostname which is a record in the internal DNS service. e.g. <https://app.company.internal>\n3. Cloudflare looks up the internal hostname using [resolver policies](https://developers.cloudflare.com/cloudflare-one/traffic-policies/resolver-policies/), and gets the private IP address from the internal DNS server. This DNS resolution takes place within the Cloudflare network and requires no DNS client changes on the user's device.\n4. Cloudflare evaluates the network firewall policies and verifies if the user has permission to reach the destination addresses.\n5. If the request passes the policy, it is sent via secure [QUIC](https://blog.cloudflare.com/getting-cloudflare-tunnels-to-connect-to-the-cloudflare-network-with-quic) tunnels to the Cloudflared connectors which then is reverse proxied to the application servers. All data is transmitted securely through Cloudflare back to the users’ browser via encrypted vector streams.\n\n* [Tutorial: Access a web application via its private hostname without WARP](https://developers.cloudflare.com/cloudflare-one/tutorials/clientless-access-private-dns/)\n\n<page>\n---\ntitle: Secure access to SaaS applications with SASE · Cloudflare Reference\n  Architecture docs\ndescription: Cloudflare's SASE platform offers the ability to bring a more Zero\n  Trust orientated approach to securing SaaS applications. Centralized policies,\n  based on device posture, identity attributes and granular network location can\n  be applied across one or many Saas applications.\nlastUpdated: 2025-10-22T21:11:06.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/sase/secure-access-to-saas-applications-with-sase/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/sase/secure-access-to-saas-applications-with-sase/index.md\n---\n\nSaaS applications have become essential tools in today's business operations. While SaaS applications reduce IT and infrastructure burden, they also introduce new security challenges that traditional architectures struggle to address. Many companies today are on the path to implementing a [Zero Trust architecture](https://zerotrustroadmap.org/), which heavily combines identity, device and network information to better secure applications.\n\nHowever SaaS applications tend to focus their security on their own platform, such as storing data at rest in a secure manner and ensuring their applications are not exposing customer data due to application vulnerabilities. This document is going to cover how to address some of the limitations of SaaS applications by using Cloudflare's Secure Access Service Edge (SASE) platform. Specifically our Zero Trust Network Access (ZTNA) and Secure Web Gateway (SWG) services, combined with integrations to your existing identity and device security vendors.\n\n## Is SaaS not already secure?\n\nBefore discussing the specifics of implementing SASE for SaaS applications, we should consider asking: is SaaS not already secure? Major providers like Salesforce, ServiceNow, Microsoft and more have implemented robust security capabilities, including integrations with identity providers for Single Sign On (SSO), SSL/TLS for all application communication, encryption of data at rest and comprehensive audit logs. Unfortunately, SaaS vendors are not attempting to rebuild entire security platforms in their applications, so they are not able to provide many features required for a modern Zero Trust architecture.\n\nSaaS applications are unable to evaluate the security posture of connecting devices. A compromised laptop with valid credentials appears identical to a securely managed, corporate device. When data is downloaded from the SaaS application, it has no visibility into where it goes or if the device it is being downloaded to is secure. Typically authentication for SaaS applications is externalized by redirecting users to an identity service, therefore the SaaS application has no sense of how the user authenticated and as such all trust is placed in the identity provider.\n\nThese security challenges are compounded by poor network access controls — most SaaS applications accept connections from any Internet source, but sometimes they can be limited to only accessing from a specific set of IP addresses that might be associated with one or more physical offices. But these rudimentary network controls are hard to expand for remote users working from home, or partners and contractors who need access.\n\nCloudflare's SASE platform offers the ability to bring a more Zero Trust orientated approach to securing SaaS applications. Centralized policies, based on device posture, identity attributes and granular network location can be applied across one or many SaaS applications. Cloudflare becomes the new corporate network, and it is possible to gate access to Internet based SaaS applications to those users and devices that are connected to Cloudflare. Essentially it is a new corporate network in the cloud.\n\n## Securing access with Cloudflare\n\nThe diagram below shows how Cloudflare sits between your users, devices and networks that require access to any SaaS application. The two main services proving security capabilities are:\n\n* [Zero Trust Network Access](https://developers.cloudflare.com/cloudflare-one/access-controls/policies/). Allows Cloudflare to become an identity proxy, so that you can easily enable authentication with a wide variety of identity providers to a single SaaS application. This service also incorporates the ability to evaluate access based on device posture and network location.\n* [Secure Web Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/). Once all traffic to access the SaaS application flows through our gateway, HTTPS connections are terminated at Cloudflare and you have the ability to inspect the data flowing to and from the SaaS application. This allows you to block sensitive data from being exported to insecure locations.\n\n![Figure 1: Only traffic that has passed the Cloudflare network and relevant policies is authorized to access the SaaS application.](https://developers.cloudflare.com/_astro/figure1.CyQmr5MZ_ZXUa9b.svg)\n\nThe above diagram shows the variety of ways in which traffic can on-ramp to Cloudflare, where the ZNTA service ensures authentication and the Secure Web Gateway filters both inbound and outbound traffic to/from the SaaS application.\n\n1. Initial requests to the SaaS application are redirected to Cloudflare as part of SSO flow. ZTNA service authenticates users against existing identity providers.\n2. A user, authenticated or not, is denied access to the SaaS application if their traffic is not sourced from Cloudflare.\n3. A user on a non-managed device can use browser isolation, where the browser accessing the SaaS application runs on a Cloudflare server, and the results of the rendered page are securely delivered to a user's local browser.\n4. A managed device is connected to Cloudflare using a secure tunnel and therefore all communication from device to SaaS application is filtered and secured.\n   1. Cloudflare agent device posture can also be incorporated into authorizing traffic from these devices.\n5. A device connected to a local network, where all Internet traffic is routed to Cloudflare via a secure Magic WAN tunnel, also ensures all traffic from network to SaaS application is filtered and secured.\n6. Traffic then passes through our secure web gateway, where DNS and HTTP policies can be applied to traffic.\n   1. HTTP policies allow the examination of the data being both uploaded and downloaded from the SaaS application using DLP profiles.\n7. Traffic egresses Cloudflare with a specific IP. The SaaS application is configured to allow all traffic coming from that address.\n\nXDR platform integrations\n\nWhen integrating with an XDR platform such as Crowdstrike, Sentinel One or Microsoft Intune, device posture is also available for any authenticated user because Cloudflare matches the identity with the user in the XDR system and device posture information is evaluated.\n\nThe following is an example set of policies which demonstrate how you can use Cloudflare to secure access to Salesforce.\n\nThe first step is using an [egress IP policy under Cloudflare Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/egress-policies/). This allows you to purchase and assign specific IPs to users that have their traffic filtered via Gateway. Then in Salesforce, you enforce that access is only permitted for traffic with a source IP that matches the one in your egress policy. This combination ensures that the only way to get access to Salesforce is via Cloudflare.\n\n| Egress Policy | |\n| - | - |\n| **Identity** | |\n| User Group Names | All Employees |\n| **Select Egress IP** | |\n| Use dedicated Cloudflare Egress IPs | `203.0.113.88` |\n\nThis is important not only for securing access to Salesforce, but also for adequately protecting its contents while in use. Now let us examine the access policy that is limiting access to members of the Sales or Executives groups. We are also using our Crowdstrike integration to ensure that users are on company managed devices.\n\n| Policy name | Account executives on trusted devices |\n| - | - |\n| Action | Allow |\n| **Include** | |\n| Member of group | Sales, Executives |\n| **Require** | |\n| Authentication method | MFA - multi-factor authentication |\n| Gateway | On |\n| Crowdstrike Service to Service | Overall Score above 80 |\n\nThis second policy applies to all employees but we are going to apply a few more steps before access is granted.\n\n| Policy name | Employees on trusted devices |\n| - | - |\n| Action | Allow |\n| **Include** | |\n| Member of group | All Employees |\n| **Require** | |\n| Authentication method | MFA - multi-factor authentication |\n| Gateway | On |\n| Crowdstrike Service to Service | Overall Score above 80 |\n| **Additional Settings** | |\n| Purpose justification | On |\n| Temporary authentication | On |\n| Email addresses of approvers | `salesforce-admin@company.com` |\n\nWe are going to add in temporary authentication to this second policy. That means if Cloudflare determines that the incoming request is from someone outside of the Sales or Executives department, an administrator will need to explicitly grant them temporary access. In context, this policy could be used to secure access to Salesforce for employees outside the Sales department, as the customer information could be sensitive and confidential.\n\nThis approach is important for several reasons:\n\n* It allows for human oversight on potentially risky access attempts, reducing the chance of unauthorized access through compromised or insecure devices.\n* It provides flexibility for legitimate users to access the application even when their device fails to meet the highest security standards. This encourages users to maintain good security practices on their devices.\n* In addition, since all user traffic is routed through Cloudflare, we can enforce additional security measures (such as preventing the download of sensitive data) via web traffic policies.\n\nCloudflare's SASE platform allows organizations to centralize security policy for accessing SaaS applications. It also enhances security by allowing you to leverage device posture and network attributes. You can configure it in a way where your SaaS application essentially is only accessible via your new corporate network which is built on Cloudflare.\n\n* [Evolving to a SASE architecture with Cloudflare](https://developers.cloudflare.com/reference-architecture/architectures/sase/)\n* [Designing ZTNA access policies for Cloudflare Access](https://developers.cloudflare.com/reference-architecture/design-guides/designing-ztna-access-policies/)\n* [Access to private apps without having to deploy client agents](https://developers.cloudflare.com/reference-architecture/diagrams/sase/sase-clientless-access-private-dns/)\n\n<page>\n---\ntitle: Zero Trust and Virtual Desktop Infrastructure · Cloudflare Reference\n  Architecture docs\ndescription: This document provides a reference and guidance for using\n  Cloudflare's Zero Trust services. It offers a vast improvement over remote\n  access to web applications with greater security.\nlastUpdated: 2025-11-21T18:29:21.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/sase/zero-trust-and-virtual-desktop-infrastructure/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/sase/zero-trust-and-virtual-desktop-infrastructure/index.md\n---\n\nVirtual Desktop Infrastructure (VDI) is old, costly, and clunky for a number of reasons including poor user experience, high upfront investments, ongoing operational costs, and many others of which you can read about in detail [here](https://blog.cloudflare.com/decommissioning-virtual-desktop/). We recognize and empathize with the challenges many organizations face that result in continued reliance on this approach. This reference architecture describes how Cloudflare's Zero Trust solution can help organizations secure their virtual desktop infrastructure (VDI) and in most cases offload it entirely. Many organizations use expensive and poor performing VDI only to provide a secure web browser to their remote users. In these cases, Cloudflare can help offload the use of VDI entirely for web-based applications or SaaS apps.\n\nIn other cases, a full virtualized desktop may be necessary for legacy apps, yet organizations still need help securing remote access to their VDI or securing the virtualized desktops themselves once users are interacting with them. This document provides a reference and guidance for using Cloudflare's Zero Trust services and is split into two main sections.\n\n* Replacing your VDI for secure remote access to web-based applications. Accessing a full blown desktop environment to just use a web browser isn't the best experience for users. Cloudflare offers a vast improvement over remote access to web applications and can do so with greater security.\n\n* Securing your VDI desktops...\n\n* From unauthorized access.\n  * From risky public Internet destinations.\n\n### Who is this document for and what will you learn?\n\nThis reference architecture is designed for IT or security professionals who are looking at using Cloudflare to replace or secure their Virtual Desktop Infrastructure. To build a stronger baseline understanding of Cloudflare, we recommend the following resources:\n\n* [Decommissioning your VDI Blog Post](https://blog.cloudflare.com/decommissioning-virtual-desktop/)\n* [Leveraging Cloudflare's Secure Web Gateway with PAC files for VDI](https://developers.cloudflare.com/learning-paths/secure-internet-traffic/configure-device-agent/pac-files/#use-cases)\n\n## Replacing Your VDI\n\nIn today's IT landscape, most applications and services that companies rely on are accessible through a web browser and often delivered by a SaaS provider. In these cases VDI is overkill and an incredibly expensive and burdensome way to provide a secure browser to a remote user. Instead, many organizations are turning to alternatives such as a [Remote Browser Isolation](https://www.cloudflare.com/zero-trust/products/browser-isolation/) (RBI) service. These services lower costs and overhead, provide a better user experience and most importantly offer robust security and logging features.\n\n![Figure 1: Remote browser isolation can provide a secure, controlled browser environment for accessing sensitive company applications.](https://developers.cloudflare.com/_astro/figure1.DA3CfHpk_BvIVS.svg)\n\nThe diagram above shows the general flow of how user traffic goes from their local browser to Cloudflare's remote browser and then to applications hosted on their infrastructure over a secure tunnel. Figure 2 below shows how users can access applications using remote browser isolation either directly in a browser or, if you require greater privacy and security for the traffic, using our device agent to create a tunnel from the device to Cloudflare. Both methods provide secure access to internal and external resources.\n\n![Figure 2: Two different traffic flow options: clientless RBI & RBI using the device agent.](https://developers.cloudflare.com/_astro/figure2.BTMnNCIU_7MjLn.svg)\n\n**Option 1: Clientless RBI**\n\n* Device agent not required\n* RBI URL can be protected by an [Access policy](https://developers.cloudflare.com/cloudflare-one/access-controls/policies/) with authentication\n* A simpler way to begin rolling out Cloudflare Zero trust while transitioning away from VDI\n* A great option for third party contractor access who cannot install software on their device\n\n**Option 2: RBI via the device agent**\n\n* Provides full security capabilities including device posture checks, split tunneling and the ability to use the Secure Web Gateway service to filter Internet-bound traffic.\n* More robust end state to transition to once workflows and confidence is built with users and internal teams\n* Gather end user metrics around user experience, reliability and performance\n\n### Securing access to your VDI using Zero Trust policies\n\nWhen replacing your VDI is not an option and a fully virtualized desktop is required for legacy applications, Cloudflare's [SASE platform](https://www.cloudflare.com/zero-trust/) can still help secure these environments by authorizing the access to them using identity based Zero Trust policies, as well as securing the Internet bound traffic from the devices themselves.\n\n![Figure 3: Using Cloudflare Access ZTNA to secure VDI.](https://developers.cloudflare.com/_astro/figure3.CQN_cSLv_Z29Vubf.svg)\n\nThe diagram above displays a general Zero Trust deployment using best practices for authenticating your remote users to the VDI infrastructure\n\n1. The user device sends traffic to Cloudflare's network over a secure tunnel using the device agent.\n2. Traffic destined to the VDI resources reaches ZTNA policies where it is evaluated for any combination of conditional access criteria, including device posture, identity and traffic context or type.\n3. Traffic that passes the ZTNA policies is allowed to reach the VDI resources where the user can interact with the VDI normally.\n\nThis model could also benefit from the below options demonstrating how to filter traffic sourced from the VDI hosts as well (refer to below).\n\n### Securing traffic from your VDI using secure web gateway policies\n\nCloudflare's SASE platform is capable of much more than replacing VPNs and bolstering policies towards internal services. It is just as important to protect users from accessing high risk sites on the Internet. Policies in Cloudflare's Secure Web Gateway can be tuned to filter DNS requests or become a sophisticated full forward proxy, inspecting both network and HTTP traffic as it heads towards the open Internet.\n\n![Figure 4: Using Cloudflare's Secure Web Gateway to filter and protect traffic coming from VDI.](https://developers.cloudflare.com/_astro/figure4.DPa0cH6R_Z1XG962.svg)\n\n1. **DNS configurations** (Resolver IPs, DoH, DoT) or **PAC files** for **Non-persistent virtual desktop infrastructure (VDI) environments** can be configured within the infrastructure or directly on the VDI hosts\n\na. DNS configurations allow for DNS policies to be enforced while PAC files allow for all gateway policy types (DNS, Network and HTTP).\n\n2. Traffic is sent from the VDI to the secure web gateway where it is filtered by DNS, network or HTTP policies.\n\n3. Traffic is sent to the Internet if it is allowed past Gateway policies\n\nAs shown, we have seen several ways to incorporate Cloudflare's Zero Trust services with your existing VDI, either by replacing it completely in favor of Remote Browser Isolation technology or further securing it with our [Access](https://developers.cloudflare.com/cloudflare-one/access-controls/policies/) or [Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/) services.\n\nFor more thorough background, explanation and action steps to a smooth migration be sure to read the following resources:\n\n* [Decommissioning your VDI Blog Post](https://blog.cloudflare.com/decommissioning-virtual-desktop/)\n* [Leveraging Cloudflare's Secure Web Gateway with PAC files for VDI](https://developers.cloudflare.com/learning-paths/secure-internet-traffic/configure-device-agent/pac-files/#use-cases)\n* [Connect to private network services with Browser Isolation](https://blog.cloudflare.com/browser-isolation-private-network/)\n* [Clientless Web Isolation](https://developers.cloudflare.com/cloudflare-one/remote-browser-isolation/setup/clientless-browser-isolation)\n* [Determine When to use PAC Files](https://developers.cloudflare.com/learning-paths/secure-internet-traffic/configure-device-agent/pac-files/#use-cases)\n* [Agentless DNS Configurations](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/dns/)\n* [PAC Files for Agentless HTTP Filtering](https://developers.cloudflare.com/cloudflare-one/networks/resolvers-and-proxies/proxy-endpoints/)\n\nAs always, if you have any questions on these services, be sure to reach out to your Cloudflare team or contact us to [talk to an expert](https://www.cloudflare.com/products/zero-trust/plans/enterprise/).\n\n<page>\n---\ntitle: A/B-testing using Workers · Cloudflare Reference Architecture docs\ndescription: Cloudflare's low-latency, fully serverless compute platform,\n  Workers offers powerful capabilities to enable A/B testing using a server-side\n  implementation.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/serverless/a-b-testing-using-workers/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/serverless/a-b-testing-using-workers/index.md\n---\n\nA/B testing, also known as split testing, is a fundamental technique in the realm of web development, allowing teams to iteratively refine and optimize their digital experiences. A/B testing involves comparing two versions of a web page or app feature to determine which one performs better in achieving a predefined goal, such as increasing conversions, engagement, or user satisfaction.\n\nThe process typically begins with the creation of two variants: the control (A) and the variant (B). These variants are identical except for the specific element being tested, whether it's a headline, button color, layout, or any other component of the user interface or user experience. For example, a team might test two different call-to-action button colors to see which one generates more clicks.\n\nOnce the variants are ready, they are exposed to users in a randomized manner. This randomization ensures that any differences in performance between the variants can be attributed to the changes being tested rather than external factors like user demographics or behavior.\n\nAs users interact with the different variants, their actions and behaviors are tracked and analyzed to measure the performance of each variant against the predefined goal. Key metrics such as click-through rates, conversion rates, bounce rates, and engagement metrics are monitored to determine which variant is more effective in achieving the desired outcome.\n\nA/B testing is a powerful tool for continuously optimizing and improving digital experiences, enabling teams to make data-driven decisions based on real user feedback rather than subjective opinions or assumptions. By systematically testing and refining different elements of their websites or applications, organizations can enhance user satisfaction, increase conversions, and ultimately achieve their business objectives in a competitive online landscape.\n\nCloudflare's low-latency, fully serverless compute platform, [Workers](https://developers.cloudflare.com/workers/) offers powerful capabilities to enable A/B testing using a server-side implementation. With the help of [Workers KV](https://developers.cloudflare.com/kv/), this solution can be make highly configurable with ease.\n\n## A/B testing using Workers\n\n![Figure 1: A/B testing using Workers](https://developers.cloudflare.com/_astro/a-b-testing-workers.2TNh_6Un_Z2oGmWd.svg)\n\nThis architecture shows a same-URL A/B testing endpoint. The A/B testing logic and configuration is deployed on the server side, so that clients do not have to implement any changes to make use of A/B testing.\n\n1. **Client**: Sends requests to server. This could be through a desktop or mobile browser, or native or mobile app.\n2. **Configuration**: Process incoming request using Workers. Read current configuration by reading from [KV](https://developers.cloudflare.com/kv/) using the [`get()`](https://developers.cloudflare.com/kv/api/read-key-value-pairs/) method. This allows for flexible updates to the A/B services configuration fully decoupled from code-deployment.\n3. **Origin requests**: Check for already existing cookies in the request headers. If no cookie for group assignment is set, randomly assign a group. If a cookie is set, extract assigned group from the cookie header. Send request to either the control endpoint (A) or variant endpoints (B) depending on the configuration and the assigned group.\n4. **Response**: Return the response from the origin. Additionally, if no cookie was previously set, set a cookie with the respective assigned group for session affinity.\n\nFor an example with code snippets on how to use Workers and Workers KV to route requests to different origin web servers, refer to Workers KV's example on [routing across web servers](https://developers.cloudflare.com/kv/examples/routing-with-workers-kv/).\n\n* [Workers: Get started](https://developers.cloudflare.com/workers/get-started/guide/)\n* [Workers KV: Get started](https://developers.cloudflare.com/kv/get-started/)\n* [Workers KV: Route requests to web servers with Workers and Workers KV](https://developers.cloudflare.com/kv/examples/routing-with-workers-kv/)\n* [Code Example: A/B testing with same-URL direct access](https://developers.cloudflare.com/workers/examples/ab-testing/)\n\n<page>\n---\ntitle: Fullstack applications · Cloudflare Reference Architecture docs\ndescription: A practical example of how these services come together in a real\n  fullstack application architecture.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/serverless/fullstack-application/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/serverless/fullstack-application/index.md\n---\n\nFullstack web applications combine frontend and backend technologies to deliver complete, dynamic user experiences. These applications rely on a broad technology stack covering user interfaces, backend services, databases, integrations, and increasingly, AI-driven features to function seamlessly and scale reliably.\n\nOn the frontend, developers typically use HTML, CSS, and JavaScript, often alongside frameworks like React, Next.js, or Angular. These tools provide the structure and interactivity needed for modern user interfaces, helping manage state, render dynamic content, personalize experiences, and optimize performance across devices.\n\nOn the backend, server-side code handles tasks like processing requests, running business logic, authenticating users, integrating AI models, and interacting with databases. Developers build these services using languages like JavaScript, Python, or Java, supported by frameworks that simplify routing, middleware, and API creation.\n\nDatabases are critical in the stack, storing and retrieving application data. Relational databases like MySQL, PostgreSQL, and SQLite manage structured data and enforce data integrity, while NoSQL options like MongoDB or Cassandra offer flexibility for handling unstructured or large-scale datasets.\n\nModern fullstack development increasingly incorporates external services, APIs, pre-built components, and AI capabilities. This approach reduces the need to create complex features from scratch, such as content moderation, personalized recommendations, and semantic search. As a result, development teams can build applications more quickly and efficiently.\n\nCloudflare’s Developer Platform combines all these capabilities into a unified, globally distributed environment, offering developers everything they need to build, deploy, and scale modern fullstack applications with minimal operational overhead.\n\n![Figure 1: Cloudflare Developer Platform](https://developers.cloudflare.com/_astro/developer-platform.CqJ8bTq2_Z2hL90R.svg)\n\nCloudflare’s platform doesn’t just offer individual services. Rather, it offers a **composable ecosystem**, enabling teams to build powerful applications quickly, scale seamlessly, and innovate faster without the overhead of managing infrastructure.\n\n## Fullstack application diagram\n\nIn this section, we’ll present a practical example of how these services come together in a real fullstack application architecture.\n\n![Figure 2: Fullstack application](https://developers.cloudflare.com/_astro/fullstack-app-base.BiQNPV9W_ZMmbOU.svg)\n\nSends requests to the server. This could be through a desktop or mobile browser, or native or mobile app.\n\nProcess incoming requests to ensure the security of an application. This includes encryption of traffic using [SSL/TLS](https://developers.cloudflare.com/ssl/), offering [DDOS protection](https://developers.cloudflare.com/ddos-protection/), filtering malicious traffic through a [web application firewall (WAF)](https://developers.cloudflare.com/waf/), [mitigations against automated bots](https://developers.cloudflare.com/bots/), and [API Shield](https://developers.cloudflare.com/api-shield/) to identify and address your API vulnerabilities. Depending on the configuration, requests can be blocked, logged, or allowed based on a diverse set of parameters. Sensible fully managed and default configurations can be used to reduce attack surfaces with little to no overhead.\n\nServe static requests from [global cache (CDN)](https://developers.cloudflare.com/cache/). This reduces latency and lowers resource utilization, as the requests are being served from cache instead of requiring a request to storage & media services or compute services. Take advantage of [Argo Smart Routing](https://developers.cloudflare.com/argo-smart-routing/) to route requests across the most efficient network path, avoiding congestion.\n\nProcess dynamic requests using serverless compute with [Workers](https://developers.cloudflare.com/workers/). This could include authentication, routing, middleware, database interactions, and serving APIs. Moreover, [Workers Assets](https://developers.cloudflare.com/workers/static-assets/) can be used to serve client-side or server-side rendering web frameworks such as React, Next.js, or Angular. Utilize [Workers for Platforms](https://developers.cloudflare.com/cloudflare-for-platforms/workers-for-platforms/) to allow users to deploy custom code on your platform or enable them to deploy their own code directly. For stateful workloads, [Durable Objects](https://developers.cloudflare.com/durable-objects/) provide low-latency, stateful compute by running logic close to where the object's data is stored, enabling coordination, persistence, and real-time communication at the edge.\n\nFor workloads that require the flexibility of traditional containerization, [Containers](https://developers.cloudflare.com/containers/) allows you to run existing Docker-compatible applications on Cloudflare’s global network. Containers is designed for applications needing more resources than a standard Worker.\n\n### 5. Data & Storage\n\nIntroduce state to applications by persisting and retrieving data. This includes [R2](https://developers.cloudflare.com/r2/) for object storage, [D1](https://developers.cloudflare.com/d1/) for relational data, [KV](https://developers.cloudflare.com/kv/) for data with high read requirements and [Durable Objects](https://developers.cloudflare.com/durable-objects/) for strongly consistent data storage. The [storage options guide](https://developers.cloudflare.com/workers/platform/storage-options/) can help to assess which storage option is the most suitable for a given use case.\n\n### 6. Realtime content & Media\n\nBuild real-time serverless video, audio, and data applications with [Realtime](https://developers.cloudflare.com/realtime/). Serve optimized images from [Images](https://developers.cloudflare.com/images/) and on-demand videos as well as live streams from [Stream](https://developers.cloudflare.com/stream/).\n\nWith [Workers AI](https://developers.cloudflare.com/workers-ai/), developers can run popular open-source models for tasks like text generation, image analysis, and content moderation powered by serverless GPUs. [Vectorize](https://developers.cloudflare.com/vectorize/) is a globally distributed vector database for similarity search, personalization, and recommendation features. [Agents](https://developers.cloudflare.com/agents/) further extend AI capabilities - Cloudflare provides the Agents SDK that lets you build and deploy AI-powered agents that can perform tasks, interact in real time, call models, manage state, run workflows, query data, and integrate human-in-the-loop actions.\n\n### 8. Orchestration & Abstraction\n\n[Queues](https://developers.cloudflare.com/queues/) enable durable, asynchronous messaging to decouple services and handle traffic spikes. [Workflows](https://developers.cloudflare.com/workflows/) orchestrate complex processes across APIs, services, and human approvals, abstracting away infrastructure and state management. [Pipelines](https://developers.cloudflare.com/pipelines/) let you ingest high volumes of real time data, without managing any infrastructure.\n\n### 9. Cloudflare Observability\n\nSend logs from all services with [Logpush](https://developers.cloudflare.com/logs/logpush/), gather insights with [Workers Logs](https://developers.cloudflare.com/workers/observability/logs/) directly in the Cloudflare dashboard, collect custom metrics from Workers using [Workers Analytics Engine](https://developers.cloudflare.com/analytics/analytics-engine/), or observe and control AI applications with [AI Gateway](https://developers.cloudflare.com/ai-gateway/).\n\n### 10. External Logs & Analytics\n\nIntegrate Cloudflare's observability solutions with your existing third-party solutions. Logpush supports many [destinations](https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/) to push logs to for storage and further analysis. Also, Cloudflare analytics can be [integrated with analytics solutions](https://developers.cloudflare.com/analytics/analytics-integrations/). The [GraphQL Analytics API](https://developers.cloudflare.com/analytics/graphql-api/) allows for flexible queries and integrations.\n\n### 11. Tooling & Provisioning\n\nDefine and manage resources and configuration using third-party tools and frameworks such as [Terraform](https://developers.cloudflare.com/terraform/) and [Pulumi](https://developers.cloudflare.com/pulumi/), Cloudflare's Developer Platform command-line interface (CLI) [Wrangler](https://developers.cloudflare.com/workers/wrangler/), or the [Cloudflare API](https://developers.cloudflare.com/api/). All of these tools can be used either for manual provisioning, or automated as part of CI/CD pipelines.\n\n### 12. External Service Integrations\n\nCloudflare’s Developer Platform is built for seamless [integration with external services](https://developers.cloudflare.com/workers/configuration/integrations/). Whether connecting to third-party APIs, databases, SaaS platforms, or cloud providers, developers can easily make outbound requests from Workers, trigger workflows based on external events, and securely exchange data across systems.\n\n<page>\n---\ntitle: Programmable Platforms · Cloudflare Reference Architecture docs\ndescription: Workers for Platforms provide secure, scalable, cost-effective\n  infrastructure for programmable platforms with global reach.\nlastUpdated: 2025-12-29T17:29:32.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/serverless/programmable-platforms/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/serverless/programmable-platforms/index.md\n---\n\nA programmable platform allows customers to customize a product by writing code. Unlike traditional SaaS with fixed features, it enables users to extend functionality, deploy backend logic, and build full-stack experiences—all within the platform’s infrastructure.\n\nHosting the infrastructure for these platforms presents several challenges, including security, scalability, cost efficiency, and performance isolation. Allowing customers to run custom code introduces risks such as untrusted execution, potential abuse, and resource contention, all of which must be managed without compromising platform reliability. Running millions of single-tenant applications is inherently costly, making efficient resource utilization critical. The ability to scale workloads to zero when idle is key to ensuring economic viability while maintaining rapid startup times when demand spikes. Additionally, ensuring seamless global execution with low-latency performance requires a resilient, distributed architecture. Robust monitoring, debugging, and governance capabilities are also essential to provide visibility and control over customer-deployed code without restricting innovation.\n\n[Workers for Platforms](https://developers.cloudflare.com/cloudflare-for-platforms/workers-for-platforms/) provides the ideal infrastructure for building programmable platforms by offering secure, isolated environments where customers can safely execute custom code at scale, with automatic scaling to zero and a globally distributed runtime that optimizes performance and cost.\n\n## Core Architecture Components\n\nThe Workers for Platforms architecture consists of several key components that work together to provide a secure, scalable, and efficient solution for multi-tenant applications. In the following core concepts are outlined.\n\n1. **Main Request Flow**: An overview over the a request flow in a programmable platform.\n\n2. **Invocation & Metadata Flow**: commonly, incoming requests and enriched with metadata to provide the function invocation with relevant context or perform routing logic.\n\n3. **Egress Control**: controlling outbound connections to ensure compliant behaviour.\n\n4. **Utilizing Storage & Data Resources**: leveraging databases & storage to build even richer end-user expierences at scale.\n\n5. **Observability Tools**: Logging and metrics collection services to monitor platform performance and troubleshoot issues.\n\n![Figure 1: Workers for Platforms: Main Flow](https://developers.cloudflare.com/_astro/programmable-platforms-1.BCCEhzLr_Z2oGmWd.svg)\n\n1. **Client Request**: Send request from a client application to the platform's [Dynamic Dispatch Worker](https://developers.cloudflare.com/cloudflare-for-platforms/workers-for-platforms/how-workers-for-platforms-works/#dynamic-dispatch-worker).\n\n2. **Routing**: Identify the correct workload to execute and route the request to the respective [User Worker](https://developers.cloudflare.com/cloudflare-for-platforms/workers-for-platforms/how-workers-for-platforms-works/#user-workers) in the [Dispatch Namespace](https://developers.cloudflare.com/cloudflare-for-platforms/workers-for-platforms/how-workers-for-platforms-works/#dispatch-namespace). Each customer's workload runs in an isolated User Worker with its own resources and security boundaries.\n\n## Invocation & Metadata Flow\n\n![Figure 2: Workers for Platforms: Main Flow](https://developers.cloudflare.com/_astro/programmable-platforms-2.DGAT6ZDR_ZG0FdN.svg)\n\nFor many use cases, it makes sense to retrieve additional metadata, user data, or configuration to process incoming requests and provide the User Worker invocation with additional context.\n\n1. **Incoming Request**: Send requests to custom hostnames or a Worker using a Workers wildcard route.\n\n2. **Metadata Lookup**: Retrieve customer-specific configuration data from [KV](https://developers.cloudflare.com/kv/) storage. These lookups are typically based on the hostname of the incoming request or custom metadata in the case of custom hostnames.\n\n3. **Worker Invocation**: Route requests to the appropriate User Worker in the Dispatch Namespace based on metadata. Optionally, provide additional context during function invocation.\n\n## Egress Control Pattern\n\n![Figure 3: Workers for Platforms: Egress Control](https://developers.cloudflare.com/_astro/programmable-platforms-3.C-LkeZtS_ZG0FdN.svg)\n\nData observability and control is crucial for security. [Outbound Workers](https://developers.cloudflare.com/cloudflare-for-platforms/workers-for-platforms/configuration/outbound-workers/) allow for interception of all outgoing requests in User Worker scripts.\n\n1. **Worker Invocation**: Route requests to the appropriate User Worker in the Dispatch Namespace. Optionally pass additional parameters to the Outbound Worker during User Worker invocation.\n\n2. **External requests**: Send requests via `fetch()` calls to external services through a controlled Outbound Worker.\n\n3. **Request interception**: Evaluate outgoing requests and perform core functions like centralized policy enforcement and audit logging.\n\n## Metrics & Logging Architecture\n\n![Figure 4: Workers for Platforms: Metrics & Logging](https://developers.cloudflare.com/_astro/programmable-platforms-4.BoFSkvXQ_Z2j3dzk.svg)\n\n1. **Logging**: Collect logs throughout all Workers in the request flow via [Tail Worker](https://developers.cloudflare.com/cloudflare-for-platforms/workers-for-platforms/configuration/observability/#tail-workers) and [Workers Trace Events Logpush](https://developers.cloudflare.com/cloudflare-for-platforms/workers-for-platforms/configuration/observability/#workers-trace-events-logpush) services.\n\n2. **Metrics**: Collect custom metrics via [Workers Analytics Engine](https://developers.cloudflare.com/analytics/analytics-engine/) and out-of-the-box [Analytics](https://developers.cloudflare.com/analytics/graphql-api/) that can readily be queried via GraphQL API.\n\n3. **Third-party Integration**: Export logs and metrics to various external monitoring and analytics platforms like Datadog, Splunk, Grafana, and others via [Analytics integrations](https://developers.cloudflare.com/analytics/analytics-integrations/).\n\n## Resource Isolation Model\n\n![Figure 5: Workers for Platforms: Resources](https://developers.cloudflare.com/_astro/programmable-platforms-5.B2yd7IjV_Z1gqk3t.svg)\n\n1. **Incoming Request**: Send requests to custom hostnames or a Worker using a Workers wildcard route.\n\n2. **Worker Invocation**: Route requests to the appropriate User Worker in the Dispatch Namespace.\n\n3. **Resource Access**: Interact with per-script-specific resources:\n\n* D1 for relational database storage\n   * Durable Objects for strongly consistent data\n   * KV for high-read, eventually consistent key-value storage\n   * R2 for object storage\n\n## Deployment & Management Flow\n\n![Figure 6: Workers for Platforms: Deployment & Management Flow](https://developers.cloudflare.com/_astro/programmable-platforms-6.BfYznbr5_Z2oGmWd.svg)\n\n1. **Management Interface**: Interact with the platform through GUI, API, or CLI interfaces.\n\n2. **Platform Processing**: Process these interactions to:\n\n* Transform and bundle code\n   * Perform security checks\n   * Apply configuration\n\n3. **Change Management**: Deploy changes to Cloudflare using the Cloudflare REST API.\n\nCloudflare Workers for Platforms provides a robust foundation for building multi-tenant SaaS applications with strong isolation, global distribution, and scalable performance. By leveraging this architecture, platform providers can focus on delivering value to their customers while Cloudflare handles the underlying infrastructure complexity.\n\n* [Workers for Platforms: Get started](https://developers.cloudflare.com/cloudflare-for-platforms/workers-for-platforms/get-started/)\n* [Workers for Platforms: Outbound Workers](https://developers.cloudflare.com/cloudflare-for-platforms/workers-for-platforms/configuration/outbound-workers/)\n* [Workers for Platforms: Observability](https://developers.cloudflare.com/cloudflare-for-platforms/workers-for-platforms/configuration/observability/)\n\n<page>\n---\ntitle: Serverless ETL pipelines · Cloudflare Reference Architecture docs\ndescription: Cloudflare enables fully serverless ETL pipelines, significantly\n  reducing complexity, accelerating time to production, and lowering overall\n  costs.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/serverless/serverless-etl/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/serverless/serverless-etl/index.md\n---\n\nExtract, Transform, Load (ETL) pipelines are a cornerstone in the realm of data engineering, facilitating the seamless flow of data from its raw state to a structured, usable format. ETL pipelines are instrumental in the data processing journey, particularly in scenarios where data needs to be collected, cleansed, and transformed before being loaded into a target destination.\n\nThe process begins with extraction, where data is gathered from various sources such as databases, files, or streams. This raw data is often disparate and unstructured, necessitating the next step: transformation. During transformation, the data undergoes a series of operations to standardize formats, clean inconsistencies, and enrich with additional context or calculations. This phase is critical for ensuring data quality and consistency, as well as aligning it with the requirements of downstream applications and analytics.\n\nFinally, the transformed data is loaded into a destination, which could be a data warehouse, database, or any other storage solution. The loading phase involves efficiently moving the processed data to its intended destination, where it can be readily accessed and utilized for various purposes such as reporting, analysis, or feeding into machine learning models.\n\nETL pipelines play a pivotal role in data-driven decision-making processes across industries, enabling organizations to derive insights and value from their data assets. By automating and streamlining the journey from raw data to actionable insights, ETL pipelines empower businesses to make informed decisions, optimize processes, and gain competitive advantages in today's data-driven landscape.\n\nExamples of ETL pipelines in action include scenarios like extracting sales data from multiple retail stores, transforming it to a standardized format, and loading it into a centralized data warehouse for analysis and reporting purposes. Similarly, ETL pipelines are utilized in data migration projects, where legacy data needs to be migrated to modern systems while ensuring data integrity and consistency throughout the process.\n\nCloudflare allows for the deployment of fully serverless ETL pipelines, which can reduce complexity, time to production and overall cost. The following diagrams demonstrate different methods of how Cloudflare can be used in common ETL pipeline deployments.\n\n## ETL pipeline with HTTP-based ingest\n\n![Figure 1: Serverless: HTTP-based ingest](https://developers.cloudflare.com/_astro/serverless-etl-http-based.DtreS_ZH_1ghbSJ.svg)\n\nThis architecture shows a fully serverless ETL pipeline with an API endpoint as ingest. Clients send data via HTTP request to be processed. Common examples include click-stream data or analytics.\n\n1. **Client request**: Send POST request with data to be ingested. Examples would include click-stream data, analytics endpoints.\n2. **Input processing**: Process incoming request using [Workers](https://developers.cloudflare.com/workers/) and send messages to [Queues](https://developers.cloudflare.com/queues/) to add to processing backlog.\n3. **Data processing**: Use [Queues](https://developers.cloudflare.com/queues/) to trigger a [consumer](https://developers.cloudflare.com/queues/reference/how-queues-works/#consumers) that process input data in batches to prevent downstream overload and increase efficiency. The consumer performs all data cleaning, transformation and standardization operations.\n4. **Object storage**: Upload processed data to [R2](https://developers.cloudflare.com/r2/) for persistent storage.\n5. **Ack/Retry mechanism**: Signal success/error by using the [Queues Runtime API](https://developers.cloudflare.com/queues/configuration/javascript-apis/#message) in the consumer for each document. [Queues](https://developers.cloudflare.com/queues/) will schedule retries, if needed.\n6. **Data querying**: Access processed data from external services for further data usage.\n\n## ETL pipeline with object storage ingest\n\n![Figure 2: Serverless: Object storage ingest](https://developers.cloudflare.com/_astro/serverless-etl-object-storage.B0XqHlLa_1ghbSJ.svg)\n\nThis architecture shows a fully serverless ETL pipeline with object storage as ingest. Common examples include log and unstructured document processing.\n\n1. **Client request**: Upload raw data to R2 via S3-compatible API. Common examples include log and analytics data.\n2. **Input processing**: Send messages to [Queues](https://developers.cloudflare.com/queues/) using [R2 event notifications](https://developers.cloudflare.com/r2/buckets/event-notifications/) upon object upload.\n3. **Data processing**: Use [Queues](https://developers.cloudflare.com/queues/) to trigger a [consumer](https://developers.cloudflare.com/queues/reference/how-queues-works/#consumers) that process input data in batches to prevent downstream overload and increase efficiency. The consumer performs all data cleaning, transformation and standardization operations.\n4. **Object storage**: Upload processed data to [R2](https://developers.cloudflare.com/r2/) for persistent storage.\n5. **Ack/Retry mechanism**: Signal success/error by using the [Queues Runtime API](https://developers.cloudflare.com/queues/configuration/javascript-apis/#message) in the consumer for each document. [Queues](https://developers.cloudflare.com/queues/) will schedule retries, if needed.\n6. **Data querying**: Access processed data from external services for further data usage.\n\n* [Workers: Get started](https://developers.cloudflare.com/workers/get-started/guide/)\n* [Queues: Get started](https://developers.cloudflare.com/queues/get-started/)\n* [R2: Get started](https://developers.cloudflare.com/r2/get-started/)\n\n<page>\n---\ntitle: Serverless global APIs · Cloudflare Reference Architecture docs\ndescription: An example architecture of a serverless API on Cloudflare and aims\n  to illustrate how different compute and data products could interact with each\n  other.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/serverless/serverless-global-apis/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/serverless/serverless-global-apis/index.md\n---\n\nServerless APIs represent a modern approach to building and deploying scalable and reliable application programming interfaces (APIs) without the need to manage traditional server infrastructure. These APIs are designed to handle incoming requests from users or other systems, execute the necessary logic or operations, and return a response, all without the need for developers to provision or manage underlying servers.\n\nAt the heart of serverless APIs is the concept of serverless computing, where developers focus solely on writing code to implement business logic, without concerning themselves with server provisioning, scaling, or maintenance. This allows for greater agility and faster time-to-market for API-based applications.\n\nDevelopers define the API endpoints and the corresponding logic or functionality using functions or microservices, which are then deployed to the serverless platform. The platform handles the execution of these functions in response to incoming requests.\n\nAdditionally, serverless APIs often integrate seamlessly with other cloud services, such as authentication and authorization services, databases, and event-driven architectures, enabling developers to build complex, scalable, and resilient applications with minimal operational overhead.\n\nMost cloud serverless implementations have a single region where your code is executed. This means any request, from anywhere in the world, must traverse the Internet to get to this single location. All responses to the API request must also be sent back over the same Internet route to the user.\n\n![Figure 1: Traditional single-region architecture](https://developers.cloudflare.com/_astro/single-region.DcjMitxL_5wqgn.webp)\n\nCloudflare follows a different, global-first approach. Globally-deployed architectures enable lower latency and high availability for users accessing the API from different parts of the world. In order to realize performance gains, not only the compute needs to be distributed, but ideally the data as well. Different solutions such as a caching as well as global replication can enable this.\n\n![Figure 2: Region Earth](https://developers.cloudflare.com/_astro/region-earth.DPRpgTD0_8RfCc.webp)\n\nOverall, serverless globally-deployed APIs offer a cost-effective, scalable, and agile approach to building modern applications and services, allowing organizations to focus on delivering value to their users without being encumbered by the complexities of managing infrastructure.\n\n## Serverless global APIs\n\n![Figure 3: Serverless global APIs](https://developers.cloudflare.com/_astro/serverless-global-apis.BnHHhP-u_Z2oGmWd.svg)\n\nThis is an example architecture of a serverless API on Cloudflare and aims to illustrate how different compute and data products could interact with each other.\n\n1. **Client request**: Send request to API endpoint.\n2. **API Shield/Router**: Process incoming request using [Workers](https://developers.cloudflare.com/workers/), check for validity, and perform authentication logic, if needed. Then, forward the (potentially transformed and/or enriched) API call to individual [Workers](https://developers.cloudflare.com/workers) using [Service Bindings](https://developers.cloudflare.com/workers/runtime-apis/bindings/service-bindings/). This allows for a separation of concerns.\n3. **Read-heavy data**: Read from [KV](https://developers.cloudflare.com/kv/) to serve read-heavy, non-dynamic data. This could include configuration data or product information. Perform writes as needed keeping [limits](https://developers.cloudflare.com/kv/platform/limits/) in mind.\n4. **Relational data**: Query [D1](https://developers.cloudflare.com/d1/) to handle relational-data. This could include user data, product data or other data.\n5. **External data**: Query external databases using [Hyperdrive](https://developers.cloudflare.com/hyperdrive/). Leverage caching to improve performance where applicable. This can be especially helpful when a data migration is out of scope of the implementation.\n\n* [Workers: Get started](https://developers.cloudflare.com/workers/get-started/guide/)\n* [Queues: Get started](https://developers.cloudflare.com/queues/get-started/)\n* [R2: Get started](https://developers.cloudflare.com/r2/get-started/)\n\n<page>\n---\ntitle: Serverless image content management · Cloudflare Reference Architecture docs\ndescription: Leverage various components of Cloudflare's ecosystem to construct\n  a scalable image management solution\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/serverless/serverless-image-content-management/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/serverless/serverless-image-content-management/index.md\n---\n\nIn this reference architecture diagram, we reveal how to leverage various components of Cloudflare’s ecosystem to construct a scalable image management solution. This solution integrates moderation principles via Cloudflare's Workers AI platform and performs image classification through inference at the edge. The storage of images is handled by Cloudflare's R2 product, an S3 API-like object storage system, while metadata is stored in a key/value store to enable content augmentation.\n\nThe servicing of images to requesting clients is secured by link signature, resizing based on device type or requested transformations and leveraging Cloudflare’s native security and performance features.\n\n![Figure 1: Serverless image content management](https://developers.cloudflare.com/_astro/diagram.DEMTm7TJ_Z29E9sM.svg)\n\n### Products included in the recipe\n\n| Product | Function |\n| - | - |\n| [DDoS](https://www.cloudflare.com/application-services/products/bot-management/) | Volumetric attack protection |\n| [Bot Management](https://www.cloudflare.com/ddos/) | Protection against scraping and general sophisticated automated abuse |\n| [Web Application Firewall](https://www.cloudflare.com/application-services/products/waf/) | Protection against web threats |\n| [CDN](https://www.cloudflare.com/application-services/products/cdn/) | Cache spreading of the images |\n| [Optimization](https://www.cloudflare.com/application-services/products/website-optimization/) | Compression and acceleration of the image delivery |\n| [Workers](https://workers.cloudflare.com/) | Compute of the several serverless micro services |\n| [AI](https://ai.cloudflare.com/) | Image classification |\n| [R2](https://www.cloudflare.com/developer-platform/r2/) | S3-type object-storage platform |\n| [KV](https://developers.cloudflare.com/kv/) | Image metadata storage |\n\nThis reference architecture diagram reveals how to harness the power of the Cloudflare platform to construct a fully serverless image and content management system. This implementation leverages various components of the Cloudflare stack, including edge compute with Cloudflare Workers, KV, and R2 object storage; application performance optimization and caching; application security features such as rate limiting and DDoS mitigation; and artificial intelligence with Workers AI.\n\nThe ultimate goal is to create a scalable and accessible platform for storing and serving images globally. This reference architecture will walk you through the key features and mechanisms that you can use with Cloudflare’s native capabilities as well as those that can be built with Cloudflare’s robust computing capabilities.\n\n### 1. Image servicing\n\nClients request images with [HMAC signatures](https://developers.cloudflare.com/workers/examples/signing-requests/) and any necessary transformations. Transformation parameters can be included in the [src-set](https://developers.cloudflare.com/images/transform-images/make-responsive-images/#srcset-for-high-dpi-displays) for HTML content or directly sent alongside [HTTP requests](https://developers.cloudflare.com/images/transform-images/transform-via-url/).\n\n### 2. Volumetric protection\n\nCloudflare's Application Security stack takes a comprehensive approach to shielding the image servicing from malicious activities. By implementing volumetric protection [rate limiting controls](https://developers.cloudflare.com/waf/rate-limiting-rules/), we effectively mitigate the risk of abuse and [DDoS](https://developers.cloudflare.com/ddos-protection/) attacks, ensuring uninterrupted service delivery.\n\n### 3. Signature validation\n\nA [Cloudflare worker](https://developers.cloudflare.com/workers/) function validates [incoming signatures](https://developers.cloudflare.com/workers/examples/signing-requests/) to ensure the authenticity and integrity of requests. This security measure helps prevent content evasion and abuse of the service by verifying that the signature accompanying the request is legitimate. The application responsible for generating content and associated signatures can also set expiration dates for links, further guarding against tampering or man-in-the-middle attacks. HMAC (Hash-based Message Authentication Code) is commonly used as the signature mechanism of choice for this purpose.\n\n### 4. Image optimization and caching\n\nImages are retrieved from [cache](https://developers.cloudflare.com/cache/) when available or stored on the server for the first time and delivered to clients upon request. We optimize image delivery by serving the most suitable format for each device, such as [WebP or AVIF](https://developers.cloudflare.com/images/polish/), while also applying compression to reduce file size. This ensures a smooth and seamless visual experience for users.\n\n### 4. Image transformations\n\nCloudflare's [image resizing](https://developers.cloudflare.com/images/) feature will resize the original images requested for transformation, completing the process entirely at the edge from any of our global locations. This fast and efficient process offers a wide range of transformation options.\n\n### 5. Content moderation and storage\n\nA [Cloudflare Worker](https://developers.cloudflare.com/workers/) script meticulously analyzes incoming images, leveraging their [classification metadata](https://developers.cloudflare.com/workers-ai/models/) to ensure compliance with established policy of use. [Cloudflare R2](https://developers.cloudflare.com/r2/) serves as an S3-like object storage solution, storing images and their associated metadata (such as image classification) in a globally accessible and scalable manner. With lightning-fast delivery capabilities and the ability to scale from 0, Cloudflare R2 is an ideal solution for storing and managing large collections of images.\n\n### 6. Image classification\n\nWith [Cloudflare AI](https://ai.cloudflare.com/) at its core, our [image classification](https://developers.cloudflare.com/workers-ai/models/) inference model will rapidly inspect each incoming image, classifying them in real-time. This cutting-edge technology allows us to streamline the process of moderating content, significantly reducing the need for a dedicated team to sift through and review every submission.\n\n<page>\n---\ntitle: Control and data plane architectural pattern for Durable Objects ·\n  Cloudflare Reference Architecture docs\ndescription: Separate the control plane from the data plane of your application\n  to achieve great performance and reliability without compromising on\n  functionality.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/storage/durable-object-control-data-plane-pattern/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/storage/durable-object-control-data-plane-pattern/index.md\n---\n\n[Durable Objects](https://developers.cloudflare.com/durable-objects/) are built on-top of [Cloudflare Workers](https://developers.cloudflare.com/workers/) spanning several locations across our global infrastructure network. Each Durable Object instance has its own durable storage persisted across requests, in-memory state, single-threaded execution, and can be placed in a specific region.\n\nA single Durable Object instance has certain [performance and storage capabilities](https://developers.cloudflare.com/durable-objects/platform/limits/). Therefore, to scale an application without being restricted by the limits of a single instance we need to shard our application data as much as possible, and take advantage of the [Cloudflare infrastructure](https://www.cloudflare.com/en-gb/network/) by spreading our Durable Object instances across the world, moving both the data and compute as close to the users as possible.\n\nThis document describes a useful architectural pattern to separate the control plane from the data plane of your application to achieve great performance and reliability without compromising on functionality.\n\n* The **control plane** provides the administrative APIs used to manage resource metadata. For example, a user creating and deleting a wiki, or listing all wikis of a user.\n* The **data plane** provides the primary function of the application and handles the operations on the resources data directly. For example, fetching and updating the content of a wiki, or updating the content of a collaborative document. Data planes are intentionally less complicated and usually handle a much larger volume of requests.\n* The **management plane** is an optional component of a system providing a higher level of interaction than the control plane to simplify configuration and operations. In this document, we will not focus on this as the same principles apply as to the control plane.\n\n## Control and data plane separation pattern\n\nIn this pattern, our application consists of at least one Durable Object instance per resource type handling all its control plane operations, and as many Durable Object instances as we need for the data plane operations, one for each resource instance created in the application.\n\nYou can scale to millions of Durable Object instances, one for each of your resources.\n\nThe main advantage of this architectural pattern is that our data plane operations, usually with larger volume of requests than control plane operations, are handled directly by the Durable Object instances holding the resource data without going through the control plane Durable Object instance. Therefore, the application's performance and availability is not limited by a single Durable Object instance, but is shared across thousands or millions of Durable Objects.\n\nConsider an example for a generic resource type `XYZ`, where `XYZ` could in-practice be a wiki, a collaborative document, a database for each user, or any other resource type in your application.\n\n![Figure 1: Control and data plane architectural pattern for Durable Objects](https://developers.cloudflare.com/_astro/diagram.BjLddBSp_2rcUEy.svg)\n\n1. A user in London (LHR) initiates a resource `XYZ` creation request. The request is routed to the nearest Cloudflare datacenter and received by the Workers fleet which serves the application API.\n2. The Worker code will route the request to the appropriate control plane Durable Object instance managing the resources of type `XYZ`. We will use the `idFromName` approach to reference the Durable Object instance by name (`control-plane-xyz`). This allows immediate access to the control plane Durable Object instances without needing to maintain a mapping.\n   * The location of the control plane Durable Object will be close to the first request accessing it, or to the explicit region we provide using [Location Hints](https://developers.cloudflare.com/durable-objects/reference/data-location/#provide-a-location-hint).\n3. The control plane Durable Object instance (`control-plane-xyz`) receives the request, and immediately creates another Durable Object instance (`data-plane-xyz-03`) near the user request's location (using Location Hints) so that the actual Durable Object instance holding the resource's content is near the user that created it. - We call a custom `init(...)` function on the created Durable Object instance (`data-plane-xyz-03`) passing any required metadata info that will be needed to start handling user requests. The Durable Object instance stores this information in its local storage and performs any necessary initialisation. This step can be skipped if each subsequent request to the created resource contains all the information needed to handle the request. For example, if the request URL contains all the information as path and query parameters. - We use the [`idFromName`](https://developers.cloudflare.com/durable-objects/api/namespace/#idfromname) approach to reference the Durable Object (`data-plane-xyz-03`) which allows the use of name-based resource identifiers. - Alternatively, we can use the [`newUniqueId`](https://developers.cloudflare.com/durable-objects/api/namespace/#newuniqueid) approach to reference the Durable Object which will give us a random resource identifier to use instead of a name-based one. This random identifier will need to be communicated back to the user so that they provide it in their subsequent requests when accessing the resource.\n4. The control plane Durable Object instance (`control-plane-xyz`) stores the generated identifier (`data-plane-xyz-03`) to its local storage, in order to be able to list/delete all created resources, and then returns it to the Worker.\n5. The user receives a successful response for the creation of the resource and the corresponding identifier, and (optionally) gets redirected to the resource itself.\n6. The user sends a write request to the API for the resource identifier returned in the previous step, in order to update the content of the resource.\n7. The Worker code uses the resource identifier provided to directly reference the data plane Durable Object instance for that resource (`data-plane-xyz-03`). The Durable Object instance will handle the request appropriately by writing the content to its local durable persistent storage and return a response accordingly.\n8. Another user from Portland (PDX) is sending a read request to a previously created resource (`data-plane-xyz-01`).\n9. The Worker code directly references the Durable Object instance holding the data for the given resource identifier (`data-plane-xyz-01`), and the Durable Object instance will return its content by reading its local storage.\n\nAs long as the application data model allows sharding at the resource level, you can scale out as much as you want, while taking advantage of data locality near the user that accesses that resource.\n\nThe same pattern can be applied as many times as necessary to achieve the performance required.\n\nFor example, depending on our load, we could further shard our control plane Durable Object into several Durable Objects. Instead of having a single Durable Object instance for all resources of type `XYZ`, we could have one for each region. The name-based approach to reference a Durable Object instance simplifies targeting the appropriate instance accordingly.\n\nIn conclusion, as long as you find a way to shard your application's data model in fine-grained resources that are self-contained, you are able to dedicate at least one Durable Object instance to each resource and scale out.\n\n* [Durable Objects Namespace documentation](https://developers.cloudflare.com/durable-objects/api/namespace/)\n\n* [Durable Objects: Easy, Fast, Correct — Choose three](https://blog.cloudflare.com/durable-objects-easy-fast-correct-choose-three/)\n\n* [Zero-latency SQLite storage in every Durable Object](https://blog.cloudflare.com/sqlite-in-durable-objects/)\n\n* [Data, Control, Management: Three Planes, Different Altitudes](https://thenewstack.io/data-control-management-three-planes-different-altitudes/)\n\n* Examples of this architectural pattern in real-world applications:\n\n* [Durable Objects aren't just durable, they're fast: a 10x speedup for Cloudflare Queues](https://blog.cloudflare.com/how-we-built-cloudflare-queues/)\n  * [Building a global TiddlyWiki hosting platform with Cloudflare Durable Objects and Workers — Tiddlyflare](https://www.lambrospetrou.com/articles/tiddlyflare/)\n\n<page>\n---\ntitle: Egress-free object storage in multi-cloud setups · Cloudflare Reference\n  Architecture docs\ndescription: Learn how to use R2 to get egress-free object storage in multi-cloud setups.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/storage/egress-free-storage-multi-cloud/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/storage/egress-free-storage-multi-cloud/index.md\n---\n\nObject storage is a modern data storage approach that stores data as objects rather than in a hierarchical structure like traditional file systems, making object storage highly scalable and flexible for managing vast amounts of data across diverse applications and environments.\n\nOftentimes organizations leverage multiple cloud providers to distribute their workloads across different platforms, mitigating risks associated with vendor lock-in, enhancing resilience, and optimizing performance and cost. However, managing data across multiple clouds introduces challenges related to data mobility and interoperability, particularly when it comes to transferring data between cloud providers or on-premises environments.\n\nEgress fees are charges incurred when data is transferred out of a cloud provider's network, either to another cloud provider, on-premises infrastructure, or external services. These fees can vary depending on factors such as the volume of data transferred, the destination of the data, and the network bandwidth utilized.\n\n[R2](https://developers.cloudflare.com/r2/) offers an enticing value proposition by not charging the costly egress bandwidth fees associated with typical cloud storage services. This can be very advantageous in the context of multi-cloud environments, especially when you want to run compute-intensive workloads such as AI model training, query engines, and other data science tools.\n\n## R2 multi-cloud setup\n\n![Figure 1: R2 multi-cloud setup](https://developers.cloudflare.com/_astro/r2-multi-cloud.jB-KW29c_Z1vAE78.svg)\n\n1. **Worker and R2 interaction**: Use R2's [Workers API](https://developers.cloudflare.com/r2/api/workers/workers-api-reference/) to interact with R2 from a Worker. Alternatively, for improved portability, use R2's [S3 API](https://developers.cloudflare.com/r2/api/s3/) from a Worker. No R2 egress fees apply.\n2. **External service and R2 interaction**: Use R2's [S3 API](https://developers.cloudflare.com/r2/api/s3/) to interact with R2 from external services. No R2 egress fees apply.\n\n* [R2: Get started](https://developers.cloudflare.com/r2/get-started)\n* [R2: S3 API](https://developers.cloudflare.com/r2/api/s3/)\n* [R2: Workers API](https://developers.cloudflare.com/r2/api/workers/)\n* [R2: Configure aws4fetch for R2](https://developers.cloudflare.com/r2/examples/aws/aws4fetch/)\n\n<page>\n---\ntitle: Event notifications for storage · Cloudflare Reference Architecture docs\ndescription: Use Cloudflare Workers or an external service to monitor for\n  notifications about data changes and then handle them appropriately.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/storage/event-notifications-for-storage/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/storage/event-notifications-for-storage/index.md\n---\n\nCloudflare [R2](https://developers.cloudflare.com/r2/) Storage allows developers to store large amounts of unstructured data without the costly egress bandwidth fees associated with typical cloud storage services. The lifecycle of data in object storage often extends beyond uploading, modifying, or deleting the data. There may be a requirement to transform, analyze, or perform post-processing on the data. R2 provides [event notifications](https://developers.cloudflare.com/r2/buckets/event-notifications/) to manage these event-driven workflows.\n\nThis document walks through how to use our built in serverless [Cloudflare Workers](https://developers.cloudflare.com/workers/) or an external service to monitor for notifications about data changes and then handle them appropriately.\n\n## Push-based consumer Worker\n\nEvent notifications function by sending messages to a [queue](https://developers.cloudflare.com/queues/) whenever there is a change to your data. These messages are then handled by a [consumer Worker](https://developers.cloudflare.com/queues/reference/how-queues-works/#consumers). A consumer Worker is the term for a client that is subscribing to or consuming messages from a queue. The consumer Worker will automatically receive these messages, allowing you to define any subsequent actions that need to be taken.\n\nFor instance, you can configure a notification to trigger when new images are uploaded to your R2 bucket. This notification can then automatically start an AI workload that performs an action on the image, such as converting the image to text.\n\nConsider the example below of push-based post-processing: when a user uploads a new object into R2, we want to log and store that event into a separate R2 bucket. You can create this scenario yourself by following this tutorial: [Log and store upload events in R2 with event notifications](https://developers.cloudflare.com/r2/tutorials/upload-logs-event-notifications/).\n\n![Figure 1: Push-Based R2 Event Notifications](https://developers.cloudflare.com/_astro/pushed-based-event-notification.NdMYExDK_1ERAd2.svg)\n\n1. A user uploads a new object directly to R2.\n2. An event notification is sent to the queue.\n3. The consumer Worker is pushed the new work from the queue.\n4. The Worker inserts a log event into R2.\n\n## Pull-based HTTP consumer\n\nAlternatively, you can establish a [pull-based consumer](https://developers.cloudflare.com/queues/configuration/pull-consumers/), where you pull from a queue over HTTP from any environment. Use a pull-based consumer if you need to consume messages from existing infrastructure outside of Cloudflare where you need to carefully control how fast messages are consumed.\n\nA pull-based consumer must explicitly make a call to pull (and then acknowledge) messages from the queue, only when it is ready to do so.\n\nConsider the scenario below: A user initiates a delete from R2. An external service needs to be informed of the deletion, so a pull-based queue has been established for the external service to retrieve notifications.\n\n![Figure 2: Pull-Based R2 Event Notifications](https://developers.cloudflare.com/_astro/pull-based-event-notification.KnQPn3ra_ZQAQKQ.svg)\n\n1. A user initiates a delete from R2.\n2. An event notification is sent to the queue.\n3. The external service, when ready to process the request, makes an HTTP POST request to the queue to pull the message.\n4. The queue sends the message in response to the POST request from step 3.\n5. The external service must acknowledge that the message has been received.\n\nYou can follow the steps here to [configure a pull-based consumer](https://developers.cloudflare.com/queues/configuration/pull-consumers/#1-enable-http-pull).\n\n## Additional example use cases\n\n* Send an email to an administrator any time objects are deleted from R2.\n* When a video or podcast is uploaded to R2, it automatically processes the content using one of Cloudflare's Automatic Speech Recognition (ASR) AI models to generate subtitles or even translate the content.\n* Remove related database entries if an object in R2 is deleted.\n\n* [Tutorial: Log and store upload events in R2 with event notifications](https://developers.cloudflare.com/r2/tutorials/upload-logs-event-notifications/)\n* [Event Notifications documentation](https://developers.cloudflare.com/r2/buckets/event-notifications/)\n* [Cloudflare R2 overview](https://developers.cloudflare.com/r2/)\n* [Cloudflare Queues overview](https://developers.cloudflare.com/queues/)\n* [Cloudflare Queues Pull Consumers](https://developers.cloudflare.com/queues/configuration/pull-consumers/)\n\n<page>\n---\ntitle: On-demand Object Storage Data Migration · Cloudflare Reference\n  Architecture docs\ndescription: Use Cloudflare migration tools to migrate data between cloud object\n  storage providers.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/storage/on-demand-object-storage-migration/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/storage/on-demand-object-storage-migration/index.md\n---\n\nMigrating data between cloud object storage providers can be challenging and expensive. You need to ensure no objects are missed, especially when new data is coming in during your migration. Additionally, there may be a significant one-time data transfer fee to consider.\n\nIn order to address these challenges, Cloudflare has created two migration tools: [Sippy](https://developers.cloudflare.com/r2/data-migration/sippy/) and [Super Slurper](https://developers.cloudflare.com/r2/data-migration/super-slurper/). Sippy is an on-demand data migration service, and it is the primary focus of this reference architecture diagram. On the other hand, Super Slurper is designed for large-scale, one-time migrations to Cloudflare's global object storage service, [R2](https://developers.cloudflare.com/r2/). Moving all your data at once may not work for your scenario, so Sippy can help with that.\n\nSippy enables you to transfer data from other cloud providers to Cloudflare R2 as the data is requested. This workflow is ideal for situations where you want to avoid large upfront data transfer bills and selectively migrate data as it's accessed.\n\nMigration-specific egress fees incurred when using other vendors cloud storage are reduced by leveraging requests within the flow of your application where you would already be paying egress fees to copy objects to R2 simultaneously.\n\nUse Sippy to migrate your commonly accessed data objects and immediately start saving on egress fees. Then, use Super Sluper to migrate any remaining data.\n\nHere's how Sippy works: it will first attempt to retrieve an object from R2 storage. If the object is not in R2, it will retrieve the object from your source cloud object storage. At the same time, it will add the object to R2 for future access, ensuring a seamless and efficient data migration process.\n\n## On-demand Object Storage Data Migration with Sippy\n\n![Figure 1: R2 On-demand Object Storage Data Migration with Sippy](https://developers.cloudflare.com/_astro/sippy-migration-diagram.CTGKS9AD_iSwjW.svg)\n\n1. The client requests an object from R2 using[ Workers](https://developers.cloudflare.com/r2/api/workers/),[ S3 API](https://developers.cloudflare.com/r2/api/s3/), or[ public bucket](https://developers.cloudflare.com/r2/buckets/public-buckets/).\n2. If the object is found in your R2 bucket it is served to the client.\n3. If the object is not found in R2, the object will simultaneously be returned from your source storage bucket and copied to R2. Note: Some large objects may take multiple requests to copy to R2 because they are copied over as multipart uploads. From the client’s perspective they will still get the file they are requesting.\n\nAfter objects are copied, subsequent requests will be served from R2 and you’ll begin saving on egress fees immediately.\n\n* [Sippy Documentation](https://developers.cloudflare.com/r2/data-migration/sippy/)\n* [Super Slurper Documentation](https://developers.cloudflare.com/r2/data-migration/super-slurper/)\n\n<page>\n---\ntitle: Storing user generated content · Cloudflare Reference Architecture docs\ndescription: Store user-generated content in R2 for fast, secure, and\n  cost-effective architecture.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/diagrams/storage/storing-user-generated-content/\n  md: https://developers.cloudflare.com/reference-architecture/diagrams/storage/storing-user-generated-content/index.md\n---\n\nUser generated content (UGC) is an essential aspect of modern applications. This includes users uploading profile photos, documents, and videos, as well as AI models generating images, summaries, or structured data. Therefore, applications require a reliable, scalable, and cost-effective solution for storing and accessing this content.\n\nCloudflare [R2](https://developers.cloudflare.com/r2/) is an S3-compatible object storage with zero egress fees, making it ideal for handling content uploads and delivery at scale. Combined with Cloudflare [Workers](https://developers.cloudflare.com/workers/) and Cloudflare's global network, it enables fast, secure, and cost-effective workflows for ingesting and managing UGC.\n\nThis reference architecture explores two common UGC workflows, both optimized for performance, security, and cost efficiency:\n\n1. **Secure User Uploads to R2 via Signed URLs:** Allowing users to upload files (profile images, documents, etc.) efficiently and securely without overloading backend systems.\n2. **AI-Generated Content Stored in R2:** Storing content generated by Workers AI or external AI services, ensuring inference results are persistently available for future use.\n\n### Use Case 1: Secure User Uploads to R2 via Signed URLs\n\nUser generated content typically starts with file uploads, including profile pictures, resumes, rich media, and documents. Applications must securely validate and store these uploads while avoiding latency, high costs, and unnecessary complexity in the backend.\n\nIn this architecture, we use **R2** as the primary storage layer and a **Worker** to control upload access. Files are uploaded directly from the user's browser or device to R2 using signed URLs, which are generated by the Worker after validating the user's permissions and upload intent.\n\nThis approach avoids routing large files through the application backend or Worker, reducing latency and operational cost—while ensuring tight control over access and security.\n\nAnd because R2 is natively integrated with Cloudflare's global network, files stored in R2 are accessible with low latency from anywhere in the world—and **without any egress fees**, even as your application scales.\n\n![Use Case 1: Secure User Uploads to R2 via Signed URLs](https://developers.cloudflare.com/_astro/uploads-to-r2-via-signed-urls.ko_gZGAm_Z2QBKt.svg)\n\n1. **User initiates upload from the frontend:** The app collects file details (e.g. size, name) and calls a backend API (a Cloudflare Worker) to begin the upload process.\n\n2. **Worker authenticates the user and validates the request:** The Worker confirms that the user is logged in, has upload permissions, and that the file is within acceptable limits (for example, 10MB max, allowed MIME types).\n\n3. **Worker returns a signed PUT URL to R2:** A signed URL allows the frontend to upload directly to R2 for a limited time, under a specific key or namespace. There is no need for the Worker to handle large files directly.\n\n4. **Frontend uploads the file directly to R2:** The file is streamed directly from the client to R2.\n\n5. **(Optional) Trigger post-upload workflows:** R2 offers [event notifications](https://developers.cloudflare.com/r2/buckets/event-notifications/) to send messages to a queue when data in your R2 bucket changes, like a new upload. Example post-processing:\n\n* Scan, moderate, or transform the file.\n   * Write metadata (for example, `user_id`, `file_path`, `timestamp`) to [D1](https://developers.cloudflare.com/d1/), Cloudflare's serverless SQL database.\n   * Notify the user or update a dashboard/UI.\n\nFor more information on uploading data directly from the client to R2, refer to the documentation on [presigned URLs](https://developers.cloudflare.com/r2/api/s3/presigned-urls/).\n\n### Use Case 2: AI-Generated Content Stored in R2\n\nMany modern applications utilize AI-generated content, which can include product descriptions, profile pictures, audio clips, and more. When this content is created in response to user actions or scheduled events, it must be stored immediately, reliably, and at scale.\n\nThis architecture employs [Workers AI](https://developers.cloudflare.com/workers-ai/) to perform inference at the edge and then stores the generated output directly in Cloudflare R2, all within a single Worker.\n\n![Use Case 2: AI-Generated Content Stored in R2](https://developers.cloudflare.com/_astro/ai-generated-content-in-r2.KciiXeXA_Z2QBKt.svg)\n\n1. **User initiates content generation:** The frontend sends a request to a Cloudflare Worker to create content using an AI model (for example, \"Create a thumbnail image for this product\").\n2. **Worker invokes Workers AI:** The Worker passes the user input to a model deployed on Workers AI.\n3. **Generated output is returned to the Worker:** The response could be plain text, a Base64 image, a binary buffer, or other structured data—depending on the model type.\n4. **Worker uploads the output to R2 directly:** No signed URL or client upload is needed. The Worker performs a secure, authenticated `PUT` request to store the output in a designated bucket.\n5. **Worker returns success and metadata to the frontend:** The client receives a reference to the stored file (such as a path, object key, or signed download URL if needed).\n\nRefer to [Use R2 from Workers](https://developers.cloudflare.com/r2/api/workers/workers-api-usage/) for more information on accessing R2 buckets via Cloudflare Workers.\n\nBy storing **user-generated content in Cloudflare R2**, applications gain:\n\n* A highly scalable storage backend\n* Fast access through Cloudflare's edge computing\n* Predictable costs with zero egress fees\n* Seamless AI + UGC workflows that maximize efficiency\n\nThis architecture ensures that content is stored, processed, and delivered **fast, securely, and cost-effectively**.\n\n* [Cloudflare R2 Product Page](https://developers.cloudflare.com/r2/)\n* [R2 Presigned URLs](https://developers.cloudflare.com/r2/api/s3/presigned-urls/)\n* [Use R2 from Workers](https://developers.cloudflare.com/r2/api/workers/workers-api-usage/)\n* [Migrating Data to R2](https://developers.cloudflare.com/r2/data-migration/)\n* [Event notifications for storage reference architecture](https://developers.cloudflare.com/reference-architecture/diagrams/storage/event-notifications-for-storage/)\n* [Why choose Cloudflare R2 vs Amazon S3](https://www.cloudflare.com/pg-cloudflare-r2-vs-aws-s3/)\n\n<page>\n---\ntitle: Use mTLS with Cloudflare protected resources · Cloudflare Reference\n  Architecture docs\nlastUpdated: 2025-01-31T09:20:50.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/implementation-guides/application-security/mtls/\n  md: https://developers.cloudflare.com/reference-architecture/implementation-guides/application-security/mtls/index.md\n---\n\n<page>\n---\ntitle: Holistic AI Security with Cloudflare One · Cloudflare Reference\n  Architecture docs\nlastUpdated: 2025-08-26T10:01:18.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/implementation-guides/zero-trust/holistic-ai-security/\n  md: https://developers.cloudflare.com/reference-architecture/implementation-guides/zero-trust/holistic-ai-security/index.md\n---\n\n<page>\n---\ntitle: Replace your VPN · Cloudflare Reference Architecture docs\nlastUpdated: 2025-01-31T09:20:50.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/implementation-guides/zero-trust/replace-vpn/\n  md: https://developers.cloudflare.com/reference-architecture/implementation-guides/zero-trust/replace-vpn/index.md\n---\n\n<page>\n---\ntitle: Secure your Internet traffic and SaaS apps · Cloudflare Reference\n  Architecture docs\nlastUpdated: 2025-01-31T09:20:50.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/implementation-guides/zero-trust/secure-internet-traffic/\n  md: https://developers.cloudflare.com/reference-architecture/implementation-guides/zero-trust/secure-internet-traffic/index.md\n---\n\n<page>\n---\ntitle: Secure Microsoft 365 email · Cloudflare Reference Architecture docs\nlastUpdated: 2025-01-31T09:20:50.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/implementation-guides/zero-trust/secure-m365-email/\n  md: https://developers.cloudflare.com/reference-architecture/implementation-guides/zero-trust/secure-m365-email/index.md\n---\n\n<page>\n---\ntitle: Deploy clientless access · Cloudflare Reference Architecture docs\nlastUpdated: 2025-04-10T21:16:58.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/reference-architecture/implementation-guides/zero-trust/ztna-web-access/\n  md: https://developers.cloudflare.com/reference-architecture/implementation-guides/zero-trust/ztna-web-access/index.md\n---\n\n<page>\n---\ntitle: Route /images to an S3 Bucket using Terraform · Cloudflare Rules docs\ndescription: Route requests with a URI path starting with `/images` to a\n  specific AWS S3 bucket with Cloud Connector using Terraform.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/cloud-connector/examples/route-images-to-aws-s3-using-terraform/\n  md: https://developers.cloudflare.com/rules/cloud-connector/examples/route-images-to-aws-s3-using-terraform/index.md\n---\n\nTerraform code snippets below refer to the v4 SDK only.\n\nThe following example defines a single Cloud Connector rule for a zone using Terraform. The rule routes requests to `/images` on your domain to an AWS S3 bucket.\n\n## Additional resources\n\nFor additional guidance on using Terraform with Cloudflare, refer to the following resources:\n\n* [Terraform documentation](https://developers.cloudflare.com/terraform/)\n* [Cloudflare Provider for Terraform](https://registry.terraform.io/providers/cloudflare/cloudflare/latest/docs) (reference documentation)\n\n<page>\n---\ntitle: Route /images to an S3 Bucket · Cloudflare Rules docs\ndescription: Route requests with a URI path starting with `/images` to a\n  specific AWS S3 bucket using Cloud Connector.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/cloud-connector/examples/route-images-to-s3/\n  md: https://developers.cloudflare.com/rules/cloud-connector/examples/route-images-to-s3/index.md\n---\n\nTo route requests to `/images` on your domain to an AWS S3 bucket:\n\n1. In the Cloudflare dashboard, go to the **Cloud Connector** page.\n\n[Go to **Cloud Connector**](https://dash.cloudflare.com/?to=/:account/:zone/rules/cloud-connector)\n\n2. Select **Amazon S3** as your [cloud provider](https://developers.cloudflare.com/rules/cloud-connector/providers/).\n\n3. Enter the bucket URL. You can structure the URL in two ways:\n\n* **Subdomain-style URL**: Set the hostname to `<BUCKET_NAME>.s3.amazonaws.com`. In this case, your files should be organized in the root of the bucket, meaning the URI path will map directly to the file. For example, `https://<YOUR_HOSTNAME>/images/file.jpg` will map to `https://<BUCKET_NAME>.s3.amazonaws.com/images/file.jpg`.\n   * **URI path-style URL**: Set the hostname to `s3.amazonaws.com`. Here, your bucket must include a folder named `images`, and files should be placed inside this folder. The URI path will then include the bucket name, like `https://<YOUR_HOSTNAME>/<BUCKET_NAME>/images/file.jpg` mapping to `https://s3.amazonaws.com/<BUCKET_NAME>/images/file.jpg`.\n\n4. (Optional) Use [URL Rewrite Rules](https://developers.cloudflare.com/rules/transform/url-rewrite/) to adjust the URL structure. For example, you can [create a URL rewrite](https://developers.cloudflare.com/rules/transform/url-rewrite/create-dashboard/) that changes `/images` to `/<BUCKET_NAME>/images` to match the URI path-style URL structure.\n\n5. (Optional) Use [Cache Rules](https://developers.cloudflare.com/cache/how-to/cache-rules/) to adjust the caching behavior for objects returned from the bucket. For example, you can [create a cache rule](https://developers.cloudflare.com/cache/how-to/cache-rules/create-dashboard/) that caches every returned object matching the `/images/*` URI path for seven days:\n\n* **If incoming requests match** > Custom filter expression: `(starts_with(http.request.uri.path, \"/images/\"))`\n   * **Cache eligibility**: Eligible for cache\n     * **Edge TTL** > Ignore cache-control header and use this TTL: *7 days*\n\n6. Select **Next** and enter a descriptive name like `Route images to S3` in **Cloud Connector name**.\n\n7. Under **If**, select **Custom filter expression** and enter the following expression:\\\n   `http.request.full_uri wildcard \"http*://<YOUR_HOSTNAME>/images/*\"`\\\n   Replace `<YOUR_HOSTNAME>` with desired hostname.\n\n8. Select **Deploy** to activate the rule.\n\nThis setup will route all traffic matching `http*://<YOUR_HOSTNAME>/images/*` (HTTPS and HTTP requests) to your S3 bucket. Make sure to replace `<YOUR_HOSTNAME>` with your actual hostname and adjust the example paths according to your setup.\n\n<page>\n---\ntitle: Send EU visitors to a Google Cloud Storage bucket · Cloudflare Rules docs\ndescription: Route all traffic from EU visitors to a Google Cloud Storage bucket\n  using Cloud Connector.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/cloud-connector/examples/send-eu-visitors-to-gcs/\n  md: https://developers.cloudflare.com/rules/cloud-connector/examples/send-eu-visitors-to-gcs/index.md\n---\n\nTo route requests from visitors in the European Union to a Google Cloud Storage bucket:\n\n1. In the Cloudflare dashboard, go to the **Cloud Connector** page.\n\n[Go to **Cloud Connector**](https://dash.cloudflare.com/?to=/:account/:zone/rules/cloud-connector)\n\n2. Select **Google Cloud Storage** as your [cloud provider](https://developers.cloudflare.com/rules/cloud-connector/providers/).\n\n3. Enter the bucket URL. You can structure the URL in two ways:\n\n* **Subdomain-style URL**: For `<BUCKET_NAME>.storage.googleapis.com`, your files should be organized in the root of the bucket. For example, `https://<YOUR_HOSTNAME>/index.html` will map to `https://<BUCKET_NAME>.storage.googleapis.com/index.html`.\n   * **URI path-style URL**: If you set the hostname to `storage.googleapis.com`, your bucket must include folders corresponding to the intended URI paths. For example, if you want `https://<YOUR_HOSTNAME>/eu/index.html` to map to a file in your bucket, the file should be placed at `https://storage.googleapis.com/<BUCKET_NAME>/eu/index.html`.\n\n4. (Optional) Use [URL Rewrite Rules](https://developers.cloudflare.com/rules/transform/url-rewrite/) to adjust the URL structure. For example, you can [create a URL rewrite](https://developers.cloudflare.com/rules/transform/url-rewrite/create-dashboard/) that changes `/eu` to `/<BUCKET_NAME>` to match the URI path-style URL structure.\n\n5. (Optional) Use [Cache Rules](https://developers.cloudflare.com/cache/how-to/cache-rules/) to adjust the caching behavior for objects returned from the bucket. For example, you can [create a cache rule](https://developers.cloudflare.com/cache/how-to/cache-rules/create-dashboard/) that caches every returned object matching the `/eu` URI path for seven days (defined through the **Edge TTL** setting).\n\n6. Select **Next** and enter a descriptive name like `Route EU visitors to GCP` in **Cloud Connector name**.\n\n7. Under **If**, select **Custom filter expression** and enter the following expression: `(ip.src.is_in_european_union)`\\\n   This expression targets traffic from European Union users.\n\n8. Select **Deploy** to activate the rule.\n\nThis configuration will route traffic from EU visitors to your Google Cloud Storage bucket. Make sure to replace `<YOUR_HOSTNAME>` with your actual hostname and adjust the example paths according to your setup.\n\n<page>\n---\ntitle: Serve /static-assets from Azure Blob Storage · Cloudflare Rules docs\ndescription: Route requests with a URI path starting with `/static-assets` to an\n  Azure Blob Storage container using Cloud Connector.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/cloud-connector/examples/serve-static-assets-from-azure/\n  md: https://developers.cloudflare.com/rules/cloud-connector/examples/serve-static-assets-from-azure/index.md\n---\n\nTo serve static assets from an Azure Blob Storage container:\n\n1. In the Cloudflare dashboard, go to the **Cloud Connector** page.\n\n[Go to **Cloud Connector**](https://dash.cloudflare.com/?to=/:account/:zone/rules/cloud-connector)\n\n2. Select **Microsoft Azure** as your [cloud provider](https://developers.cloudflare.com/rules/cloud-connector/providers/).\n\n3. Enter the bucket URL. Use the following URL structure:\n\n* **Subdomain-style URL**: Set the hostname to `<BUCKET_NAME>.blob.core.windows.net`. In this case, your bucket should include a folder named `static-assets`, and files should be placed inside this folder. For example, `https://<YOUR_HOSTNAME>/static-assets/style.css` will map to `https://<BUCKET_NAME>.blob.core.windows.net/static-assets/style.css`.\n\n4. (Optional) Use [URL Rewrite Rules](https://developers.cloudflare.com/rules/transform/url-rewrite/) to adjust the URL structure. For example, you can [create a URL rewrite](https://developers.cloudflare.com/rules/transform/url-rewrite/create-dashboard/) that changes `/static-assets` to `/my-pages-project/static-assets` to match the file structure of your object storage bucket.\n\n5. (Optional) Use [Cache Rules](https://developers.cloudflare.com/cache/how-to/cache-rules/) to adjust the caching behavior for objects returned from the bucket. For example, you can [create a cache rule](https://developers.cloudflare.com/cache/how-to/cache-rules/create-dashboard/) that caches every returned object matching the `/static-assets` URI path for seven days (defined through the **Edge TTL** setting).\n\n6. Click **Next** and enter a descriptive name like `Serve static assets from Azure` in **Cloud Connector name**.\n\n7. Under **If**, select **Custom filter expression** and enter the following expression: `http.request.full_uri wildcard \"http*://<YOUR_HOSTNAME>/static-assets/*\"`\n\n8. Select **Deploy** to activate the rule.\n\nThis setup ensures that all traffic matching `http*://<YOUR_HOSTNAME>/static-assets/*` (HTTPS and HTTP requests) is served from your Azure Blob Storage container. Make sure to replace `<YOUR_HOSTNAME>` with your actual hostname and adjust the example paths according to your setup.\n\n<page>\n---\ntitle: Define a single configuration rule using Terraform · Cloudflare Rules docs\ndescription: Create a configuration rule using Terraform to turn off Email\n  Obfuscation and Browser Integrity Check for API requests in a given zone.\nlastUpdated: 2025-10-13T13:40:40.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/rules/configuration-rules/examples/define-single-configuration-terraform/\n  md: https://developers.cloudflare.com/rules/configuration-rules/examples/define-single-configuration-terraform/index.md\n---\n\nTerraform code snippets below refer to the v4 SDK only.\n\nThe following example defines a single configuration rule for a zone using Terraform. The rule disables Email Obfuscation and Browser Integrity Check for API requests.",
  "code_samples": [
    {
      "code": "AWS VPC: 192.0.2.0/24\nGCP VPC: 198.51.100.0/24\nAzure vNet: 203.0.113.0/26\nOn-premise data center 1: 203.0.113.64/26\nOn-premise data center 2: 203.0.113.128/25",
      "language": "txt"
    },
    {
      "code": "AWS VPC: 192.0.2.0/28\nGCP VPC: 192.0.2.16/28\nAzure vNet: 192.0.2.32/28\nOn-premise data center 1: 192.0.2.48/28\nOn-premise data center 2: 192.0.2.64/28",
      "language": "txt"
    },
    {
      "code": "AWS VPC: 192.0.2.0/28\nGCP VPC: 192.0.2.16/28\nAzure vNet: 192.0.2.32/28\nOn-premise data center 1: 198.51.100.0/24\nOn-premise data center 2: 203.0.113.0/24",
      "language": "txt"
    },
    {
      "code": "AWS VPC: 192.0.2.0/24\nGCP VPC: 198.51.100.0/24\nAzure vNet: 203.0.113.0/26\nOn-premises data center 1: 203.0.113.64/26\nOn-premises data center 2: 203.0.113.128/25",
      "language": "plaintext"
    },
    {
      "code": "flowchart TB\n  User((User/Client)) --> |1.SNI = keyless.example.com| CF[Cloudflare Edge Network]\n\n  subgraph CF [Cloudflare Edge]\n      KeylessSSL[Keyless SSL Service]\n  end\n\n  subgraph Private[Private Infrastructure]\n      Tunnel[Cloudflare Tunnel]\n      HSM[Hardware Security Module]\n  \t\tKeylessModule[Keyless Module]\n  end\n\n  Tunnel -->|2.Establish tunnel| KeylessSSL\n  KeylessSSL -->|3.Keyless operation required| Tunnel\n  Tunnel -->|4.Forward to HSM| KeylessModule\n  KeylessModule -->|5.Key Operations via PKCS11| HSM\n\n  classDef cloudflare fill:#F6821F,stroke:#fff,stroke-width:2px,color:#fff\n  classDef aws fill:#232F3E,stroke:#fff,stroke-width:2px,color:#fff\n  classDef default fill:#fff,stroke:#000,stroke-width:2px, color:#000\n\n  class CF,KeylessSSL,Tunnel,KeylessModule cloudflare\n  class HSM aws\n  class User default",
      "language": "mermaid"
    },
    {
      "code": "",
      "language": "plaintext"
    },
    {
      "code": "{\n  \"aud\": [\"264063895705477af73bfbaed1bf401981f4812eefcdb9fea33f5e10e666e282\"],\n  \"email\": \"john.doe@cloudflare.com\",\n  \"exp\": 1728551137,\n  \"iat\": 1728464737,\n  \"nbf\": 1728464737,\n  \"iss\": \"https://myorg.cloudflareaccess.com\",\n  \"type\": \"app\",\n  \"identity_nonce\": \"IA0hPRvwILtbUXSQ\",\n  \"sub\": \"ce40d564-c72f-475f-a9b8-f395f19ad986\",\n  \"device_id\": \"8469d7c4-83a9-11ee-b559-76e6e80876db\",\n  \"country\": \"FR\"\n}",
      "language": "json"
    },
    {
      "code": "{\n  \"id\": \"P51Tuu01fWHMBjIBvrCK1lK-eUDWs2aQMv03WDqT5oY\",\n  \"name\": \"John Doe\",\n  \"email\": \"john.doe@cloudflare.com\",\n  \"amr\": [\n    \"pwd\"\n  ],\n  \"oidc_fields\": {\n    \"principalName\": \"john.doe_cloudflare.com#EXT#@XXXXXXcloudflare.onmicrosoft.com\"\n  },\n  \"groups\": [\n    {\n      \"id\": \"fdaedb59-e9be-4ab7-8001-3e069da54185\",\n      \"name\": \"Security Team\"\n    }\n  ],\n  \"idp\": {\n    \"id\": \"b9f4d68e-dac1-48b0-b728-ae05a5f0d4b2\",\n    \"type\": \"azureAD\"\n  },\n  \"geo\": {\n    \"country\": \"FR\"\n  },\n  \"user_uuid\": \"ce40d564-c72f-475f-a9b8-f395f19ad986\",\n  \"account_id\": \"121287a0c6e6260ec930655e6b39a3a8\",\n  \"iat\": 1724056537,\n  \"devicePosture\": {\n    \"f6f9391e-6776-4878-9c60-0cc807dc7dc8\": {\n      \"id\": \"f6f9391e-6776-4878-9c60-0cc807dc7dc8\",\n      \"schedule\": \"5m\",\n      \"timestamp\": \"2024-08-19T08:31:59.274Z\",\n      \"description\": \"\",\n      \"type\": \"disk_encryption\",\n      \"check\": {\n        \"drives\": {\n          \"C\": {\n            \"encrypted\": true\n          }\n        }\n      },\n      \"success\": false,\n      \"rule_name\": \"Disk Encryption - Windows\",\n      \"input\": {\n        \"requireAll\": true,\n        \"checkDisks\": []\n    },\n    \"a0a8e83d-be75-4aa6-bfa0-5791da6e9186\": {\n      \"id\": \"a0a8e83d-be75-4aa6-bfa0-5791da6e9186\",\n      \"schedule\": \"5m\",\n      \"timestamp\": \"2024-08-19T08:31:59.274Z\",\n      \"description\": \"\",\n      \"type\": \"firewall\",\n      \"check\": {\n        \"firewall\": false\n      },\n      \"success\": false,\n      \"rule_name\": \"Local Firewall Check - Windows\",\n      \"input\": {\n        \"enabled\": true\n      }\n    }\n    ...\n  }",
      "language": "json"
    },
    {
      "code": "resource \"cloudflare_cloud_connector_rules\" \"serve_images_in_aws\" {\n  zone_id = \"<ZONE_ID>\"\n  rules {\n    description = \"Route images to AWS S3 bucket\"\n    enabled     = true\n    expression  = \"http.request.full_uri wildcard \\\"https://<YOUR_HOSTNAME>/images/*\\\"\"\n    provider    = \"aws_s3\"\n    parameters {\n      host = \"<BUCKET_NAME>.s3.amazonaws.com\"\n    }\n  }\n}",
      "language": "tf"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Protect inbound traffic to public-facing networks",
      "id": "protect-inbound-traffic-to-public-facing-networks"
    },
    {
      "level": "h2",
      "text": "Protect Internet access from public-facing networks",
      "id": "protect-internet-access-from-public-facing-networks"
    },
    {
      "level": "h2",
      "text": "Protect site-to-site, inter-data center, private network traffic",
      "id": "protect-site-to-site,-inter-data-center,-private-network-traffic"
    },
    {
      "level": "h2",
      "text": "Protect outbound Internet traffic from private networks",
      "id": "protect-outbound-internet-traffic-from-private-networks"
    },
    {
      "level": "h2",
      "text": "Related Resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Scenario 1 - Customer BYOIP for both on-premise and cloud network deployments",
      "id": "scenario-1---customer-byoip-for-both-on-premise-and-cloud-network-deployments"
    },
    {
      "level": "h2",
      "text": "Scenario 2 - Customer lease IP address from Cloudflare for both on-premise and cloud network deployments",
      "id": "scenario-2---customer-lease-ip-address-from-cloudflare-for-both-on-premise-and-cloud-network-deployments"
    },
    {
      "level": "h2",
      "text": "Scenario 3 - Customer BYOIP for on-premise networks and lease IP address from Cloudflare for cloud network deployments",
      "id": "scenario-3---customer-byoip-for-on-premise-networks-and-lease-ip-address-from-cloudflare-for-cloud-network-deployments"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Protect inbound network traffic",
      "id": "protect-inbound-network-traffic"
    },
    {
      "level": "h2",
      "text": "Protect outbound network traffic",
      "id": "protect-outbound-network-traffic"
    },
    {
      "level": "h2",
      "text": "Related Resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Protecting service provider networks from attack",
      "id": "protecting-service-provider-networks-from-attack"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "FIPS 140-3 levels",
      "id": "fips-140-3-levels"
    },
    {
      "level": "h2",
      "text": "Key components",
      "id": "key-components"
    },
    {
      "level": "h2",
      "text": "Architecture overview",
      "id": "architecture-overview"
    },
    {
      "level": "h2",
      "text": "Further reading",
      "id": "further-reading"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Protecting data with Cloudflare CASB",
      "id": "protecting-data-with-cloudflare-casb"
    },
    {
      "level": "h2",
      "text": "Securing user access to data at rest",
      "id": "securing-user-access-to-data-at-rest"
    },
    {
      "level": "h2",
      "text": "Discovering and protecting the data at rest",
      "id": "discovering-and-protecting-the-data-at-rest"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Securing network connectivity",
      "id": "securing-network-connectivity"
    },
    {
      "level": "h2",
      "text": "Inspecting traffic with Cloudflare DLP",
      "id": "inspecting-traffic-with-cloudflare-dlp"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Protecting data in use with Cloudflare RBI",
      "id": "protecting-data-in-use-with-cloudflare-rbi"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Showcased products",
      "id": "showcased-products"
    },
    {
      "level": "h2",
      "text": "Use-cases",
      "id": "use-cases"
    },
    {
      "level": "h2",
      "text": "Getting started",
      "id": "getting-started"
    },
    {
      "level": "h3",
      "text": "1. Custom authorization process using your own rules",
      "id": "1.-custom-authorization-process-using-your-own-rules"
    },
    {
      "level": "h3",
      "text": "2. Analyze and validate the authentication material (JWT)",
      "id": "2.-analyze-and-validate-the-authentication-material-(jwt)"
    },
    {
      "level": "h3",
      "text": "3. Augment the authentication material (JWT) with extra authentication details",
      "id": "3.-augment-the-authentication-material-(jwt)-with-extra-authentication-details"
    },
    {
      "level": "h2",
      "text": "Related Resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Bi-directional VoIP traffic flow",
      "id": "bi-directional-voip-traffic-flow"
    },
    {
      "level": "h2",
      "text": "Call flow examples",
      "id": "call-flow-examples"
    },
    {
      "level": "h3",
      "text": "Remote user calling another remote user",
      "id": "remote-user-calling-another-remote-user"
    },
    {
      "level": "h3",
      "text": "Remote user to on-premise user",
      "id": "remote-user-to-on-premise-user"
    },
    {
      "level": "h2",
      "text": "Summary",
      "id": "summary"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Solution",
      "id": "solution"
    },
    {
      "level": "h2",
      "text": "Additional offerings based on DNS filtering capabilities",
      "id": "additional-offerings-based-on-dns-filtering-capabilities"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Solution",
      "id": "solution"
    },
    {
      "level": "h3",
      "text": "Office or site based users",
      "id": "office-or-site-based-users"
    },
    {
      "level": "h3",
      "text": "Remote users",
      "id": "remote-users"
    },
    {
      "level": "h3",
      "text": "Additional controls",
      "id": "additional-controls"
    },
    {
      "level": "h3",
      "text": "Visibility",
      "id": "visibility"
    },
    {
      "level": "h2",
      "text": "Additional capabilities",
      "id": "additional-capabilities"
    },
    {
      "level": "h3",
      "text": "Threat protection",
      "id": "threat-protection"
    },
    {
      "level": "h3",
      "text": "Data protection",
      "id": "data-protection"
    },
    {
      "level": "h2",
      "text": "Adopting Cloudflare Gateway as Secure Web Gateway",
      "id": "adopting-cloudflare-gateway-as-secure-web-gateway"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Deployment locations",
      "id": "deployment-locations"
    },
    {
      "level": "h2",
      "text": "High availability",
      "id": "high-availability"
    },
    {
      "level": "h3",
      "text": "Uplink HA",
      "id": "uplink-ha"
    },
    {
      "level": "h3",
      "text": "Full HA",
      "id": "full-ha"
    },
    {
      "level": "h2",
      "text": "Advanced use cases",
      "id": "advanced-use-cases"
    },
    {
      "level": "h3",
      "text": "Protecting local Internet breakout (LIBO)",
      "id": "protecting-local-internet-breakout-(libo)"
    },
    {
      "level": "h3",
      "text": "Split tunneling",
      "id": "split-tunneling"
    },
    {
      "level": "h3",
      "text": "Protecting segments / segmentation",
      "id": "protecting-segments-/-segmentation"
    },
    {
      "level": "h2",
      "text": "Related Resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Accessing private applications",
      "id": "accessing-private-applications"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Is SaaS not already secure?",
      "id": "is-saas-not-already-secure?"
    },
    {
      "level": "h2",
      "text": "Securing access with Cloudflare",
      "id": "securing-access-with-cloudflare"
    },
    {
      "level": "h2",
      "text": "Example policy",
      "id": "example-policy"
    },
    {
      "level": "h2",
      "text": "Related Resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h3",
      "text": "Who is this document for and what will you learn?",
      "id": "who-is-this-document-for-and-what-will-you-learn?"
    },
    {
      "level": "h2",
      "text": "Replacing Your VDI",
      "id": "replacing-your-vdi"
    },
    {
      "level": "h2",
      "text": "Securing Your VDI",
      "id": "securing-your-vdi"
    },
    {
      "level": "h3",
      "text": "Securing access to your VDI using Zero Trust policies",
      "id": "securing-access-to-your-vdi-using-zero-trust-policies"
    },
    {
      "level": "h3",
      "text": "Securing traffic from your VDI using secure web gateway policies",
      "id": "securing-traffic-from-your-vdi-using-secure-web-gateway-policies"
    },
    {
      "level": "h2",
      "text": "Summary",
      "id": "summary"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "A/B testing using Workers",
      "id": "a/b-testing-using-workers"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Fullstack application diagram",
      "id": "fullstack-application-diagram"
    },
    {
      "level": "h3",
      "text": "1. Client",
      "id": "1.-client"
    },
    {
      "level": "h3",
      "text": "2. Security",
      "id": "2.-security"
    },
    {
      "level": "h3",
      "text": "3. Performance",
      "id": "3.-performance"
    },
    {
      "level": "h3",
      "text": "4. Compute",
      "id": "4.-compute"
    },
    {
      "level": "h3",
      "text": "5. Data & Storage",
      "id": "5.-data-&-storage"
    },
    {
      "level": "h3",
      "text": "6. Realtime content & Media",
      "id": "6.-realtime-content-&-media"
    },
    {
      "level": "h3",
      "text": "7. AI",
      "id": "7.-ai"
    },
    {
      "level": "h3",
      "text": "8. Orchestration & Abstraction",
      "id": "8.-orchestration-&-abstraction"
    },
    {
      "level": "h3",
      "text": "9. Cloudflare Observability",
      "id": "9.-cloudflare-observability"
    },
    {
      "level": "h3",
      "text": "10. External Logs & Analytics",
      "id": "10.-external-logs-&-analytics"
    },
    {
      "level": "h3",
      "text": "11. Tooling & Provisioning",
      "id": "11.-tooling-&-provisioning"
    },
    {
      "level": "h3",
      "text": "12. External Service Integrations",
      "id": "12.-external-service-integrations"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Core Architecture Components",
      "id": "core-architecture-components"
    },
    {
      "level": "h2",
      "text": "Main Request Flow",
      "id": "main-request-flow"
    },
    {
      "level": "h2",
      "text": "Invocation & Metadata Flow",
      "id": "invocation-&-metadata-flow"
    },
    {
      "level": "h2",
      "text": "Egress Control Pattern",
      "id": "egress-control-pattern"
    },
    {
      "level": "h2",
      "text": "Metrics & Logging Architecture",
      "id": "metrics-&-logging-architecture"
    },
    {
      "level": "h2",
      "text": "Resource Isolation Model",
      "id": "resource-isolation-model"
    },
    {
      "level": "h2",
      "text": "Deployment & Management Flow",
      "id": "deployment-&-management-flow"
    },
    {
      "level": "h2",
      "text": "Conclusion",
      "id": "conclusion"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "ETL pipeline with HTTP-based ingest",
      "id": "etl-pipeline-with-http-based-ingest"
    },
    {
      "level": "h2",
      "text": "ETL pipeline with object storage ingest",
      "id": "etl-pipeline-with-object-storage-ingest"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Serverless global APIs",
      "id": "serverless-global-apis"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h3",
      "text": "Products included in the recipe",
      "id": "products-included-in-the-recipe"
    },
    {
      "level": "h2",
      "text": "Getting started",
      "id": "getting-started"
    },
    {
      "level": "h3",
      "text": "1. Image servicing",
      "id": "1.-image-servicing"
    },
    {
      "level": "h3",
      "text": "2. Volumetric protection",
      "id": "2.-volumetric-protection"
    },
    {
      "level": "h3",
      "text": "3. Signature validation",
      "id": "3.-signature-validation"
    },
    {
      "level": "h3",
      "text": "4. Image optimization and caching",
      "id": "4.-image-optimization-and-caching"
    },
    {
      "level": "h3",
      "text": "4. Image transformations",
      "id": "4.-image-transformations"
    },
    {
      "level": "h3",
      "text": "5. Content moderation and storage",
      "id": "5.-content-moderation-and-storage"
    },
    {
      "level": "h3",
      "text": "6. Image classification",
      "id": "6.-image-classification"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Control and data plane separation pattern",
      "id": "control-and-data-plane-separation-pattern"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "R2 multi-cloud setup",
      "id": "r2-multi-cloud-setup"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Push-based consumer Worker",
      "id": "push-based-consumer-worker"
    },
    {
      "level": "h2",
      "text": "Pull-based HTTP consumer",
      "id": "pull-based-http-consumer"
    },
    {
      "level": "h2",
      "text": "Additional example use cases",
      "id": "additional-example-use-cases"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "On-demand Object Storage Data Migration with Sippy",
      "id": "on-demand-object-storage-data-migration-with-sippy"
    },
    {
      "level": "h2",
      "text": "Related Resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "Introduction",
      "id": "introduction"
    },
    {
      "level": "h2",
      "text": "Use Cases",
      "id": "use-cases"
    },
    {
      "level": "h3",
      "text": "Use Case 1: Secure User Uploads to R2 via Signed URLs",
      "id": "use-case-1:-secure-user-uploads-to-r2-via-signed-urls"
    },
    {
      "level": "h3",
      "text": "Use Case 2: AI-Generated Content Stored in R2",
      "id": "use-case-2:-ai-generated-content-stored-in-r2"
    },
    {
      "level": "h2",
      "text": "Summary",
      "id": "summary"
    },
    {
      "level": "h2",
      "text": "Related Links",
      "id": "related-links"
    },
    {
      "level": "h2",
      "text": "Additional resources",
      "id": "additional-resources"
    }
  ],
  "url": "llms-txt#related-resources",
  "links": []
}