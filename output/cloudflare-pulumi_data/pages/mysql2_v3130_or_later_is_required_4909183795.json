{
  "title": "mysql2 v3.13.0 or later is required",
  "content": "npm i drizzle-orm mysql2 dotenv\nnpm i -D drizzle-kit tsx @types/node\njsonc\n  {\n    \"$schema\": \"./node_modules/wrangler/config-schema.json\",\n    \"compatibility_flags\": [\n      \"nodejs_compat\"\n    ],\n    \"compatibility_date\": \"2024-09-23\",\n    \"hyperdrive\": [\n      {\n        \"binding\": \"HYPERDRIVE\",\n        \"id\": \"<your-hyperdrive-id-here>\"\n      }\n    ]\n  }\n  toml\n  # required for database drivers to function\n  compatibility_flags = [\"nodejs_compat\"]\n  compatibility_date = \"2024-09-23\"\n\n[[hyperdrive]]\n  binding = \"HYPERDRIVE\"\n  id = \"<your-hyperdrive-id-here>\"\n  ts\n   // src/schema.ts\n   import { mysqlTable, int, varchar, timestamp } from \"drizzle-orm/mysql-core\";\n\nexport const users = mysqlTable(\"users\", {\n     id: int(\"id\").primaryKey().autoincrement(),\n     name: varchar(\"name\", { length: 255 }).notNull(),\n     email: varchar(\"email\", { length: 255 }).notNull().unique(),\n     createdAt: timestamp(\"created_at\").defaultNow(),\n   });\n   ts\n// src/index.ts\n\nimport { drizzle } from \"drizzle-orm/mysql2\";\nimport { createConnection } from \"mysql2\";\nimport { users } from \"./db/schema\";\n\nexport interface Env {\n  HYPERDRIVE: Hyperdrive;\n  }\n\nexport default {\n  async fetch(request, env, ctx): Promise<Response> {\n    // Create a connection using the mysql2 driver with the Hyperdrive credentials (only accessible from your Worker).\n    const connection = await createConnection({\n      host: env.HYPERDRIVE.host,\n      user: env.HYPERDRIVE.user,\n      password: env.HYPERDRIVE.password,\n      database: env.HYPERDRIVE.database,\n      port: env.HYPERDRIVE.port,\n\n// Required to enable mysql2 compatibility for Workers\n      disableEval: true,\n    });\n\n// Create the Drizzle client with the mysql2 driver connection\n    const db = drizzle(connection);\n\n// Sample query to get all users\n    const allUsers = await db.select().from(users);\n\nreturn Response.json(allUsers);\n  },\n} satisfies ExportedHandler<Env>;\ntoml\n   # .env\n   # Replace with your direct database connection string\n   DATABASE_URL='mysql://user:password@db-host.cloud/database-name'\n   ts\n   import 'dotenv/config';\n   import { defineConfig } from 'drizzle-kit';\n   export default defineConfig({\n   out: './drizzle',\n   schema: './src/db/schema.ts',\n   dialect: 'mysql',\n   dbCredentials: {\n   url: process.env.DATABASE_URL!,\n     },\n   });\n   bash\n   npx drizzle-kit generate\n   bash\n   No config path provided, using default 'drizzle.config.ts'\n   Reading config file 'drizzle.config.ts'\n   Reading schema files:\n   /src/db/schema.ts\n\n1 tables\n   users 4 columns 0 indexes 0 fks\n\n[âœ“] Your SQL migration file âžœ drizzle/0000_daffy_rhodey.sql ðŸš€\n   bash\n   npx drizzle-kit migrate\n   bash\n   No config path provided, using default 'drizzle.config.ts'\n   Reading config file 'drizzle.config.ts'\n   bash\nnpx wrangler deploy\nsh\n  npm i mysql\n  sh\n  yarn add mysql\n  sh\n  pnpm add mysql\n  jsonc\n  {\n    \"$schema\": \"./node_modules/wrangler/config-schema.json\",\n    \"compatibility_flags\": [\n      \"nodejs_compat\"\n    ],\n    \"compatibility_date\": \"2024-09-23\",\n    \"hyperdrive\": [\n      {\n        \"binding\": \"HYPERDRIVE\",\n        \"id\": \"<your-hyperdrive-id-here>\"\n      }\n    ]\n  }\n  toml\n  # required for database drivers to function\n  compatibility_flags = [\"nodejs_compat\"]\n  compatibility_date = \"2024-09-23\"\n\n[[hyperdrive]]\n  binding = \"HYPERDRIVE\"\n  id = \"<your-hyperdrive-id-here>\"\n  ts\nimport { createConnection } from \"mysql\";\n\nexport default {\n  async fetch(request, env, ctx): Promise<Response> {\n    const result = await new Promise<any>((resolve) => {\n      // Create a connection using the mysql driver with the Hyperdrive credentials (only accessible from your Worker).\n      const connection = createConnection({\n        host: env.HYPERDRIVE.host,\n        user: env.HYPERDRIVE.user,\n        password: env.HYPERDRIVE.password,\n        database: env.HYPERDRIVE.database,\n        port: env.HYPERDRIVE.port,\n      });\n\nconnection.connect((error: { message: string }) => {\n        if (error) {\n          throw new Error(error.message);\n        }\n\n// Sample query\n        connection.query(\"SHOW tables;\", [], (error, rows, fields) => {\n          connection.end();\n\nresolve({ fields, rows });\n        });\n      });\n    });\n\n// Return result  as JSON\n    return new Response(JSON.stringify(result), {\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n    });\n  },\n} satisfies ExportedHandler<Env>;\nsh\n  npm i mysql2@>3.13.0\n  sh\n  yarn add mysql2@>3.13.0\n  sh\n  pnpm add mysql2@>3.13.0\n  jsonc\n  {\n    \"$schema\": \"./node_modules/wrangler/config-schema.json\",\n    \"compatibility_flags\": [\n      \"nodejs_compat\"\n    ],\n    \"compatibility_date\": \"2024-09-23\",\n    \"hyperdrive\": [\n      {\n        \"binding\": \"HYPERDRIVE\",\n        \"id\": \"<your-hyperdrive-id-here>\"\n      }\n    ]\n  }\n  toml\n  # required for database drivers to function\n  compatibility_flags = [\"nodejs_compat\"]\n  compatibility_date = \"2024-09-23\"\n\n[[hyperdrive]]\n  binding = \"HYPERDRIVE\"\n  id = \"<your-hyperdrive-id-here>\"\n  ts\n// mysql2 v3.13.0 or later is required\nimport { createConnection } from \"mysql2/promise\";\n\nexport default {\n  async fetch(request, env, ctx): Promise<Response> {\n    // Create a connection using the mysql2 driver with the Hyperdrive credentials (only accessible from your Worker).\n    const connection = await createConnection({\n      host: env.HYPERDRIVE.host,\n      user: env.HYPERDRIVE.user,\n      password: env.HYPERDRIVE.password,\n      database: env.HYPERDRIVE.database,\n      port: env.HYPERDRIVE.port,\n\n// Required to enable mysql2 compatibility for Workers\n      disableEval: true,\n    });\n\ntry {\n      // Sample query\n      const [results, fields] = await connection.query(\"SHOW tables;\");\n\n// Clean up the client after the response is returned, before the Worker is killed\n      ctx.waitUntil(connection.end());\n\n// Return result rows as JSON\n      return Response.json({ results, fields });\n    } catch (e) {\n      console.error(e);\n    }\n  },\n} satisfies ExportedHandler<Env>;\nsh",
  "code_samples": [
    {
      "code": "Add the required Node.js compatibility flags and Hyperdrive binding to your `wrangler.jsonc` file:\n\n* wrangler.jsonc",
      "language": "unknown"
    },
    {
      "code": "* wrangler.toml",
      "language": "unknown"
    },
    {
      "code": "## 2. Configure Drizzle\n\n### 2.1. Define a schema\n\nWith Drizzle ORM, we define the schema in TypeScript rather than writing raw SQL.\n\n1. Create a folder `/db/` in `/src/`.\n\n2. Create a `schema.ts` file.\n\n3. In `schema.ts`, define a `users` table as shown below.",
      "language": "unknown"
    },
    {
      "code": "### 2.2. Connect Drizzle ORM to the database with Hyperdrive\n\nUse your the credentials of your Hyperdrive configuration for your database when using the Drizzle ORM.\n\nPopulate your `index.ts` file as shown below.",
      "language": "unknown"
    },
    {
      "code": "### 2.3. Configure Drizzle-Kit for migrations (optional)\n\nNote\n\nYou need to set up the tables in your database so that Drizzle ORM can make queries that work.\n\nIf you have already set it up (for example, if another user has applied the schema to your database), or if you are starting to use Drizzle ORM and the schema matches what already exists in your database, then you do not need to run the migration.\n\nYou can generate and run SQL migrations on your database based on your schema using Drizzle Kit CLI. Refer to [Drizzle ORM docs](https://orm.drizzle.team/docs/get-started/mysql-new) for additional guidance.\n\n1. Create a `.env` file in the root folder of your project, and add your database connection string. The Drizzle Kit CLI will use this connection string to create and apply the migrations.",
      "language": "unknown"
    },
    {
      "code": "2. Create a `drizzle.config.ts` file in the root folder of your project to configure Drizzle Kit and add the following content:",
      "language": "unknown"
    },
    {
      "code": "3. Generate the migration file for your database according to your schema files and apply the migrations to your database.",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "## 3. Deploy your Worker\n\nDeploy your Worker.",
      "language": "unknown"
    },
    {
      "code": "## Next steps\n\n* Learn more about [How Hyperdrive Works](https://developers.cloudflare.com/hyperdrive/concepts/how-hyperdrive-works/).\n* Refer to the [troubleshooting guide](https://developers.cloudflare.com/hyperdrive/observability/troubleshooting/) to debug common issues.\n* Understand more about other [storage options](https://developers.cloudflare.com/workers/platform/storage-options/) available to Cloudflare Workers.\n\n</page>\n\n<page>\n---\ntitle: mysql Â· Cloudflare Hyperdrive docs\ndescription: >-\n  The mysql package is a MySQL driver for Node.js.\n\n  This example demonstrates how to use it with Cloudflare Workers and\n  Hyperdrive.\nlastUpdated: 2025-05-12T14:16:48.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/hyperdrive/examples/connect-to-mysql/mysql-drivers-and-libraries/mysql/\n  md: https://developers.cloudflare.com/hyperdrive/examples/connect-to-mysql/mysql-drivers-and-libraries/mysql/index.md\n---\n\nThe [mysql](https://github.com/mysqljs/mysql) package is a MySQL driver for Node.js. This example demonstrates how to use it with Cloudflare Workers and Hyperdrive.\n\nInstall the [mysql](https://github.com/mysqljs/mysql) driver:\n\n* npm",
      "language": "unknown"
    },
    {
      "code": "* yarn",
      "language": "unknown"
    },
    {
      "code": "* pnpm",
      "language": "unknown"
    },
    {
      "code": "Add the required Node.js compatibility flags and Hyperdrive binding to your `wrangler.jsonc` file:\n\n* wrangler.jsonc",
      "language": "unknown"
    },
    {
      "code": "* wrangler.toml",
      "language": "unknown"
    },
    {
      "code": "Create a new connection and pass the Hyperdrive parameters:",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: mysql2 Â· Cloudflare Hyperdrive docs\ndescription: >-\n  The mysql2 package is a modern MySQL driver for Node.js with better\n  performance and built-in Promise support.\n\n  This example demonstrates how to use it with Cloudflare Workers and\n  Hyperdrive.\nlastUpdated: 2025-05-12T14:16:48.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/hyperdrive/examples/connect-to-mysql/mysql-drivers-and-libraries/mysql2/\n  md: https://developers.cloudflare.com/hyperdrive/examples/connect-to-mysql/mysql-drivers-and-libraries/mysql2/index.md\n---\n\nThe [mysql2](https://github.com/sidorares/node-mysql2) package is a modern MySQL driver for Node.js with better performance and built-in Promise support. This example demonstrates how to use it with Cloudflare Workers and Hyperdrive.\n\nInstall the [mysql2](https://github.com/sidorares/node-mysql2) driver:\n\n* npm",
      "language": "unknown"
    },
    {
      "code": "* yarn",
      "language": "unknown"
    },
    {
      "code": "* pnpm",
      "language": "unknown"
    },
    {
      "code": "Note\n\n`mysql2` v3.13.0 or later is required\n\nAdd the required Node.js compatibility flags and Hyperdrive binding to your `wrangler.jsonc` file:\n\n* wrangler.jsonc",
      "language": "unknown"
    },
    {
      "code": "* wrangler.toml",
      "language": "unknown"
    },
    {
      "code": "Create a new `connection` instance and pass the Hyperdrive parameters:",
      "language": "unknown"
    },
    {
      "code": "Note\n\nThe minimum version of `mysql2` required for Hyperdrive is `3.13.0`.\n\n</page>\n\n<page>\n---\ntitle: AWS RDS and Aurora Â· Cloudflare Hyperdrive docs\ndescription: Connect Hyperdrive to an AWS RDS or Aurora Postgres database instance.\nlastUpdated: 2025-08-20T20:59:04.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/hyperdrive/examples/connect-to-postgres/postgres-database-providers/aws-rds-aurora/\n  md: https://developers.cloudflare.com/hyperdrive/examples/connect-to-postgres/postgres-database-providers/aws-rds-aurora/index.md\n---\n\nThis example shows you how to connect Hyperdrive to an Amazon Relational Database Service (Amazon RDS) Postgres or Amazon Aurora database instance.\n\n## 1. Allow Hyperdrive access\n\nTo allow Hyperdrive to connect to your database, you will need to ensure that Hyperdrive has valid user credentials and network access.\n\nNote\n\nTo allow Hyperdrive to connect to your database, you must allow Cloudflare IPs to be able to access your database. You can either allow-list all IP address ranges (0.0.0.0 - 255.255.255.255) or restrict your IP access control list to the [IP ranges used by Hyperdrive](https://developers.cloudflare.com/hyperdrive/configuration/firewall-and-networking-configuration/).\n\nAlternatively, you can connect to your databases over in your private network using [Cloudflare Tunnels](https://developers.cloudflare.com/hyperdrive/configuration/connect-to-private-database/).\n\n### AWS Console\n\nWhen creating or modifying an instance in the AWS console:\n\n1. Configure a **DB cluster identifier** and other settings you wish to customize.\n2. Under **Settings** > **Credential settings**, note down the **Master username** and **Master password** (Aurora only).\n3. Under the **Connectivity** header, ensure **Public access** is set to **Yes**.\n4. Select an **Existing VPC security group** that allows public Internet access from `0.0.0.0/0` to the port your database instance is configured to listen on (default: `5432` for PostgreSQL instances).\n5. Select **Create database**.\n\nWarning\n\nYou must ensure that the [VPC security group](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-security-groups.html) associated with your database allows public IPv4 access to your database port.\n\nRefer to AWS' [database server rules](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules-reference.html#sg-rules-db-server) for details on how to configure rules specific to your RDS or Aurora database.\n\n### Retrieve the database endpoint (Aurora)\n\nTo retrieve the database endpoint (hostname) for Hyperdrive to connect to:\n\n1. Go to **Databases** view under **RDS** in the AWS console.\n2. Select the database you want Hyperdrive to connect to.\n3. Under the **Endpoints** header, note down the **Endpoint name** with the type `Writer` and the **Port**.\n\n### Retrieve the database endpoint (RDS PostgreSQL)\n\nFor regular RDS instances (non-Aurora), you will need to fetch the endpoint and port of the database:\n\n1. Go to **Databases** view under **RDS** in the AWS console.\n2. Select the database you want Hyperdrive to connect to.\n3. Under the **Connectivity & security** header, note down the **Endpoint** and the **Port**.\n\nThe endpoint will resemble `YOUR_DATABASE_NAME.cpuo5rlli58m.AWS_REGION.rds.amazonaws.com` and the port will default to `5432`.\n\n## 2. Create your user\n\nOnce your database is created, you will need to create a user for Hyperdrive to connect as. Although you can use the **Master username** configured during initial database creation, best practice is to create a less privileged user.\n\nTo create a new user, log in to the database and use the `CREATE ROLE` command:",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "2. Configure Drizzle",
      "id": "2.-configure-drizzle"
    },
    {
      "level": "h3",
      "text": "2.1. Define a schema",
      "id": "2.1.-define-a-schema"
    },
    {
      "level": "h3",
      "text": "2.2. Connect Drizzle ORM to the database with Hyperdrive",
      "id": "2.2.-connect-drizzle-orm-to-the-database-with-hyperdrive"
    },
    {
      "level": "h3",
      "text": "2.3. Configure Drizzle-Kit for migrations (optional)",
      "id": "2.3.-configure-drizzle-kit-for-migrations-(optional)"
    },
    {
      "level": "h2",
      "text": "3. Deploy your Worker",
      "id": "3.-deploy-your-worker"
    },
    {
      "level": "h2",
      "text": "Next steps",
      "id": "next-steps"
    },
    {
      "level": "h2",
      "text": "1. Allow Hyperdrive access",
      "id": "1.-allow-hyperdrive-access"
    },
    {
      "level": "h3",
      "text": "AWS Console",
      "id": "aws-console"
    },
    {
      "level": "h3",
      "text": "Retrieve the database endpoint (Aurora)",
      "id": "retrieve-the-database-endpoint-(aurora)"
    },
    {
      "level": "h3",
      "text": "Retrieve the database endpoint (RDS PostgreSQL)",
      "id": "retrieve-the-database-endpoint-(rds-postgresql)"
    },
    {
      "level": "h2",
      "text": "2. Create your user",
      "id": "2.-create-your-user"
    }
  ],
  "url": "llms-txt#mysql2-v3.13.0-or-later-is-required",
  "links": []
}