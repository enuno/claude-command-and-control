{
  "title": "cmu requestCertificate -c=\"US\" -o=\"Example, Inc.\" -cn=\"azure-dedicatedhsm.example.com\" -s=\"California\" -l=\"San Francisco\" -publichandle=48 -privatehandle=51 -outputfile=\"rsa.csr\" -sha256withrsa",
  "content": "Please enter password for token in slot 0 : ********\nUsing \"CKM_SHA256_RSA_PKCS\" Mechanism\nyaml\nprivate_key_stores:\n  - dir: /etc/keyless/keys\nyaml\n- uri: pkcs11:token=KeylessSSL;object=myrsakey?module-path=/usr/safenet/lunaclient/lib/libCryptoki2_64.so&pin-value=password&max-sessions=1\nsh\nsudo systemctl restart gokeyless.service\nsudo systemctl status gokeyless.service -l\nplaintext\nbrew install azure-cli\nsh\n   az login\n   az group create --name HSMgroup --location southcentralus\n   plaintext\n   az keyvault key import --hsm-name \"KeylessHSM\" --name \"hsm-pub-keyless\" --pem-file server.key\n   plaintext\n      az keyvault role assignment create  --hsm-name KeylessHSM --assignee $(az vm identity show --name \"hsmtestvm\" --resource-group \"HSMgroup\" --query principalId -o tsv) --scope / --role \"Managed HSM Crypto User\"\n      plaintext\nsudo systemctl restart gokeyless.service\nsudo systemctl status gokeyless.service -l\nsh\npkcs11-tool --module <module path> --list-token-slots\nbash\npkcs11-tool --module <module path> --pin <pin> \\\n    --list-token-slots --login --list-objects\ntxt\npkcs11:path-component[?query-component]\ntxt\nprivate_key_stores:\n- uri: pkcs11:token=SoftHSM2%20RSA%20Token;id=%03?module-path=/usr/lib64/libsofthsm2.so&pin-value=1234\n- uri: pkcs11:token=accelerator;object=thaleskey?module-path=/opt/nfast/toolkits/pkcs11/libcknfast.so\n- uri: pkcs11:token=YubiKey%20PIV;id=%00?module-path=/usr/lib64/libykcs11.so&pin-value=123456&max-sessions=1\n- uri: pkcs11:token=elab2parN;id=%04?module-path=/usr/lib/libCryptoki2_64.so&pin-value=crypto1\ntxt\npkcs11-tool --module /opt/nfast/toolkits/pkcs11/libcknfast.so -O\ntxt\nUsing slot 0 with a present token (0x1d622495)\nPrivate Key Object; RSA\n  label:      rsa-privkey\n  ID:         105013281578de42ea45f5bfac46d302fb006687\n  Usage:      decrypt, sign, unwrap\nwarning: PKCS11 function C_GetAttributeValue(ALWAYS_AUTHENTICATE) failed: rv = CKR_ATTRIBUTE_TYPE_INVALID (0x12)\n\nPublic Key Object; RSA 2048 bits\n  label:      rsa-privkey\n  ID:         105013281578de42ea45f5bfac46d302fb006687\n  Usage:      encrypt, verify, wrap\nyaml\nprivate_key_stores:\n  - dir: /etc/keyless/keys\nyaml\n- uri: pkcs11:token=accelerator;object=rsa-privkey?module-path=/opt/nfast/toolkits/pkcs11/libcknfast.so&max-sessions=4\nsh\nsudo systemctl restart gokeyless.service\nsudo systemctl status gokeyless.service -l\nsh\nsudo systemctl restart gokeyless.service\nsudo systemctl status gokeyless.service -l\ntxt\nvm$ ssh admin@hsm\n\n[cloudflare-hsm.softlayer.com] lunash:>partition create -partition KeylessSSL\n\nType 'proceed' to create the partition, or\n          'quit' to quit now.\n          > proceed\n'partition create' successful.\n\nCommand Result : 0 (Success)\nbash\n[cloudflare-hsm.softlayer.com] lunash:>client assignpartition -client cloudflare-vm.softlayer.com -partition KeylessSSL\n\n'client assignPartition' successful.\n\nCommand Result : 0 (Success)\ntxt\nvm$ lunacm\nLunaCM v7.1.0-379. Copyright (c) 2006-2017 SafeNet.\n\nSlot Id ->              0\n    Label ->\n    Serial Number ->        XXXXXXXXXXXXX\n    Model ->                LunaSA 7.0.0\n    Firmware Version ->     7.0.1\n    Configuration ->        Luna User Partition With SO (PW) Signing With Cloning Mode\n    Slot Description ->     Net Token Slot\n\nlunacm:>partition init -label KeylessSSL -domain cloudflare\n\nEnter password for Partition SO: ********\n\nRe-enter password for Partition SO: ********\n\nYou are about to initialize the partition.\n  All contents of the partition will be destroyed.\n\nAre you sure you wish to continue?\n\nType 'proceed' to continue, or 'quit' to quit now ->proceed\n\nCommand Result : No Error\ntxt\nvm$ cmu generatekeypair -keyType=RSA -modulusBits=2048 -publicExponent=65537 -sign=1 -verify=1 -labelpublic=myrsakey -labelprivate=myrsakey -keygenmech=1  -id=a000\nPlease enter password for token in slot 0 : ********",
  "code_samples": [
    {
      "code": "***\n\n## 3. Obtain and upload a signed certificate from your Certificate Authority (CA)\n\nProvide the CSR created in the previous step to your organization's preferred CA, demonstrate control of your domain as requested, and then download the signed SSL certificates. Follow the instructions provided in [Upload Keyless SSL Certificates](https://developers.cloudflare.com/ssl/keyless-ssl/configuration/cloudflare-tunnel/#3-upload-keyless-ssl-certificates).\n\n***\n\n## 4. Modify your gokeyless config file and restart the service\n\nLastly, we need to modify the configuration file that the key server will read on startup. Be sure to change the `object=mykey` and `pin-value=username:password` values to match the key label you provided and CU user you created.\n\nOpen `/etc/keyless/gokeyless.yaml` and immediately after:",
      "language": "unknown"
    },
    {
      "code": "add:",
      "language": "unknown"
    },
    {
      "code": "With the config file saved, restart `gokeyless` and verify it started successfully.",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Azure Managed HSM · Cloudflare SSL/TLS docs\ndescription: This tutorial uses Microsoft Azure’s Managed HSM to deploy a VM\n  with the Keyless SSL daemon. Follow these instructions to deploy your keyless\n  server.\nlastUpdated: 2025-10-09T15:47:46.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/azure-managed-hsm/\n  md: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/azure-managed-hsm/index.md\n---\n\nThis tutorial uses [Microsoft Azure’s Managed HSM](https://azure.microsoft.com/en-us/updates/akv-managed-hsm-public-preview/) — a FIPS 140-2 Level 3 certified implementation — to deploy a VM with the Keyless SSL daemon.\n\n***\n\n## Before you start\n\nMake sure you have:\n\n* Followed Microsoft's [tutorial](https://docs.microsoft.com/en-us/azure/key-vault/managed-hsm/quick-create-cli) for provisioning and activating the managed HSM\n* Set up a VM for your key server\n\n***\n\n## 1. Create a VM\n\nCreate a VM where you will deploy the keyless daemon.\n\n***\n\n## 2. Deploy the keyless server\n\nFollow [these instructions](https://developers.cloudflare.com/ssl/keyless-ssl/configuration/cloudflare-tunnel/#4-set-up-and-activate-key-server) to deploy your keyless server.\n\n***\n\n## 3. Set up the Azure CLI\n\nSet up the Azure CLI (used to access the private key).\n\nFor example, if you were using macOS:",
      "language": "unknown"
    },
    {
      "code": "***\n\n## 4. Set up the Managed HSM\n\n1. Log in through the Azure CLI and create a resource group for the Managed HSM in one of the supported regions:",
      "language": "unknown"
    },
    {
      "code": "Note\n\n   For a list of supported regions, see the [Microsoft documentation](https://azure.microsoft.com/en-us/global-infrastructure/services/?products=key-vault).\n\n2. [Create, provision, and activate](https://docs.microsoft.com/en-us/azure/key-vault/managed-hsm/quick-create-cli) the HSM.\n\n3. Add your private key to the `keyvault`, which returns the URI you need for **Step 4**:",
      "language": "unknown"
    },
    {
      "code": "4. If the key server is running in an Azure VM in the same account, use **Managed services** for authorization:\n\n   1. Enable managed services on the VM in the UI.\n\n   2. Give your service user (associated with your VM) HSM sign permissions",
      "language": "unknown"
    },
    {
      "code": "5. In the `gokeyless` YAML file, add the URI from **Step 2** under `private_key_stores`. See our [README](https://github.com/cloudflare/gokeyless/blob/master/README.md) for an example.\n\n## 5. Restart gokeyless\n\nOnce you save the config file, restart `gokeyless` and verify that it started successfully:",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Configuration · Cloudflare SSL/TLS docs\ndescription: \"To get started with your PKCS#11 token you will need to initialize\n  it with a private key, PIN, and token label. The instructions to do this will\n  be specific to each hardware device, and you should follow the instructions\n  provided by your vendor. You will also need to find the path to your module, a\n  shared object file (.so). Having initialized your device, you can query it to\n  check your token label with:\"\nlastUpdated: 2024-08-20T19:58:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/configuration/\n  md: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/configuration/index.md\n---\n\nImportant\n\nCarefully review the manufacturer documentation for your HSM and properly restrict access to the key server.\n\nTo get started with your PKCS#11 token you will need to initialize it with a private key, PIN, and token label. The instructions to do this will be specific to each hardware device, and you should follow the instructions provided by your vendor. You will also need to find the path to your `module`, a shared object file (`.so`). Having initialized your device, you can query it to check your token label with:",
      "language": "unknown"
    },
    {
      "code": "You will also want to check the label of the private key you imported (or generated). Run the following command and look for a `Private Key Object`:",
      "language": "unknown"
    },
    {
      "code": "You now have all the information you need to use your PKCS#11 token with the Keyless server, by adding to the `private_key_stores` section in the configuration file. You can specify the key pairs that you want Keyless to have access to in the [configuration file using the PKCS#11 URI](https://tools.ietf.org/html/rfc7512) format.\n\n## PKCS#11 URI\n\nA PKCS#11 URI is a sequence of attribute value pairs separated by a semicolon that form a one-level path component, optionally followed by a query. The general form represented is:",
      "language": "unknown"
    },
    {
      "code": "The URI path component contains attributes that identify a resource. The query component can contain a few attributes that may be needed to retrieve the resource identified by the URI path component. Attributes in the path component are delimited by the `;` character, and attributes in the query component use `&` as a delimiter. All attributes are URL-encoded.\n\nKeyless requires the following three attributes be specified:\n\n* **Module**: use `module-path` to locate the PKCS#11 module library.\n* **Token**: use `serial`, `slot-id`, or `token` to specify the PKCS#11 token.\n* **Slot**: use `id` or `object` to specify the PKCS#11 key pair.\n\nFor certain modules, a query attribute `max-sessions` is required in order to prevent opening too many sessions to the module. Certain additional attributes, such as `pin-value`, may be necessary depending on the situation. Refer to the documentation for your PKCS#11 module for more details.\n\n## Examples\n\nHere are some examples of PKCS#11 URIs for keys stored on various modules:",
      "language": "unknown"
    },
    {
      "code": "## Limitations\n\nFor now, only one PKCS#11 module can be used at a time, so if you have keys on multiple HSMs, we recommend [using p11-glue to consolidate access through one module](https://p11-glue.github.io/p11-glue/).\n\n</page>\n\n<page>\n---\ntitle: Entrust nShield Connect · Cloudflare SSL/TLS docs\ndescription: Learn how to use Keyless SSL with Entrust nShield Connect.\nlastUpdated: 2025-10-09T15:47:46.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/entrust-nshield-connect/\n  md: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/entrust-nshield-connect/index.md\n---\n\nNote\n\nThis example assumes you have already configured the nShield Connect device and generated or imported your private keys.\n\nSince the keys are already in place, we merely need to build the configuration file that the key server will read on startup. In this example the device contains a single RSA key pair.\n\nWe ask `pkcs11-tool` (provided by the `opensc` package) to display the objects stored in the token:",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "The key piece of information is the label of the object, `rsa-privkey`. Open up `/etc/keyless/gokeyless.yaml` and immediately after",
      "language": "unknown"
    },
    {
      "code": "add",
      "language": "unknown"
    },
    {
      "code": "Save the config file, restart `gokeyless`, and verify it started successfully.",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Fortanix Data Security Manager · Cloudflare SSL/TLS docs\ndescription: You can use Cloudflare Keyless SSL with Fortanix Data Security\n  Manager (DSM), a FIPS 140-2 Level 3 certified implementation.\nlastUpdated: 2025-05-06T14:59:24.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/fortanix-dsm/\n  md: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/fortanix-dsm/index.md\n---\n\nYou can use Cloudflare Keyless SSL with [Fortanix Data Security Manager (DSM)](https://www.fortanix.com/platform/data-security-manager), a FIPS 140-2 Level 3 certified implementation.\n\nYou must have a [Data Security Manager Enterprise Tier](https://www.fortanix.com/start-your-free-trial) and set up a group and an application assigned to the group.\n\nFor detailed guidance, follow the tutorial in the [Fortanix documentation](https://support.fortanix.com/docs/fortanix-data-security-manager-with-cloudflare-integration#50-configure-fortanix-dsm). This guide is based on the Keyless SSL [public DNS](https://developers.cloudflare.com/ssl/keyless-ssl/configuration/public-dns/) option and has been tested using a virtual machine (VM) deployed to Azure running Ubuntu 22.04.3 LTS.\n\n</page>\n\n<page>\n---\ntitle: Google Cloud HSM · Cloudflare SSL/TLS docs\ndescription: Learn how to use Keyless SSL with Google Cloud HSM.\nlastUpdated: 2025-10-09T15:47:46.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/google-cloud-hsm/\n  md: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/google-cloud-hsm/index.md\n---\n\nThis tutorial uses [Google Cloud HSM](https://cloud.google.com/kms/docs/hsm) — a FIPS 140-2 Level 3 certified implementation.\n\n***\n\n## Before you start\n\nMake sure that you have:\n\n* Set up your [Google Cloud project](https://cloud.google.com/kms/docs/quickstart#before-you-begin)\n\n***\n\n## 1. Create a key ring\n\nTo set up the Google Cloud HSM, [create a key ring](https://cloud.google.com/kms/docs/hsm#kms-create-key-hsm-web) and indicate its location.\n\nNote:\n\nOnly [certain locations](https://cloud.google.com/kms/docs/locations#hsm-regions) support Google Cloud HSM.\n\n***\n\n## 2. Create a key\n\nCreate a key, including the following information:\n\n| Field | Value |\n| - | - |\n| Key ring | The key ring you created in **Step 2** |\n| Protection level | HSM |\n| Purpose | Asymmetric Encrypt |\n\n***\n\n## 3. Import the private key\n\nAfter creating a key ring and key, [import the private key](https://cloud.google.com/kms/docs/importing-a-key).\n\nNote:\n\nYou need to [convert your key](https://cloud.google.com/kms/docs/formatting-keys-for-import#formatting_asymmetric_keys) from a PEM to DER format.\n\n***\n\n## 4. Modify your gokeyless config file and restart the service\n\nOnce you’ve imported the key, copy the **Resource name** from the UI. Then, add this value to the `gokeyless` YAML file under `private_key_stores`.\n\nWith the config file saved, restart `gokeyless` and verify it started successfully.",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: IBM Cloud HSM · Cloudflare SSL/TLS docs\ndescription: Learn how to use Keyless SSL with IBM Cloud HSM.\nlastUpdated: 2025-10-09T15:47:46.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/ibm-cloud-hsm/\n  md: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/ibm-cloud-hsm/index.md\n---\n\nThe example below was tested using [IBM Cloud HSM 7.0](https://console.bluemix.net/docs/infrastructure/hardware-security-modules/about.html#about-ibm-cloud-hsm), a FIPS 140-2 Level 3 certified implementation based on the Gemalto SafeNet Luna a750.\n\n***\n\n## Before you start\n\nMake sure that you have:\n\n* Initialized [your device](https://console.bluemix.net/docs/infrastructure/hardware-security-modules/initialize_hsm.html#initializing-the-ibm-cloud-hsm)\n* Installed the [SafeNet client software](https://cpl.thalesgroup.com/node/11350)\n\n***\n\n## 1. Create, assign, and initialize a new partition\n\nThe first step is creating an HSM partition, which can be thought of as an independent logical HSM within your IBM Cloud HSM device.",
      "language": "unknown"
    },
    {
      "code": "Next, the partition needs to be assigned to the client, in this case your key server.",
      "language": "unknown"
    },
    {
      "code": "After the partition has been assigned, run `lunacm` from your virtual server and initialize the partition.",
      "language": "unknown"
    },
    {
      "code": "***\n\n## 2. Generate RSA and ECDSA key pairs and certificate signing requests (CSRs)\n\nBefore running the commands below, check with your information security and/or cryptography team to confirm the approved key creation procedures for your organization.\n\nWhen you perform this operation, you need define the ID field for the newly generated keys. It must be set to a big-endian hexadecimal integer value.",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "3. Obtain and upload a signed certificate from your Certificate Authority (CA)",
      "id": "3.-obtain-and-upload-a-signed-certificate-from-your-certificate-authority-(ca)"
    },
    {
      "level": "h2",
      "text": "4. Modify your gokeyless config file and restart the service",
      "id": "4.-modify-your-gokeyless-config-file-and-restart-the-service"
    },
    {
      "level": "h2",
      "text": "Before you start",
      "id": "before-you-start"
    },
    {
      "level": "h2",
      "text": "1. Create a VM",
      "id": "1.-create-a-vm"
    },
    {
      "level": "h2",
      "text": "2. Deploy the keyless server",
      "id": "2.-deploy-the-keyless-server"
    },
    {
      "level": "h2",
      "text": "3. Set up the Azure CLI",
      "id": "3.-set-up-the-azure-cli"
    },
    {
      "level": "h2",
      "text": "4. Set up the Managed HSM",
      "id": "4.-set-up-the-managed-hsm"
    },
    {
      "level": "h2",
      "text": "5. Restart gokeyless",
      "id": "5.-restart-gokeyless"
    },
    {
      "level": "h2",
      "text": "PKCS#11 URI",
      "id": "pkcs#11-uri"
    },
    {
      "level": "h2",
      "text": "Examples",
      "id": "examples"
    },
    {
      "level": "h2",
      "text": "Limitations",
      "id": "limitations"
    },
    {
      "level": "h2",
      "text": "Before you start",
      "id": "before-you-start"
    },
    {
      "level": "h2",
      "text": "1. Create a key ring",
      "id": "1.-create-a-key-ring"
    },
    {
      "level": "h2",
      "text": "2. Create a key",
      "id": "2.-create-a-key"
    },
    {
      "level": "h2",
      "text": "3. Import the private key",
      "id": "3.-import-the-private-key"
    },
    {
      "level": "h2",
      "text": "4. Modify your gokeyless config file and restart the service",
      "id": "4.-modify-your-gokeyless-config-file-and-restart-the-service"
    },
    {
      "level": "h2",
      "text": "Before you start",
      "id": "before-you-start"
    },
    {
      "level": "h2",
      "text": "1. Create, assign, and initialize a new partition",
      "id": "1.-create,-assign,-and-initialize-a-new-partition"
    },
    {
      "level": "h2",
      "text": "2. Generate RSA and ECDSA key pairs and certificate signing requests (CSRs)",
      "id": "2.-generate-rsa-and-ecdsa-key-pairs-and-certificate-signing-requests-(csrs)"
    }
  ],
  "url": "llms-txt#cmu-requestcertificate--c=\"us\"--o=\"example,-inc.\"--cn=\"azure-dedicatedhsm.example.com\"--s=\"california\"--l=\"san-francisco\"--publichandle=48--privatehandle=51--outputfile=\"rsa.csr\"--sha256withrsa",
  "links": []
}