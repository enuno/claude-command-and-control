{
  "title": "Using azure-cli",
  "content": "az login\naz account get-access-token --resource https://graph.microsoft.com\n\n(payload with accessToken returned)\ncurl\ncurl -X POST 'https://graph.microsoft.com/v1.0/applicationTemplates/8adf8e6e-67b2-4cf2-a259-e3dc5476c621/instantiate' \\\n  --header 'Content-Type: application/json' \\\n  --header 'Authorization: Bearer <accessToken>' \\\n  --data-raw '{\n    \"displayName\": \"Entra API create application test\"\n}'\ncurl\n{\n  \"@odata.context\": \"https://graph.microsoft.com/v1.0/$metadata#microsoft.graph.applicationServicePrincipal\",\n  \"application\": {\n    \"id\": \"343a8552-f9d9-471c-b677-d37062117cc8\", //\n    \"appId\": \"03d8207b-e837-4be9-b4e6-180492eb3b61\",\n    \"applicationTemplateId\": \"8adf8e6e-67b2-4cf2-a259-e3dc5476c621\",\n    \"createdDateTime\": \"2025-01-30T00:37:44Z\",\n    \"deletedDateTime\": null,\n    \"displayName\": \"Entra API create application test\",\n    \"description\": null,\n    // ... snipped rest of large application payload\n  },\n  \"servicePrincipal\": {\n    \"id\": \"a8cb133d-f841-4eb9-8bc9-c8e9e8c0d417\", // Note this ID for the subsequent request\n    \"deletedDateTime\": null,\n    \"accountEnabled\": true,\n    \"appId\": \"03d8207b-e837-4be9-b4e6-180492eb3b61\",\n    \"applicationTemplateId\": \"8adf8e6e-67b2-4cf2-a259-e3dc5476c621\",\n    \"appDisplayName\": \"Entra API create application test\",\n  // ...snipped rest of JSON payload\n}\n}\ncurl\ncurl -X POST 'https://graph.microsoft.com/v1.0/servicePrincipals/<SERVICE_PRINCIPAL_ID>/synchronization/jobs' \\\n  --header 'Content-Type: application/json' \\\n  --header 'Authorization: Bearer <accessToken>' \\\n  --data-raw '{\n    \"templateId\": \"scim\"\n}'\ncurl\n{\n  \"@odata.context\": \"https://graph.microsoft.com/v1.0/$metadata#servicePrincipals('a8cb133d-f841-4eb9-8bc9-c8e9e8c0d417')/synchronization/jobs/$entity\",\n  \"id\": \"scim.5b223a2cc249463bbd9a791550f11c76.03d8207b-e837-4be9-b4e6-180492eb3b61\",\n  \"templateId\": \"scim\",\n  \"schedule\": {\n    \"expiration\": null,\n    \"interval\": \"PT40M\",\n    \"state\": \"Disabled\"\n  },\n}\n// ... snipped rest of JSON payload\ncurl\n --header 'Content-Type: application/json' \\\n  --header 'Authorization: Bearer <accessToken>' \\\n  --data-raw '{\n  \"value\": [\n    {\n      \"key\": \"BaseAddress\",\n      \"value\": \"https://api.cloudflare.com/client/v4/accounts/<ACCOUNT_ID>/scim/v2\"\n    },\n    {\n      \"key\": \"SecretToken\",\n      \"value\": \"<SCIM_PROVISIONING_API_TOKEN_VALUE>\"\n    }\n  ]\n}'\ncurl\ncurl -X GET \"https://api.cloudflare.com/client/v4/accounts/{account_id}/members\" \\\n  -H \"Authorization: Bearer YOUR_SCIM_AOT\" \\\n  -H \"Content-Type: application/json\"\ncurl\ncurl -X PUT \"https://api.cloudflare.com/client/v4/accounts/{account_id}/members/{member_id}\" \\\n  -H \"Authorization: Bearer YOUR_SCIM_AOT\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"roles\": [\n      {\n        \"id\": \"33666b9c79b9a5273fc7344ff42f953d\"\n      }\n    ]\n  }'\nsh",
  "code_samples": [
    {
      "code": "**2. Create a new application via template.**\n\nThe template ID 8adf8e6e-67b2-4cf2-a259-e3dc5476c621 is the suggested template to create non-gallery apps in the Entra docs. Replace `<accessToken>` and `displayName` with your values.",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "**3. Create a provisioning job**\n\nTo enable provisioning, you will also need to create a job. Note the SERVICE\\_PRINCIPAL\\_ID in the previous request will be used in the request below. The SCIM templateId is an Entra provided template.",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "**4. Configure the SCIM provisioning URL and API token**\n\nNext, configure the Tenant URL (Cloudflare SCIM endpoint) and API token (SCIM Provisioning API Token).\n\nReplace `<accessToken>`, `<ACCOUNT_ID>`, `<SCIM_PROVISIONING_API_TOKEN_VALUE>` with your values.",
      "language": "unknown"
    },
    {
      "code": "After completing the tasks above, the next steps in Entra include:\n\n* Additional group/provisioning configuration\n* Test and save after updating the config.\n* Provisioning after configuration is complete\n\n</page>\n\n<page>\n---\ntitle: Office 365 directory integration · Cloudflare Email security (formerly\n  Area 1) docs\ndescription: Email security (formerly Area 1) can integrate with Office 365 to\n  retrieve user and group information. This can be used to enforce the Business\n  Email Compromise configuration to prevent user impersonation.\nlastUpdated: 2025-10-27T15:00:52.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/email-security/email-configuration/enhanced-detections/business-email-compromise/o365-directory-guide/\n  md: https://developers.cloudflare.com/email-security/email-configuration/enhanced-detections/business-email-compromise/o365-directory-guide/index.md\n---\n\nEmail security (formerly Area 1) can integrate with Office 365 to retrieve user and group information. This can be used to enforce the Business Email Compromise configuration to prevent user impersonation.\n\n## 1. Authorize Email security with Office 365 for Directory Access\n\nYou need to authorize Email security to make connections into your [Office 365 tenant](https://learn.microsoft.com/en-us/microsoft-365/solutions/tenant-management-overview) to retrieve your directory details. The account used to authorize will require the **Privileged authentication admin** and **Privileged role admin** roles.\n\n### How does the authorization work?\n\nThe authorization process grants Email security access to the Azure environment with the least applicable privileges required to function. The Enterprise Application that Email security registers is not tied to any administrator account. Inside of the Azure Active Directory admin center you can review the permissions granted to the application in the Enterprise Application section.\n\nWhen assigning user roles in the Office 365 console, you will find these roles in **User permissions** > **Roles configuration** > **Identity admin roles**.\n\n![A list of permissions for Email security](https://developers.cloudflare.com/_astro/permissions.DRkhTx-V_JHMjL.webp)\n\n1. Log in to the [Email security (formerly Area 1) dashboard](https://horizon.area1security.com/), and select **Settings** (the gear icon).\n\n2. Go to **Directories**, and select **Add Directory** to start the authorization process.\n\n   ![Go to Directories in the dashboard of Email security, and then select Add Directory to start the authorization process](https://developers.cloudflare.com/_astro/step2-directories.D22k3b5I_Z2pynUM.webp)\n\n3. In the Add Directory configuration panel, enter the following details:\n\n   * **Directory Type**: Open the drop-down menu and select **Office 365**.\n   * **Directory Name**: Enter a string that represents the directory. This value will be referenced in the Business Email Compromise List configuration section. For example, `Office 365`.\n   * **Sync Frequency**: Update the value to your preference.\n\n   Select **Authorize** when you are done.\n\n   ![Add the appropriate details to the configuration panel](https://developers.cloudflare.com/_astro/step3-directory-config-panel.CN4uFFNK_Z10sKoT.webp)\n\n4. The Email security dashboard will redirect you to a Microsoft login page. Select or enter the appropriate account to initiate the authentication process.\n\n   ![Select the appropriate Microsoft account to continue](https://developers.cloudflare.com/_astro/step4-login.DmmDslaO_ZcfduF.webp)\n\n5. Once authenticated, the system will show a dialog box with a list of the requested permissions. Select **Accept** to authorize the change.\n\n   ![Accept the permissions to continue](https://developers.cloudflare.com/_astro/step5-permissions.CNTdCD6P_ZDk7eE.webp)\n\n6. Upon authorization, you will be automatically redirected back to the Add Directory configuration panel. Select **Save** to complete the authorization process.\n\n   ![Select Save to complete the authorization process](https://developers.cloudflare.com/_astro/step6-save.CJqUX5UA_Z1SjV0d.webp)\n\n7. Once saved, your newly configured directory will appear in the configured directories table.\n\n   ![Your directory will appear in the configured directories table](https://developers.cloudflare.com/_astro/step7-directories.X-76CIOe_19aOhA.webp)\n\n## 2. Configure the Business Email Compromise list\n\nNow that Email Security (formerly Area 1) has been authorized to access and retrieve directory information, you will need to configure the Business Email Compromise list.\n\n1. Log in to the [Email Security (formerly Area 1) dashboard](https://horizon.area1security.com/), and select **Settings** (the gear icon).\n\n2. Go to **Email Configuration** > **Enhanced Detections** > **Business Email Compromise**.\n\n   ![Access Business Email Compromise in Email Security (formerly Area 1) dashboard to start setting up this feature](https://developers.cloudflare.com/_astro/step2-business-email-compromise.JLn7Jc_Z_ZUFG4J.webp)\n\n3. Open the drop-down menu and select the directory you have created in the previous step 3.\n\n   ![Select the directory you have created in the previous step 3](https://developers.cloudflare.com/_astro/step3-office365.DovwiIDh_Z1sV2Cc.webp)\n\n4. If the initial directory synchronization has completed, the page will refresh and list groups and users. If you do not see any information, wait a few minutes as the system completes processing the initial synchronization.\n\n   ![The screen should refresh and show a list of users and groups](https://developers.cloudflare.com/_astro/step4-business-list.CpO6oJT4_moqQF.webp)\n\n5. Select the arrow next to a group to expand it and show its members.\n\n   ![Select the arrow to expand it and show a list of its members](https://developers.cloudflare.com/_astro/step5-show-members.DDOL6mZ3_Z22IF1S.webp)\n\n6. To protect an entire group, select the three-dots button next to it, and then select **Protect**. When you protect a group, all of its members will be automatically protected. The protection markers will turn green to indicate that protection is active.\n\n   ![You can protect an entire group of users. The protection markers will turn green to show that protection is active](https://developers.cloudflare.com/_astro/step6-protect-group.Dp7Ice3T_Who9v.webp)\n\n7. You can also protect individual users. Select the three-dots button next to each user you want to protect, and then select **Protect**.\n\n## 3. Configure secondary email address (if required)\n\nWhen the Business Email Compromise list is configured, Email Security (formerly Area 1) will enforce the proper match of the sender’s display name and email address. Any variation from this strict requirement will raise a detection event. The reason of detection will be `Protected Name <NAME> should not appear as <non-configured email address>`.\n\nIn some instances, you may want to allow your protected users to send emails from an alternate email address (like their personal email address). To configure this alternate address, you will have to add it to their directory entry.\n\n1. Log in to the [Email Security (formerly Area 1) dashboard](https://horizon.area1security.com/), and select **Settings** (the gear icon).\n\n2. Go to **Email Configuration** > **Enhanced Detections** > **Business Email Compromise**.\n\n3. Search for the user you want to allow an alternate email address.\n\n4. Select the three-dots button > **Edit**.\n\n   ![Select edit to add alternate email addresses to your user](https://developers.cloudflare.com/_astro/step4-edit-user.DL6F3KAq_ZD7GcV.webp)\n\n5. In **Secondary Emails** add the additional email addresses. Place each entry on a new line.\n\n   ![Add each new email address to the Secondary Emails field. Place each address on a separate line](https://developers.cloudflare.com/_astro/step5-new-email.B-eIH6gr_zbom5.webp)\n\n6. Select **Save** to finish.\n\n</page>\n\n<page>\n---\ntitle: Provision with Okta · Cloudflare Fundamentals docs\ndescription: Once you have gathered the required data, the following steps will\n  be required to finish the provisioning with Okta.\nlastUpdated: 2025-08-20T18:47:44.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/fundamentals/account/account-security/scim-setup/okta/\n  md: https://developers.cloudflare.com/fundamentals/account/account-security/scim-setup/okta/index.md\n---\n\nNote\n\n**Important Update:** Cloudflare now supports native User Groups for enhanced access control. This new feature replaces the previous method of directly assigning Cloudflare roles based on IdP group mappings (identified by the pattern `CF-<accountID> - <Role Name>`), which is deprecated as of June 2nd, 2025. SCIM Virtual Groups will reach end-of-life on December 2, 2025. Update your SCIM configurations using the instructions below to utilize User Groups for seamless provisioning.\n\nOnce you have [gathered the required data](https://developers.cloudflare.com/fundamentals/account/account-security/scim-setup/#gather-the-required-data), the following steps will be required to finish the provisioning with Okta.\n\n## Set up your Okta SCIM application\n\n1. In the Okta dashboard, go to **Applications** > **Applications**.\n\n2. Select **Browse App Catalog**.\n\n3. Locate and select **SCIM 2.0 Test App (OAuth Bearer Token)**.\n\n4. Select **Add Integration** and name your integration.\n\n5. Enable the following options:\n\n   * **Do not display application icon to users**\n   * **Do not display application icon in the Okta Mobile App**\n\n6. Disable **Automatically log in when user lands on login page**.\n\n7. Select **Next**, then select **Done**.\n\n## Integrate the Cloudflare API\n\nNote\n\nThe **Update User Attributes** option is not supported.\n\n1. In your integration page, go to **Provisioning** > **Configure API Integration**.\n2. Enable **Enable API Integration**.\n3. In SCIM 2.0 Base URL, enter: `https://api.cloudflare.com/client/v4/accounts/<accountID>/scim/v2`, substituting `accountID` for your [Cloudflare Account ID](https://developers.cloudflare.com/fundamentals/account/account-security/scim-setup/#get-your-account-id).\n4. In the **OAuth Bearer Token** field, enter your API token value.\n5. Deselect **Import Groups**.\n\n## Configure user & group sync in Okta\n\n1. In **Provisioning to App**, select **Edit**.\n2. Enable **Create Users** and **Deactivate Users**. Select **Save**.\n3. Select **Done**.\n4. In the Assignments tab, add the users you want to synchronize with Cloudflare dashboard. You can add users in batches by assigning a group. If a user is removed from the application assignment via either direct user assignment or removed from the group that was assigned to the app, this will trigger a deprovisioning event from Okta to Cloudflare.\n5. In the Push Groups tab, add the Okta groups you want to synchronize with Cloudflare dashboard. View these Okta groups in the dashboard under Manage Account > Manage members > Members > User Groups.\n\nTo verify the integration, select **View Logs** in the Okta SCIM application, and check the Audit Logs in the Cloudflare dashboard by navigating to **Manage Account** > **Audit Log**.\n\nThis will provision all of the users in the group(s) affected to your Cloudflare account with \"minimal account access.\"\n\n</page>\n\n<page>\n---\ntitle: SCIM troubleshooting · Cloudflare Fundamentals docs\ndescription: If you have removed all Super Administrators mistakenly, you can\n  restore the role to account member(s) using the Account API Token you created\n  for SCIM provisioning.\nlastUpdated: 2025-11-07T11:09:44.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/fundamentals/account/account-security/scim-setup/troubleshooting/\n  md: https://developers.cloudflare.com/fundamentals/account/account-security/scim-setup/troubleshooting/index.md\n---\n\n## Restore Super Administrator after group misconfiguration\n\nIf you have removed all Super Administrators mistakenly, you can restore the role to account member(s) using the Account API Token you created for SCIM provisioning.\n\nFirst, fetch a list of account members and find the member ID for the user you want to restore Super Admin to via [list members](https://developers.cloudflare.com/api/resources/accounts/subresources/members/methods/list/).",
      "language": "unknown"
    },
    {
      "code": "Then restore the Super Admin role to that member via [update member](https://developers.cloudflare.com/api/resources/accounts/subresources/members/methods/update/)",
      "language": "unknown"
    },
    {
      "code": "The value `33666b9c79b9a5273fc7344ff42f953d` is the role ID of Super Administrator.\n\n</page>\n\n<page>\n---\ntitle: AWS RDS and Aurora · Cloudflare Hyperdrive docs\ndescription: Connect Hyperdrive to an AWS RDS database instance.\nlastUpdated: 2025-12-27T11:24:06.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/hyperdrive/examples/connect-to-mysql/mysql-database-providers/aws-rds-aurora/\n  md: https://developers.cloudflare.com/hyperdrive/examples/connect-to-mysql/mysql-database-providers/aws-rds-aurora/index.md\n---\n\nThis example shows you how to connect Hyperdrive to an Amazon Relational Database Service (Amazon RDS) or Amazon Aurora MySQL database instance.\n\n## 1. Allow Hyperdrive access\n\nTo allow Hyperdrive to connect to your database, you will need to ensure that Hyperdrive has valid user credentials and network access.\n\nNote\n\nTo allow Hyperdrive to connect to your database, you must allow Cloudflare IPs to be able to access your database. You can either allow-list all IP address ranges (0.0.0.0 - 255.255.255.255) or restrict your IP access control list to the [IP ranges used by Hyperdrive](https://developers.cloudflare.com/hyperdrive/configuration/firewall-and-networking-configuration/).\n\nAlternatively, you can connect to your databases over in your private network using [Cloudflare Tunnels](https://developers.cloudflare.com/hyperdrive/configuration/connect-to-private-database/).\n\n### AWS Console\n\nWhen creating or modifying an instance in the AWS console:\n\n1. Configure a **database cluster** and other settings you wish to customize.\n2. Under **Settings** > **Credential settings**, note down the **Master username** and **Master password** (Aurora only).\n3. Under the **Connectivity** header, ensure **Public access** is set to **Yes**.\n4. Select an **Existing VPC security group** that allows public Internet access from `0.0.0.0/0` to the port your database instance is configured to listen on (default: `3306` for MySQL instances).\n5. Select **Create database**.\n\nWarning\n\nYou must ensure that the [VPC security group](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-security-groups.html) associated with your database allows public IPv4 access to your database port.\n\nRefer to AWS' [database server rules](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules-reference.html#sg-rules-db-server) for details on how to configure rules specific to your RDS database.\n\n### Retrieve the database endpoint (Aurora)\n\nTo retrieve the database endpoint (hostname) for Hyperdrive to connect to:\n\n1. Go to **Databases** view under **RDS** in the AWS console.\n2. Select the database you want Hyperdrive to connect to.\n3. Under the **Endpoints** header, note down the **Endpoint name** with the type `Writer` and the **Port**.\n\n### Retrieve the database endpoint (RDS MySQL)\n\nFor regular RDS instances (non-Aurora), you will need to fetch the endpoint and port of the database:\n\n1. Go to **Databases** view under **RDS** in the AWS console.\n2. Select the database you want Hyperdrive to connect to.\n3. Under the **Connectivity & security** header, note down the **Endpoint** and the **Port**.\n\nThe endpoint will resemble `YOUR_DATABASE_NAME.cpuo5rlli58m.AWS_REGION.rds.amazonaws.com`, and the port will default to `3306`.\n\nSupport for MySQL-compatible providers\n\nSupport for AWS Aurora MySQL databases is coming soon. Join our early preview support by reaching out to us in the [Hyperdrive Discord channel](https://discord.cloudflare.com/).\n\n## 2. Create your user\n\nOnce your database is created, you will need to create a user for Hyperdrive to connect as. Although you can use the **Master username** configured during initial database creation, best practice is to create a less privileged user.\n\nTo create a new user, log in to the database and use the `CREATE ROLE` command:",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "1. Authorize Email security with Office 365 for Directory Access",
      "id": "1.-authorize-email-security-with-office-365-for-directory-access"
    },
    {
      "level": "h3",
      "text": "How does the authorization work?",
      "id": "how-does-the-authorization-work?"
    },
    {
      "level": "h2",
      "text": "2. Configure the Business Email Compromise list",
      "id": "2.-configure-the-business-email-compromise-list"
    },
    {
      "level": "h2",
      "text": "3. Configure secondary email address (if required)",
      "id": "3.-configure-secondary-email-address-(if-required)"
    },
    {
      "level": "h2",
      "text": "Set up your Okta SCIM application",
      "id": "set-up-your-okta-scim-application"
    },
    {
      "level": "h2",
      "text": "Integrate the Cloudflare API",
      "id": "integrate-the-cloudflare-api"
    },
    {
      "level": "h2",
      "text": "Configure user & group sync in Okta",
      "id": "configure-user-&-group-sync-in-okta"
    },
    {
      "level": "h2",
      "text": "Restore Super Administrator after group misconfiguration",
      "id": "restore-super-administrator-after-group-misconfiguration"
    },
    {
      "level": "h2",
      "text": "1. Allow Hyperdrive access",
      "id": "1.-allow-hyperdrive-access"
    },
    {
      "level": "h3",
      "text": "AWS Console",
      "id": "aws-console"
    },
    {
      "level": "h3",
      "text": "Retrieve the database endpoint (Aurora)",
      "id": "retrieve-the-database-endpoint-(aurora)"
    },
    {
      "level": "h3",
      "text": "Retrieve the database endpoint (RDS MySQL)",
      "id": "retrieve-the-database-endpoint-(rds-mysql)"
    },
    {
      "level": "h2",
      "text": "2. Create your user",
      "id": "2.-create-your-user"
    }
  ],
  "url": "llms-txt#using-azure-cli",
  "links": []
}