{
  "title": "Define function responsible for adding the header",
  "content": "def add_custom_header(params, **kwargs):\n    params[\"headers\"]['cf-create-bucket-if-missing'] = 'true'\n\nevent_system.register('before-call.s3.PutObject', add_custom_header)\n\nresponse = client.put_object(Bucket=\"my_bucket\", Key=\"my_file\", Body=\"file_contents\")\nprint(response)\nts\nimport {\n  PutObjectCommand,\n  S3Client,\n} from \"@aws-sdk/client-s3\";\n\nconst client = new S3Client({\n  region: \"auto\", // Required by SDK but not used by R2\n  endpoint: `https://${ACCOUNT_ID}.r2.cloudflarestorage.com`,\n  // Retrieve your S3 API credentials for your R2 bucket via API tokens (see: https://developers.cloudflare.com/r2/api/tokens)\n  credentials: {\n    accessKeyId: ACCESS_KEY_ID,\n    secretAccessKey: SECRET_ACCESS_KEY,\n  },\n});\n\nclient.middlewareStack.add(\n  (next, context) => async (args) => {\n      const r = args.request as RequestInit\n      r.headers[\"cf-create-bucket-if-missing\"] = \"true\";\n\nreturn await next(args)\n    },\n  { step: 'build', name: 'customHeaders' },\n)\n\nconst command = new PutObjectCommand({\n  Bucket: \"my_bucket\",\n  Key: \"my_key\",\n  Body: \"my_data\"\n});\n\nconst response = await client.send(command);\n\nconsole.log(response);\npython\nimport boto3\n\nclient = boto3.resource('s3',\n  # Provide your Cloudflare account ID\n  endpoint_url = 'https://<ACCOUNT_ID>.r2.cloudflarestorage.com',\n  # Retrieve your S3 API credentials for your R2 bucket via API tokens (see: https://developers.cloudflare.com/r2/api/tokens)\n  aws_access_key_id = '<ACCESS_KEY_ID>',\n  aws_secret_access_key = '<SECRET_ACCESS_KEY>'\n)\n\nevent_system = client.meta.events",
  "code_samples": [
    {
      "code": "### Set a header for all requests with `aws-sdk-js-v3`\n\n`aws-sdk-js-v3` allows the customization of request behavior through the use of its [middleware stack](https://aws.amazon.com/blogs/developer/middleware-stack-modular-aws-sdk-js/). This example adds a middleware to the client which adds a header to every `PutObject` request being made.",
      "language": "unknown"
    },
    {
      "code": "## Set a different header on each request\n\nCertain extensions that R2 has provided in the S3 compatible api may require setting a different header on each request. For example, you may want to only want to overwrite an object if its etag matches a certain expected value. This value will likely be different for each object that is being overwritten, which requires the `If-Match` header to be different with each request you make. This section shows examples of how to accomplish that.\n\n### Set a header per request in `boto3`\n\nTo enable us to pass custom headers as an extra argument into the call to `client.put_object()` we need to register 2 functions into `boto3`'s event system. This is necessary because `boto3` performs a parameter validation step which rejects extra method arguments. Since this parameter validation occurs before we can set headers on the request, we first need to move the custom argument into the request context before the parameter validation happens. In a subsequent step we can now actually set the headers based on the information we put in the request context.",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h3",
      "text": "Set a header for all requests with `aws-sdk-js-v3`",
      "id": "set-a-header-for-all-requests-with-`aws-sdk-js-v3`"
    },
    {
      "level": "h2",
      "text": "Set a different header on each request",
      "id": "set-a-different-header-on-each-request"
    },
    {
      "level": "h3",
      "text": "Set a header per request in `boto3`",
      "id": "set-a-header-per-request-in-`boto3`"
    }
  ],
  "url": "llms-txt#define-function-responsible-for-adding-the-header",
  "links": []
}