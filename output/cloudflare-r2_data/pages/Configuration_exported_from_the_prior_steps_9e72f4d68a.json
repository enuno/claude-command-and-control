{
  "title": "Configuration - exported from the prior steps",
  "content": "STREAM_ENDPOINT = os.environ[\"STREAM_ENDPOINT\"]# From the stream you created\nAPI_TOKEN = os.environ[\"WRANGLER_R2_SQL_AUTH_TOKEN\"] #the same one created earlier\nEVENTS_TO_SEND = 1000 # Feel free to adjust this\n\ndef generate_transaction():\n    \"\"\"Generate some random transactions with occasional fraud\"\"\"\n\n# User IDs\n    high_risk_users = [1001, 1002, 1003, 1004, 1005]\n    normal_users = list(range(1006, 2000))\n\nuser_id = random.choice(high_risk_users + normal_users)\n    is_high_risk_user = user_id in high_risk_users\n\n# Generate amounts\n    if random.random() < 0.05:\n        amount = round(random.uniform(5000, 50000), 2)\n    elif random.random() < 0.03:\n        amount = round(random.uniform(0.01, 1.00), 2)\n    else:\n        amount = round(random.uniform(10, 500), 2)\n\n# Locations\n    normal_locations = [\"NEW_YORK\", \"LOS_ANGELES\", \"CHICAGO\", \"MIAMI\", \"SEATTLE\", \"SAN FRANCISCO\"]\n    high_risk_locations = [\"UNKNOWN_LOCATION\", \"VPN_EXIT\", \"MARS\", \"BAT_CAVE\"]\n\nif is_high_risk_user and random.random() < 0.3:\n        location = random.choice(high_risk_locations)\n    else:\n        location = random.choice(normal_locations)\n\n# Merchant categories\n    normal_merchants = [\"GROCERY\", \"GAS_STATION\", \"RESTAURANT\", \"RETAIL\"]\n    high_risk_merchants = [\"GAMBLING\", \"CRYPTO\", \"MONEY_TRANSFER\", \"GIFT_CARDS\"]\n\nif random.random() < 0.1:  # 10% high-risk merchants\n        merchant_category = random.choice(high_risk_merchants)\n    else:\n        merchant_category = random.choice(normal_merchants)\n\n# Series of checks to either increase fraud score by a certain margin\n    fraud_score = 0\n    if amount > 2000: fraud_score += 0.4\n    if amount < 1: fraud_score += 0.3\n    if location in high_risk_locations: fraud_score += 0.5\n    if merchant_category in high_risk_merchants: fraud_score += 0.3\n    if is_high_risk_user: fraud_score += 0.2\n\n# Compare the fraud scores\n    is_fraud = random.random() < min(fraud_score * 0.3, 0.8)\n\n# Generate timestamps (some fraud happens at unusual hours)\n    base_time = datetime.now(timezone.utc)\n    if is_fraud and random.random() < 0.4:  # 40% of fraud at night\n        hour = random.randint(0, 5)  # Late night/early morning\n        transaction_time = base_time.replace(hour=hour)\n    else:\n        transaction_time = base_time - timedelta(\n            hours=random.randint(0, 168)  # Last week\n        )\n\nreturn {\n        \"transaction_id\": str(uuid.uuid4()),\n        \"user_id\": user_id,\n        \"amount\": amount,\n        \"transaction_timestamp\": transaction_time.isoformat(),\n        \"location\": location,\n        \"merchant_category\": merchant_category,\n        \"is_fraud\": True if is_fraud else False\n    }\n\ndef send_batch_to_stream(events, batch_size=100):\n    \"\"\"Send events to Cloudflare Stream in batches\"\"\"\n\nheaders = {\n        \"Authorization\": f\"Bearer {API_TOKEN}\",\n        \"Content-Type\": \"application/json\"\n    }\n\ntotal_sent = 0\n    fraud_count = 0\n\nfor i in range(0, len(events), batch_size):\n        batch = events[i:i + batch_size]\n        fraud_in_batch = sum(1 for event in batch if event[\"is_fraud\"] == True)\n\ntry:\n            response = requests.post(STREAM_ENDPOINT, headers=headers, json=batch)\n\nif response.status_code in [200, 201]:\n                total_sent += len(batch)\n                fraud_count += fraud_in_batch\n                print(f\"Sent batch of {len(batch)} events (Total: {total_sent})\")\n            else:\n                print(f\"Failed to send batch: {response.status_code} - {response.text}\")\n\nexcept Exception as e:\n            print(f\"Error sending batch: {e}\")\n\nreturn total_sent, fraud_count\n\ndef main():\n    print(\"Generating fraud detection data...\")\n\n# Generate events\n    events = []\n    for i in range(EVENTS_TO_SEND):\n        events.append(generate_transaction())\n        if (i + 1) % 100 == 0:\n            print(f\"Generated {i + 1} events...\")\n\nfraud_events = sum(1 for event in events if event[\"is_fraud\"] == True)\n    print(f\"ðŸ“Š Generated {len(events)} total events ({fraud_events} fraud, {fraud_events/len(events)*100:.1f}%)\")\n\n# Send to stream\n    print(\"Sending data to Pipeline stream...\")\n    sent, fraud_sent = send_batch_to_stream(events)\n\nprint(f\"\\nComplete!\")\n    print(f\"   Events sent: {sent:,}\")\n    print(f\"   Fraud events: {fraud_sent:,} ({fraud_sent/sent*100:.1f}%)\")\n    print(f\"   Data is now flowing through your pipeline!\")\n\nif __name__ == \"__main__\":\n    main()\nbash\npip install requests\npython fraud_data_generator.py\nbash\nnpx wrangler r2 sql query \"$WAREHOUSE\" \"\nSELECT\n    transaction_id,\n    user_id,\n    amount,\n    location,\n    merchant_category,\n    is_fraud,\n    transaction_timestamp\nFROM fraud_detection.transactions\nWHERE __ingest_ts > '2025-09-24T01:00:00Z'\nAND is_fraud = true\nLIMIT 10\"\nbash\nnpx wrangler pipelines sinks create fraud_filter_sink \\\n  --type \"r2-data-catalog\" \\\n  --bucket \"fraud-pipeline\" \\\n  --roll-interval 30 \\\n  --namespace \"fraud_detection\" \\\n  --table \"fraud_transactions\" \\\n  --catalog-token $WRANGLER_R2_SQL_AUTH_TOKEN\nbash\nnpx wrangler pipelines create fraud_events_pipeline \\\n  --sql \"INSERT INTO fraud_filter_sink SELECT * FROM raw_events_stream WHERE is_fraud=true and amount > 1000\"\nbash\nnpx wrangler r2 sql query \"$WAREHOUSE\" \"\nSELECT\n    transaction_id,\n    user_id,\n    amount,\n    location,\n    merchant_category,\n    is_fraud,\n    transaction_timestamp\nFROM fraud_detection.fraud_transactions\nLIMIT 10\"\nbash\nnpx wrangler r2 sql query \"$WAREHOUSE\" \"\nSELECT\n    transaction_id,\n    user_id,\n    amount,\n    location,\n    merchant_category,\n    is_fraud,\n    transaction_timestamp\nFROM fraud_detection.fraud_transactions\nWHERE is_fraud = false\nLIMIT 10\"\ntext\nQuery executed successfully with no results\nsh\n  npx wrangler r2 sql query [WAREHOUSE] [QUERY]\n  sh\n  pnpm wrangler r2 sql query [WAREHOUSE] [QUERY]\n  sh\n  yarn wrangler r2 sql query [WAREHOUSE] [QUERY]\n  js\ntry {\n  await env.MY_BUCKET.put(\"my-key\", data, { customMetadata: largeMetadata });\n} catch (error) {\n  console.error(error.message);\n  // \"put: Your metadata headers exceed the maximum allowed metadata size. (10012)\"\n}\nxml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Error>\n  <Code>NoSuchKey</Code>\n  <Message>The specified key does not exist.</Message>\n</Error>\njson\n\"com.cloudflare.edge.r2.bucket.<ACCOUNT_ID>_<JURISDICTION>_<BUCKET_NAME>\": \"*\"\njson\n\"com.cloudflare.api.account.<ACCOUNT_ID>\": {\n  \"com.cloudflare.edge.r2.bucket.*\": \"*\"\n}\njson\n[\n  {\n    \"id\": \"f267e341f3dd4697bd3b9f71dd96247f\",\n    \"effect\": \"allow\",\n    \"resources\": {\n      \"com.cloudflare.edge.r2.bucket.4793d734c0b8e484dfc37ec392b5fa8a_default_my-bucket\": \"*\",\n      \"com.cloudflare.edge.r2.bucket.4793d734c0b8e484dfc37ec392b5fa8a_eu_my-eu-bucket\": \"*\"\n    },\n    \"permission_groups\": [\n      {\n        \"id\": \"6a018a9f2fc74eb6b293b0c548f38b39\",\n        \"name\": \"Workers R2 Storage Bucket Item Read\"\n      }\n    ]\n  }\n]\nplaintext\nAWS_ACCESS_KEY_ID = <accessKeyId>\nAWS_SECRET_ACCESS_KEY = <secretAccessKey>\nAWS_SESSION_TOKEN = <sessionToken>\nsh\nnpx wrangler r2 bucket lock add <BUCKET_NAME> [OPTIONS]\nsh\nnpx wrangler r2 bucket lock set <BUCKET_NAME> --file <FILE_PATH>\nbash\ncurl -X PUT \"https://api.cloudflare.com/client/v4/accounts/<ACCOUNT_ID>/r2/buckets/<BUCKET_NAME>/lock\" \\\n    -H \"Authorization: Bearer <API_TOKEN>\" \\\n    -H \"Content-Type: application/json\" \\\n    -d '{\n        \"rules\": [\n            {\n                \"id\": \"lock-logs-7d\",\n                \"enabled\": true,\n                \"prefix\": \"logs/\",\n                \"condition\": {\n                    \"type\": \"Age\",\n                    \"maxAgeSeconds\": 604800\n                }\n            },\n            {\n                \"id\": \"lock-images-indefinite\",\n                \"enabled\": true,\n                \"prefix\": \"images/\",\n                \"condition\": {\n                    \"type\": \"Indefinite\"\n                }\n            }\n        ]\n    }'\nsh\nnpx wrangler r2 bucket lock list <BUCKET_NAME>\nsh\nnpx wrangler r2 bucket lock remove <BUCKET_NAME> --id <RULE_ID>\nsh\nwrangler r2 bucket create your-bucket-name\nsh\nwrangler r2 bucket list\nsh\nwrangler r2 bucket delete BUCKET_TO_DELETE\njson\n[\n  {\n    \"AllowedOrigins\": [\"https://example.com\"],\n    \"AllowedMethods\": [\"PUT\"],\n    \"AllowedHeaders\": [\"Content-Type\"],\n    \"ExposeHeaders\": [\"ETag\"],\n    \"MaxAgeSeconds\": 3600\n  }\n]\njson\n{\n  \"rules\": [\n    {\n      \"allowed\": {\n        \"origins\": [\"https://example.com\"],\n        \"methods\": [\"GET\"]\n      }\n    }\n  ]\n}\nsh\nnpx wrangler r2 bucket cors set <BUCKET_NAME> --file cors.json\nsh\nnpx wrangler r2 bucket cors list <BUCKET_NAME>\njson\n[\n  {\n    \"AllowedOrigins\": [\"http://localhost:3000\"],\n    \"AllowedMethods\": [\"GET\"]\n  }\n]\nsh\nnpx wrangler r2 bucket notification create <BUCKET_NAME> --event-type <EVENT_TYPE> --queue <QUEUE_NAME>\nsh",
  "code_samples": [
    {
      "code": "Install the required Python dependency and run the script:",
      "language": "unknown"
    },
    {
      "code": "## 5. Query the data with R2 SQL\n\nNow you can analyze your fraud detection data using R2 SQL. Here are some example queries:\n\n### 5.1. View recent transactions",
      "language": "unknown"
    },
    {
      "code": "### 5.2. Filter the raw transactions into a new table to highlight high-value transactions\n\nCreate a new sink that will write the filtered data to a new Apache Iceberg table in R2 Data Catalog:",
      "language": "unknown"
    },
    {
      "code": "Now you will create a new SQL query to process data from the original `raw_events_stream` stream and only write flagged transactions that are over the `amount` of 1,000.",
      "language": "unknown"
    },
    {
      "code": "Note\n\nIt may take a few minutes for the new Pipeline to fully Initialize and start processing the data. Also keep in mind the 30 second `roll-interval`.\n\nQuery the table and check the results:",
      "language": "unknown"
    },
    {
      "code": "Also verify that the non-fraudulent events are being filtered out:",
      "language": "unknown"
    },
    {
      "code": "You should see the following output:",
      "language": "unknown"
    },
    {
      "code": "## Conclusion\n\nYou have successfully built an end to end data pipeline using Cloudflare's data platform. Through this tutorial, you hve learned to:\n\n1. **Use R2 Data Catalog**: Leveraged Apache Iceberg tables for efficient data storage\n2. **Set up Cloudflare Pipelines**: Created streams, sinks, and pipelines for data ingestion\n3. **Generated sample data**: Created transaction data with some basic fraud patterns\n4. **Query your tables with R2 SQL**: Access raw and processed data tables stored in R2 Data Catalog\n\n</page>\n\n<page>\n---\ntitle: Wrangler commands Â· R2 SQL docs\ndescription: Execute SQL query against R2 Data Catalog\nlastUpdated: 2025-11-17T17:45:17.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/r2-sql/reference/wrangler-commands/\n  md: https://developers.cloudflare.com/r2-sql/reference/wrangler-commands/index.md\n---\n\nNote\n\nR2 SQL is currently in open beta. Report R2 SQL bugs in [GitHub](https://github.com/cloudflare/workers-sdk/issues/new/choose). R2 SQL expects there to be a [`WRANGLER_R2_SQL_AUTH_TOKEN`](https://developers.cloudflare.com/r2-sql/query-data/#authentication) environment variable to be set.\n\n### `r2 sql query`\n\nExecute SQL query against R2 Data Catalog\n\n* npm",
      "language": "unknown"
    },
    {
      "code": "* pnpm",
      "language": "unknown"
    },
    {
      "code": "* yarn",
      "language": "unknown"
    },
    {
      "code": "- `[WAREHOUSE]` string required\n\n  R2 Data Catalog warehouse name\n\n- `[QUERY]` string required\n\n  The SQL query to execute\n\nGlobal flags\n\n* `--v` boolean alias: --version\n\n  Show version number\n\n* `--cwd` string\n\n  Run as if Wrangler was started in the specified directory instead of the current working directory\n\n* `--config` string alias: --c\n\n  Path to Wrangler configuration file\n\n* `--env` string alias: --e\n\n  Environment to use for operations, and for selecting .env and .dev.vars files\n\n* `--env-file` string\n\n  Path to an .env file to load - can be specified multiple times - values from earlier files are overridden by values in later files\n\n* `--experimental-provision` boolean aliases: --x-provision default: true\n\n  Experimental: Enable automatic resource provisioning\n\n* `--experimental-auto-create` boolean alias: --x-auto-create default: true\n\n  Automatically provision draft bindings with new resources\n\n</page>\n\n<page>\n---\ntitle: Error codes Â· Cloudflare R2 docs\ndescription: This page documents error codes returned by R2 when using the\n  Workers API or the S3-compatible API, along with recommended fixes to help\n  with troubleshooting.\nlastUpdated: 2025-12-29T18:01:22.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/r2/api/error-codes/\n  md: https://developers.cloudflare.com/r2/api/error-codes/index.md\n---\n\nThis page documents error codes returned by R2 when using the [Workers API](https://developers.cloudflare.com/r2/api/workers/) or the [S3-compatible API](https://developers.cloudflare.com/r2/api/s3/), along with recommended fixes to help with troubleshooting.\n\n## How errors are returned\n\nFor the **Workers API**, R2 operations throw exceptions that you can catch. The error code is included at the end of the `message` property:",
      "language": "unknown"
    },
    {
      "code": "For the **S3-compatible API**, errors are returned as XML in the response body:",
      "language": "unknown"
    },
    {
      "code": "## Error code reference\n\n### Authentication and authorization errors\n\n| Error Code | S3 Code | HTTP Status | Details | Recommended Fix |\n| - | - | - | - | - |\n| 10002 | Unauthorized | 401 | Missing or invalid authentication credentials. | Verify your [API token](https://developers.cloudflare.com/r2/api/tokens/) or access key credentials are correct and have not expired. |\n| 10003 | AccessDenied | 403 | Insufficient permissions for the requested operation. | Check that your [API token](https://developers.cloudflare.com/r2/api/tokens/) has the required permissions for the bucket and operation. |\n| 10018 | ExpiredRequest | 400 | Presigned URL or request signature has expired. | Regenerate the [presigned URL](https://developers.cloudflare.com/r2/api/s3/presigned-urls/) or signature. |\n| 10035 | SignatureDoesNotMatch | 403 | Request signature does not match calculated signature. | Verify your secret key and signing algorithm. Check for URL encoding issues. |\n| 10042 | NotEntitled | 403 | Account not entitled to this feature. | Ensure your account has an [R2 subscription](https://developers.cloudflare.com/r2/pricing/). |\n\n### Bucket errors\n\n| Error Code | S3 Code | HTTP Status | Details | Recommended Fix |\n| - | - | - | - | - |\n| 10005 | InvalidBucketName | 400 | Bucket name does not meet naming requirements. | Bucket names must be 3-63 chars, lowercase alphanumeric and hyphens, start/end with alphanumeric. |\n| 10006 | NoSuchBucket | 404 | The specified bucket does not exist. | Verify the bucket name is correct and the bucket exists in your account. |\n| 10008 | BucketNotEmpty | 409 | Cannot delete bucket that contains objects. | Delete all objects in the bucket before deleting the bucket. |\n| 10009 | TooManyBuckets | 400 | Account bucket limit exceeded (default: 1,000,000 buckets). | Request a limit increase via the [Limits Increase Request Form](https://forms.gle/ukpeZVLWLnKeixDu7). |\n| 10073 | BucketConflict | 409 | Bucket name already exists. | Choose a different bucket name. Bucket names must be unique within your account. |\n\n### Object errors\n\n| Error Code | S3 Code | HTTP Status | Details | Recommended Fix |\n| - | - | - | - | - |\n| 10007 | NoSuchKey | 404 | The specified object key does not exist. For the [Workers API](https://developers.cloudflare.com/r2/api/workers/workers-api-reference/), `get()` and `head()` return `null` instead of throwing. | Verify the object key is correct and the object has not been deleted. |\n| 10020 | InvalidObjectName | 400 | Object key contains invalid characters or is too long. | Use valid UTF-8 characters. Maximum key length is 1024 bytes. |\n| 100100 | EntityTooLarge | 400 | Object exceeds maximum size (5 GiB for single upload, 5 TiB for multipart). | Use [multipart upload](https://developers.cloudflare.com/r2/objects/multipart-objects/) for objects larger than 5 GiB. Maximum object size is 5 TiB. |\n| 10012 | MetadataTooLarge | 400 | Custom metadata exceeds the 8,192 byte limit. | Reduce custom metadata size. Maximum is 8,192 bytes total for all custom metadata. |\n| 10069 | ObjectLockedByBucketPolicy | 403 | Object is protected by a bucket lock rule and cannot be modified or deleted. | Wait for the retention period to expire. Refer to [bucket locks](https://developers.cloudflare.com/r2/buckets/bucket-locks/). |\n\n### Upload and request errors\n\n| Error Code | S3 Code | HTTP Status | Details | Recommended Fix |\n| - | - | - | - | - |\n| 10033 | MissingContentLength | 411 | `Content-Length` header required but missing. | Include the `Content-Length` header in PUT/POST requests. |\n| 10013 | IncompleteBody | 400 | Request body terminated before expected `Content-Length`. | Ensure the full request body is sent. Check for network interruptions or client timeouts. |\n| 10014 | InvalidDigest | 400 | Checksum header format is malformed. | Ensure checksums are properly encoded (base64 for SHA/CRC checksums). |\n| 10037 | BadDigest | 400 | Provided checksum does not match the uploaded content. | Verify data integrity and retry the upload. |\n| 10039 | InvalidRange | 416 | Requested byte range is not satisfiable. | Ensure the range start is less than object size. Check `Range` header format. |\n| 10031 | PreconditionFailed | 412 | Conditional headers (`If-Match`, `If-Unmodified-Since`, etc.) were not satisfied. | Object's ETag or modification time does not match your condition. Refetch and retry. Refer to [conditional operations](https://developers.cloudflare.com/r2/api/s3/extensions/#conditional-operations-in-putobject). |\n\n### Multipart upload errors\n\n| Error Code | S3 Code | HTTP Status | Details | Recommended Fix |\n| - | - | - | - | - |\n| 10011 | EntityTooSmall | 400 | Multipart part is below minimum size (5 MiB), except for the last part. | Ensure each part (except the last) is at least 5 MiB. |\n| 10024 | NoSuchUpload | 404 | Multipart upload does not exist or was aborted. | Verify the `uploadId` is correct. By default, incomplete multipart uploads expire after 7 days. Refer to [object lifecycles](https://developers.cloudflare.com/r2/buckets/object-lifecycles/). |\n| 10025 | InvalidPart | 400 | One or more parts could not be found when completing the upload. | Verify each part was uploaded successfully and use the exact ETag returned from `UploadPart`. |\n| 10048 | InvalidPart | 400 | All non-trailing parts must have the same size. | Ensure all parts except the last have identical sizes. R2 requires uniform part sizes for multipart uploads. |\n\n### Service errors\n\n| Error Code | S3 Code | HTTP Status | Details | Recommended Fix |\n| - | - | - | - | - |\n| 10001 | InternalError | 500 | An internal error occurred. | Retry the request. If persistent, check [Cloudflare Status](https://www.cloudflarestatus.com) or contact support. |\n| 10043 | ServiceUnavailable | 503 | Service is temporarily unavailable. | Retry with exponential backoff. Check [Cloudflare Status](https://www.cloudflarestatus.com). |\n| 10054 | ClientDisconnect | 400 | Client disconnected before request completed. | Check network connectivity and retry. |\n| 10058 | TooManyRequests | 429 | Rate limit exceeded. Often caused by multiple concurrent requests to the same object key (limit: 1 write/second per key). | Check if multiple clients are accessing the same object key. See [R2 limits](https://developers.cloudflare.com/r2/platform/limits/). |\n\n</page>\n\n<page>\n---\ntitle: S3 Â· Cloudflare R2 docs\nlastUpdated: 2025-12-29T18:01:22.000Z\nchatbotDeprioritize: true\nsource_url:\n  html: https://developers.cloudflare.com/r2/api/s3/\n  md: https://developers.cloudflare.com/r2/api/s3/index.md\n---\n\n* [Extensions](https://developers.cloudflare.com/r2/api/s3/extensions/)\n* [S3 API compatibility](https://developers.cloudflare.com/r2/api/s3/api/)\n* [Presigned URLs](https://developers.cloudflare.com/r2/api/s3/presigned-urls/)\n\n</page>\n\n<page>\n---\ntitle: Authentication Â· Cloudflare R2 docs\ndescription: You can generate an API token to serve as the Access Key for usage\n  with existing S3-compatible SDKs or XML APIs.\nlastUpdated: 2025-10-28T15:46:27.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/r2/api/tokens/\n  md: https://developers.cloudflare.com/r2/api/tokens/index.md\n---\n\nYou can generate an API token to serve as the Access Key for usage with existing S3-compatible SDKs or XML APIs.\n\nNote\n\nThis page contains instructions on generating API tokens *specifically* for R2. Note that this is different from generating API tokens for other services, as documented in [Create API token](https://developers.cloudflare.com/fundamentals/api/get-started/create-token/).\n\nYou must purchase R2 before you can generate an API token.\n\nTo create an API token:\n\n1. In the Cloudflare dashboard, go to the **R2 object storage** page.\n\n   [Go to **Overview**](https://dash.cloudflare.com/?to=/:account/r2/overview)\n\n2. Select **Manage in API tokens**.\n\n3. Choose to create either:\n\n   * **Create Account API token** - These tokens are tied to the Cloudflare account itself and can be used by any authorized system or user. Only users with the Super Administrator role can view or create them. These tokens remain valid until manually revoked.\n   * **Create User API token** - These tokens are tied to your individual Cloudflare user. They inherit your personal permissions and become inactive if your user is removed from the account.\n\n4. Under **Permissions**, choose a permission types for your token. Refer to [Permissions](#permissions) for information about each option.\n\n5. (Optional) If you select the **Object Read and Write** or **Object Read** permissions, you can scope your token to a set of buckets.\n\n6. Select **Create Account API token** or **Create User API token**.\n\nAfter your token has been successfully created, review your **Secret Access Key** and **Access Key ID** values. These may often be referred to as Client Secret and Client ID, respectively.\n\nWarning\n\nYou will not be able to access your **Secret Access Key** again after this step. Copy and record both values to avoid losing them.\n\nYou will also need to configure the `endpoint` in your S3 client to `https://<ACCOUNT_ID>.r2.cloudflarestorage.com`.\n\nFind your [account ID in the Cloudflare dashboard](https://developers.cloudflare.com/fundamentals/account/find-account-and-zone-ids/).\n\nBuckets created with jurisdictions must be accessed via jurisdiction-specific endpoints:\n\n* European Union (EU): `https://<ACCOUNT_ID>.eu.r2.cloudflarestorage.com`\n* FedRAMP: `https://<ACCOUNT_ID>.fedramp.r2.cloudflarestorage.com`\n\nWarning\n\nJurisdictional buckets can only be accessed via the corresponding jurisdictional endpoint. Most S3 clients will not let you configure multiple `endpoints`, so you'll generally have to initialize one client per jurisdiction.\n\n## Permissions\n\n| Permission | Description |\n| - | - |\n| Admin Read & Write | Allows the ability to create, list, and delete buckets, edit bucket configuration, read, write, and list objects, and read and write to data catalog tables and associated metadata. |\n| Admin Read only | Allows the ability to list buckets and view bucket configuration, read and list objects, and read from the data catalog tables and associated metadata. |\n| Object Read & Write | Allows the ability to read, write, and list objects in specific buckets. |\n| Object Read only | Allows the ability to read and list objects in specific buckets. |\n\nNote\n\nCurrently **Admin Read & Write** or **Admin Read only** permission is required to use [R2 Data Catalog](https://developers.cloudflare.com/r2/data-catalog/).\n\n## Create API tokens via API\n\nYou can create API tokens via the API and use them to generate corresponding Access Key ID and Secret Access Key values. To get started, refer to [Create API tokens via the API](https://developers.cloudflare.com/fundamentals/api/how-to/create-via-api/). Below are the specifics for R2.\n\n### Access Policy\n\nAn Access Policy specifies what resources the token can access and the permissions it has.\n\n#### Resources\n\nThere are two relevant resource types for R2: `Account` and `Bucket`. For more information on the Account resource type, refer to [Account](https://developers.cloudflare.com/fundamentals/api/how-to/create-via-api/#account).\n\n##### Bucket\n\nInclude a set of R2 buckets or all buckets in an account.\n\nA specific bucket is represented as:",
      "language": "unknown"
    },
    {
      "code": "* `ACCOUNT_ID`: Refer to [Find zone and account IDs](https://developers.cloudflare.com/fundamentals/account/find-account-and-zone-ids/#find-account-id-workers-and-pages).\n* `JURISDICTION`: The [jurisdiction](https://developers.cloudflare.com/r2/reference/data-location/#available-jurisdictions) where the R2 bucket lives. For buckets not created in a specific jurisdiction this value will be `default`.\n* `BUCKET_NAME`: The name of the bucket your Access Policy applies to.\n\nAll buckets in an account are represented as:",
      "language": "unknown"
    },
    {
      "code": "* `ACCOUNT_ID`: Refer to [Find zone and account IDs](https://developers.cloudflare.com/fundamentals/account/find-account-and-zone-ids/#find-account-id-workers-and-pages).\n\n#### Permission groups\n\nDetermine what [permission groups](https://developers.cloudflare.com/fundamentals/api/how-to/create-via-api/#permission-groups) should be applied.\n\n| Permission group | Resource | Description |\n| - | - | - |\n| `Workers R2 Storage Write` | Account | Can create, delete, and list buckets, edit bucket configuration, and read, write, and list objects. |\n| `Workers R2 Storage Read` | Account | Can list buckets and view bucket configuration, and read and list objects. |\n| `Workers R2 Storage Bucket Item Write` | Bucket | Can read, write, and list objects in buckets. |\n| `Workers R2 Storage Bucket Item Read` | Bucket | Can read and list objects in buckets. |\n| `Workers R2 Data Catalog Write` | Account | Can read from and write to data catalogs. This permission allows access to the Iceberg REST catalog interface. |\n| `Workers R2 Data Catalog Read` | Account | Can read from data catalogs. This permission allows read-only access to the Iceberg REST catalog interface. |\n\n#### Example Access Policy",
      "language": "unknown"
    },
    {
      "code": "### Get S3 API credentials from an API token\n\nYou can get the Access Key ID and Secret Access Key values from the response of the [Create Token](https://developers.cloudflare.com/api/resources/user/subresources/tokens/methods/create/) API:\n\n* Access Key ID: The `id` of the API token.\n* Secret Access Key: The SHA-256 hash of the API token `value`.\n\nRefer to [Authenticate against R2 API using auth tokens](https://developers.cloudflare.com/r2/examples/authenticate-r2-auth-tokens/) for a tutorial with JavaScript, Python, and Go examples.\n\n## Temporary access credentials\n\nIf you need to create temporary credentials for a bucket or a prefix/object within a bucket, you can use the [temp-access-credentials endpoint](https://developers.cloudflare.com/api/resources/r2/subresources/temporary_credentials/methods/create/) in the API. You will need an existing R2 token to pass in as the parent access key id. You can use the credentials from the API result for an S3-compatible request by setting the credential variables like so:",
      "language": "unknown"
    },
    {
      "code": "Note\n\nThe temporary access key cannot have a permission that is higher than the parent access key. e.g. if the parent key is set to `Object Read Write`, the temporary access key could only have `Object Read Write` or `Object Read Only` permissions.\n\n</page>\n\n<page>\n---\ntitle: Workers API Â· Cloudflare R2 docs\nlastUpdated: 2025-12-29T18:01:22.000Z\nchatbotDeprioritize: true\nsource_url:\n  html: https://developers.cloudflare.com/r2/api/workers/\n  md: https://developers.cloudflare.com/r2/api/workers/index.md\n---\n\n* [Workers API reference](https://developers.cloudflare.com/r2/api/workers/workers-api-reference/)\n* [Use R2 from Workers](https://developers.cloudflare.com/r2/api/workers/workers-api-usage/)\n* [Use the R2 multipart API from Workers](https://developers.cloudflare.com/r2/api/workers/workers-multipart-usage/)\n\n</page>\n\n<page>\n---\ntitle: Bucket locks Â· Cloudflare R2 docs\ndescription: Bucket locks prevent the deletion and overwriting of objects in an\n  R2 bucket for a specified period â€” or indefinitely. When enabled, bucket locks\n  enforce retention policies on your objects, helping protect them from\n  accidental or premature deletions.\nlastUpdated: 2025-09-03T16:40:54.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/r2/buckets/bucket-locks/\n  md: https://developers.cloudflare.com/r2/buckets/bucket-locks/index.md\n---\n\nBucket locks prevent the deletion and overwriting of objects in an R2 bucket for a specified period â€” or indefinitely. When enabled, bucket locks enforce retention policies on your objects, helping protect them from accidental or premature deletions.\n\n## Get started with bucket locks\n\nBefore getting started, you will need:\n\n* An existing R2 bucket. If you do not already have an existing R2 bucket, refer to [Create buckets](https://developers.cloudflare.com/r2/buckets/create-buckets/).\n* (API only) An API token with [permissions](https://developers.cloudflare.com/r2/api/tokens/#permissions) to edit R2 bucket configuration.\n\n### Enable bucket lock via dashboard\n\n1. In the Cloudflare dashboard, go to the **R2 object storage** page.\n\n   [Go to **Overview**](https://dash.cloudflare.com/?to=/:account/r2/overview)\n\n2. Select the bucket you would like to add bucket lock rule to.\n\n3. Switch to the **Settings** tab, then scroll down to the **Bucket lock rules** card.\n\n4. Select **Add rule** and enter the rule name, prefix, and retention period.\n\n5. Select **Save changes**.\n\n### Enable bucket lock via Wrangler\n\n1. Install [`npm`](https://docs.npmjs.com/getting-started).\n2. Install [Wrangler, the Developer Platform CLI](https://developers.cloudflare.com/workers/wrangler/install-and-update/).\n3. Log in to Wrangler with the [`wrangler login` command](https://developers.cloudflare.com/workers/wrangler/commands/#login).\n4. Add a bucket lock rule to your bucket by running the [`r2 bucket lock add` command](https://developers.cloudflare.com/workers/wrangler/commands/#r2-bucket-lock-add).",
      "language": "unknown"
    },
    {
      "code": "Alternatively, you can set the entire bucket lock configuration for a bucket from a JSON file using the [`r2 bucket lock set` command](https://developers.cloudflare.com/workers/wrangler/commands/#r2-bucket-lock-set).",
      "language": "unknown"
    },
    {
      "code": "The JSON file should be in the format of the request body of the [put bucket lock configuration API](https://developers.cloudflare.com/api/resources/r2/subresources/buckets/subresources/locks/methods/update/).\n\n### Enable bucket lock via API\n\nFor information about getting started with the Cloudflare API, refer to [Make API calls](https://developers.cloudflare.com/fundamentals/api/how-to/make-api-calls/). For information on required parameters and more examples of how to set bucket lock configuration, refer to the [API documentation](https://developers.cloudflare.com/api/resources/r2/subresources/buckets/subresources/locks/methods/update/).\n\nBelow is an example of setting a bucket lock configuration (a collection of rules):",
      "language": "unknown"
    },
    {
      "code": "This request creates two rules:\n\n* `lock-logs-7d`: Objects under the `logs/` prefix are retained for 7 days (604800 seconds).\n* `lock-images-indefinite`: Objects under the `images/` prefix are locked indefinitely.\n\nNote\n\nIf your bucket is setup with [jurisdictional restrictions](https://developers.cloudflare.com/r2/reference/data-location/#jurisdictional-restrictions), you will need to pass a `cf-r2-jurisdiction` request header with that jurisdiction. For example, `cf-r2-jurisdiction: eu`.\n\n## Get bucket lock rules for your R2 bucket\n\n### Dashboard\n\n1. In the Cloudflare dashboard, go to the **R2 object storage** page.\n\n   [Go to **Overview**](https://dash.cloudflare.com/?to=/:account/r2/overview)\n\n2. Select the bucket you would like to add bucket lock rule to.\n\n3. Switch to the **Settings** tab, then scroll down to the **Bucket lock rules** card.\n\n### Wrangler\n\nTo list bucket lock rules, run the [`r2 bucket lock list` command](https://developers.cloudflare.com/workers/wrangler/commands/#r2-bucket-lock-list):",
      "language": "unknown"
    },
    {
      "code": "### API\n\nFor more information on required parameters and examples of how to get bucket lock rules, refer to the [API documentation](https://developers.cloudflare.com/api/resources/r2/subresources/buckets/subresources/locks/methods/get/).\n\n## Remove bucket lock rules from your R2 bucket\n\n### Dashboard\n\n1. In the Cloudflare dashboard, go to the **R2 object storage** page.\n\n   [Go to **Overview**](https://dash.cloudflare.com/?to=/:account/r2/overview)\n\n2. Select the bucket you would like to add bucket lock rule to.\n\n3. Switch to the **Settings** tab, then scroll down to the **Bucket lock rules** card.\n\n4. Locate the rule you want to remove, select the `...` icon next to it, and then select **Delete**.\n\n### Wrangler\n\nTo remove a bucket lock rule, run the [`r2 bucket lock remove` command](https://developers.cloudflare.com/workers/wrangler/commands/#r2-bucket-lock-remove):",
      "language": "unknown"
    },
    {
      "code": "### API\n\nTo remove bucket lock rules via API, exclude them from your updated configuration and use the [put bucket lock configuration API](https://developers.cloudflare.com/api/resources/r2/subresources/buckets/subresources/locks/methods/update/).\n\n## Bucket lock rules\n\nA bucket lock configuration can include up to 1,000 rules. Each rule specifies which objects it covers (via prefix) and how long those objects must remain locked. You can:\n\n* Lock objects for a specific duration. For example, 90 days.\n* Retain objects until a certain date. For example, until January 1, 2026.\n* Keep objects locked indefinitely.\n\nIf multiple rules apply to the same prefix or object key, the strictest (longest) retention requirement takes precedence.\n\n## Notes\n\n* Rules without prefix apply to all objects in the bucket.\n* Rules apply to both new and existing objects in the bucket.\n* Bucket lock rules take precedence over [lifecycle rules](https://developers.cloudflare.com/r2/buckets/object-lifecycles/). For example, if a lifecycle rule attempts to delete an object at 30 days but a bucket lock rule requires it be retained for 90 days, the object will not be deleted until the 90-day requirement is met.\n\n</page>\n\n<page>\n---\ntitle: Create new buckets Â· Cloudflare R2 docs\ndescription: You can create a bucket from the Cloudflare dashboard or using Wrangler.\nlastUpdated: 2025-05-28T15:17:46.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/r2/buckets/create-buckets/\n  md: https://developers.cloudflare.com/r2/buckets/create-buckets/index.md\n---\n\nYou can create a bucket from the Cloudflare dashboard or using Wrangler.\n\nNote\n\nWrangler is [a command-line tool](https://developers.cloudflare.com/workers/wrangler/install-and-update/) for building with Cloudflare's developer products, including R2.\n\nThe R2 support in Wrangler allows you to manage buckets and perform basic operations against objects in your buckets. For more advanced use-cases, including bulk uploads or mirroring files from legacy object storage providers, we recommend [rclone](https://developers.cloudflare.com/r2/examples/rclone/) or an [S3-compatible](https://developers.cloudflare.com/r2/api/s3/) tool of your choice.\n\n## Bucket-Level Operations\n\nCreate a bucket with the [`r2 bucket create`](https://developers.cloudflare.com/workers/wrangler/commands/#r2-bucket-create) command:",
      "language": "unknown"
    },
    {
      "code": "Note\n\n* Bucket names can only contain lowercase letters (a-z), numbers (0-9), and hyphens (-).\n* Bucket names cannot begin or end with a hyphen.\n* Bucket names can only be between 3-63 characters in length.\n\nThe placeholder text is only for the example.\n\nList buckets in the current account with the [`r2 bucket list`](https://developers.cloudflare.com/workers/wrangler/commands/#r2-bucket-list) command:",
      "language": "unknown"
    },
    {
      "code": "Delete a bucket with the [`r2 bucket delete`](https://developers.cloudflare.com/workers/wrangler/commands/#r2-bucket-delete) command. Note that the bucket must be empty and all objects must be deleted.",
      "language": "unknown"
    },
    {
      "code": "## Notes\n\n* Bucket names and buckets are not public by default. To allow public access to a bucket, refer to [Public buckets](https://developers.cloudflare.com/r2/buckets/public-buckets/).\n* For information on controlling access to your R2 bucket with Cloudflare Access, refer to [Protect an R2 Bucket with Cloudflare Access](https://developers.cloudflare.com/r2/tutorials/cloudflare-access/).\n* Invalid (unauthorized) access attempts to private buckets do not incur R2 operations charges against that bucket. Refer to the [R2 pricing FAQ](https://developers.cloudflare.com/r2/pricing/#frequently-asked-questions) to understand what operations are billed vs. not billed.\n\n</page>\n\n<page>\n---\ntitle: Configure CORS Â· Cloudflare R2 docs\ndescription: Cross-Origin Resource Sharing (CORS) is a standardized method that\n  prevents domain X from accessing the resources of domain Y. It does so by\n  using special headers in HTTP responses from domain Y, that allow your browser\n  to verify that domain Y permits domain X to access these resources.\nlastUpdated: 2025-12-12T19:03:39.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/r2/buckets/cors/\n  md: https://developers.cloudflare.com/r2/buckets/cors/index.md\n---\n\n[Cross-Origin Resource Sharing (CORS)](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS) is a standardized method that prevents domain X from accessing the resources of domain Y. It does so by using special headers in HTTP responses from domain Y, that allow your browser to verify that domain Y permits domain X to access these resources.\n\nWhile CORS can help protect your data from malicious websites, CORS is also used to interact with objects in your bucket and configure policies on your bucket.\n\nCORS is used when you interact with a bucket from a web browser, and you have two options:\n\n**[Set a bucket to public:](#use-cors-with-a-public-bucket)** This option makes your bucket accessible on the Internet as read-only, which means anyone can request and load objects from your bucket in their browser or anywhere else. This option is ideal if your bucket contains images used in a public blog.\n\n**[Presigned URLs:](#use-cors-with-a-presigned-url)** Allows anyone with access to the unique URL to perform specific actions on your bucket.\n\n## Prerequisites\n\nBefore you configure CORS, you must have:\n\n* An R2 bucket with at least one object. If you need to create a bucket, refer to [Create a public bucket](https://developers.cloudflare.com/r2/buckets/public-buckets/).\n* A domain you can use to access the object. This can also be a `localhost`.\n* (Optional) Access keys. An access key is only required when creating a presigned URL.\n\n## Use CORS with a public bucket\n\n[To use CORS with a public bucket](https://developers.cloudflare.com/r2/buckets/public-buckets/), ensure your bucket is set to allow public access.\n\nNext, [add a CORS policy](#add-cors-policies-from-the-dashboard) to your bucket to allow the file to be shared.\n\n## Use CORS with a presigned URL\n\n[Presigned URLs](https://developers.cloudflare.com/r2/api/s3/presigned-urls/) allow temporary access to perform specific actions on your bucket without exposing your credentials. While presigned URLs handle authentication, you still need to configure CORS when making requests from a browser.\n\nWhen a browser makes a request to a presigned URL on a different origin, the browser enforces CORS. Without a CORS policy, browser-based uploads and downloads using presigned URLs will fail, even though the presigned URL itself is valid.\n\nTo enable browser-based access with presigned URLs:\n\n1. [Add a CORS policy](#add-cors-policies-from-the-dashboard) to your bucket that allows requests from your application's origin.\n\n2. Set `AllowedMethods` to match the operations your presigned URLs perform, use `GET`, `PUT`, `HEAD`, and/or `DELETE`.\n\n3. Set `AllowedHeaders` to include any headers the client will send when using the presigned URL, such as headers for content type, checksums, caching, or custom metadata.\n\n4. (Optional) Set `ExposeHeaders` to allow your JavaScript to read response headers like `ETag`, which contains the object's hash and is useful for verifying uploads.\n\n5. (Optional) Set `MaxAgeSeconds` to cache the preflight response and reduce the number of preflight requests the browser makes.\n\nThe following example allows browser-based uploads from `https://example.com` with a `Content-Type` header:",
      "language": "unknown"
    },
    {
      "code": "## Use CORS with a custom domain\n\n[Custom domains](https://developers.cloudflare.com/r2/buckets/public-buckets/#custom-domains) connected to an R2 bucket with a CORS policy automatically return CORS response headers for [cross-origin requests](https://fetch.spec.whatwg.org/#http-cors-protocol).\n\nCross-origin requests must include a valid `Origin` request header, for example, `Origin: https://example.com`. If you are testing directly or using a command-line tool such as `curl`, you will not see CORS `Access-Control-*` response headers unless the `Origin` request header is included in the request.\n\nCaching and CORS headers\n\nIf you set a CORS policy on a bucket that is already serving traffic using a custom domain, any existing cached assets will not reflect the CORS response headers until they are refreshed in cache. Use [Cache Purge](https://developers.cloudflare.com/cache/how-to/purge-cache/) to purge the cache for that hostname after making any CORS policy related changes.\n\n## Add CORS policies from the dashboard\n\n1. In the Cloudflare dashboard, go to the **R2 object storage** page.\n\n   [Go to **Overview**](https://dash.cloudflare.com/?to=/:account/r2/overview)\n\n2. Locate and select your bucket from the list.\n\n3. Select **Settings**.\n\n4. Under **CORS Policy**, select **Add CORS policy**.\n\n5. From the **JSON** tab, manually enter or copy and paste your policy into the text box.\n\n6. When you are done, select **Save**.\n\nYour policy displays on the **Settings** page for your bucket.\n\n## Add CORS policies via Wrangler CLI\n\nYou can configure CORS rules using the [Wrangler CLI](https://developers.cloudflare.com/r2/reference/wrangler-commands/).\n\n1. Create a JSON file with your CORS configuration:",
      "language": "unknown"
    },
    {
      "code": "1. Apply the CORS policy to your bucket:",
      "language": "unknown"
    },
    {
      "code": "1. Verify the CORS policy was applied:",
      "language": "unknown"
    },
    {
      "code": "## Response headers\n\nThe following fields in an R2 CORS policy map to HTTP response headers. These response headers are only returned when the incoming HTTP request is a valid CORS request.\n\n| Field Name | Description | Example |\n| - | - | - |\n| `AllowedOrigins` | Specifies the value for the `Access-Control-Allow-Origin` header R2 sets when requesting objects in a bucket from a browser. | If a website at `www.test.com` needs to access resources (e.g. fonts, scripts) on a [custom domain](https://developers.cloudflare.com/r2/buckets/public-buckets/#custom-domains) of `static.example.com`, you would set `https://www.test.com` as an `AllowedOrigin`. |\n| `AllowedMethods` | Specifies the value for the `Access-Control-Allow-Methods` header R2 sets when requesting objects in a bucket from a browser. | `GET`, `POST`, `PUT` |\n| `AllowedHeaders` | Specifies the value for the `Access-Control-Allow-Headers` header R2 sets when requesting objects in this bucket from a browser.Cross-origin requests that include custom headers (e.g. `x-user-id`) should specify these headers as `AllowedHeaders`. | `x-requested-by`, `User-Agent` |\n| `ExposeHeaders` | Specifies the headers that can be exposed back, and accessed by, the JavaScript making the cross-origin request. If you need to access headers beyond the [safelisted response headers](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Access-Control-Expose-Headers#examples), such as `Content-Encoding` or `cf-cache-status`, you must specify it here. | `Content-Encoding`, `cf-cache-status`, `Date` |\n| `MaxAgeSeconds` | Specifies the amount of time (in seconds) browsers are allowed to cache CORS preflight responses. Browsers may limit this to 2 hours or less, even if the maximum value (86400) is specified. | `3600` |\n\n## Example\n\nThis example shows a CORS policy added for a bucket that contains the `Roboto-Light.ttf` object, which is a font file.\n\nThe `AllowedOrigins` specify the web server being used, and `localhost:3000` is the hostname where the web server is running. The `AllowedMethods` specify that only `GET` requests are allowed and can read objects in your bucket.",
      "language": "unknown"
    },
    {
      "code": "In general, a good strategy for making sure you have set the correct CORS rules is to look at the network request that is being blocked by your browser.\n\n* Make sure the rule's `AllowedOrigins` includes the origin where the request is being made from. (like `http://localhost:3000` or `https://yourdomain.com`)\n* Make sure the rule's `AllowedMethods` includes the blocked request's method.\n* Make sure the rule's `AllowedHeaders` includes the blocked request's headers.\n\nAlso note that CORS rule propagation can, in rare cases, take up to 30 seconds.\n\n## Common Issues\n\n* Only a cross-origin request will include CORS response headers.\n\n  * A cross-origin request is identified by the presence of an `Origin` HTTP request header, with the value of the `Origin` representing a valid, allowed origin as defined by the `AllowedOrigins` field of your CORS policy.\n  * A request without an `Origin` HTTP request header will *not* return any CORS response headers. Origin values must match exactly.\n\n* The value(s) for `AllowedOrigins` in your CORS policy must be a valid [HTTP Origin header value](https://fetch.spec.whatwg.org/#origin-header). A valid `Origin` header does *not* include a path component and must only be comprised of a `scheme://host[:port]` (where port is optional).\n\n  * Valid `AllowedOrigins` value: `https://static.example.com` - includes the scheme and host. A port is optional and implied by the scheme.\n  * Invalid `AllowedOrigins` value: `https://static.example.com/` or `https://static.example.com/fonts/Calibri.woff2` - incorrectly includes the path component.\n\n* If you need to access specific header values via JavaScript on the origin page, such as when using a video player, ensure you set `Access-Control-Expose-Headers` correctly and include the headers your JavaScript needs access to, such as `Content-Length`.\n\n</page>\n\n<page>\n---\ntitle: Event notifications Â· Cloudflare R2 docs\ndescription: Event notifications send messages to your queue when data in your\n  R2 bucket changes. You can consume these messages with a consumer Worker or\n  pull over HTTP from outside of Cloudflare Workers.\nlastUpdated: 2025-09-03T16:40:54.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/r2/buckets/event-notifications/\n  md: https://developers.cloudflare.com/r2/buckets/event-notifications/index.md\n---\n\nEvent notifications send messages to your [queue](https://developers.cloudflare.com/queues/) when data in your R2 bucket changes. You can consume these messages with a [consumer Worker](https://developers.cloudflare.com/queues/reference/how-queues-works/#create-a-consumer-worker) or [pull over HTTP](https://developers.cloudflare.com/queues/configuration/pull-consumers/) from outside of Cloudflare Workers.\n\n## Get started with event notifications\n\n### Prerequisites\n\nBefore getting started, you will need:\n\n* An existing R2 bucket. If you do not already have an existing R2 bucket, refer to [Create buckets](https://developers.cloudflare.com/r2/buckets/create-buckets/).\n* An existing queue. If you do not already have a queue, refer to [Create a queue](https://developers.cloudflare.com/queues/get-started/#2-create-a-queue).\n* A [consumer Worker](https://developers.cloudflare.com/queues/reference/how-queues-works/#create-a-consumer-worker) or [HTTP pull](https://developers.cloudflare.com/queues/configuration/pull-consumers/) enabled on your Queue.\n\n### Enable event notifications via Dashboard\n\n1. In the Cloudflare dashboard, go to the **R2 object storage** page.\n\n   [Go to **Overview**](https://dash.cloudflare.com/?to=/:account/r2/overview)\n\n2. Select the bucket you'd like to add an event notification rule to.\n\n3. Switch to the **Settings** tab, then scroll down to the **Event notifications** card.\n\n4. Select **Add notification** and choose the queue you'd like to receive notifications and the [type of events](https://developers.cloudflare.com/r2/buckets/event-notifications/#event-types) that will trigger them.\n\n5. Select **Add notification**.\n\n### Enable event notifications via Wrangler\n\n#### Set up Wrangler\n\nTo begin, install [`npm`](https://docs.npmjs.com/getting-started). Then [install Wrangler, the Developer Platform CLI](https://developers.cloudflare.com/workers/wrangler/install-and-update/).\n\n#### Enable event notifications on your R2 bucket\n\nLog in to Wrangler with the [`wrangler login` command](https://developers.cloudflare.com/workers/wrangler/commands/#login). Then add an [event notification rule](https://developers.cloudflare.com/r2/buckets/event-notifications/#event-notification-rules) to your bucket by running the [`r2 bucket notification create` command](https://developers.cloudflare.com/workers/wrangler/commands/#r2-bucket-notification-create).",
      "language": "unknown"
    },
    {
      "code": "To add filtering based on `prefix` or `suffix` use the `--prefix` or `--suffix` flag, respectively.",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "5. Query the data with R2 SQL",
      "id": "5.-query-the-data-with-r2-sql"
    },
    {
      "level": "h3",
      "text": "5.1. View recent transactions",
      "id": "5.1.-view-recent-transactions"
    },
    {
      "level": "h3",
      "text": "5.2. Filter the raw transactions into a new table to highlight high-value transactions",
      "id": "5.2.-filter-the-raw-transactions-into-a-new-table-to-highlight-high-value-transactions"
    },
    {
      "level": "h2",
      "text": "Conclusion",
      "id": "conclusion"
    },
    {
      "level": "h3",
      "text": "`r2 sql query`",
      "id": "`r2-sql-query`"
    },
    {
      "level": "h2",
      "text": "How errors are returned",
      "id": "how-errors-are-returned"
    },
    {
      "level": "h2",
      "text": "Error code reference",
      "id": "error-code-reference"
    },
    {
      "level": "h3",
      "text": "Authentication and authorization errors",
      "id": "authentication-and-authorization-errors"
    },
    {
      "level": "h3",
      "text": "Bucket errors",
      "id": "bucket-errors"
    },
    {
      "level": "h3",
      "text": "Object errors",
      "id": "object-errors"
    },
    {
      "level": "h3",
      "text": "Upload and request errors",
      "id": "upload-and-request-errors"
    },
    {
      "level": "h3",
      "text": "Multipart upload errors",
      "id": "multipart-upload-errors"
    },
    {
      "level": "h3",
      "text": "Service errors",
      "id": "service-errors"
    },
    {
      "level": "h2",
      "text": "Permissions",
      "id": "permissions"
    },
    {
      "level": "h2",
      "text": "Create API tokens via API",
      "id": "create-api-tokens-via-api"
    },
    {
      "level": "h3",
      "text": "Access Policy",
      "id": "access-policy"
    },
    {
      "level": "h3",
      "text": "Get S3 API credentials from an API token",
      "id": "get-s3-api-credentials-from-an-api-token"
    },
    {
      "level": "h2",
      "text": "Temporary access credentials",
      "id": "temporary-access-credentials"
    },
    {
      "level": "h2",
      "text": "Get started with bucket locks",
      "id": "get-started-with-bucket-locks"
    },
    {
      "level": "h3",
      "text": "Enable bucket lock via dashboard",
      "id": "enable-bucket-lock-via-dashboard"
    },
    {
      "level": "h3",
      "text": "Enable bucket lock via Wrangler",
      "id": "enable-bucket-lock-via-wrangler"
    },
    {
      "level": "h3",
      "text": "Enable bucket lock via API",
      "id": "enable-bucket-lock-via-api"
    },
    {
      "level": "h2",
      "text": "Get bucket lock rules for your R2 bucket",
      "id": "get-bucket-lock-rules-for-your-r2-bucket"
    },
    {
      "level": "h3",
      "text": "Dashboard",
      "id": "dashboard"
    },
    {
      "level": "h3",
      "text": "Wrangler",
      "id": "wrangler"
    },
    {
      "level": "h3",
      "text": "API",
      "id": "api"
    },
    {
      "level": "h2",
      "text": "Remove bucket lock rules from your R2 bucket",
      "id": "remove-bucket-lock-rules-from-your-r2-bucket"
    },
    {
      "level": "h3",
      "text": "Dashboard",
      "id": "dashboard"
    },
    {
      "level": "h3",
      "text": "Wrangler",
      "id": "wrangler"
    },
    {
      "level": "h3",
      "text": "API",
      "id": "api"
    },
    {
      "level": "h2",
      "text": "Bucket lock rules",
      "id": "bucket-lock-rules"
    },
    {
      "level": "h2",
      "text": "Notes",
      "id": "notes"
    },
    {
      "level": "h2",
      "text": "Bucket-Level Operations",
      "id": "bucket-level-operations"
    },
    {
      "level": "h2",
      "text": "Notes",
      "id": "notes"
    },
    {
      "level": "h2",
      "text": "Prerequisites",
      "id": "prerequisites"
    },
    {
      "level": "h2",
      "text": "Use CORS with a public bucket",
      "id": "use-cors-with-a-public-bucket"
    },
    {
      "level": "h2",
      "text": "Use CORS with a presigned URL",
      "id": "use-cors-with-a-presigned-url"
    },
    {
      "level": "h2",
      "text": "Use CORS with a custom domain",
      "id": "use-cors-with-a-custom-domain"
    },
    {
      "level": "h2",
      "text": "Add CORS policies from the dashboard",
      "id": "add-cors-policies-from-the-dashboard"
    },
    {
      "level": "h2",
      "text": "Add CORS policies via Wrangler CLI",
      "id": "add-cors-policies-via-wrangler-cli"
    },
    {
      "level": "h2",
      "text": "Response headers",
      "id": "response-headers"
    },
    {
      "level": "h2",
      "text": "Example",
      "id": "example"
    },
    {
      "level": "h2",
      "text": "Common Issues",
      "id": "common-issues"
    },
    {
      "level": "h2",
      "text": "Get started with event notifications",
      "id": "get-started-with-event-notifications"
    },
    {
      "level": "h3",
      "text": "Prerequisites",
      "id": "prerequisites"
    },
    {
      "level": "h3",
      "text": "Enable event notifications via Dashboard",
      "id": "enable-event-notifications-via-dashboard"
    },
    {
      "level": "h3",
      "text": "Enable event notifications via Wrangler",
      "id": "enable-event-notifications-via-wrangler"
    }
  ],
  "url": "llms-txt#configuration---exported-from-the-prior-steps",
  "links": []
}