{
  "title": "Copy only the necessary files",
  "content": "COPY --from=build /app/dist ./dist\nCOPY --from=build /app/package.json ./package.json\nCOPY --from=build /app/node_modules ./node_modules\n\nEXPOSE 3000\nCMD [\"pnpm\", \"start\"]\nyaml\nname: Build Docker images\n\non:\n  push:\n    branches: [\"main\"]\n\njobs:\n  build-and-push-dockerfile-image:\n    runs-on: ubuntu-latest\n\nsteps:\n       ...Same as step 7 from the previous example\n          \n      - name: Trigger Dokploy Deployment\n        uses: dokploy/dokploy-action@v1\n        run: |\n            curl -X 'POST' \\\n            'https://<your-dokploy-domain>/api/application.deploy' \\\n            -H 'accept: application/json' \\\n            -H 'x-api-key: YOUR-GENERATED-API-KEY' \\\n            -H 'Content-Type: application/json' \\\n            -d '{\n                 \"applicationId\": \"YOUR-APPLICATION-ID\"\n            }'\njson\n{\n  \"Test\": [\n    \"CMD\",\n    \"curl\",\n    \"-f\",\n    \"http://localhost:3000/health\"\n  ],\n  \"Interval\": 30000000000,\n  \"Timeout\": 10000000000,\n  \"StartPeriod\": 30000000000,\n  \"Retries\": 3\n}\njson\n{\n  \"Parallelism\": 1,\n  \"Delay\": 10000000000,\n  \"FailureAction\": \"rollback\",\n  \"Order\": \"start-first\"\n}\n```\n\nNow you everything a production ready application with automated deployments, zero downtime, rollbacks and healthchecks.\n\nWe recommend strongly to use this approach in production since this will make your server never build the application, will only in charge of the deployment keeping your server without any downtime.",
  "code_samples": [
    {
      "code": "9. Now when you make a commit to your repository, the workflow will be triggered and the application will build and push to `Dockerhub`.\n10. Now let's create application in Dokploy.\n11. In `Source Type` select `Docker`\n12. In the docker image field enter `namespace/example:latest`\n13. Click on `Save`.\n14. Click on `Deploy`.\n15. Go to `Domains` and click `Dices` icon to generate a domain and the port set to `3000`.\n16. Now you can access your application.\n\n### Auto deploy\n\nWhen using Dockerhub as a registry you can also enable auto deploy, this will automatically deploy your application whenever you push to your repository.\n\nTo setup auto deploys for Dockerhub, follow the steps below:\n\n1. Go to your application and select `Deployments` tab.\n2. Copy the `Webhook URL`.\n3. Go to your Dockerhub repository and select `Webhooks` tab.\n4. Set a name for the webhook and paste the `Webhook URL` copied in step 2.\n5. That's it, now every time you push to your repository, your application will trigger a deployment in dokploy.\n\nThe deployment will trigger only if the `Tag` matches the one specified in Dokploy.\n\n#### External Registry\n\nIf you have a registry that is not Dockerhub, you can trigger a deployment after pushing to your repository in Github Actions.\n\nYour workflow will look like this:\n\nThis method use the [Api Method](/docs/core/auto-deploy#api-method) to trigger a deployment.",
      "language": "unknown"
    },
    {
      "code": "You can also use this Github Action [Action](https://github.com/marketplace/actions/dokploy-deployment) to automate the deployment.\n\n## Healthcheck & Rollbacks\n\nWhen using Dokploy you can also configure healthchecks and rollbacks, this will allow you to configure your application to be able to recover from failures.\n\nIn the repo we are using from the `Step 1.` we have a healthcheck endpoint `/health` that returns a 200 status code and running in the port 3000.\n\nGo to `Advanced` Tab and go to Cluster Settings and enter to `Swarm Settings`\n\nThere are a couple options that you can use, in this case we will focus on `Health Check` and `Update Config`.\n\nMake sure the API Route exists in your application",
      "language": "unknown"
    },
    {
      "code": "Now in the `Update Config`\n\nNow when the application is getting unhealthy response from the health check, the container will rollback to the previous version.\n\nPaste the following code:",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h3",
      "text": "Auto deploy",
      "id": "auto-deploy"
    },
    {
      "level": "h2",
      "text": "Healthcheck & Rollbacks",
      "id": "healthcheck-&-rollbacks"
    }
  ],
  "url": "llms-txt#copy-only-the-necessary-files",
  "links": []
}