{
  "title": "Rollbacks",
  "content": "import { Callout } from 'fumadocs-ui/components/callout';\n\nRollbacks are a powerful feature that allows you to easily revert changes to your application. This is particularly useful when you encounter issues or want to revert to a previous version of your application.\n\n## Types of Rollbacks\n\nDokploy supports two types of rollback mechanisms:\n\n1. **Docker Swarm Rollbacks** (Automatic): Based on health checks, automatically reverts to the previous version if a deployment fails health checks\n2. **Registry-based Rollbacks** (Manual): Uses Docker registry to store each deployment's image, allowing you to manually rollback to any specific deployment version\n\n<Callout type=\"info\">\n  The rollback methods described in the first section of this guide are based on **Docker Swarm's automatic rollback feature**. Dokploy also supports **registry-based rollbacks** at the deployment level, which allows you to save each deployment's image to a registry and rollback to any specific version. See the \"Rollback to a specific version\" section below for more details.\n</Callout>\n\n1. Have a `/health` endpoint in your application.\n2. Have `curl` available in your container (if you use alpine for example, it won't be installed by default).\n\n## Docker Swarm Automatic Rollback\n\nThis method uses Docker Swarm's built-in rollback feature, which automatically reverts to the previous version if health checks fail during deployment.\n\n<Callout type=\"info\">\n  This rollback method is **automatic** and based on Docker Swarm's health check system. It only works if the new deployment fails health checks, triggering an automatic rollback to the previous version.\n</Callout>\n\n### Steps to Configure Automatic Rollback\n\nLet's suppose we have a NodeJS application that has a health check route `/api/health` that returns a 200 status code and running in the port 3000.\n\n1. In your application is necessary to have a `Path` or `Health Route` to be able to achieve zero downtime deployments eg. in the case of a NodeJS app you can have a route `/api/health` that returns a 200 status code.\n2. Go to `Advanced` Tab and go to Cluster Settings and enter to `Swarm Settings`\n3. There are a couple options that you can use, in this case we will focus on `Health Check` and `Update Config`.\n4. Paste this code in the health check field:\n   Make sure the API Route exists in your application\n\n5. Now in the `Update Config`\n\nNow when the application is getting unhealthy response from the health check, the container will rollback to the previous version.\n\nPaste the following code:\n\n## Registry-based Rollback to Specific Versions\n\nThe previous section covered Docker Swarm's automatic rollback feature, which only works when health checks fail. Dokploy also supports **registry-based rollbacks** at the deployment level, which provides more control and flexibility.\n\n### How Registry-based Rollbacks Work\n\nWhen using registry-based rollbacks, Dokploy:\n\n* **Saves each deployment's image to your configured registry**: Every time you deploy, the built image is tagged and pushed to your Docker registry (Docker Hub, GHCR, etc.)\n* **Associates each deployment with its image**: Each deployment record in Dokploy is linked to a specific image tag in your registry\n* **Enables rollback to any deployment**: You can rollback to any previous deployment by using the image that was saved during that deployment\n\nThis approach is different from Docker Swarm rollbacks because:\n\n* ✅ **Works with any deployment**: Not limited to health check failures\n* ✅ **Rollback to any version**: Can rollback to any previous deployment, not just the immediate previous one\n* ✅ **Uses registry storage**: Images are stored in your registry, making them persistent and accessible\n\n<Callout type=\"info\">\n  Registry-based rollbacks require that your application is configured to use a Docker registry. The images are automatically pushed to your registry during each deployment, and Dokploy tracks which image corresponds to each deployment.\n</Callout>\n\n### Prerequisites for Registry-based Rollbacks\n\nTo use registry-based rollbacks, you need:\n\n1. **A configured Docker registry** in Dokploy (Docker Hub, GHCR, or custom registry)\n2. **Registry credentials** set up in Dokploy's registry settings\n3. **Application configured to push images** to the registry during deployment\n\n<Callout type=\"info\">\n  When you enable rollbacks, Dokploy will automatically push each deployment's image to your configured registry with a unique tag, allowing you to rollback to any specific deployment version.\n</Callout>\n\n### Enabling Registry-based Rollbacks\n\nTo start saving deployment images to your registry for rollbacks:\n\n1. Navigate to your application\n2. Go to **Deployments** → **Rollback Settings**\n3. Enable the **Rollback** option\n4. Select the registry you want to use for rollbacks\n5. Click on **Save**\n\nOnce enabled, Dokploy will:\n\n* **Automatically tag and push images**: Every deployment's image is tagged and pushed to your configured registry\n* **Track deployment associations**: Each deployment is linked to its specific image tag in the registry\n* **Enable rollback buttons**: You'll see a **Rollback** button next to each deployment in the Deployments section\n\n### Performing a Registry-based Rollback\n\n1. Go to your application's **Deployments** section\n2. Find the deployment version you want to rollback to\n3. Click the **Rollback** button next to that deployment\n4. Confirm the rollback action\n\n<Callout type=\"info\">\n  After clicking **Rollback**, you'll need to wait a few seconds for Dokploy to download the image from your registry. The container will not appear in the **Logs** tab immediately - wait a moment for the image download to complete before checking the logs to see the container running.\n</Callout>",
  "code_samples": [
    {
      "code": "{\n  \"Test\": [\n    \"CMD\",\n    \"curl\",\n    \"-f\",\n    \"http://localhost:3000/api/health\"\n  ],\n  \"Interval\": 30000000000,\n  \"Timeout\": 10000000000,\n  \"StartPeriod\": 30000000000,\n  \"Retries\": 3\n}",
      "language": "json"
    },
    {
      "code": "{\n  \"Parallelism\": 1,\n  \"Delay\": 10000000000,\n  \"FailureAction\": \"rollback\",\n  \"Order\": \"start-first\"\n}",
      "language": "json"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Types of Rollbacks",
      "id": "types-of-rollbacks"
    },
    {
      "level": "h2",
      "text": "Requirements",
      "id": "requirements"
    },
    {
      "level": "h2",
      "text": "Docker Swarm Automatic Rollback",
      "id": "docker-swarm-automatic-rollback"
    },
    {
      "level": "h3",
      "text": "Steps to Configure Automatic Rollback",
      "id": "steps-to-configure-automatic-rollback"
    },
    {
      "level": "h2",
      "text": "Registry-based Rollback to Specific Versions",
      "id": "registry-based-rollback-to-specific-versions"
    },
    {
      "level": "h3",
      "text": "How Registry-based Rollbacks Work",
      "id": "how-registry-based-rollbacks-work"
    },
    {
      "level": "h3",
      "text": "Prerequisites for Registry-based Rollbacks",
      "id": "prerequisites-for-registry-based-rollbacks"
    },
    {
      "level": "h3",
      "text": "Enabling Registry-based Rollbacks",
      "id": "enabling-registry-based-rollbacks"
    },
    {
      "level": "h3",
      "text": "Performing a Registry-based Rollback",
      "id": "performing-a-registry-based-rollback"
    }
  ],
  "url": "llms-txt#rollbacks",
  "links": []
}