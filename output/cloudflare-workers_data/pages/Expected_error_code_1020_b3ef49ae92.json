{
  "title": "Expected: error code: 1020",
  "content": "bash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/logpush/jobs\" \\\n  --request POST \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"name\": \"<PUBLIC_DOMAIN>\",\n    \"destination_conf\": \"https://<PUBLIC_DOMAIN>:<PUBLIC_PORT>?header_<SECRET_HEADER>=<SECRET_VALUE>\",\n    \"dataset\": \"http_requests\",\n    \"output_options\": {\n        \"field_names\": [\n            \"RayID\",\n            \"EdgeStartTimestamp\"\n        ],\n        \"timestamp_format\": \"rfc3339\"\n    }\n  }'\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/logpush/jobs\" \\\n  --request POST \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"name\": \"theburritobot.com-https\",\n    \"output_options\": {\n        \"field_names\": [\n            \"EdgeStartTimestamp\",\n            \"RayID\"\n        ],\n        \"timestamp_format\": \"rfc3339\"\n    },\n    \"destination_conf\": \"https://logs.example.com?header_Authorization=Basic%20REDACTED&tags=host:theburritobot.com,dataset:http_requests\",\n    \"max_upload_bytes\": 5000000,\n    \"max_upload_records\": 1000,\n    \"dataset\": \"http_requests\",\n    \"enabled\": true\n  }'\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/logpush/jobs\" \\\n  --request POST \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"name\": \"<DOMAIN_NAME>\",\n    \"output_options\": {\n        \"output_type\": \"ndjson\",\n        \"timestamp_format\": \"rfc3339\",\n        \"batch_prefix\": \"[\",\n        \"batch_suffix\": \"]\",\n        \"record_prefix\": \"{\\\"applicationName\\\":\\\"ibm-platform-log\\\",\\\"subsystemName\\\":\\\"internet-svcs:logpush\\\",\\\"text\\\":{\",\n        \"record_suffix\": \"}}\",\n        \"record_delimiter\": \",\"\n    },\n    \"destination_conf\": \"ibmcl://<INSTANCE_ID>.ingress.<REGION>.logs.cloud.ibm.com/logs/v1/singles?ibm_api_key=<IBM_API_KEY>\",\n    \"max_upload_bytes\": 2000000,\n    \"dataset\": \"http_requests\",\n    \"enabled\": true\n  }'\njson\n{\n  \"errors\": [],\n  \"messages\": [],\n  \"result\": {\n    \"dataset\": \"http_requests\",\n    \"destination_conf\": \"ibmcl://<INSTANCE_ID>.ingress.<REGION>.logs.cloud.ibm.com/logs/v1/singles?ibm_api_key=<IBM_API_KEY>\",\n    \"enabled\": true,\n    \"error_message\": null,\n    \"id\": <JOB_ID>,\n    \"kind\": \"\",\n    \"last_complete\": null,\n    \"last_error\": null,\n    \"output_options\": {\n      \"output_type\": \"ndjson\",\n      \"timestamp_format\": \"rfc3339\",\n      \"batch_prefix\": \"[\",\n      \"batch_suffix\": \"]\",\n      \"record_prefix\": \"{\\\"applicationName\\\":\\\"ibm-platform-log\\\",\\\"subsystemName\\\":\\\"internet-svcs:logpush\\\",\\\"text\\\":{\",\n      \"record_suffix\": \"}}\",\n      \"record_delimiter\": \",\"\n    },\n    \"max_upload_bytes\": 2000000,\n    \"name\": \"<DOMAIN_NAME>\"\n  },\n  \"success\": true\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/logpush/jobs/$JOB_ID\" \\\n  --request PUT \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"enabled\": true\n  }'\njson\n{\n  \"errors\": [],\n  \"messages\": [],\n  \"result\": {\n    \"dataset\": \"http_requests\",\n    \"destination_conf\": \"ibmcl://<INSTANCE_ID>.ingress.<REGION>.logs.cloud.ibm.com/logs/v1/singles?ibm_api_key=<IBM_API_KEY>\",\n    \"enabled\": true,\n    \"error_message\": null,\n    \"id\": <JOB_ID>,\n    \"kind\": \"\",\n    \"last_complete\": null,\n    \"last_error\": null,\n    \"output_options\": {\n      \"output_type\": \"ndjson\",\n      \"timestamp_format\": \"rfc3339\",\n      \"batch_prefix\": \"[\",\n      \"batch_suffix\": \"]\",\n      \"record_prefix\": \"{\\\"applicationName\\\":\\\"ibm-platform-log\\\",\\\"subsystemName\\\":\\\"internet-svcs:logpush\\\",\\\"text\\\":{\",\n      \"record_suffix\": \"}}\",\n      \"record_delimiter\": \",\"\n    },\n    \"max_upload_bytes\": 2000000,\n    \"name\": \"<DOMAIN_NAME>\"\n  },\n  \"success\": true\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/logpush/jobs\" \\\n  --request POST \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"name\": \"<NAME>\",\n    \"output_options\": {\n        \"field_names\": [\n            \"Action\",\n            \"ClientIP\",\n            \"ClientASN\",\n            \"ClientASNDescription\",\n            \"ClientCountry\",\n            \"ClientIPClass\",\n            \"ClientRefererHost\",\n            \"ClientRefererPath\",\n            \"ClientRefererQuery\",\n            \"ClientRefererScheme\",\n            \"ClientRequestHost\",\n            \"ClientRequestMethod\",\n            \"ClientRequestPath\",\n            \"ClientRequestProtocol\",\n            \"ClientRequestQuery\",\n            \"ClientRequestScheme\",\n            \"ClientRequestUserAgent\",\n            \"EdgeColoCode\",\n            \"EdgeResponseStatus\",\n            \"Kind\",\n            \"MatchIndex\",\n            \"Metadata\",\n            \"OriginResponseStatus\",\n            \"OriginatorRayID\",\n            \"RayID\",\n            \"RuleID\",\n            \"Source\",\n            \"Datetime\"\n        ],\n        \"timestamp_format\": \"rfc3339\"\n    },\n    \"destination_conf\": \"<QRADAR_URL>:<LOG_SOURCE_PORT>\",\n    \"max_upload_bytes\": 5000000,\n    \"max_upload_records\": 1000,\n    \"dataset\": \"firewall_events\",\n    \"enabled\": true\n  }'\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/logpush/jobs\" \\\n  --request POST \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"name\": \"<NAME>\",\n    \"output_options\": {\n        \"field_names\": [\n            \"ClientRequestMethod\",\n            \"EdgeResponseStatus\",\n            \"ClientIP\",\n            \"ClientSrcPort\",\n            \"CacheCacheStatus\",\n            \"ClientCountry\",\n            \"ClientDeviceType\",\n            \"ClientIPClass\",\n            \"ClientMTLSAuthCertFingerprint\",\n            \"ClientMTLSAuthStatus\",\n            \"ClientRegionCode\",\n            \"ClientRequestBytes\",\n            \"ClientRequestHost\",\n            \"ClientRequestPath\",\n            \"ClientRequestProtocol\",\n            \"ClientRequestReferer\",\n            \"ClientRequestScheme\",\n            \"ClientRequestSource\",\n            \"ClientRequestURI\",\n            \"ClientRequestUserAgent\",\n            \"ClientSSLCipher\",\n            \"ClientSSLProtocol\",\n            \"ClientXRequestedWith\",\n            \"EdgeEndTimestamp\",\n            \"EdgeRequestHost\",\n            \"EdgeResponseBodyBytes\",\n            \"EdgeResponseBytes\",\n            \"EdgeServerIP\",\n            \"EdgeStartTimestamp\",\n            \"SecurityActions\",\n            \"SecurityRuleIDs\",\n            \"SecuritySources\",\n            \"OriginIP\",\n            \"OriginResponseStatus\",\n            \"OriginSSLProtocol\",\n            \"ParentRayID\",\n            \"RayID\",\n            \"SecurityAction\",\n            \"WAFAttackScore\",\n            \"SecurityRuleID\",\n            \"SecurityRuleDescription\",\n            \"WAFSQLiAttackScore\",\n            \"WAFXSSAttackScore\",\n            \"EdgeStartTimestamp\"\n        ],\n        \"timestamp_format\": \"rfc3339\"\n    },\n    \"destination_conf\": \"<QRADAR_URL>:<LOG_SOURCE_PORT>\",\n    \"max_upload_bytes\": 5000000,\n    \"max_upload_records\": 1000,\n    \"dataset\": \"http_requests\",\n    \"enabled\": true\n  }'\njava\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": [\n                    \"arn:aws:iam::391854517948:user/cloudflare-logpush\"\n                ]\n            },\n            \"Action\": \"sts:AssumeRole\"\n        }\n    ]\n}\njava\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": \"kinesis:PutRecord\",\n            \"Resource\": \"arn:aws:kinesis:<AWS_REGION>:<YOUR_AWS_ACCOUNT_ID>:stream/<STREAM_NAME>\"\n        }\n    ]\n}\nbash\nkinesis://<STREAM_NAME>?region=<AWS_REGION>&sts-assume-role-arn=arn:aws:iam::<YOUR_AWS_ACCOUNT_ID>:role/<IAM_ROLE_NAME>\nbash\nkinesis://<STREAM_NAME>?region=<AWS_REGION>&sts-assume-role-arn=arn:aws:iam::<YOUR_AWS_ACCOUNT_ID>:role/<IAM_ROLE_NAME>&sts-external-id=<EXTERNAL_ID>\nbash\n$ curl https://api.cloudflare.com/client/v4/zones/$ZONE_TAG/logpush/jobs \\\n-H 'Authorization: Bearer <API_TOKEN>' \\\n-H 'Content-Type: application/json' -d '{\n  \"name\": \"kinesis\",\n  \"destination_conf\": \"kinesis://<STREAM_NAME>?region=<AWS_REGION>&sts-assume-role-arn=arn:aws:iam::<YOUR_AWS_ACCOUNT_ID>:role/<IAM_ROLE_NAME>\",\n  \"dataset\": \"http_requests\",\n  \"enabled\": true\n}'\nbash\nkinesis://<STREAM_NAME>?region=<AWS_REGION>&access-key-id=<AWS_ACCESS_KEY_ID>&secret-access-key=<AWS_SECRET_ACCESS_KEY>\nbash\n$ curl https://api.cloudflare.com/client/v4/zones/$ZONE_TAG/logpush/jobs \\\n-H 'Authorization: Bearer <API_TOKEN>' \\\n-H 'Content-Type: application/json' -d '{\n  \"name\": \"kinesis\",\n  \"destination_conf\": \"kinesis://<STREAM_NAME>?region=<AWS_REGION>&access-key-id=<AWS_ACCESS_KEY_ID>&secret-access-key=<AWS_SECRET_ACCESS_KEY>\",\n  \"dataset\": \"http_requests\",\n  \"enabled\": true\n}'\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/logpush/jobs\" \\\n  --request POST \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"name\": \"<DOMAIN_NAME>\",\n    \"output_options\": {\n        \"field_names\": [\n            \"ClientIP\",\n            \"ClientRequestHost\",\n            \"ClientRequestMethod\",\n            \"ClientRequestURI\",\n            \"EdgeEndTimestamp\",\n            \"EdgeResponseBytes\",\n            \"EdgeResponseStatus\",\n            \"EdgeStartTimestamp\",\n            \"RayID\"\n        ],\n        \"timestamp_format\": \"unix\"\n    },\n    \"destination_conf\": \"https://log-api.newrelic.com/log/v1?Api-Key=<NR_LICENSE_KEY>&format=cloudflare\",\n    \"max_upload_bytes\": 5000000,\n    \"dataset\": \"http_requests\",\n    \"enabled\": true\n  }'\njson\n{\n  \"errors\": [],\n  \"messages\": [],\n  \"result\": {\n    \"dataset\": \"http_requests\",\n    \"destination_conf\": \"https://log-api.newrelic.com/log/v1?Api-Key=<NR_LICENSE_KEY>&format=cloudflare\",\n    \"enabled\": true,\n    \"error_message\": null,\n    \"id\": <JOB_ID>,\n    \"kind\": \"\",\n    \"last_complete\": null,\n    \"last_error\": null,\n    \"output_options\": {\n      \"field_names\": [\"ClientIP\", \"ClientRequestHost\", \"ClientRequestMethod\", \"ClientRequestURI\", \"EdgeEndTimestamp\",\"EdgeResponseBytes\", \"EdgeResponseStatus\", \"EdgeStartTimestamp\", \"RayID\"],\n      \"timestamp_format\": \"unix\"\n    },\n    \"max_upload_bytes\": 5000000,\n    \"name\": \"<DOMAIN_NAME>\"\n  },\n  \"success\": true\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/logpush/jobs/$JOB_ID\" \\\n  --request PUT \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"enabled\": true\n  }'\njson\n{\n  \"errors\": [],\n  \"messages\": [],\n  \"result\": {\n    \"dataset\": \"http_requests\",\n    \"destination_conf\": \"https://log-api.newrelic.com/log/v1?Api-Key=<NR_LICENSE_KEY>&format=cloudflare\",\n    \"enabled\": true,\n    \"error_message\": null,\n     \"id\": <JOB_ID>,\n     \"kind\": \"\",\n     \"last_complete\": \"null\",\n     \"last_error\": null,\n     \"output_options\": {\n       \"field_names\": [\"ClientIP\", \"ClientRequestHost\", \"ClientRequestMethod\", \"ClientRequestURI\", \"EdgeEndTimestamp\",\"EdgeResponseBytes\", \"EdgeResponseStatus\", \"EdgeStartTimestamp\", \"RayID\"],\n       \"timestamp_format\": \"unix\"\n     },\n     \"max_upload_bytes\": 5000000,\n     \"name\": \"<DOMAIN_NAME>\"\n  },\n  \"success\": true\n}\nbash\nr2://<BUCKET_PATH>/{DATE}?account-id=<ACCOUNT_ID>&access-key-id=<R2_ACCESS_KEY_ID>&secret-access-key=<R2_SECRET_ACCESS_KEY>\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/logpush/jobs\" \\\n  --request POST \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"name\": \"<DOMAIN_NAME>\",\n    \"output_options\": {\n        \"field_names\": [\n            \"ClientIP\",\n            \"ClientRequestHost\",\n            \"ClientRequestMethod\",\n            \"ClientRequestURI\",\n            \"EdgeEndTimestamp\",\n            \"EdgeResponseBytes\",\n            \"EdgeResponseStatus\",\n            \"EdgeStartTimestamp\",\n            \"RayID\"\n        ],\n        \"timestamp_format\": \"rfc3339\"\n    },\n    \"destination_conf\": \"r2://<BUCKET_PATH>/{DATE}?account-id=<ACCOUNT_ID>&access-key-id=<R2_ACCESS_KEY_ID>&secret-access-key=<R2_SECRET_ACCESS_KEY>\",\n    \"dataset\": \"http_requests\",\n    \"enabled\": true\n  }'\nbash\naws s3 cp s3://<BUCKET-NAME>/<PATH-TO-LOG-FILE> <LOCAL-DESTINATION>\nbash\n\"https://<SENTINELONE_ENDPOINT_URL>?sourcetype=<SOURCE_TYPE>&header_Authorization=<SENTINELONE_AUTH_TOKEN>\"\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/logpush/jobs\" \\\n  --request POST \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"name\": \"<DOMAIN_NAME>\",\n    \"destination_conf\": \"sentinelone://<SENTINELONE_ENDPOINT_URL>?sourcetype=<SOURCE_TYPE>&header_Authorization=<SENTINELONE_AUTH_TOKEN>\",\n    \"output_options\": {\n        \"field_names\": [\n            \"ClientIP\",\n            \"ClientRequestHost\",\n            \"ClientRequestMethod\",\n            \"ClientRequestURI\",\n            \"EdgeEndTimestamp\",\n            \"EdgeResponseBytes\",\n            \"EdgeResponseStatus\",\n            \"EdgeStartTimestamp\",\n            \"RayID\"\n        ],\n        \"timestamp_format\": \"rfc3339\"\n    },\n    \"dataset\": \"http_requests\"\n  }'\njson\n{\n  \"errors\": [],\n  \"messages\": [],\n  \"result\": {\n    \"id\": <JOB_ID>,\n    \"dataset\": \"http_requests\",\n    \"enabled\": false,\n    \"name\": \"<DOMAIN_NAME>\",\n    \"output_options\": {\n      \"field_names\": [\"ClientIP\", \"ClientRequestHost\", \"ClientRequestMethod\", \"ClientRequestURI\", \"EdgeEndTimestamp\",\"EdgeResponseBytes\", \"EdgeResponseStatus\", \"EdgeStartTimestamp\", \"RayID\"],\n      \"timestamp_format\": \"rfc3339\"\n    },\n    \"destination_conf\": \"sentinelone://<SENTINELONE_ENDPOINT_URL>?sourcetype=<SOURCE_TYPE>&header_Authorization=<SENTINELONE_AUTH_TOKEN>\",\n    \"last_complete\": null,\n    \"last_error\": null,\n    \"error_message\": null\n  },\n  \"success\": true\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/logpush/jobs/$JOB_ID\" \\\n  --request PUT \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"enabled\": true\n  }'\njson\n{\n  \"errors\": [],\n  \"messages\": [],\n  \"result\": {\n    \"id\": <JOB_ID>,\n    \"dataset\": \"http_requests\",\n    \"enabled\": true,\n    \"name\": \"<DOMAIN_NAME>\",\n    \"output_options\": {\n      \"field_names\": [\"ClientIP\", \"ClientRequestHost\", \"ClientRequestMethod\", \"ClientRequestURI\", \"EdgeEndTimestamp\",\"EdgeResponseBytes\", \"EdgeResponseStatus\", \"EdgeStartTimestamp\", \"RayID\"],\n      \"timestamp_format\": \"rfc3339\"\n    },\n    \"destination_conf\": \"sentinelone://<SENTINELONE_ENDPOINT_URL>?sourcetype=<SOURCE_TYPE>&header_Authorization=<SENTINELONE_AUTH_TOKEN>\",\n    \"last_complete\": null,\n    \"last_error\": null,\n    \"error_message\": null\n  },\n  \"success\": true\n}\nbash\n\"s3://<BUCKET_NAME>/<BUCKET_PATH>?region=<REGION>&access-key-id=<ACCESS_KEY_ID>&secret-access-key=<SECRET_ACCESS_KEY>&endpoint=<ENDPOINT_URL>\"\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/logpush/jobs\" \\\n  --request POST \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"name\": \"<DOMAIN_NAME>\",\n    \"destination_conf\": \"s3://<BUCKET_NAME>/<BUCKET_PATH>?region=<REGION>&access-key-id=<ACCESS_KEY_ID>&secret-access-key=<SECRET_ACCESS_KEY>&endpoint=<ENDPOINT_URL>\",\n    \"output_options\": {\n        \"field_names\": [\n            \"ClientIP\",\n            \"ClientIP\",\n            \"ClientRequestHost\",\n            \"ClientRequestMethod\",\n            \"ClientRequestURI\",\n            \"EdgeEndTimestamp\",\n            \"EdgeResponseBytes\",\n            \"EdgeResponseStatus\",\n            \"EdgeStartTimestamp\",\n            \"RayID\"\n        ],\n        \"timestamp_format\": \"rfc3339\"\n    },\n    \"dataset\": \"http_requests\"\n  }'\njson\n{\n  \"errors\": [],\n  \"messages\": [],\n  \"result\": {\n    \"id\": <JOB_ID>,\n    \"dataset\": \"http_requests\",\n    \"enabled\": false,\n    \"name\": \"<DOMAIN_NAME>\",\n    \"output_options\": {\n      \"field_names\": [\"ClientIP\", \"ClientRequestHost\", \"ClientRequestMethod\", \"ClientRequestURI\", \"EdgeEndTimestamp\",\"EdgeResponseBytes\", \"EdgeResponseStatus\", \"EdgeStartTimestamp\", \"RayID\"],\n      \"timestamp_format\": \"rfc3339\"\n    },\n    \"destination_conf\": \"s3://<BUCKET_NAME>/<BUCKET_PATH>?region=<REGION>&access-key-id=<ACCESS_KEY_ID>&secret-access-key=<SECRET_ACCESS_KEY>&endpoint=<ENDPOINT_URL>\",\n    \"last_complete\": null,\n    \"last_error\": null,\n    \"error_message\": null\n  },\n  \"success\": true\n}\nbash\ncurl --request PUT \\\nhttps://api.cloudflare.com/client/v4/zones/{zone_id}/logpush/jobs/{job_id} \\\n--header \"X-Auth-Email: <EMAIL>\" \\\n--header \"X-Auth-Key: <API_KEY>\" \\\n--header \"Content-Type: application/json\" \\\n--data '{\n  \"enabled\": true\n}'\njson\n{\n  \"errors\": [],\n  \"messages\": [],\n  \"result\": {\n    \"id\": <JOB_ID>,\n    \"dataset\": \"http_requests\",\n    \"enabled\": true,\n    \"name\": \"<DOMAIN_NAME>\",\n    \"output_options\": {\n      \"field_names\": [\"ClientIP\", \"ClientRequestHost\", \"ClientRequestMethod\", \"ClientRequestURI\", \"EdgeEndTimestamp\",\"EdgeResponseBytes\", \"EdgeResponseStatus\", \"EdgeStartTimestamp\", \"RayID\"],\n      \"timestamp_format\": \"rfc3339\"\n    },\n    \"destination_conf\": \"s3://<BUCKET_NAME>/<BUCKET_PATH>?region=<REGION>&access-key-id=<ACCESS_KEY_ID>&secret-access-key=<SECRET_ACCESS_KEY>&endpoint=<ENDPOINT_URL>\",\n    \"last_complete\": null,\n    \"last_error\": null,\n    \"error_message\": null\n  },\n  \"success\": true\n}\nbash\n\"splunk://<SPLUNK_ENDPOINT_URL>?channel=<SPLUNK_CHANNEL_ID>&insecure-skip-verify=<INSECURE_SKIP_VERIFY>&sourcetype=<SOURCE_TYPE>&header_Authorization=<SPLUNK_AUTH_TOKEN>\"\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/logpush/jobs\" \\\n  --request POST \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"name\": \"<DOMAIN_NAME>\",\n    \"destination_conf\": \"splunk://<SPLUNK_ENDPOINT_URL>?channel=<SPLUNK_CHANNEL_ID>&insecure-skip-verify=<INSECURE_SKIP_VERIFY>&sourcetype=<SOURCE_TYPE>&header_Authorization=<SPLUNK_AUTH_TOKEN>\",\n    \"output_options\": {\n        \"field_names\": [\n            \"ClientIP\",\n            \"ClientRequestHost\",\n            \"ClientRequestMethod\",\n            \"ClientRequestURI\",\n            \"EdgeEndTimestamp\",\n            \"EdgeResponseBytes\",\n            \"EdgeResponseStatus\",\n            \"EdgeStartTimestamp\",\n            \"RayID\"\n        ],\n        \"timestamp_format\": \"rfc3339\"\n    },\n    \"dataset\": \"http_requests\"\n  }'\njson\n{\n  \"errors\": [],\n  \"messages\": [],\n  \"result\": {\n    \"id\": <JOB_ID>,\n    \"dataset\": \"http_requests\",\n    \"enabled\": false,\n    \"name\": \"<DOMAIN_NAME>\",\n    \"output_options\": {\n      \"field_names\": [\"ClientIP\", \"ClientRequestHost\", \"ClientRequestMethod\", \"ClientRequestURI\", \"EdgeEndTimestamp\",\"EdgeResponseBytes\", \"EdgeResponseStatus\", \"EdgeStartTimestamp\", \"RayID\"],\n      \"timestamp_format\": \"rfc3339\"\n    },\n    \"destination_conf\": \"splunk://<SPLUNK_ENDPOINT_URL>?channel=<SPLUNK_CHANNEL_ID>&insecure-skip-verify=<INSECURE_SKIP_VERIFY>&sourcetype=<SOURCE_TYPE>&header_Authorization=<SPLUNK_AUTH_TOKEN>\",\n    \"last_complete\": null,\n    \"last_error\": null,\n    \"error_message\": null\n  },\n  \"success\": true\n}\nbash\ncurl \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/logpush/jobs/$JOB_ID\" \\\n  --request PUT \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"enabled\": true\n  }'\njson\n{\n  \"errors\": [],\n  \"messages\": [],\n  \"result\": {\n    \"id\": <JOB_ID>,\n    \"dataset\": \"http_requests\",\n    \"enabled\": true,\n    \"name\": \"<DOMAIN_NAME>\",\n    \"output_options\": {\n      \"field_names\": [\"ClientIP\", \"ClientRequestHost\", \"ClientRequestMethod\", \"ClientRequestURI\", \"EdgeEndTimestamp\",\"EdgeResponseBytes\", \"EdgeResponseStatus\", \"EdgeStartTimestamp\", \"RayID\"],\n      \"timestamp_format\": \"rfc3339\"\n    },\n    \"destination_conf\": \"splunk://<SPLUNK_ENDPOINT_URL>?channel=<SPLUNK_CHANNEL_ID>&insecure-skip-verify=<INSECURE_SKIP_VERIFY>&sourcetype=<SOURCE_TYPE>&header_Authorization=<SPLUNK_AUTH_TOKEN>\",\n    \"last_complete\": null,\n    \"last_error\": null,\n    \"error_message\": null\n  },\n  \"success\": true\n}\ntxt\n     (http.request.method eq \"POST\" and http.host eq \"splunk.cf-analytics.com\" and http.request.uri.path eq \"/services/collector/raw\" and http.request.uri.query contains \"channel\" and ip.src.asnum eq 132892 and http.user_agent eq \"Go-http-client/2.0\")\n     txt\n     (http.request.method eq \"POST\" and http.host eq \"splunk.cf-analytics.com\" and http.request.uri.path eq \"/services/collector/raw\" and http.request.uri.query contains \"channel\" and ip.src.asnum eq 132892 and http.user_agent eq \"Go-http-client/2.0\")\n     mermaid\n\tflowchart LR\n\taccTitle: In this example, there are LANs where traffic flows between each other, instead of going to Cloudflare first.\n\t\t\ta(Magic WAN Connector) <---> b(Internet) <---> c(Cloudflare)\n\nsubgraph Customer site\n\t\t\td[LAN 1] <---> a\n\t\t\te[LAN 2] <---> a\n\t\t\tg[LAN 3] <---> a\n\t\t\th[LAN 4] <---> a\n\t\t\tend\n\t\t\tclassDef orange fill:#f48120,color: black\n\t\t\tclass a,c orange\n\nlinkStyle 0,1,2,3 stroke:#f48120,stroke-width:3px\n\t\t\tlinkStyle 4,5 stroke:red,stroke-width:3px\nbash\n  curl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/magic/sites/$SITE_ID/acls\" \\\n    --request POST \\\n    --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n    --json '{\n      \"description\": \"<POLICY_DESCRIPTION>\",\n      \"forward_locally\": true,\n      \"lan_1\": {\n          \"lan_id\": \"<LAN_ID>\",\n          \"lan_name\": \"<LAN_NAME>\",\n          \"ports\": [\n              1\n          ],\n          \"subnets\": [\n              \"192.0.2.1\"\n          ]\n      },\n      \"lan_2\": {\n          \"lan_id\": \"<LAN_ID>\",\n          \"lan_name\": \"<LAN_NAME\",\n          \"ports\": [\n              1\n          ],\n          \"subnets\": [\n              \"192.0.2.1\"\n          ]\n      },\n      \"name\": \"<POLICY_NAME>\",\n      \"protocols\": [\n          \"tcp\"\n      ]\n    }'\n  json\n  {\n    \"errors\": [\n      {\n        \"code\": 1000,\n        \"message\": \"message\"\n      }\n    ],\n    \"messages\": [\n      {\n        \"code\": 1000,\n        \"message\": \"message\"\n      }\n    ],\n    \"result\": {\n      \"id\": \"023e105f4ecef8ad9ca31a8372d0c353\",\n      \"description\": \"Allows local traffic between PIN pads and cash register.\",\n      \"forward_locally\": true,\n      \"lan_1\": {\n        \"lan_id\": \"lan_id\",\n        \"lan_name\": \"lan_name\",\n        \"port_ranges\": [\n          \"8080-9000\"\n        ],\n        \"ports\": [\n          1\n        ],\n        \"subnets\": [\n          \"192.0.2.1\"\n        ]\n      },\n      \"lan_2\": {\n        \"lan_id\": \"lan_id\",\n        \"lan_name\": \"lan_name\",\n        \"port_ranges\": [\n          \"8080-9000\"\n        ],\n        \"ports\": [\n          1\n        ],\n        \"subnets\": [\n          \"192.0.2.1\"\n        ]\n      },\n      \"name\": \"PIN Pad - Cash Register\",\n      \"protocols\": [\n        \"tcp\"\n      ],\n      \"unidirectional\": true\n    },\n    \"success\": true\n  }\n  bash\n  curl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/magic/sites/$SITE_ID/acls/$ACL_ID\" \\\n    --request PUT \\\n    --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n    --json '{\n      \"description\": \"<POLICY_DESCRIPTION>\",\n      \"forward_locally\": true,\n      \"lan_1\": {\n          \"lan_id\": \"<LAN_ID>\",\n          \"lan_name\": \"<LAN_NAME>\",\n          \"ports\": [\n              1\n          ],\n          \"subnets\": [\n              \"192.0.2.1\"\n          ]\n      },\n      \"lan_2\": {\n          \"lan_id\": \"<LAN_ID>\",\n          \"lan_name\": \"<LAN_NAME>\",\n          \"ports\": [\n              1\n          ],\n          \"subnets\": [\n              \"192.0.2.1\"\n          ]\n      },\n      \"name\": \"<POLICY_NAME>\",\n      \"protocols\": [\n          \"tcp\"\n      ]\n    }'\n  json\n  {\n    \"errors\": [\n      {\n        \"code\": 1000,\n        \"message\": \"message\"\n      }\n    ],\n    \"messages\": [\n      {\n        \"code\": 1000,\n        \"message\": \"message\"\n      }\n    ],\n    \"result\": {\n      \"id\": \"023e105f4ecef8ad9ca31a8372d0c353\",\n      \"connector_id\": \"ac60d3d0435248289d446cedd870bcf4\",\n      \"description\": \"description\",\n      \"ha_mode\": true,\n      \"location\": {\n        \"lat\": \"37.6192\",\n        \"lon\": \"122.3816\"\n      },\n      \"name\": \"site_1\",\n      \"secondary_connector_id\": \"8d67040d3835dbcf46ce29da440dc482\"\n    },\n    \"success\": true\n  }\n  bash\n  curl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/magic/sites/$SITE_ID/acls/$ACL_ID\" \\\n    --request DELETE \\\n    --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\"\n  mermaid\n\tflowchart TB\n\taccTitle: Routed subnets\n\taccDescr: Some LANs are complex, and might have additional subnets behind L3 routers.\n\nsubgraph b [Magic WAN Connector]\n\tdirection TB\n\tc(LAN 1)\n\td(LAN n)\n\tend\n\nc --- e(subnet x):::blue\n\td --- f(subnet 192.168.100.0/24):::blue\n\nf---|192.168.100.10|g(Layer 3 router)\n\ng --- h(routed subnet y):::red\n\tg --- i(192.168.200.0/24):::red\n\tg --- j(layer 3 router)\n\tj --- k(routed subnet z):::red\n\nclassDef blue fill:#add8e6,color: black\n\tclassDef red fill:#ff6900,color: black\nbash\ncurl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/zerotrust/subnets/cloudflare_source/$ADDRESS_FAMILY\" \\\n  --request PATCH \\\n  --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  --json '{\n    \"comment\": \"example_comment\",\n    \"name\": \"IPv4 Cloudflare Source IPs\",\n    \"network\": \"100.64.0.0/12\"\n  }'\nbash\n  curl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/magic/routes\" \\\n    --request POST \\\n    --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n    --json '{\n      \"nexthop\": \"<IP_NEXT_HOP>\",\n      \"prefix\": \"<YOUR_IP_PREFIX>\",\n      \"priority\": 0,\n      \"id\": \"023e105f4ecef8ad9ca31a8372d0c353\",\n      \"description\": \"<ROUTE_DESCRIPTION>\",\n      \"scope\": {\n          \"colo_names\": [\n              \"den01\"\n          ],\n          \"colo_regions\": [\n              \"APAC\"\n          ]\n      },\n      \"weight\": 0\n    }'\n  json\n  {\n    \"errors\": [\n      {\n        \"code\": 1000,\n        \"message\": \"message\"\n      }\n    ],\n    \"messages\": [\n      {\n        \"code\": 1000,\n        \"message\": \"message\"\n      }\n    ],\n    \"result\": {\n      \"routes\": [\n        {\n          \"nexthop\": \"203.0.113.1\",\n          \"prefix\": \"192.0.2.0/24\",\n          \"priority\": 0,\n          \"id\": \"023e105f4ecef8ad9ca31a8372d0c353\",\n          \"description\": \"New route for new prefix 203.0.113.1\",\n          \"scope\": {\n            \"colo_names\": [\n              \"den01\"\n            ],\n            \"colo_regions\": [\n              \"APAC\"\n            ]\n          },\n          \"weight\": 0\n        }\n      ]\n    },\n    \"success\": true\n  }\n  bash\n  curl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/magic/routes/$ROUTE_ID\" \\\n    --request PUT \\\n    --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n    --json '{\n      \"nexthop\": \"<IP_NEXT_HOP>\",\n      \"prefix\": \"<YOUR_IP_PREFIX>\",\n      \"priority\": 0,\n      \"id\": \"023e105f4ecef8ad9ca31a8372d0c353\",\n      \"description\": \"<ROUTE_DESCRIPTION>\",\n      \"scope\": {\n          \"colo_names\": [\n              \"den01\"\n          ],\n          \"colo_regions\": [\n              \"APAC\"\n          ]\n      },\n      \"weight\": 0\n    }'\n  json\n  {\n    \"errors\": [\n      {\n        \"code\": 1000,\n        \"message\": \"message\"\n      }\n    ],\n    \"messages\": [\n      {\n        \"code\": 1000,\n        \"message\": \"message\"\n      }\n    ],\n    \"result\": {\n      \"modified\": true,\n      \"modified_route\": {\n        \"nexthop\": \"203.0.113.1\",\n        \"prefix\": \"192.0.2.0/24\",\n        \"priority\": 0,\n        \"id\": \"023e105f4ecef8ad9ca31a8372d0c353\",\n        \"description\": \"New route for new prefix 203.0.113.1\",\n        \"scope\": {\n          \"colo_names\": [\n            \"den01\"\n          ],\n          \"colo_regions\": [\n            \"APAC\"\n          ]\n        },\n        \"weight\": 0\n      }\n    },\n    \"success\": true\n  }\n  bash\n  curl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/magic/routes/$ROUTE_ID\" \\\n    --request DELETE \\\n    --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\"\n  json\n  {\n    \"errors\": [\n      {\n        \"code\": 1000,\n        \"message\": \"message\"\n      }\n    ],\n    \"messages\": [\n      {\n        \"code\": 1000,\n        \"message\": \"message\"\n      }\n    ],\n    \"result\": {\n      \"deleted\": true,\n      \"deleted_route\": {\n        \"nexthop\": \"203.0.113.1\",\n        \"prefix\": \"192.0.2.0/24\",\n        \"priority\": 0,\n        \"id\": \"023e105f4ecef8ad9ca31a8372d0c353\",\n        \"description\": \"New route for new prefix 203.0.113.1\",\n        \"scope\": {\n          \"colo_names\": [\n            \"den01\"\n          ],\n          \"colo_regions\": [\n            \"APAC\"\n          ]\n        },\n        \"weight\": 0\n      }\n    },\n    \"success\": true\n  }\n  bash\n  curl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/magic/ipsec_tunnels\" \\\n    --request POST \\\n    --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n    --json '{\n      \"cloudflare_endpoint\": \"<CLOUDFLARE_ENDPOINT>\",\n      \"interface_address\": \"<INTERFACE_ADDRESS>\",\n      \"name\": \"IPsec_1\",\n      \"customer_endpoint\": \"<CUSTOMER_ENDPOINT>\",\n      \"description\": \"Tunnel for ISP X\",\n      \"psk\": \"<PSK>\",\n      \"automatic_return_routing\": \"true\"\n    }'\n  bash\n  curl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/magic/gre_tunnels\" \\\n    --request POST \\\n    --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n    --json '{\n      \"name\": \"<TUNNEL_NAME>\",\n      \"description\": \"<TUNNEL_DESCRIPTION>\",\n      \"interface_address\": \"<INTERFACE_ADDRESS>\",\n      \"cloudflare_gre_endpoint\": \"<CLOUDFLARE_ENDPOINT>\",\n      \"customer_gre_endpoint\": \"<CUSTOMER_ENDPOINT>\"\n    }'\n  json\n  {\n    \"errors\": [\n      {\n        \"code\": 1000,\n        \"message\": \"message\"\n      }\n    ],\n    \"messages\": [\n      {\n        \"code\": 1000,\n        \"message\": \"message\"\n      }\n    ],\n    \"result\": {\n      \"gre_tunnels\": [\n        {\n          \"cloudflare_gre_endpoint\": \"<IP_ADDRESS>\",\n          \"customer_gre_endpoint\": \"<IP_ADDRESS>\",\n          \"interface_address\": \"<INTERFACE_CIDR>\",\n          \"name\": \"<TUNNEL_NAME>\",\n          \"description\": \"<TUNNEL_DESCRIPTION>\",\n          \"health_check\": {\n            \"direction\": \"unidirectional\",\n            \"enabled\": true,\n            \"rate\": \"low\",\n            \"type\": \"reply\"\n          },\n          \"mtu\": 0,\n          \"ttl\": 0\n        }\n      ]\n    },\n    \"success\": true\n  }\n  bash\n     curl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/magic/ipsec_tunnels\" \\\n       --request POST \\\n       --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n       --json '{\n         \"name\": \"<TUNNEL_NAME>\",\n         \"description\": \"<TUNNEL_DESCRIPTION>\",\n         \"interface_address\": \"<INTERFACE_ADDRESS>\",\n         \"cloudflare_endpoint\": \"<CLOUDFLARE_ENDPOINT>\",\n         \"customer_endpoint\": \"<CUSTOMER_ENDPOINT>\"\n       }'\n     json\n     {\n       \"errors\": [\n         {\n           \"code\": 1000,\n           \"message\": \"message\"\n         }\n       ],\n       \"messages\": [\n         {\n           \"code\": 1000,\n           \"message\": \"message\"\n         }\n       ],\n       \"result\": {\n         \"ipsec_tunnels\": [\n           {\n             \"id\": \"<IPSEC_TUNNEL_ID>\",\n             \"interface_address\": \"<INTERFACE_CIDR>\",\n             \"name\": \"<TUNNEL_NAME>\",\n             \"cloudflare_endpoint\": \"<IP_ADDRESS>\",\n             \"customer_endpoint\": \"<IP_ADDRESS>\",\n             \"description\": \"<TUNNEL_DESCRIPTION>\",\n             \"health_check\": {\n               \"direction\": \"unidirectional\",\n               \"enabled\": true,\n               \"rate\": \"low\",\n               \"type\": \"reply\"\n             },\n             \"psk_metadata\": {},\n             \"replay_protection\": false\n           }\n         ]\n       },\n       \"success\": true\n     }\n     bash\n     curl \"https://api.cloudflare.com/client/v4/accounts/$ACCOUNT_ID/magic/ipsec_tunnels/$IPSEC_TUNNEL_ID/psk_generate\" \\\n       --request POST \\\n       --header \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\"\n     json\n     {\n       \"result\": {\n         \"ipsec_id\": \"<IPSEC_ID>\",\n         \"ipsec_tunnel_id\": \"<IPSEC_TUNNEL_ID>\",\n         \"psk\": \"<PSK_CODE>\",\n         \"psk_metadata\": {\n           \"last_generated_on\": \"2025-03-13T14:28:47.054317925Z\"\n         }\n       },\n       \"success\": true,\n       \"errors\": [],\n       \"messages\": []\n     }\n     bash\n     curl \"https://api.cloudflare.com/client/v4/accounts/%7Baccount_id%7D/magic/ipsec_tunnels/%7Bipsec_tunnel_id%7D\" \\\n       --request PUT \\\n       --json '{\n         \"psk\": \"<PSK_VALUE>\"\n       }'\n     json\n  {\n    \"result\": {\n      \"modified\": true,\n      \"modified_ipsec_tunnel\": {\n        \"id\": \"<IPSEC_ID>\",\n        \"interface_address\": \"<IPSEC_CIDR>\",\n        \"created_on\": \"2025-03-13T14:28:21.139535Z\",\n        \"modified_on\": \"2025-03-13T14:33:26.09683Z\",\n        \"name\": \"<TUNNEL_NAME>\",\n        \"cloudflare_endpoint\": \"<IP_ADDRESS>\",\n        \"customer_endpoint\": \"<IP_ADDRESS>\",\n        \"remote_identities\": {\n          \"hex_id\": \"\",\n          \"fqdn_id\": \"\",\n          \"user_id\": \"\"\n        },\n        \"psk_metadata\": {\n          \"last_generated_on\": \"2025-03-13T14:28:47.054318Z\"\n        },\n        \"description\": \"<TUNNEL_DESCRIPTION>\",\n        \"health_check\": {\n          \"enabled\": true,\n          \"target\": \"\",\n          \"type\": \"reply\",\n          \"rate\": \"mid\",\n          \"direction\": \"unidirectional\"\n        }\n      }\n    },\n    \"success\": true,\n    \"errors\": [],\n    \"messages\": []\n  }\n  bash\n  curl \"https://api.cloudflare.com/client/v4/accounts/%7Baccount_id%7D/magic/ipsec_tunnels/%7Bipsec_tunnel_id%7D\" \\\n    --request PUT \\\n    --json '{\n      \"health_check\": {\n          \"direction\": \"bidirectional\"\n      }\n    }'\n  json\n  {\n    \"result\": {\n      \"modified\": true,\n      \"modified_ipsec_tunnel\": {\n        \"id\": \"<IPSEC_ID>\",\n        \"interface_address\": \"<IPSEC_CIDR>\",\n        \"created_on\": \"2025-03-13T14:28:21.139535Z\",\n        \"modified_on\": \"2025-03-13T14:33:26.09683Z\",\n        \"name\": \"<TUNNEL_NAME>\",\n        \"cloudflare_endpoint\": \"<IP_ADDRESS>\",\n        \"customer_endpoint\": \"<IP_ADDRESS>\",\n        \"remote_identities\": {\n          \"hex_id\": \"\",\n          \"fqdn_id\": \"\",\n          \"user_id\": \"\"\n        },\n        \"psk_metadata\": {\n          \"last_generated_on\": \"2025-03-13T14:28:47.054318Z\"\n        },\n        \"description\": \"<TUNNEL_DESCRIPTION>\",\n        \"health_check\": {\n          \"enabled\": true,\n          \"target\": \"\",\n          \"type\": \"reply\",\n          \"rate\": \"mid\",\n          \"direction\": \"bidirectional\"\n        }\n      }\n    },\n    \"success\": true,\n    \"errors\": [],\n    \"messages\": []\n  }\n  sh\nsudo traceroute -s 10.1.0.100 -I 10.3.0.100\nsh\ntraceroute to 10.3.0.100 (10.3.0.100), 30 hops max, 60 byte packets\n 1  * * *\n 2  * * *\n 3  * * *\n 4  * * *\n 5  * * *\n 6  * * *\n 7  * * *\n 8  * * *\n 9  * * *\n10  10.3.0.100 (10.3.0.100)  420.505 ms  420.779 ms  420.776 ms\nsh\nsudo ip link set cf_gre type gre ttl 64\nsudo traceroute -s 10.1.0.100 -I 10.3.0.100\nsh\ntraceroute to 10.3.0.100 (10.3.0.100), 30 hops max, 60 byte packets\n 1  10.0.0.11 (10.0.0.11)  58.947 ms  58.933 ms  58.930 ms\n 2  173.245.60.175 (173.245.60.175)  61.138 ms  61.316 ms  61.313 ms\n 3  172.68.145.21 (172.68.145.21)  367.448 ms  367.532 ms  367.530 ms\n 4  mplat-e2e-vm3.c.magic-transit.internal (10.152.0.20)  370.362 ms  370.440 ms  370.522 ms\n 5  10.3.0.100 (10.3.0.100)  370.519 ms  370.541 ms  518.152 ms\nsh\nsudo sysctl -w net.ipv4.conf.CloudflareWARP.rp_filter=2\nsh\nnet.ipv4.conf.CloudflareWARP.rp_filter = 2\nsh\nsudo traceroute -s 172.16.0.2 -I 10.3.0.100\nsh\ntraceroute to 10.3.0.100 (10.3.0.100), 30 hops max, 60 byte packets\n 1  169.254.21.171 (169.254.21.171)  48.887 ms  48.894 ms  48.620 ms\n 2  173.245.60.175 (173.245.60.175)  49.403 ms  49.519 ms  49.603 ms\n 3  172.68.65.7 (172.68.65.7)  357.499 ms  357.519 ms  357.520 ms\n 4  mplat-e2e-vm3.c.magic-transit.internal (10.152.0.20)  360.024 ms  360.086 ms  360.078 ms\n 5  10.3.0.100 (10.3.0.100)  360.283 ms  360.297 ms  360.489 ms\nbash\ncurl \"https://api.cloudflare.com/client/v4/accounts/{account_id}/magic/ipsec_tunnels?validate_only=true\" \\\n--header \"X-Auth-Email: <EMAIL>\" \\\n--header \"X-Auth-Key: <API_KEY>\" \\\n--header \"Content-Type: application/json\" \\\n--data '{\n  \"ipsec_tunnels\": [\n    {\n      \"name\": \"EdgeConnect_IPSEC_1\",\n      \"customer_endpoint\": \"35.188.72.56\",\n      \"cloudflare_endpoint\": \"172.64.241.205\",\n      \"interface_address\": \"192.168.10.11/31\",\n      \"description\": \"Tunnel for EdgeConnect - GCP Central\"\n    }\n  ]\n}'\nbash\ncurl https://api.cloudflare.com/client/v4/accounts/{account_id}/magic/ipsec_tunnels \\\n--header \"X-Auth-Email: <EMAIL>\" \\\n--header \"X-Auth-Key: <API_KEY>\" \\\n--header \"Content-Type: application/json\" \\\n--data '{\n  \"ipsec_tunnels\": [\n    {\n      \"name\": \"EdgeConnect_IPSEC_1\",\n      \"customer_endpoint\": \"35.188.72.56\",\n      \"cloudflare_endpoint\": \"172.64.241.205\",\n      \"interface_address\": \"192.168.10.11/31\",\n      \"description\": \"Tunnel for EdgeConnect - GCP Central\"\n    }\n  ]\n}'\njson\n{\n  \"result\": {\n    \"ipsec_tunnels\": [\n      {\n        \"id\": \"tunnel_id\",\n        \"interface_address\": \"192.168.10.11/31\",\n        \"created_on\": \"2022-04-14T19:57:43.938376Z\",\n        \"modified_on\": \"2022-04-14T19:57:43.938376Z\",\n        \"name\": \"EdgeConnect_IPSEC_1\",\n        \"cloudflare_endpoint\": \"172.64.241.205\",\n        \"customer_endpoint\": \"35.188.72.56\",\n        \"description\": \"Tunnel for EdgeConnect - GCP Central\",\n        \"health_check\": {\n          \"enabled\": true,\n          \"target\": \"35.188.72.56\",\n          \"type\": \"reply\"\n        }\n      }\n    ]\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\nbash\ncurl --request POST \\\n\"https://api.cloudflare.com/client/v4/accounts/{account_id}/magic/ipsec_tunnels/{tunnel_id}/psk_generate?validate_only=true\" \\\n--header \"X-Auth-Email: <EMAIL>\" \\\n--header \"X-Auth-Key: <API_KEY>\"\njson\n{\n  \"result\": {\n  \"ipsec_id\": \"<ipsec_id>\",\n  \"ipsec_tunnel_id\": \"<tunnel_id>\",\n  \"psk\": \"XXXXXXXXXXXXXXXXX\",\n  \"psk_metadata\": {\n  \"last_generated_on\": \"2022-04-14T20:05:29.756514071Z\"\n  }\n  },\n  \"success\": true,\n  \"errors\": [],\n  \"messages\": []\n}\ntxt\ncrypto ikev2 proposal CF_MAGIC_WAN_IKEV2_PROPOSAL\n encryption aes-cbc-256\n integrity sha512 sha384 sha256\n group 20\n!\ncrypto ikev2 policy CF_MAGIC_WAN_IKEV2_POLICY\n match fvrf any\n proposal CF_MAGIC_WAN_IKEV2_PROPOSAL\n!\ncrypto ikev2 keyring CF_MAGIC_WAN_KEYRING\n peer GCP_CSR_IPSEC01\n  address 162.159.###.###\n  pre-shared-key hbGnJzFMqwltb###############BapXCOwsGZz2NMg\n !\n peer GCP_CSR_IPSEC02\n  address 172.64.###.###\n  pre-shared-key 1VscPp0LPFAcZ###############HOdN-1cUgKVduL4\n !\n!\n!\ncrypto ikev2 profile CF_MAGIC_WAN_01\n match identity remote address 162.159.###.### 255.255.255.255\n identity local fqdn ad329f56###############bbe898c0a0.33145236.ipsec.cloudflare.com\n authentication remote pre-share\n authentication local pre-share\n keyring local CF_MAGIC_WAN_KEYRING\n no config-exchange request\n!\ncrypto ikev2 profile CF_MAGIC_WAN_02\n match identity remote address 172.64.###.### 255.255.255.255\n identity local fqdn 83f9c418###############29b3f97049.33145236.ipsec.cloudflare.com\n authentication remote pre-share\n authentication local pre-share\n keyring local CF_MAGIC_WAN_KEYRING\n no config-exchange request\n!\n!\n!\n!\ncrypto ipsec profile CF_MAGIC_WAN_01\n set security-association lifetime kilobytes disable\n set security-association replay disable\n set pfs group20\n set ikev2-profile CF_MAGIC_WAN_01\n!\ncrypto ipsec profile CF_MAGIC_WAN_02\n set security-association lifetime kilobytes disable\n set security-association replay disable\n set pfs group14\n set ikev2-profile CF_MAGIC_WAN_02\n!\n!\n!\n!\ninterface Tunnel101\n ip address 10.252.2.35 255.255.255.254\n ip mtu 1450\n ip tcp adjust-mss 1350\n tunnel source 10.141.0.9\n tunnel mode ipsec ipv4\n tunnel destination 162.159.###.###\n tunnel path-mtu-discovery\n tunnel protection ipsec profile CF_MAGIC_WAN_01\n!\ninterface Tunnel102\n ip address 10.252.2.37 255.255.255.254\n ip mtu 1450\n ip tcp adjust-mss 1350\n tunnel source 10.141.0.9\n tunnel mode ipsec ipv4\n tunnel destination 172.64.###.###\n tunnel path-mtu-discovery\n tunnel protection ipsec profile CF_MAGIC_WAN_02\n!\ninterface GigabitEthernet1\n ip address dhcp\n ip nat outside\n negotiation auto\n no mop enabled\n no mop sysid\n!\ninterface GigabitEthernet2\n ip address 10.10.0.35 255.255.255.0\n negotiation auto\n no mop enabled\n no mop sysid\ntxt\ncrypto ikev2 profile CF_MAGIC_WAN_01\n match identity remote address 162.159.###.### 255.255.255.255\n identity local fqdn ad329f56###############bbe898c0a0.33145236.ipsec.cloudflare.com\n authentication remote pre-share\n authentication local pre-share\n keyring local CF_MAGIC_WAN_KEYRING\n nat force-encap\n no config-exchange request\ntxt\ncisco-csr1000v#show crypto session detail\nCrypto session current status\n\nCode: C - IKE Configuration mode, D - Dead Peer Detection\nK - Keepalives, N - NAT-traversal, T - cTCP encapsulation\nX - IKE Extended Authentication, F - IKE Fragmentation\nR - IKE Auto Reconnect, U - IKE Dynamic Route Update\nS - SIP VPN\n\nInterface: Tunnel101\nProfile: CF_MAGIC_WAN_01\nUptime: 00:15:16\nSession status: UP-ACTIVE\nPeer: 162.159.###.### port 500 fvrf: (none) ivrf: (none)\n      Phase1_id: 162.159.###.###\n      Desc: (none)\n  Session ID: 6\n  IKEv2 SA: local 10.141.0.9/500 remote 162.159.###.###/500 Active\n          Capabilities:(none) connid:1 lifetime:23:44:44\n  IPSEC FLOW: permit ip 0.0.0.0/0.0.0.0 0.0.0.0/0.0.0.0\n        Active SAs: 2, origin: crypto map\n        Inbound:  #pkts dec'ed 28110 drop 0 life (KB/Sec) KB Vol Rekey Disabled/2684\n        Outbound: #pkts enc'ed 0 drop 0 life (KB/Sec) KB Vol Rekey Disabled/2684\n\nInterface: Tunnel102\nProfile: CF_MAGIC_WAN_02\nUptime: 00:14:59\nSession status: UP-ACTIVE\nPeer: 172.64.###.### port 500 fvrf: (none) ivrf: (none)\n      Phase1_id: 172.64.###.###\n      Desc: (none)\n  Session ID: 7\n  IKEv2 SA: local 10.141.0.9/500 remote 172.64.###.###/500 Active\n          Capabilities:(none) connid:2 lifetime:23:45:01\n  IPSEC FLOW: permit ip 0.0.0.0/0.0.0.0 0.0.0.0/0.0.0.0\n        Active SAs: 2, origin: crypto map\n        Inbound:  #pkts dec'ed 27586 drop 0 life (KB/Sec) KB Vol Rekey Disabled/2701\n        Outbound: #pkts enc'ed 0 drop 0 life (KB/Sec) KB Vol Rekey Disabled/2701\ntxt\ncisco-csr1000v#show crypto session remote 162.159.###.### detail\nCrypto session current status\n\nCode: C - IKE Configuration mode, D - Dead Peer Detection\nK - Keepalives, N - NAT-traversal, T - cTCP encapsulation\nX - IKE Extended Authentication, F - IKE Fragmentation\nR - IKE Auto Reconnect, U - IKE Dynamic Route Update\nS - SIP VPN\n\nInterface: Tunnel101\nProfile: CF_MAGIC_WAN_01\nUptime: 00:15:45\nSession status: UP-ACTIVE\nPeer: 162.159.###.### port 500 fvrf: (none) ivrf: (none)\n      Phase1_id: 162.159.###.###\n      Desc: (none)\n  Session ID: 6\n  IKEv2 SA: local 10.141.0.9/500 remote 162.159.###.###/500 Active\n          Capabilities:(none) connid:1 lifetime:23:44:15\n  IPSEC FLOW: permit ip 0.0.0.0/0.0.0.0 0.0.0.0/0.0.0.0\n        Active SAs: 2, origin: crypto map\n        Inbound:  #pkts dec'ed 29000 drop 0 life (KB/Sec) KB Vol Rekey Disabled/2655\n        Outbound: #pkts enc'ed 0 drop 0 life (KB/Sec) KB Vol Rekey Disabled/2655\ntxt\ncisco-csr1000v#show crypto session remote 172.64.###.### detail\nCrypto session current status\n\nCode: C - IKE Configuration mode, D - Dead Peer Detection\nK - Keepalives, N - NAT-traversal, T - cTCP encapsulation\nX - IKE Extended Authentication, F - IKE Fragmentation\nR - IKE Auto Reconnect, U - IKE Dynamic Route Update\nS - SIP VPN\n\nInterface: Tunnel102\nProfile: CF_MAGIC_WAN_02\nUptime: 00:17:10\nSession status: UP-ACTIVE\nPeer: 172.64.###.### port 500 fvrf: (none) ivrf: (none)\n      Phase1_id: 172.64.###.###\n      Desc: (none)\n  Session ID: 7\n  IKEv2 SA: local 10.141.0.9/500 remote 172.64.###.###/500 Active\n          Capabilities:(none) connid:2 lifetime:23:42:50\n  IPSEC FLOW: permit ip 0.0.0.0/0.0.0.0 0.0.0.0/0.0.0.0\n        Active SAs: 2, origin: crypto map\n        Inbound:  #pkts dec'ed 31639 drop 0 life (KB/Sec) KB Vol Rekey Disabled/2569\n        Outbound: #pkts enc'ed 0 drop 0 life (KB/Sec) KB Vol Rekey Disabled/2569\ntxt\nconf t\ncrypto isakmp invalid-spi-recovery\nexit\ntxt\ninterface Tunnel 1\n ip address 10.0.0.0 255.255.255.254\n tunnel mode ipsec map MAP1\n link-state sync-sa\nexit\n!\n\ncrypto ipsec policy IPsec_POLICY\n set security-association always-up\n set security-association lifetime seconds 28800\n set security-association transform-keysize aes 256 256 256\n set security-association transform esp-aes esp-sha256-hmac\n set mtu 1460\n set mss 1350\n set ip df-bit 0\n set ip fragment post\n ! if there is a NAT router between Cloudflare and FITELnet,\n ! add the two udp-encapsulation options below\n set udp-encapsulation nat-t keepalive interval 30 always-send\n set udp-encapsulation-force\nexit\n!\ncrypto ipsec selector SELECTOR\n src 1 ipv4 any\n dst 1 ipv4 any\nexit\n!\ncrypto isakmp keepalive\ncrypto isakmp log sa\ncrypto isakmp log session\ncrypto isakmp log negotiation-fail\ncrypto isakmp negotiation always-up-params interval 100 max-initiate 10 max-pending 10 delay 1\ncrypto ipsec replay-check disable\n!\ncrypto isakmp policy ISAKMP_POLICY\n authentication pre-share\n encryption aes\n encryption-keysize aes 256 256 256\n group 20\n lifetime 86400\n hash sha sha-256\n initiate-mode aggressive\nexit\n!\ncrypto isakmp profile PROF1\n ! set the value of FQDN ID for self-identify\n self-identity fqdn <FQDN-ID-TUNNEL01>\n set isakmp-policy ISAKMP_POLICY\n set ipsec-policy IPsec_POLICY\n set peer <CLOUDFLARE-ANYCAST-ADDRESS>\n ike-version 2\n local-key <PRE-SHARED-KEY-TUNNEL01>\nexit\n!\ncrypto map MAP1 ipsec-isakmp\n match address SELECTOR\n set isakmp-profile PROF1\nexit\n!\ntxt\ninterface Tunnel 2\n ip address 10.0.0.2 255.255.255.254\n tunnel mode ipsec map MAP1\n link-state sync-sa\nexit\n!\n\ncrypto ipsec policy IPsec_POLICY\n set security-association always-up\n set security-association lifetime seconds 28800\n set security-association transform-keysize aes 256 256 256\n set security-association transform esp-aes esp-sha256-hmac\n set mtu 1460\n set mss 1350\n set ip df-bit 0\n set ip fragment post\n ! if there is a NAT router between Cloudflare and FITELnet,\n ! add the two udp-encapsulation options below\n set udp-encapsulation nat-t keepalive interval 30 always-send\n set udp-encapsulation-force\nexit\n!\ncrypto ipsec selector SELECTOR\n src 1 ipv4 any\n dst 1 ipv4 any\nexit\n!\ncrypto isakmp keepalive\ncrypto isakmp log sa\ncrypto isakmp log session\ncrypto isakmp log negotiation-fail\ncrypto isakmp negotiation always-up-params interval 100 max-initiate 10 max-pending 10 delay 1\ncrypto ipsec replay-check disable\n!\ncrypto isakmp policy ISAKMP_POLICY\n authentication pre-share\n encryption aes\n encryption-keysize aes 256 256 256\n group 20\n lifetime 86400\n hash sha sha-256\n initiate-mode aggressive\nexit\n!\ncrypto isakmp profile PROF1\n ! set the value of FQDN ID for self-identify\n self-identity fqdn <FQDN-ID-TUNNEL02>\n set isakmp-policy ISAKMP_POLICY\n set ipsec-policy IPsec_POLICY\n set peer <CLOUDFLARE-ANYCAST-ADDRESS>\n ike-version 2\n local-key <PRE-SHARED-KEY-TUNNEL02>\nexit\n!\ncrypto map MAP1 ipsec-isakmp\n match address SELECTOR\n set isakmp-profile PROF1\nexit\n!\ntxt\nip route 192.168.0.0 255.255.255.0 tunnel 1\ntxt\nip route 192.168.1.0 255.255.255.0 tunnel 2\ntxt\nshow crypto sa\n\nIKE_SA\n    Mode: <I>\n    Local IP : <LOCAL_IP>/500\n    Local ID : <LOCAL_ID> (ipv4)\n    Remote IP : anycast-address/500\n    Remote ID : anycast-address (ipv4)\n    Local Authentication method : Pre-shared key\n    Remote Authentication method : Pre-shared key\n    Encryption algorithm : aes256-cbc\n    Hash algorithm : hmac-sha256-128\n    Diffie-Hellman group : 20\n    Initiator Cookie : aaaaaaaa bbbbbbbb\n    Responder Cookie : cccccccc dddddddd\n    Life time : 6852/14400 sec\n    DPD : on\n\nCHILD_SA <I>\n    Selector :\n      0.0.0.0/0 ALL ALL <---> 0.0.0.0/0 ALL ALL\n    Interface : tunnel 1\n    Peer IP : anycast-address/500\n    Local IP : xxx.xxx.xxx.xxx/500\n    Encryption algorithm : AES-CBC/256\n    Authentication algorithm : HMAC-SHA2-256\n    Life time : 22868/28800 sec\n    PFS : off ESN : off\n    IN\n      SPI : eeeeeeee\n      Packets       : 0\n      Octets        : 0\n      Replay error  : 0\n      Auth error    : 0\n      Padding error : 0\n      Rule error    : 0\n    OUT\n      SPI : ffffffff\n      Packets       : 0\n      Octets        : 0\n      Seq lapped    : 0\n\nTotal number of ISAKMP SA 1\n  Total number of IPSEC SA 1\ntxt\nshow ip route\n\nCodes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF,\n       B - BGP, T - Tunnel, i - IS-IS, V - VRRP track,\n       Iu - ISAKMP SA up, It - ISAKMP tunnel route, Ip - ISAKMP l2tpv2-ppp\n       Dc - DHCP-client, L - Local Breakout\n       > - selected route, * - FIB route, p - stale info\n\n<snip>\nS > * 192.168.1.0/24 [100/0] is directly connected, Tunnel1\n<snip>\n#\ntxt\nconfig system settings\n    set asymroute-icmp enable\nend\ntxt\nconfig system settings\n    set ike-port 4500\nend\ntxt\nfortigate # config vpn ipsec phase1-interface\n    edit \"<NAME_OF_YOUR_TUNNEL>\"\n        set nattraversal enable\ntxt\nconfig system global\n    set anti-replay disable\nend\ntxt\nfortigate # config vpn ipsec phase1-interface\n    edit \"MWAN_IPsec_Tun1\"\n        set interface \"wan1\"\n        set ike-version 2\n        set keylife 86400\n        set peertype any\n        set net-device enable\n        set proposal aes256gcm-prfsha512 aes256gcm-prfsha384 aes256gcm-prfsha256\n        set localid \"f1473dXXXXXXX72e33.49561179.ipsec.cloudflare.com\"\n        set dhgrp 20\n        set nattraversal disable\n        set remote-gw 162.159.67.210\n        set add-gw-route enable\n        set psksecret <YOUR_PRE-SHARED_KEY>\n    next\n    edit \"MWAN_IPsec_Tun2\"\n        set interface \"wan1\"\n        set ike-version 2\n        set keylife 86400\n        set peertype any\n        set net-device enable\n        set proposal aes256gcm-prfsha512 aes256gcm-prfsha384 aes256gcm-prfsha256\n        set localid \"de91565XXXXXXXfbbd6632.49561179.ipsec.cloudflare.com\"\n        set dhgrp 20\n        set nattraversal disable\n        set remote-gw 172.XX.XX.210\n        set add-gw-route enable\n        set psksecret ENC <YOUR_PRE-SHARED_KEY>\n    next\nend\ntxt\nfortigate # config vpn ipsec phase2-interface\n    edit \"MWAN_IPsec_Tun1\"\n        set phase1name \"MWAN_IPsec_Tun1\"\n        set proposal aes256gcm aes128gcm\n        set dhgrp 20\n        set replay disable\n        set keylifeseconds 28800\n        set auto-negotiate enable\n        set keepalive enable\n    next\n    edit \"MWAN_IPsec_Tun2\"\n        set phase1name \"MWAN_IPsec_Tun2\"\n        set proposal aes256gcm aes128gcm\n        set dhgrp 20\n        set replay disable\n        set keylifeseconds 28800\n        set auto-negotiate enable\n        set keepalive enable\n    next\nend\ntxt\nfortigate # config system interface\n    edit \"MWAN_IPsec_Tun1\"\n        set vdom \"root\"\n        set ip 10.252.2.91 255.255.255.255\n        set allowaccess ping\n        set type tunnel\n        set remote-ip 10.252.2.90 255.255.255.254\n        set alias \"MWAN_IPsec_Tun1\"\n        set snmp-index 17\n        set interface \"wan1\"\n    next\n    edit \"MWAN_IPsec_Tun2\"\n        set vdom \"root\"\n        set ip 10.252.2.93 255.255.255.255\n        set allowaccess ping\n        set type tunnel\n        set remote-ip 10.252.2.92 255.255.255.254\n        set alias \"MWAN_IPsec_Tun2\"\n        set snmp-index 18\n        set interface \"wan1\"\n    next\nend\ntxt\nfortigate # execute ping 10.252.2.90\nPING 10.252.2.90 (10.252.2.90): 56 data bytes\n64 bytes from 10.252.2.90: icmp_seq=0 ttl=64 time=5.8 ms\n64 bytes from 10.252.2.90: icmp_seq=1 ttl=64 time=5.8 ms\n64 bytes from 10.252.2.90: icmp_seq=2 ttl=64 time=5.8 ms\n64 bytes from 10.252.2.90: icmp_seq=3 ttl=64 time=5.8 ms\n64 bytes from 10.252.2.90: icmp_seq=4 ttl=64 time=5.7 ms\n\n--- 10.252.2.90 ping statistics ---\n5 packets transmitted, 5 packets received, 0% packet loss\nround-trip min/avg/max = 5.7/5.7/5.8 ms\ntxt\nfortigate # execute ping 10.252.2.92\nPING 10.252.2.92 (10.252.2.92): 56 data bytes\n64 bytes from 10.252.2.92: icmp_seq=0 ttl=64 time=6.1 ms\n64 bytes from 10.252.2.92: icmp_seq=1 ttl=64 time=6.1 ms\n64 bytes from 10.252.2.92: icmp_seq=2 ttl=64 time=6.1 ms\n64 bytes from 10.252.2.92: icmp_seq=3 ttl=64 time=6.1 ms\n64 bytes from 10.252.2.92: icmp_seq=4 ttl=64 time=6.0 ms\n\n--- 10.252.2.92 ping statistics ---\n5 packets transmitted, 5 packets received, 0% packet loss\nround-trip min/avg/max = 6.0/6.0/6.1 ms\ntxt\nfortigate # config system zone\n    edit \"Cloudflare_Zone\"\n        set intrazone allow\n        set interface \"MWAN_IPsec_Tun1\" \"MWAN_IPsec_Tun2\"\n    next\n    edit \"Trust_Zone\"\n        set intrazone allow\n        set interface \"internal\"\n    next\n    edit \"Untrust_Zone\"\n        set intrazone allow\n        set interface \"wan1\"\n    next\nend\ntxt\nconfig firewall address\n    edit \"Cloudflare_IPv4_01\"\n        set color 9\n        set subnet 173.245.48.0 255.255.240.0\n    next\n    edit \"Cloudflare_IPv4_02\"\n        set color 9\n        set subnet 103.21.244.0 255.255.252.0\n    next\n    edit \"Cloudflare_IPv4_03\"\n        set color 9\n        set subnet 103.22.200.0 255.255.252.0\n    next\n    edit \"Cloudflare_IPv4_04\"\n        set color 9\n        set subnet 103.31.4.0 255.255.252.0\n    next\n    edit \"Cloudflare_IPv4_05\"\n        set color 9\n        set subnet 141.101.64.0 255.255.192.0\n    next\n    edit \"Cloudflare_IPv4_06\"\n        set color 9\n        set subnet 108.162.192.0 255.255.192.0\n    next\n    edit \"Cloudflare_IPv4_07\"\n        set color 9\n        set subnet 190.93.240.0 255.255.240.0\n    next\n    edit \"Cloudflare_IPv4_08\"\n        set color 9\n        set subnet 188.114.96.0 255.255.240.0\n    next\n    edit \"Cloudflare_IPv4_09\"\n        set color 9\n        set subnet 197.234.240.0 255.255.252.0\n    next\n    edit \"Cloudflare_IPv4_10\"\n        set color 9\n        set subnet 198.41.128.0 255.255.128.0\n    next\n    edit \"Cloudflare_IPv4_11\"\n        set color 9\n        set subnet 162.158.0.0 255.254.0.0\n    next\n    edit \"Cloudflare_IPv4_12\"\n        set color 9\n        set subnet 104.16.0.0 255.248.0.0\n    next\n    edit \"Cloudflare_IPv4_13\"\n        set color 9\n        set subnet 104.24.0.0 255.252.0.0\n    next\n    edit \"Cloudflare_IPv4_14\"\n        set color 9\n        set subnet 172.64.0.0 255.248.0.0\n    next\n    edit \"Cloudflare_IPv4_15\"\n        set color 9\n        set subnet 131.0.72.0 255.255.252.0\n    next\n    edit \"Bidirect_HC_Endpoint_01\"\n        set comment \"Bidirectional health check endpoint address\"\n        set color 9\n        set subnet 172.64.240.253 255.255.255.255\n    next\n    edit \"Bidirect_HC_Endpoint_02\"\n        set comment \"Bidirectional health check endpoint address\"\n        set color 9\n        set subnet 172.64.240.254 255.255.255.255\n    next\nend\ntxt\nconfig firewall addrgrp\n    edit \"Cloudflare_IPv4_Nets\"\n        set member \"Cloudflare_IPv4_01\" \"Cloudflare_IPv4_02\" \"Cloudflare_IPv4_03\" \"Cloudflare_IPv4_04\" \"Cloudflare_IPv4_05\" \"Cloudflare_IPv4_06\" \"Cloudflare_IPv4_07\" \"Cloudflare_IPv4_08\" \"Cloudflare_IPv4_09\" \"Cloudflare_IPv4_10\" \"Cloudflare_IPv4_11\" \"Cloudflare_IPv4_12\" \"Cloudflare_IPv4_13\" \"Cloudflare_IPv4_14\" \"Cloudflare_IPv4_15\"\n        set color 9\n    next\nend\ntxt\nfortigate (policy) # show\nconfig firewall policy\n    edit 2\n        set name \"CF_Magic_Health_Checks\"\n        set uuid 80eb76ce-3033-51ee-c5e5-d5a670dff3b3\n        set srcintf \"Cloudflare_Zone\"\n        set action accept\n        set srcaddr \"Cloudflare_IPv4_Nets\"\n        set dstaddr \"Bidirect_HC_Endpoint_01\" \"Bidirect_HC_Endpoint_02\"\n        set schedule \"always\"\n        set service \"ALL_ICMP\"\n        set logtraffic all\n    next\nend\ntxt\nfortigate # config router policy\n    edit 1\n        set input-device \"MWAN_IPsec_Tun1\"\n        set srcaddr \"all\"\n        set dstaddr \"all\"\n        set gateway 10.252.2.90\n        set output-device \"MWAN_IPsec_Tun1\"\n    next\n    edit 2\n        set input-device \"MWAN_IPsec_Tun2\"\n        set srcaddr \"all\"\n        set dstaddr \"all\"\n        set gateway 10.252.2.92\n        set output-device \"MWAN_IPsec_Tun2\"\n    next\nend\ntxt\nfortigate # diagnose sniffer packet any 'host 172.64.240.253' 4\ninterfaces=[any]\nfilters=[host 172.64.240.253]\n0.601569 MWAN_IPsec_Tun1 in 172.64.240.253 -> 162.158.176.118: icmp: echo reply\n0.601585 MWAN_IPsec_Tun1 out 172.64.240.253 -> 162.158.176.118: icmp: echo reply\n0.611164 MWAN_IPsec_Tun1 in 172.64.240.253 -> 172.71.87.94: icmp: echo reply\n0.611178 MWAN_IPsec_Tun1 out 172.64.240.253 -> 172.71.87.94: icmp: echo reply\n0.617562 MWAN_IPsec_Tun1 in 172.64.240.253 -> 172.71.129.214: icmp: echo reply\n0.617574 MWAN_IPsec_Tun1 out 172.64.240.253 -> 172.71.129.214: icmp: echo reply\n0.622042 MWAN_IPsec_Tun1 in 172.64.240.253 -> 172.69.61.43: icmp: echo reply\n0.622056 MWAN_IPsec_Tun1 out 172.64.240.253 -> 172.69.61.43: icmp: echo reply\n0.624092 MWAN_IPsec_Tun1 in 172.64.240.253 -> 172.68.9.214: icmp: echo reply\ntxt\nfortigate # diagnose sniffer packet any 'host 172.64.240.254' 4\ninterfaces=[any]\nfilters=[host 172.64.240.254]\n0.912041 MWAN_IPsec_Tun2 in 172.64.240.254 -> 172.70.177.56: icmp: echo reply\n0.912057 MWAN_IPsec_Tun2 out 172.64.240.254 -> 172.70.177.56: icmp: echo reply\n0.913579 MWAN_IPsec_Tun2 in 172.64.240.254 -> 172.70.221.154: icmp: echo reply\n0.913592 MWAN_IPsec_Tun2 out 172.64.240.254 -> 172.70.221.154: icmp: echo reply\n0.914247 MWAN_IPsec_Tun2 in 172.64.240.254 -> 162.158.1.85: icmp: echo reply\n0.914260 MWAN_IPsec_Tun2 out 172.64.240.254 -> 162.158.1.85: icmp: echo reply\n0.918533 MWAN_IPsec_Tun2 in 172.64.240.254 -> 172.71.125.75: icmp: echo reply\n0.918550 MWAN_IPsec_Tun2 out 172.64.240.254 -> 172.71.125.75: icmp: echo reply\n0.924465 MWAN_IPsec_Tun2 in 172.64.240.254 -> 172.69.21.134: icmp: echo reply\ntxt\nfortigate # diagnose debug disable\nfortigate # diagnose debug flow filter clear\nfortigate # diagnose debug reset\nfortigate # diagnose debug flow filter addr 172.64.240.253\nfortigate # diagnose debug show flow show function-name enable\nfortigate # diagnose debug config-error-log timestamps enable\nfortigate # diagnose debug flow trace start 999\nfortigate # diagnose debug enable\nfortigate # 2023-08-01 09:27:26 id=20085 trace_id=2871 func=print_pkt_detail line=5844 msg=\"vd-root:0 received a packet(proto=1, 172.64.240.253:56968->172.70.121.28:0) tun_id=162.159.67.210 from MWAN_IPsec_Tun1. type=0, code=0, id=56968, seq=0.\"\n2023-08-01 09:27:26 id=20085 trace_id=2871 func=rpdb_srv_match_input line=1036 msg=\"Match policy routing id=1: to 10.252.2.90 via ifindex-34\"\n2023-08-01 09:27:26 id=20085 trace_id=2871 func=vf_ip_route_input_common line=2605 msg=\"find a route: flag=00000000 gw-162.159.67.210 via MWAN_IPsec_Tun1\"\n2023-08-01 09:27:26 id=20085 trace_id=2871 func=ipsecdev_hard_start_xmit line=669 msg=\"enter IPSec interface MWAN_IPsec_Tun1, tun_id=0.0.0.0\"\n2023-08-01 09:27:26 id=20085 trace_id=2871 func=_do_ipsecdev_hard_start_xmit line=229 msg=\"output to IPSec tunnel MWAN_IPsec_Tun1\"\n2023-08-01 09:27:26 id=20085 trace_id=2871 func=esp_output4 line=844 msg=\"IPsec encrypt/auth\"\n2023-08-01 09:27:26 id=20085 trace_id=2871 func=ipsec_output_finish line=544 msg=\"send to 172.71.91.34 via intf-wan1\"\n2023-08-01 09:27:26 id=20085 trace_id=2872 func=print_pkt_detail line=5844 msg=\"vd-root:0 received a packet(proto=1, 172.64.240.253:18685->162.158.209.64:0) tun_id=162.159.67.210 from MWAN_IPsec_Tun1. type=0, code=0, id=18685, seq=0.\"\n2023-08-01 09:27:26 id=20085 trace_id=2872 func=rpdb_srv_match_input line=1036 msg=\"Match policy routing id=1: to 10.252.2.90 via ifindex-34\"\n2023-08-01 09:27:26 id=20085 trace_id=2872 func=vf_ip_route_input_common line=2605 msg=\"find a route: flag=00000000 gw-162.159.67.210 via MWAN_IPsec_Tun1\"\n2023-08-01 09:27:26 id=20085 trace_id=2872 func=ipsecdev_hard_start_xmit line=669 msg=\"enter IPSec interface MWAN_IPsec_Tun1, tun_id=0.0.0.0\"\n2023-08-01 09:27:26 id=20085 trace_id=2872 func=_do_ipsecdev_hard_start_xmit line=229 msg=\"output to IPSec tunnel MWAN_IPsec_Tun1\"\n2023-08-01 09:27:26 id=20085 trace_id=2872 func=esp_output4 line=844 msg=\"IPsec encrypt/auth\"\n2023-08-01 09:27:26 id=20085 trace_id=2872 func=ipsec_output_finish line=544 msg=\"send to 172.71.91.34 via intf-wan1\"\ntxt\nfortigate # diagnose debug disable\ntxt\nset interfaces st0 unit 0 family inet address 10.252.2.21/31\nset interfaces st0 unit 1 family inet address 10.252.2.23/31\ntxt\nadmin@srx300> show configuration interfaces st0\ntxt\nunit 0 {\n    family inet {\n        address 10.252.2.21/31;\n    }\n}\nunit 1 {\n    family inet {\n        address 10.252.2.23/31;\n    }\n}\ntxt\nset security zones security-zone cloudflare interfaces st0.0 host-inbound-traffic system-services all\nset security zones security-zone cloudflare interfaces st0.0 host-inbound-traffic\nset security zones security-zone cloudflare interfaces st0.1 host-inbound-traffic system-services all\nset security zones security-zone cloudflare interfaces st0.1 host-inbound-traffic\ntxt\nadmin@srx220> show configuration security zones security-zone cloudflare\ntxt\ninterfaces {\n  st0.0 {\n    host-inbound-traffic {\n      system-services {\n        all;\n      }\n      protocols {\n        all;\n      }\n    }\n  }\n  st0.1 {\n    host-inbound-traffic {\n      system-services {\n        all;\n      }\n      protocols {\n        all;\n      }\n    }\n  }\n}\ntxt\nset security zones security-zone untrust interfaces ge-0/0/0.0 host-inbound-traffic system-services ike\ntxt\nadmin@srx300> show configuration security zones security-zone untrust\ntxt\nscreen untrust-screen;\ninterfaces {\n    ge-0/0/0.0 {\n        host-inbound-traffic {\n            system-services {\n                ike;\n            }\n        }\n    }\n}\ntxt\nset security ike proposal cf_magic_wan_ike_prop authentication-method pre-shared-keys\nset security ike proposal cf_magic_wan_ike_prop dh-group group20\nset security ike proposal cf_magic_wan_ike_prop authentication-algorithm sha-256\nset security ike proposal cf_magic_wan_ike_prop encryption-algorithm aes-256-cbc\nset security ike proposal cf_magic_wan_ike_prop lifetime-seconds 86400\ntxt\nadmin@srx300> show configuration security ike proposal cf_magic_wan_ike_prop\ntxt\nauthentication-method pre-shared-keys;\ndh-group group20;\nauthentication-algorithm sha-256;\nencryption-algorithm aes-256-cbc;\nlifetime-seconds 86400;\ntxt\nset security ike policy cf_magic_wan_tun_01_pol mode main\nset security ike policy cf_magic_wan_tun_01_pol proposals cf_magic_wan_ike_prop\nset security ike policy cf_magic_wan_tun_01_pol pre-shared-key ascii-text \"$9$GRjPTF<REDACTED>WZUjHPT\"\ntxt\nadmin@srx300> show configuration security ike policy cf_magic_wan_tun_01_pol\ntxt\nmode main;\nproposals cf_magic_wan_ike_prop;\npre-shared-key ascii-text \"$9$GRjPTF<REDACTED>WZUjHPT\"; ## SECRET-DATA\ntxt\nset security ike policy cf_magic_wan_tun_02_pol mode main\nset security ike policy cf_magic_wan_tun_02_pol proposals cf_magic_wan_ike_prop\nset security ike policy cf_magic_wan_tun_02_pol pre-shared-key ascii-text \"$9$f536tp<REDACTED>SrH.fT/9Lx7-bY\"\ntxt\nadmin@srx300> show configuration security ike policy cf_magic_wan_tun_02_pol\ntxt\nmode main;\nproposals cf_magic_wan_ike_prop;\npre-shared-key ascii-text \"$9$f536tp<REDACTED>SrH.fT/9Lx7-bY\"; ## SECRET-DATA\ntxt\nset security ike gateway cf_magic_wan_gw_tun_01 ike-policy cf_magic_wan_tun_01_pol\nset security ike gateway cf_magic_wan_gw_tun_01 address 162.159.68.68\nset security ike gateway cf_magic_wan_gw_tun_01 local-identity hostname 1663e5e70<REDACTED>6555.ipsec.cloudflare.com\nset security ike gateway cf_magic_wan_gw_tun_01 external-interface ge-0/0/0.0\nset security ike gateway cf_magic_wan_gw_tun_01 version v2-only\ntxt\nadmin@srx300> show configuration security ike gateway cf_magic_wan_gw_tun_01\ntxt\nike-policy cf_magic_wan_tun_01_pol;\naddress 162.159.68.68;\nlocal-identity hostname 1663e5e70<REDACTED>6555.ipsec.cloudflare.com;\nexternal-interface ge-0/0/0.0;\nversion v2-only;\ntxt\nset security ike gateway cf_magic_wan_gw_tun_02 ike-policy cf_magic_wan_tun_02_pol\nset security ike gateway cf_magic_wan_gw_tun_02 address 172.64.244.68\nset security ike gateway cf_magic_wan_gw_tun_02 local-identity hostname b5ee5303<REDACTED>6555.ipsec.cloudflare.com\nset security ike gateway cf_magic_wan_gw_tun_02 external-interface ge-0/0/0.0\nset security ike gateway cf_magic_wan_gw_tun_02 version v2-only\ntxt\nadmin@srx300> show configuration security ike gateway cf_magic_wan_gw_tun_02\ntxt\nike-policy cf_magic_wan_tun_02_pol;\naddress 172.64.244.68;\nlocal-identity hostname b5ee5303<REDACTED>6555.ipsec.cloudflare.com;\nexternal-interface ge-0/0/0.0;\nversion v2-only;\ntxt\nset security ipsec proposal cf_magic_wan_ipsec_prop protocol esp\nset security ipsec proposal cf_magic_wan_ipsec_prop authentication-algorithm hmac-sha-256-128\nset security ipsec proposal cf_magic_wan_ipsec_prop encryption-algorithm aes-256-cbc\nset security ipsec proposal cf_magic_wan_ipsec_prop lifetime-seconds 28800\ntxt\nadmin@srx300> show configuration security ipsec proposal cf_magic_wan_ipsec_prop\ntxt\nprotocol esp;\nauthentication-algorithm hmac-sha-256-128;\nencryption-algorithm aes-256-cbc;\nlifetime-seconds 28800;\ntxt\nset security ipsec policy cf_magic_wan_ipsec_pol proposals cf_magic_wan_ipsec_prop\ntxt\nadmin@srx300> show configuration security ipsec policy cf_magic_wan_ipsec_pol\ntxt\nproposals cf_magic_wan_ipsec_prop;\ntxt\nset security ipsec vpn cf_magic_wan_ipsec_tun_01 bind-interface st0.0\nset security ipsec vpn cf_magic_wan_ipsec_tun_01 ike gateway cf_magic_wan_gw_tun_01\nset security ipsec vpn cf_magic_wan_ipsec_tun_01 ike no-anti-replay\nset security ipsec vpn cf_magic_wan_ipsec_tun_01 ike ipsec-policy cf_magic_wan_ipsec_pol\nset security ipsec vpn cf_magic_wan_ipsec_tun_01 establish-tunnels immediately\ntxt\nadmin@srx300> show configuration security ipsec vpn cf_magic_wan_ipsec_tun_01\ntxt\nbind-interface st0.0;\nike {\n    gateway cf_magic_wan_gw_tun_01;\n    no-anti-replay;\n    ipsec-policy cf_magic_wan_ipsec_pol;\n}\nestablish-tunnels immediately;\ntxt\nset security ipsec vpn cf_magic_wan_ipsec_tun_02 bind-interface st0.1\nset security ipsec vpn cf_magic_wan_ipsec_tun_02 ike gateway cf_magic_wan_gw_tun_02\nset security ipsec vpn cf_magic_wan_ipsec_tun_02 ike no-anti-replay\nset security ipsec vpn cf_magic_wan_ipsec_tun_02 ike ipsec-policy cf_magic_wan_ipsec_pol\nset security ipsec vpn cf_magic_wan_ipsec_tun_02 establish-tunnels immediately\ntxt\nadmin@srx300> show configuration security ipsec vpn cf_magic_wan_ipsec_tun_02\ntxt\nbind-interface st0.1;\nike {\n    gateway cf_magic_wan_gw_tun_02;\n    no-anti-replay;\n    ipsec-policy cf_magic_wan_ipsec_pol;\n}\nestablish-tunnels immediately;\ntxt\nset routing-instances MAGIC_WAN_RI instance-type forwarding\nset routing-instances MAGIC_WAN_RI routing-options static route 0.0.0.0/0 next-hop 10.252.2.20\nset routing-instances MAGIC_WAN_RI routing-options static route 0.0.0.0/0 next-hop 10.252.2.22\ntxt\nadmin@srx300> show configuration routing-instances\ntxt\nMAGIC_WAN_RI {\n    instance-type forwarding;\n    routing-options {\n        static {\n            route 0.0.0.0/0 next-hop [ 10.252.2.20 10.252.2.22 ];\n        }\n    }\n}\ntxt\nset firewall family inet filter MAGIC_WAN_FBF term MAGIC_WAN_NETS from source-address 10.1.20.0/24\nset firewall family inet filter MAGIC_WAN_FBF term MAGIC_WAN_NETS from destination-address 10.1.100.0/24\nset firewall family inet filter MAGIC_WAN_FBF term MAGIC_WAN_NETS then count MAGIC_WAN_GATEWAY_FBF_count\nset firewall family inet filter MAGIC_WAN_FBF term MAGIC_WAN_NETS then routing-instance MAGIC_WAN_RI\nset firewall family inet filter MAGIC_WAN_FBF term ALLOW_EVERYTHING_ELSE then accept\ntxt\nadmin@srx300> show configuration firewall\ntxt\nfamily inet {\n    filter MAGIC_WAN_FBF {\n        term MAGIC_WAN_NETS {\n            from {\n                source-address {\n                    10.1.20.0/24;\n                }\n                destination-address {\n                    10.1.100.0/24;\n                }\n            }\n            then {\n                count MAGIC_WAN_FBF_count;\n                routing-instance MAGIC_WAN_RI;\n            }\n        }\n        term ALLOW_EVERYTHING_ELSE {\n            then accept;\n        }\n    }\n}\ntxt\nadmin@srx300> show firewall filter MAGIC_WAN_FBF counter MAGIC_WAN_FBF_count\ntxt\nFilter: MAGIC_WAN_FBF\n\nName                                      Bytes       Packets\nMAGIC_WAN_FBF_count                       760174478   1940954\ntxt\nset interfaces ge-0/0/7 unit 0 family inet filter input MAGIC_WAN_FBF\nset interfaces ge-0/0/7 unit 0 family inet address 10.1.20.1/24\ntxt\nadmin@srx300> show configuration interfaces ge-0/0/7 unit 0\ntxt\nfamily inet {\n    filter {\n        input MAGIC_WAN_FBF;\n    }\n    address 10.1.20.1/24;\n}\ntxt\nset routing-options static route 0.0.0.0/0 next-hop <DEFAULT GATEWAY VIA ISP>\nset routing-options rib-groups MAGIC_WAN_RG import-rib [ inet.0 MAGIC_WAN_RI.inet.0 ]\nset routing-options interface-routes rib-group inet MAGIC_WAN_RG\nset routing-options interface-routes rib-group inet MAGIC_WAN_RG\ntxt\nadmin@srx300> show configuration routing-options\ntxt\ninterface-routes {\n    rib-group inet MAGIC_WAN_GW_RG;\n}\nstatic {\n    route 0.0.0.0/0 next-hop <DEFAULT GATEWAY VIA ISP>;\n}\nrib-groups {\n    MAGIC_WAN_GW_RG {\n        import-rib [ inet.0 MAGIC_WAN_RI.inet.0 ];\n    }\n}\ntxt\nset security policies from-zone cloudflare to-zone trust policy cloudflare_to_trust match source-address any\nset security policies from-zone cloudflare to-zone trust policy cloudflare_to_trust match destination-address any\nset security policies from-zone cloudflare to-zone trust policy cloudflare_to_trust match application any\nset security policies from-zone cloudflare to-zone trust policy cloudflare_to_trust then permit\nset security policies from-zone cloudflare to-zone trust policy cloudflare_to_trust then log session-close\ntxt\nadmin@srx300> show configuration security policies from-zone cloudflare to-zone trust\ntxt\npolicy cloudflare_to_trust_permit {\n    match {\n        source-address any;\n        destination-address any;\n        application any;\n    }\n    then {\n        permit;\n        log {\n            session-close;\n        }\n    }\n}\ntxt\nset security policies from-zone trust to-zone cloudflare policy trust_to_cloudflare_permit match source-address any\nset security policies from-zone trust to-zone cloudflare policy trust_to_cloudflare_permit match destination-address any\nset security policies from-zone trust to-zone cloudflare policy trust_to_cloudflare_permit match application any\nset security policies from-zone trust to-zone cloudflare policy trust_to_cloudflare_permit then permit\nset security policies from-zone trust to-zone cloudflare policy trust_to_cloudflare_permit then log session-close\ntxt\nadmin@srx300> show configuration security policies from-zone trust to-zone cloudflare\ntxt\npolicy trust_to_cloudflare_permit {\n    match {\n        source-address any;\n        destination-address any;\n        application any;\n    }\n    then {\n        permit;\n        log {\n            session-close;\n        }\n    }\n}\ntxt\nadmin@srx300> ping source 10.252.2.21 10.252.2.20\ntxt\nPING 10.252.2.20 (10.252.2.20): 56 data bytes\n64 bytes from 10.252.2.20: icmp_seq=0 ttl=64 time=8.429 ms\n64 bytes from 10.252.2.20: icmp_seq=1 ttl=64 time=4.134 ms\n64 bytes from 10.252.2.20: icmp_seq=2 ttl=64 time=4.028 ms\n64 bytes from 10.252.2.20: icmp_seq=3 ttl=64 time=3.855 ms\n64 bytes from 10.252.2.20: icmp_seq=4 ttl=64 time=3.811 ms\ntxt\nadmin@srx300> ping source 10.252.2.23 10.252.2.22\ntxt\nPING 10.252.2.22 (10.252.2.22): 56 data bytes\n\n64 bytes from 10.252.2.22: icmp_seq=0 ttl=64 time=7.405 ms\n64 bytes from 10.252.2.22: icmp_seq=1 ttl=64 time=3.685 ms\n64 bytes from 10.252.2.22: icmp_seq=2 ttl=64 time=3.666 ms\n64 bytes from 10.252.2.22: icmp_seq=3 ttl=64 time=3.888 ms\n64 bytes from 10.252.2.22: icmp_seq=4 ttl=64 time=3.814 ms\ntxt\nadmin@srx300> show security ike active-peer\ntxt\nRemote Address            Port     Peer IKE-ID     XAUTH username    Assigned IP\n162.XXX.XX.164            500      162.XX.XXX.164  not available     0.0.0.0\n172.XX.XXX.164            500      172.XX.XXX.164  not available     0.0.0.0\ntxt\nadmin@srx300> show security ike security-associations\ntxt\nIndex  State Initiator cookie Responder cookie Mode      Remote Address\n3628774 UP   51078ae37b319d23 1475e3b48ca89a9a IKEv2     162.XXX.XX.164\n3628775 UP   b2d9a698b6224fc9 7fb1a9f81db0611c IKEv2     172.XX.XXX.164\ntxt\nadmin@srx300> show security ipsec security-associations\ntxt\nTotal active tunnels: 2\nID    Algorithm       SPI      Life:sec/kb  Mon lsys Port  Gateway\n<131073 ESP:aes-cbc-256/sha256 d28e709e 28565/unlim - root 500 162.XXX.66.164\n>131073 ESP:aes-cbc-256/sha256 25aed8ae 28565/unlim - root 500 162.XXX.XX.164\n<131074 ESP:aes-cbc-256/sha256 3f13176d 28566/unlim - root 500 172.XX.XXX.164\n>131074 ESP:aes-cbc-256/sha256 965169e9 28566/unlim - root 500 172.XX.XXX.164\ntxt\nset security ike traceoptions file ike-debug.log\nset security ike traceoptions file size 1m\nset security ike traceoptions file files 3\nset security ike traceoptions file world-readable\nset security ike traceoptions flag all\ntxt\n   tail -f /var/log/ike-debug.log\n   txt\ndeactivate security ike traceoptions\ntxt\nadmin@srx300> show configuration security ike traceoptions\ntxt\n##\n## inactive: security ike traceoptions\n##\nfile ike-debug.log size 1m files 3 world-readable;\nflag all;\ntxt\nset security ipsec traceoptions file ipsec-debug.log\nset security ipsec traceoptions file size 1m\nset security ipsec traceoptions file files 3\nset security ipsec traceoptions file world-readable\nset security ipsec traceoptions flag all\ntxt\ndelete security ipsec traceoptions\ntxt\ndeactivate security ipsec traceoptions\ntxt\nadmin@srx300> show configuration security ipsec traceoptions\ntxt\n##\n## inactive: security ipsec traceoptions\n##\nfile ipsec-debug.log size 1m files 3 world-readable;\nflag all;\njs\n    const a = new Uint8Array(48);\n    crypto.getRandomValues(a);\n    let base64String = btoa(String.fromCharCode.apply(null, a));\n\nbase64String = base64String.replace(/\\+/g, '')\n                   .replace(/\\//g, '')\n                   .replace(/=/g, '');\n\nconsole.log(base64String.substring(0, 32));\nbash\nset tag Trust_L3_Zone color color2\nset tag Untrust_L3_Zone color color1\nset tag Cloudflare_L3_Zone color color6\nbash\nset address CF_Health_Check_Anycast_01 ip-netmask 172.64.240.253\nset address CF_Health_Check_Anycast_01 tag Cloudflare_L3_Zone\nset address CF_Health_Check_Anycast_02 ip-netmask 172.64.240.254\nset address CF_Health_Check_Anycast_02 tag Cloudflare_L3_Zone\nset address CF_Magic_WAN_Anycast_01 ip-netmask 162.159.66.164\nset address CF_Magic_WAN_Anycast_01 tag Cloudflare_L3_Zone\nset address CF_Magic_WAN_Anycast_02 ip-netmask 172.64.242.164\nset address CF_Magic_WAN_Anycast_02 tag Cloudflare_L3_Zone\nset address CF_MWAN_IPsec_VTI_01_Local ip-netmask 10.252.2.27/31\nset address CF_MWAN_IPsec_VTI_01_Local tag Cloudflare_L3_Zone\nset address CF_MWAN_IPsec_VTI_02_Local ip-netmask 10.252.2.29/31\nset address CF_MWAN_IPsec_VTI_02_Local tag Cloudflare_L3_Zone\nset address CF_MWAN_IPsec_VTI_01_Remote ip-netmask 10.252.2.26\nset address CF_MWAN_IPsec_VTI_01_Remote tag Cloudflare_L3_Zone\nset address CF_MWAN_IPsec_VTI_02_Remote ip-netmask 10.252.2.28\nset address CF_MWAN_IPsec_VTI_02_Remote tag Cloudflare_L3_Zone\nset address CF_WARP_Client_Prefix ip-netmask 100.96.0.0/12\nset address CF_WARP_Client_Prefix tag Cloudflare_L3_Zone\nset address Cloudflare_IPv4_01 ip-netmask 173.245.48.0/20\nset address Cloudflare_IPv4_01 tag Cloudflare_L3_Zone\nset address Cloudflare_IPv4_02 ip-netmask 103.21.244.0/22\nset address Cloudflare_IPv4_02 tag Cloudflare_L3_Zone\nset address Cloudflare_IPv4_03 ip-netmask 103.22.200.0/22\nset address Cloudflare_IPv4_03 tag Cloudflare_L3_Zone\nset address Cloudflare_IPv4_04 ip-netmask 103.31.4.0/22\nset address Cloudflare_IPv4_04 tag Cloudflare_L3_Zone\nset address Cloudflare_IPv4_05 ip-netmask 141.101.64.0/18\nset address Cloudflare_IPv4_05 tag Cloudflare_L3_Zone\nset address Cloudflare_IPv4_06 ip-netmask 108.162.192.0/18\nset address Cloudflare_IPv4_06 tag Cloudflare_L3_Zone\nset address Cloudflare_IPv4_07 ip-netmask 190.93.240.0/20\nset address Cloudflare_IPv4_07 tag Cloudflare_L3_Zone\nset address Cloudflare_IPv4_08 ip-netmask 188.114.96.0/20\nset address Cloudflare_IPv4_08 tag Cloudflare_L3_Zone\nset address Cloudflare_IPv4_09 ip-netmask 197.234.240.0/22\nset address Cloudflare_IPv4_09 tag Cloudflare_L3_Zone\nset address Cloudflare_IPv4_10 ip-netmask 198.41.128.0/17\nset address Cloudflare_IPv4_10 tag Cloudflare_L3_Zone\nset address Cloudflare_IPv4_11 ip-netmask 162.158.0.0/15\nset address Cloudflare_IPv4_11 tag Cloudflare_L3_Zone\nset address Cloudflare_IPv4_12 ip-netmask 104.16.0.0/13\nset address Cloudflare_IPv4_12 tag Cloudflare_L3_Zone\nset address Cloudflare_IPv4_13 ip-netmask 104.24.0.0/14\nset address Cloudflare_IPv4_13 tag Cloudflare_L3_Zone\nset address Cloudflare_IPv4_14 ip-netmask 172.64.0.0/13\nset address Cloudflare_IPv4_14 tag Cloudflare_L3_Zone\nset address Cloudflare_IPv4_15 ip-netmask 131.0.72.0/22\nset address Cloudflare_IPv4_15 tag Cloudflare_L3_Zone\nset address Internet_L3_203-0-113-254--24 ip-netmask 203.0.113.254/24\nset address Internet_L3_203-0-113-254--24 tag Untrust_L3_Zone\nset address VLAN0010_10-1-10-0--24 ip-netmask 10.1.10.0/24\nset address VLAN0010_10-1-10-0--24 tag Trust_L3_Zone\nset address VLAN0020_10-1-20-0--24 ip-netmask 10.1.20.0/24\nset address VLAN0020_10-1-20-0--24 tag Trust_L3_Zone\nset address VLAN0100_10-1-100-0--24 ip-netmask 10.1.100.0/24\nset address VLAN0100_10-1-100-0--24 tag Trust_L3_Zone\nset address VLAN0100_L3_10-1-100-254--24 ip-netmask 10.1.100.254/24\nset address VLAN0100_L3_10-1-100-254--24 tag Trust_L3_Zone\nbash\nset address-group Cloudflare_IPv4_Static_Grp static [ Cloudflare_IPv4_01 Cloudflare_IPv4_02 Cloudflare_IPv4_03 Cloudflare_IPv4_04 Cloudflare_IPv4_05 Cloudflare_IPv4_06 Cloudflare_IPv4_07 Cloudflare_IPv4_08 Cloudflare_IPv4_09 Cloudflare_IPv4_10 Cloudflare_IPv4_11 Cloudflare_IPv4_12 Cloudflare_IPv4_13 Cloudflare_IPv4_14 Cloudflare_IPv4_15 ]\nset address-group Cloudflare_IPv4_Static_Grp tag Cloudflare_L3_Zone\nbash\nset network profiles interface-management-profile Allow_Ping userid-service no\nset network profiles interface-management-profile Allow_Ping ping yes\nbash\nset network interface ethernet ethernet1/1 layer3 ndp-proxy enabled no\nset network interface ethernet ethernet1/1 layer3 lldp enable no\nset network interface ethernet ethernet1/1 layer3 ip VLAN0100_L3_10-1-100-254--24\nset network interface ethernet ethernet1/1 layer3 interface-management-profile Mgmt_Services\nset network interface ethernet ethernet1/2 layer3 ndp-proxy enabled no\nset network interface ethernet ethernet1/2 layer3 lldp enable no\nset network interface ethernet ethernet1/2 layer3 ip Internet_L3_203-0-113-254--24\nset network interface ethernet ethernet1/2 layer3 interface-management-profile Allow_Ping\nset network interface ethernet ethernet1/2 layer3 adjust-tcp-mss enable yes\nset network interface ethernet ethernet1/2 layer3 adjust-tcp-mss ipv4-mss-adjustment 64\nbash\nset network interface tunnel units tunnel.1 ip CF_MWAN_IPsec_VTI_01_Local\nset network interface tunnel units tunnel.1 mtu 1450\nset network interface tunnel units tunnel.1 interface-management-profile Allow_Ping\nset network interface tunnel units tunnel.2 ip CF_MWAN_IPsec_VTI_02_Local\nset network interface tunnel units tunnel.2 mtu 1450\nset network interface tunnel units tunnel.2 interface-management-profile Allow_Ping\nbash\nset zone Trust_L3_Zone network layer3 ethernet1/1\nset zone Untrust_L3_Zone network layer3 ethernet1/2\nset zone Cloudflare_L3_Zone network layer3 [ tunnel.1 tunnel.2 ]\nbash\nset network ike crypto-profiles ike-crypto-profiles CF_IKE_Crypto_CBC hash [ sha512 sha384 sha256 ]\nset network ike crypto-profiles ike-crypto-profiles CF_IKE_Crypto_CBC dh-group [ group20 ]\nset network ike crypto-profiles ike-crypto-profiles CF_IKE_Crypto_CBC encryption aes-256-cbc\nset network ike crypto-profiles ike-crypto-profiles CF_IKE_Crypto_CBC lifetime hours 24\nset network ike crypto-profiles ike-crypto-profiles CF_IKE_Crypto_CBC authentication-multiple 0\nbash\nset network ike crypto-profiles ipsec-crypto-profiles CF_IPsec_Crypto_CBC esp authentication [ sha256 sha1 ]\nset network ike crypto-profiles ipsec-crypto-profiles CF_IPsec_Crypto_CBC esp encryption aes-256-cbc\nset network ike crypto-profiles ipsec-crypto-profiles CF_IPsec_Crypto_CBC lifetime hours 8\nset network ike crypto-profiles ipsec-crypto-profiles CF_IPsec_Crypto_CBC dh-group group20\nbash\nset network ike gateway CF_Magic_WAN_IKE_01 protocol ikev1 dpd enable yes\nset network ike gateway CF_Magic_WAN_IKE_01 protocol ikev2 dpd enable yes\nset network ike gateway CF_Magic_WAN_IKE_01 protocol ikev2 ike-crypto-profile CF_IKE_Crypto_CBC\nset network ike gateway CF_Magic_WAN_IKE_01 protocol version ikev2\nset network ike gateway CF_Magic_WAN_IKE_01 local-address ip Internet_L3_203-0-113-254--24\nset network ike gateway CF_Magic_WAN_IKE_01 local-address interface ethernet1/2\nset network ike gateway CF_Magic_WAN_IKE_01 protocol-common nat-traversal enable no\nset network ike gateway CF_Magic_WAN_IKE_01 protocol-common fragmentation enable no\nset network ike gateway CF_Magic_WAN_IKE_01 peer-address ip CF_Magic_WAN_Anycast_01\nset network ike gateway CF_Magic_WAN_IKE_01 authentication pre-shared-key key -AQ==Xdcd9ir5o5xhjuIH---------------------HsRoVf+M0TTG4ja3EzulN37zMOwGs\nset network ike gateway CF_Magic_WAN_IKE_01 local-id id 28de99ee57424ee0a1591384193982fa.33145236.ipsec.cloudflare.com\nset network ike gateway CF_Magic_WAN_IKE_01 local-id type fqdn\nset network ike gateway CF_Magic_WAN_IKE_01 disabled no\nbash\nset network ike gateway CF_Magic_WAN_IKE_02 protocol ikev1 dpd enable yes\nset network ike gateway CF_Magic_WAN_IKE_02 protocol ikev2 dpd enable yes\nset network ike gateway CF_Magic_WAN_IKE_02 protocol ikev2 ike-crypto-profile CF_IKE_Crypto_CBC\nset network ike gateway CF_Magic_WAN_IKE_02 protocol version ikev2\nset network ike gateway CF_Magic_WAN_IKE_02 local-address ip Internet_L3_203-0-113-254--24\nset network ike gateway CF_Magic_WAN_IKE_02 local-address interface ethernet1/2\nset network ike gateway CF_Magic_WAN_IKE_02 protocol-common nat-traversal enable no\nset network ike gateway CF_Magic_WAN_IKE_02 protocol-common fragmentation enable no\nset network ike gateway CF_Magic_WAN_IKE_02 peer-address ip CF_Magic_WAN_Anycast_02\nset network ike gateway CF_Magic_WAN_IKE_02 authentication pre-shared-key key -AQ==rvwEulxx7wLBl---------------------swSeJPXxxM2cfPbt7q4HZZGZZ8\nset network ike gateway CF_Magic_WAN_IKE_02 local-id id b87322b0915b47158667bf1653990e66.33145236.ipsec.cloudflare.com\nset network ike gateway CF_Magic_WAN_IKE_02 local-id type fqdn\nset network ike gateway CF_Magic_WAN_IKE_02 disabled no\nbash\nset network tunnel ipsec CF_Magic_WAN_IPsec_01 auto-key ike-gateway CF_Magic_WAN_IKE_01\nset network tunnel ipsec CF_Magic_WAN_IPsec_01 auto-key ipsec-crypto-profile CF_IPsec_Crypto_CBC\nset network tunnel ipsec CF_Magic_WAN_IPsec_01 tunnel-monitor destination-ip 10.252.2.26\nset network tunnel ipsec CF_Magic_WAN_IPsec_01 tunnel-monitor tunnel-monitor-profile default\nset network tunnel ipsec CF_Magic_WAN_IPsec_01 tunnel-interface tunnel.1\nset network tunnel ipsec CF_Magic_WAN_IPsec_01 anti-replay no\nset network tunnel ipsec CF_Magic_WAN_IPsec_01 disabled no\nbash\nset network tunnel ipsec CF_Magic_WAN_IPsec_02 auto-key ike-gateway CF_Magic_WAN_IKE_02\nset network tunnel ipsec CF_Magic_WAN_IPsec_02 auto-key ipsec-crypto-profile CF_IPsec_Crypto_CBC\nset network tunnel ipsec CF_Magic_WAN_IPsec_02 tunnel-monitor destination-ip 10.252.2.28\nset network tunnel ipsec CF_Magic_WAN_IPsec_02 tunnel-monitor tunnel-monitor-profile default\nset network tunnel ipsec CF_Magic_WAN_IPsec_02 tunnel-interface tunnel.2\nset network tunnel ipsec CF_Magic_WAN_IPsec_02 anti-replay no\nset network tunnel ipsec CF_Magic_WAN_IPsec_02 disabled no\nbash\nshow vpn ike-sa gateway [value]\nbash\nadmin@panvm03> show vpn ike-sa gateway CF_Magic_WAN_IKE_01\n\nThere is no IKEv1 phase-1 SA found.\n\nThere is no IKEv1 phase-2 SA found.\n\nIKEv2 SAs\nGateway ID      Peer-Address           Gateway Name           Role SN       Algorithm             Established     Expiration      Xt Child  ST\n\n----------      ------------           ------------           ---- --       ---------             -----------     ----------      -- -----  --\n\n2               162.159.66.164         CF_Magic_WAN_IKE_01    Init 67       PSK/DH20/A256/SHA256  Jun.04 21:09:13 Jun.05 05:09:13 0  1      Established\n\nIKEv2 IPsec Child SAs\nGateway Name           TnID     Tunnel                    ID       Parent   Role SPI(in)  SPI(out) MsgID    ST\n\n------------           ----     ------                    --       ------   ---- -------  -------- -----    --\n\nCF_Magic_WAN_IKE_01    2        CF_Magic_WAN_IPsec_01     322550   67       Init FCAEE176 1EF41BA9 000007B4 Mature\n\nShow IKEv2 SA: Total 2 gateways found. 1 ike sa found.\nbash\nadmin@panvm03> show vpn ike-sa gateway CF_Magic_WAN_IKE_02\n\nThere is no IKEv1 phase-1 SA found.\n\nThere is no IKEv1 phase-2 SA found.\n\nIKEv2 SAs\nGateway ID      Peer-Address           Gateway Name           Role SN       Algorithm             Established     Expiration      Xt Child  ST\n\n----------      ------------           ------------           ---- --       ---------             -----------     ----------      -- -----  --\n\n3               172.64.242.164         CF_Magic_WAN_IKE_02    Init 66       PSK/DH20/A256/SHA256  Jun.04 20:37:42 Jun.05 04:37:42 0  2      Established\n\nIKEv2 IPsec Child SAs\nGateway Name           TnID     Tunnel                    ID       Parent   Role SPI(in)  SPI(out) MsgID    ST\n\n------------           ----     ------                    --       ------   ---- -------  -------- -----    --\n\nCF_Magic_WAN_IKE_02    3        CF_Magic_WAN_IPsec_02     323145   66       Init B6EDA356 43F71BC5 00000A52 Mature\n\nShow IKEv2 SA: Total 2 gateways found. 1 ike sa found.\nbash\ntest vpn ike-sa gateway [value]\nbash\nadmin@panvm03> test vpn ike-sa gateway CF_Magic_WAN_IKE_01\n\nStart time: Jun.05 00:30:29\nInitiate 1 IKE SA.\nbash\nadmin@panvm03> test vpn ike-sa gateway CF_Magic_WAN_IKE_02\n\nStart time: Jun.05 00:30:33\nInitiate 1 IKE SA.\nbash\nshow vpn ipsec-sa tunnel [value]\nbash\nadmin@panvm03> show vpn ipsec-sa tunnel CF_Magic_WAN_IPsec_01\n\nGwID/client IP  TnID   Peer-Address           Tunnel(Gateway)                                Algorithm          SPI(in)  SPI(out) life(Sec/KB)             remain-time(Sec)\n\n--------------  ----   ------------           ---------------                                ---------          -------  -------- ------------             ----------------\n\n2               2      162.159.66.164         CF_Magic_WAN_IPsec_01(CF_Magic_WAN_IKE_01)     ESP/A256/SHA256    B5D09AB8 9FA69407 3600/Unlimited           3445\n\nShow IPsec SA: Total 1 tunnels found. 1 ipsec sa found.\nbash\nadmin@panvm03> show vpn ipsec-sa tunnel CF_Magic_WAN_IPsec_02\n\nGwID/client IP  TnID   Peer-Address           Tunnel(Gateway)                                Algorithm          SPI(in)  SPI(out) life(Sec/KB)             remain-time(Sec)\n\n--------------  ----   ------------           ---------------                                ---------          -------  -------- ------------             ----------------\n\n3               3      172.64.242.164         CF_Magic_WAN_IPsec_02(CF_Magic_WAN_IKE_02)     ESP/A256/SHA256    CAEA6F09 EC6ACC7A 3600/Unlimited           3361\n\nShow IPsec SA: Total 1 tunnels found. 1 ipsec sa found.\nbash\ntest vpn ipsec-sa tunnel [value]\nbash\nadmin@panvm03> test vpn ipsec-sa tunnel CF_Magic_WAN_IPsec_01\n\nStart time: Jun.05 00:37:50\nInitiate 1 IPsec SA for tunnel CF_Magic_WAN_IPsec_01.\nbash\nadmin@panvm03> test vpn ipsec-sa tunnel CF_Magic_WAN_IPsec_02\n\nStart time: Jun.05 00:38:52\nInitiate 1 IPsec SA for tunnel CF_Magic_WAN_IPsec_02.\nbash\nping source [value src IP] host [value dst IP]\nbash\nadmin@panvm03> ping source 10.252.2.27 host 10.252.2.26\nPING 10.252.2.26 (10.252.2.26) from 10.252.2.27 : 56(84) bytes of data.\n64 bytes from 10.252.2.26: icmp_seq=1 ttl=64 time=2.71 ms\n64 bytes from 10.252.2.26: icmp_seq=2 ttl=64 time=2.03 ms\n64 bytes from 10.252.2.26: icmp_seq=3 ttl=64 time=1.98 ms\n64 bytes from 10.252.2.26: icmp_seq=4 ttl=64 time=1.98 ms\n^C\n--- 10.252.2.26 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3002ms\nrtt min/avg/max/mdev = 1.980/2.180/2.719/0.312 ms\nbash\nadmin@panvm03> ping source 10.252.2.29 host 10.252.2.28\nPING 10.252.2.28 (10.252.2.28) from 10.252.2.29 : 56(84) bytes of data.\n64 bytes from 10.252.2.28: icmp_seq=1 ttl=64 time=2.90 ms\n64 bytes from 10.252.2.28: icmp_seq=2 ttl=64 time=1.92 ms\n64 bytes from 10.252.2.28: icmp_seq=3 ttl=64 time=1.76 ms\n64 bytes from 10.252.2.28: icmp_seq=4 ttl=64 time=1.97 ms\n^C\n--- 10.252.2.28 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3003ms\nrtt min/avg/max/mdev = 1.765/2.141/2.900/0.446 ms\nbash\nset network virtual-router default ecmp algorithm weighted-round-robin interface tunnel.1 weight 100\nset network virtual-router default ecmp algorithm weighted-round-robin interface tunnel.2 weight 100\nset network virtual-router default ecmp enable yes\nset network virtual-router default ecmp symmetric-return yes\nset network virtual-router default ecmp strict-source-path yes\nbash\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0010_Tun01 nexthop ip-address CF_MWAN_IPsec_VTI_01_Remote\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0010_Tun01 bfd profile None\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0010_Tun01 interface tunnel.1\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0010_Tun01 metric 10\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0010_Tun01 destination VLAN0010_10-1-10-0--24\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0010_Tun01 route-table unicast\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0010_Tun02 nexthop ip-address CF_MWAN_IPsec_VTI_02_Remote\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0010_Tun02 bfd profile None\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0010_Tun02 interface tunnel.2\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0010_Tun02 metric 11\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0010_Tun02 destination VLAN0010_10-1-10-0--24\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0010_Tun02 route-table unicast\nbash\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0020_Tun01 nexthop ip-address CF_MWAN_IPsec_VTI_01_Remote\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0020_Tun01 bfd profile None\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0020_Tun01 interface tunnel.1\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0020_Tun01 metric 10\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0020_Tun01 destination VLAN0020_10-1-20-0--24\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0020_Tun01 route-table unicast\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0020_Tun02 nexthop ip-address CF_MWAN_IPsec_VTI_02_Remote\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0020_Tun02 bfd profile None\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0020_Tun02 interface tunnel.2\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0020_Tun02 metric 11\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0020_Tun02 destination VLAN0020_10-1-20-0--24\nset network virtual-router default routing-table ip static-route Magic_WAN_VLAN0020_Tun02 route-table unicast\nbash\nset rulebase security rules Cloudflare_Tunnel_Bidirect_HC to Cloudflare_L3_Zone\nset rulebase security rules Cloudflare_Tunnel_Bidirect_HC from Cloudflare_L3_Zone\nset rulebase security rules Cloudflare_Tunnel_Bidirect_HC source [ CF_Health_Check_Anycast_01 CF_Health_Check_Anycast_02 ]\nset rulebase security rules Cloudflare_Tunnel_Bidirect_HC destination Cloudflare_IPv4_Static_Grp\nset rulebase security rules Cloudflare_Tunnel_Bidirect_HC source-user any\nset rulebase security rules Cloudflare_Tunnel_Bidirect_HC category any\nset rulebase security rules Cloudflare_Tunnel_Bidirect_HC application [ icmp ping ]\nset rulebase security rules Cloudflare_Tunnel_Bidirect_HC service application-default\nset rulebase security rules Cloudflare_Tunnel_Bidirect_HC hip-profiles any\nset rulebase security rules Cloudflare_Tunnel_Bidirect_HC action allow\nset rulebase security rules Cloudflare_Tunnel_Bidirect_HC rule-type universal\nset rulebase security rules Cloudflare_Tunnel_Bidirect_HC description \"Permit bidirectional HCs\"\nset rulebase security rules Cloudflare_Tunnel_Bidirect_HC disabled no\nset rulebase security rules Cloudflare_Tunnel_Bidirect_HC log-end yes\nbash\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_01 action forward nexthop ip-address CF_MWAN_IPsec_VTI_01_Remote\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_01 action forward egress-interface tunnel.1\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_01 from zone Cloudflare_L3_Zone\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_01 enforce-symmetric-return enabled no\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_01 source CF_Health_Check_Anycast_01\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_01 destination Cloudflare_IPv4_Static_Grp\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_01 source-user any\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_01 application any\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_01 service any\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_01 tag Cloudflare_L3_Zone\nbash\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_02 action forward nexthop ip-address CF_MWAN_IPsec_VTI_02_Remote\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_02 action forward egress-interface tunnel.2\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_02 from zone Cloudflare_L3_Zone\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_02 enforce-symmetric-return enabled no\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_02 source CF_Health_Check_Anycast_02\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_02 destination Cloudflare_IPv4_Static_Grp\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_02 source-user any\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_02 application any\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_02 service any\nset rulebase pbf rules PBF_Cloudflare_Healthcheck_02 tag Cloudflare_L3_Zone\nbash\nrule eq Cloudflare_Tunnel_Bidirect_HC\nbash\n( addr.src in 172.64.240.253 ) or ( addr.src in 172.64.240.254 )\nbash\nset rulebase security rules Trust_to_Cloudflare_Magic_WAN_Allow to Cloudflare_L3_Zone\nset rulebase security rules Trust_to_Cloudflare_Magic_WAN_Allow from Trust_L3_Zone\nset rulebase security rules Trust_to_Cloudflare_Magic_WAN_Allow source VLAN0100_10-1-100-0--24\nset rulebase security rules Trust_to_Cloudflare_Magic_WAN_Allow destination [ VLAN0010_10-1-10-0--24 VLAN0020_10-1-20-0--24 ]\nset rulebase security rules Trust_to_Cloudflare_Magic_WAN_Allow source-user any\nset rulebase security rules Trust_to_Cloudflare_Magic_WAN_Allow category any\nset rulebase security rules Trust_to_Cloudflare_Magic_WAN_Allow application any\nset rulebase security rules Trust_to_Cloudflare_Magic_WAN_Allow service application-default\nset rulebase security rules Trust_to_Cloudflare_Magic_WAN_Allow hip-profiles any\nset rulebase security rules Trust_to_Cloudflare_Magic_WAN_Allow action allow\nset rulebase security rules Trust_to_Cloudflare_Magic_WAN_Allow rule-type universal\nbash\nset rulebase security rules Cloudflare_Magic_WAN_to_Trust_Allow to Trust_L3_Zone\nset rulebase security rules Cloudflare_Magic_WAN_to_Trust_Allow from Cloudflare_L3_Zone\nset rulebase security rules Cloudflare_Magic_WAN_to_Trust_Allow source [ VLAN0010_10-1-10-0--24 VLAN0020_10-1-20-0--24 ]\nset rulebase security rules Cloudflare_Magic_WAN_to_Trust_Allow destination VLAN0100_10-1-100-0--24\nset rulebase security rules Cloudflare_Magic_WAN_to_Trust_Allow source-user any\nset rulebase security rules Cloudflare_Magic_WAN_to_Trust_Allow category any\nset rulebase security rules Cloudflare_Magic_WAN_to_Trust_Allow application any\nset rulebase security rules Cloudflare_Magic_WAN_to_Trust_Allow service application-default\nset rulebase security rules Cloudflare_Magic_WAN_to_Trust_Allow hip-profiles any\nset rulebase security rules Cloudflare_Magic_WAN_to_Trust_Allow action allow\nset rulebase security rules Cloudflare_Magic_WAN_to_Trust_Allow rule-type universal\nbash\nset rulebase pbf rules PBF_Magic_WAN_Sites_01 action forward nexthop ip-address CF_MWAN_IPsec_VTI_01_Remote\nset rulebase pbf rules PBF_Magic_WAN_Sites_01 action forward egress-interface tunnel.1\nset rulebase pbf rules PBF_Magic_WAN_Sites_01 from zone Trust_L3_Zone\nset rulebase pbf rules PBF_Magic_WAN_Sites_01 enforce-symmetric-return enabled no\nset rulebase pbf rules PBF_Magic_WAN_Sites_01 source VLAN0100_10-1-100-0--24\nset rulebase pbf rules PBF_Magic_WAN_Sites_01 destination [ VLAN0010_10-1-10-0--24 VLAN0020_10-1-20-0--24 ]\nset rulebase pbf rules PBF_Magic_WAN_Sites_01 source-user any\nset rulebase pbf rules PBF_Magic_WAN_Sites_01 application any\nset rulebase pbf rules PBF_Magic_WAN_Sites_01 service any\nset rulebase pbf rules PBF_Magic_WAN_Sites_01 disabled no\nset rulebase pbf rules PBF_Magic_WAN_Sites_01 negate-destination no\nbash\nset rulebase pbf rules PBF_Magic_WAN_Sites_02 action forward nexthop ip-address CF_MWAN_IPsec_VTI_02_Remote\nset rulebase pbf rules PBF_Magic_WAN_Sites_02 action forward egress-interface tunnel.2\nset rulebase pbf rules PBF_Magic_WAN_Sites_02 from zone Trust_L3_Zone\nset rulebase pbf rules PBF_Magic_WAN_Sites_02 enforce-symmetric-return enabled no\nset rulebase pbf rules PBF_Magic_WAN_Sites_02 source VLAN0100_10-1-100-0--24\nset rulebase pbf rules PBF_Magic_WAN_Sites_02 destination [ VLAN0010_10-1-10-0--24 VLAN0020_10-1-20-0--24 ]\nset rulebase pbf rules PBF_Magic_WAN_Sites_02 source-user any\nset rulebase pbf rules PBF_Magic_WAN_Sites_02 application any\nset rulebase pbf rules PBF_Magic_WAN_Sites_02 service any\nset rulebase pbf rules PBF_Magic_WAN_Sites_02 disabled no\nset rulebase pbf rules PBF_Magic_WAN_Sites_02 negate-destination no\nbash\nset rulebase security rules Trust_to_MWAN_Gateway_Egress_Allow to Cloudflare_L3_Zone\nset rulebase security rules Trust_to_MWAN_Gateway_Egress_Allow from Trust_L3_Zone\nset rulebase security rules Trust_to_MWAN_Gateway_Egress_Allow source any\nset rulebase security rules Trust_to_MWAN_Gateway_Egress_Allow destination [ VLAN0010_10-1-10-0--24 VLAN0020_10-1-20-0--24 ]\nset rulebase security rules Trust_to_MWAN_Gateway_Egress_Allow source-user any\nset rulebase security rules Trust_to_MWAN_Gateway_Egress_Allow category any\nset rulebase security rules Trust_to_MWAN_Gateway_Egress_Allow application any\nset rulebase security rules Trust_to_MWAN_Gateway_Egress_Allow service application-default\nset rulebase security rules Trust_to_MWAN_Gateway_Egress_Allow hip-profiles any\nset rulebase security rules Trust_to_MWAN_Gateway_Egress_Allow action allow\nset rulebase security rules Trust_to_MWAN_Gateway_Egress_Allow rule-type universal\nset rulebase security rules Trust_to_MWAN_Gateway_Egress_Allow negate-destination yes\nbash\nset rulebase pbf rules PBF_MWAN_Egress_01 action forward nexthop ip-address CF_MWAN_IPsec_VTI_01_Remote\nset rulebase pbf rules PBF_MWAN_Egress_01 action forward egress-interface tunnel.1\nset rulebase pbf rules PBF_MWAN_Egress_01 from zone Trust_L3_Zone\nset rulebase pbf rules PBF_MWAN_Egress_01 enforce-symmetric-return enabled no\nset rulebase pbf rules PBF_MWAN_Egress_01 source VLAN0100_10-1-100-0--24\nset rulebase pbf rules PBF_MWAN_Egress_01 destination [ VLAN0010_10-1-10-0--24 VLAN0020_10-1-20-0--24 ]\nset rulebase pbf rules PBF_MWAN_Egress_01 source-user any\nset rulebase pbf rules PBF_MWAN_Egress_01 application any\nset rulebase pbf rules PBF_MWAN_Egress_01 service any\nset rulebase pbf rules PBF_MWAN_Egress_01 disabled no\nset rulebase pbf rules PBF_MWAN_Egress_01 negate-destination yes\nbash\nset rulebase pbf rules PBF_MWAN_Egress_02 action forward nexthop ip-address CF_MWAN_IPsec_VTI_02_Remote\nset rulebase pbf rules PBF_MWAN_Egress_02 action forward egress-interface tunnel.2\nset rulebase pbf rules PBF_MWAN_Egress_02 from zone Trust_L3_Zone\nset rulebase pbf rules PBF_MWAN_Egress_02 enforce-symmetric-return enabled no\nset rulebase pbf rules PBF_MWAN_Egress_02 source VLAN0100_10-1-100-0--24\nset rulebase pbf rules PBF_MWAN_Egress_02 destination [ VLAN0010_10-1-10-0--24 VLAN0020_10-1-20-0--24 ]\nset rulebase pbf rules PBF_MWAN_Egress_02 source-user any\nset rulebase pbf rules PBF_MWAN_Egress_02 application any\nset rulebase pbf rules PBF_MWAN_Egress_02 service any\nset rulebase pbf rules PBF_MWAN_Egress_02 disabled no\nset rulebase pbf rules PBF_MWAN_Egress_02 negate-destination yes\nbash\ncurl --request PUT \\\nhttps://api.cloudflare.com/client/v4/accounts/{account_id}/magic/ipsec_tunnels/{tunnel_id} \\\n--header \"X-Auth-Email: <EMAIL>\" \\\n--header \"X-Auth-Key: <API_KEY>\" \\\n--header \"Content-Type: application/json\" \\\n--data '{\n  \"health_check\": {\n    \"direction\": \"bidirectional\",\n    \"enabled\": true,\n    \"type\": \"request\",\n    \"rate\": \"low\"\n  }\n}'\nbash\n   set vpn ipsec-performance anti-replay window-size 0\n   bash\n   system gre tunnel add name <NAME_OF_YOUR_GRE_TUNNEL> local-gw <WAN_PORT> remote-gw <REMOTE_GATEWAY_IP_ADDRESS> local-ip <LOCAL_IP_ADDRESS> remote-ip <REMOTE_IP_ADDRESS>\n   bash\nsystem gre route add net <IP_ADDRESS> tunnelname <TUNNEL_NAME>\nbash\ncurl --request PUT \\\nhttps://api.cloudflare.com/client/v4/accounts/{account_id}/magic/ipsec_tunnels/{tunnel_id} \\\n--header \"X-Auth-Email: <EMAIL>\" \\\n--header \"X-Auth-Key: <API_KEY>\" \\\n--header \"Content-Type: application/json\" \\\n--data '{\n  \"health_check\": {\n    \"enabled\": true,\n    \"target\": \"172.64.240.252\",\n    \"type\": \"request\",\n    \"rate\": \"mid\"\n  }\n}'\nsh\ntcpdump -nn proto 1\nsh\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on any, link-type LINUX_SLL (Linux cooked v1), capture size 262144 bytes\n\n13:09:55.500453 xfrm1, IN: IP 172.70.51.31 > 172.64.240.252: ICMP echo request, id 33504, seq 0, length 64\n13:09:55.500480 xfrm1, OUT: IP 172.64.240.252 > 172.70.51.31: ICMP echo reply, id 33504, seq 0, length 64\n\n13:09:55.504669 xfrm1, IN: IP 172.71.29.66 > 172.64.240.252: ICMP echo request, id 60828, seq 0, length 64\n13:09:55.504695 xfrm1, OUT: IP 172.64.240.252 > 172.71.29.66: ICMP echo reply, id 60828, seq 0, length 64\nbash\ncurl --request PUT \\\nhttps://api.cloudflare.com/client/v4/accounts/{account_id}/magic/ipsec_tunnels/{tunnel_id} \\\n--header \"X-Auth-Email: <EMAIL>\" \\\n--header \"X-Auth-Key: <API_KEY>\" \\\n--header \"Content-Type: application/json\" \\\n--data '{\n  \"health_check\": {\n    \"enabled\": true,\n    \"target\": \"172.64.240.252\",\n    \"type\": \"request\",\n    \"rate\": \"mid\"\n  }\n}'\nsh\nsudo apt-get install strongswan -y\ntxt\ncharon {\n    load_modular = yes\n    install_routes = no\n    install_virtual_ip = no\n\nplugins {\n        include strongswan.d/charon/*.conf\n    }\n}\n\ninclude strongswan.d/*.conf\ntxt",
  "code_samples": [
    {
      "code": "Check Cloudflare Analytics for the proxy zone to confirm Logpush traffic is flowing, and monitor WAF events to ensure unauthorized requests are blocked.\n\n</page>\n\n<page>\n---\ntitle: Enable Logpush to Elastic  Cloudflare Logs docs\ndescription: Push your Cloudflare logs to Elastic for instant visibility and\n  insights. Enabling this integration with Elastic comes with a predefined\n  dashboard to view all of your Cloudflare observability and security data with\n  ease.\nlastUpdated: 2025-07-21T15:07:21.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/elastic/\n  md: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/elastic/index.md\n---\n\nPush your Cloudflare logs to Elastic for instant visibility and insights. Enabling this integration with Elastic comes with a predefined dashboard to view all of your Cloudflare observability and security data with ease.\n\nThe Cloudflare Logpush integration can be used in three different modes to collect data:\n\n* **HTTP Endpoint mode** - Cloudflare pushes logs directly to an HTTP endpoint hosted by your Elastic Agent.\n* **AWS S3 polling mode** - Cloudflare writes data to S3, and the Elastic Agent polls the S3 bucket by listing its contents and reading new files.\n* **AWS S3 SQS mode** - Cloudflare writes data to S3, S3 pushes a new object notification to SQS, the Elastic Agent receives the notification from SQS, and then reads the S3 object. Multiple Agents can be used in this mode.\n\nNote\n\nElastic recommends the AWS S3 SQS mode.\n\n## Enable Logpush Job in Cloudflare\n\nDetermine which method you want to use, and configure the appropriate Logpush job in the Cloudflare dashboard or via the API.\n\nElastic supports the default JSON format.\n\nTo push logs to an object storage for short term storage and buffering before ingesting into Elastic (recommended), follow the instructions to configure a Logpush job to push logs to [AWS S3](https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/aws-s3/), [Google Cloud Storage](https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/google-cloud-storage/), or [Azure Blob Storage](https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/azure/).\n\nTo use the [HTTP Endpoint mode](https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/http/), use the API to push logs to an HTTP endpoint backed by your Elastic Agent.\n\nAdd the same custom header along with its value on both sides for additional security.\n\nFor example, while creating a job along with a header and value for a particular dataset:\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "## Enable the Integration in Elastic\n\nOnce the Logpush job is configured, follow Elastics instructions for [setting up the Integration](https://docs.elastic.co/integrations/cloudflare_logpush) in the Elastic app.\n\n## View Dashboards\n\nLog in to your [Elastic account](https://www.elastic.co/) to view prebuilt dashboards and configure alerts.\n\n</page>\n\n<page>\n---\ntitle: Enable Logpush to Google Cloud Storage  Cloudflare Logs docs\ndescription: Cloudflare Logpush supports pushing logs directly to Google Cloud\n  Storage (GCS) via the Cloudflare dashboard or via API.\nlastUpdated: 2025-10-10T13:43:07.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/google-cloud-storage/\n  md: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/google-cloud-storage/index.md\n---\n\nCloudflare Logpush supports pushing logs directly to Google Cloud Storage (GCS) via the Cloudflare dashboard or via API.\n\n## Manage via the Cloudflare dashboard\n\n1. In the Cloudflare dashboard, go to the **Logpush** page at the account or or domain (also known as zone) level.\n\n   For account: [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/logs)\n\n   For domain (also known as zone): [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/:zone/analytics/logs)\n\n2. Depending on your choice, you have access to [account-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/account/) and [zone-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/zone/), respectively.\n\n3. Select **Create a Logpush job**.\n\n1) In **Select a destination**, choose **Google Cloud Storage**.\n\n2) Enter or select the following destination details:\n\n   * **Bucket** - GCS bucket name\n   * **Path** - bucket location within the storage container\n   * **Organize logs into daily subfolders** (recommended)\n   * For **Grant Cloudflare access to upload files to your bucket**, make sure your bucket has added Cloudflares IAM as a user with a [Storage Object Admin role](https://cloud.google.com/storage/docs/access-control/iam-roles).\n\nWhen you are done entering the destination details, select **Continue**.\n\n1. To prove ownership, Cloudflare will send a file to your designated destination. To find the token, select the **Open** button in the **Overview** tab of the ownership challenge file, then paste it into the Cloudflare dashboard to verify your access to the bucket. Enter the **Ownership Token** and select **Continue**.\n\n2. Select the dataset to push to the storage service.\n\n3. In the next step, you need to configure your logpush job:\n\n   * Enter the **Job name**.\n   * Under **If logs match**, you can select the events to include and/or remove from your logs. Refer to [Filters](https://developers.cloudflare.com/logs/logpush/logpush-job/filters/) for more information. Not all datasets have this option available.\n   * In **Send the following fields**, you can choose to either push all logs to your storage destination or selectively choose which logs you want to push.\n\n4. In **Advanced Options**, you can:\n\n   * Choose the format of timestamp fields in your logs (`RFC3339`(default),`Unix`, or `UnixNano`).\n   * Select a [sampling rate](https://developers.cloudflare.com/logs/logpush/logpush-job/api-configuration/#sampling-rate) for your logs or push a randomly-sampled percentage of logs.\n   * Enable redaction for `CVE-2021-44228`. This option will replace every occurrence of `${` with `x{`.\n\n5. Select **Submit** once you are done configuring your logpush job.\n\n## Create and get access to a GCS bucket\n\nCloudflare uses Google Cloud Identity and Access Management (IAM) to gain access to your bucket. The Cloudflare IAM service account needs admin permission for the bucket.\n\nEnsure **Log Share** permissions are enabled, before attempting to read or configure a Logpush job. For more information refer to the [Roles section](https://developers.cloudflare.com/logs/logpush/permissions/#roles).\n\n\n\nTo enable Logpush to GCS:\n\n1. Create a GCS bucket. Refer to [instructions from GCS](https://cloud.google.com/storage/docs/creating-buckets#storage-create-bucket-console).\n\n2. In **Storage** > **Browser** > **Bucket** > **Permissions**, add the member `logpush@cloudflare-data.iam.gserviceaccount.com` with `Storage Object Admin` permission.\n\n</page>\n\n<page>\n---\ntitle: Enable HTTP destination  Cloudflare Logs docs\ndescription: Cloudflare Logpush now supports the ability to send logs to\n  configurable HTTP endpoints.\nlastUpdated: 2025-10-10T13:43:07.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/http/\n  md: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/http/index.md\n---\n\nCloudflare Logpush now supports the ability to send logs to configurable HTTP endpoints.\n\nNote that when using Logpush to HTTP endpoints, Cloudflare customers are expected to perform their own authentication of the pushed logs. For example, customers may specify a secret token in the URL or an HTTP header of the Logpush destination.\n\nEndpoint requirements\n\nCloudflare expects that the endpoint is available over HTTPS, using a trusted certificate. The endpoint must accept `POST` requests.\n\n## Manage via the Cloudflare dashboard\n\n1. In the Cloudflare dashboard, go to the **Logpush** page at the account or or domain (also known as zone) level.\n\n   For account: [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/logs)\n\n   For domain (also known as zone): [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/:zone/analytics/logs)\n\n2. Depending on your choice, you have access to [account-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/account/) and [zone-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/zone/), respectively.\n\n3. Select **Create a Logpush job**.\n\n1) In **Select a destination**, choose **HTTP destination**.\n\n2) Enter the **HTTP endpoint** where you want to send the logs to, and select **Continue**. - You can use `\"header_*\"` URL parameters to set request headers, for example, to pass an authentication token to your HTTP endpoint.\n\n3) Select the dataset to push to the storage service.\n\n4) In the next step, you need to configure your logpush job:\n\n   * Enter the **Job name**.\n   * Under **If logs match**, you can select the events to include and/or remove from your logs. Refer to [Filters](https://developers.cloudflare.com/logs/logpush/logpush-job/filters/) for more information. Not all datasets have this option available.\n   * In **Send the following fields**, you can choose to either push all logs to your storage destination or selectively choose which logs you want to push.\n\n5) In **Advanced Options**, you can:\n\n   * Choose the format of timestamp fields in your logs (`RFC3339`(default),`Unix`, or `UnixNano`).\n   * Select a [sampling rate](https://developers.cloudflare.com/logs/logpush/logpush-job/api-configuration/#sampling-rate) for your logs or push a randomly-sampled percentage of logs.\n   * Enable redaction for `CVE-2021-44228`. This option will replace every occurrence of `${` with `x{`.\n\n6) Select **Submit** once you are done configuring your logpush job.\n\n## Manage via API\n\nTo create a Logpush job, make a `POST` request to the [Logpush job creation endpoint URL](https://developers.cloudflare.com/logs/logpush/logpush-job/api-configuration/) with the appropriate parameters.\n\nThe supported parameters are as follows:\n\n* Fields that are unchanged from other sources:\n\n  * **dataset** (required): For example, `http_requests`.\n  * **name** (optional): We suggest using your domain name as the job name.\n  * **output\\_options** (optional): Refer to [Log Output Options](https://developers.cloudflare.com/logs/logpush/logpush-job/log-output-options/) to configure fields, sample rate, and timestamp format.\n\n* Unique fields:\n\n  * **destination\\_conf**: Where to send the logs. This consists of an endpoint URL and HTTP headers used.\n\n    * Any `\"header_*\"` URL parameters will be used to set request headers.\n\n      * The HTTPS endpoint cannot have custom URL parameters that conflicts with any `\"header_*\"` URL parameters you have set.\n      * These parameters must be properly URL-encoded (that is, use `\"%20\"` for a whitespace), otherwise some special characters may be decoded incorrectly.\n\n    * `destination_conf` may have more URL parameters in addition to special `\"header_*\"` parameters.\n      * Non URL-encoded special characters will be encoded when uploading.\n\n    * Example: `https://logs.example.com?header_Authorization=Basic%20REDACTED&tags=host:theburritobot.com,dataset:http_requests`\n\n  * **max\\_upload\\_bytes** (optional): The maximum uncompressed file size of a batch of logs. This setting value must be between 5 MB and 1 GB. Note that you cannot set a minimum file size; this means that log files may be much smaller than this batch size.\n\n  * **max\\_upload\\_records** (optional): The maximum number of log lines per batch. This setting must be between 1,000 and 1,000,000 lines. Note that you cannot to specify a minimum number of log lines per batch; this means that log files may contain many fewer lines than this.\n\nNote\n\nThe `ownership_challenge` parameter is not required to create a Logpush job to an HTTP endpoint. You need to make sure that the file upload to validate the destination accepts a gzipped `test.txt.gz` with content as `{\"content\":\"tests\"}` compressed, otherwise it will return an error, like `error validating destination: error writing object: error uploading`.\n\n## Example curl request\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Enable Logpush IBM Cloud Logs  Cloudflare Logs docs\ndescription: Cloudflare Logpush supports pushing logs directly to IBM Cloud Logs\n  via dashboard or API.\nlastUpdated: 2025-10-10T13:43:07.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/ibm-cloud-logs/\n  md: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/ibm-cloud-logs/index.md\n---\n\nCloudflare Logpush supports pushing logs directly to IBM Cloud Logs via dashboard or API.\n\n## Manage via the Cloudflare dashboard\n\n1. In the Cloudflare dashboard, go to the **Logpush** page at the account or or domain (also known as zone) level.\n\n   For account: [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/logs)\n\n   For domain (also known as zone): [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/:zone/analytics/logs)\n\n2. Depending on your choice, you have access to [account-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/account/) and [zone-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/zone/), respectively.\n\n3. Select **Create a Logpush job**.\n\n1) In **Select a destination**, choose **IBM Cloud Logs**.\n\n2) Enter the following destination information:\n\n* **HTTP Source Address** - For example, `ibmcl://<INSTANCE_ID>.ingress.<REGION>.logs.cloud.ibm.com/logs/v1/singles`.\n* **IBM API Key** - For more information refer to the [IBM Cloud Logs documentation](https://cloud.ibm.com/docs/cloud-logs).\n\nWhen you are done entering the destination details, select **Continue**.\n\n1. Select the dataset to push to the storage service.\n\n2. In the next step, you need to configure your logpush job:\n\n   * Enter the **Job name**.\n   * Under **If logs match**, you can select the events to include and/or remove from your logs. Refer to [Filters](https://developers.cloudflare.com/logs/logpush/logpush-job/filters/) for more information. Not all datasets have this option available.\n   * In **Send the following fields**, you can choose to either push all logs to your storage destination or selectively choose which logs you want to push.\n\n3. In **Advanced Options**, you can:\n\n   * Choose the format of timestamp fields in your logs (`RFC3339`(default),`Unix`, or `UnixNano`).\n   * Select a [sampling rate](https://developers.cloudflare.com/logs/logpush/logpush-job/api-configuration/#sampling-rate) for your logs or push a randomly-sampled percentage of logs.\n   * Enable redaction for `CVE-2021-44228`. This option will replace every occurrence of `${` with `x{`.\n\n4. Select **Submit** once you are done configuring your logpush job.\n\n## Manage via API\n\nTo set up an IBM Cloud Logs job:\n\n1. Create a job with the appropriate endpoint URL and authentication parameters.\n2. Enable the job to begin pushing logs.\n\nNote\n\nEnsure Log Share permissions are enabled, before attempting to read or configure a Logpush job. For more information refer to the [Roles section](https://developers.cloudflare.com/logs/logpush/permissions/#roles).\n\n### 1. Create a job\n\nTo create a job, make a `POST` request to the Logpush jobs endpoint with the following fields:\n\n* **name** (optional) - Use your domain name as the job name.\n\n* **output\\_options** (optional) - This parameter is used to define the desired output format and structure. Below are the configurable fields:\n\n  * output\\_type\n  * timestamp\\_format\n  * batch\\_prefix and batch\\_suffix\n  * record\\_prefix and record\\_suffix\n  * record\\_delimiter\n\n* **destination\\_conf** - A log destination consisting of Instance ID, Region and [IBM API Key](https://cloud.ibm.com/docs/account?topic=account-iamtoken_from_apikey) in the string format below.\n\n`ibmcl://<INSTANCE_ID>.ingress.<REGION>.logs.cloud.ibm.com/logs/v1/singles?ibm_api_key=<IBM_API_KEY>`\n\n* **max\\_upload\\_records** (optional) - The maximum number of log lines per batch. This must be at least 1,000 lines or more. Note that there is no way to specify a minimum number of log lines per batch. This means that log files may contain many fewer lines than specified.\n* **max\\_upload\\_bytes** (optional) - The maximum uncompressed file size for a batch of logs. We recommend a default value of 2 MB per upload based on IBM's limits, which our system will enforce for this destination. Since minimum file sizes cannot be set, log files may be smaller than the specified batch size.\n* **dataset** - The category of logs you want to receive. Refer to [Datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/) for the full list of supported datasets.\n\nExample request using cURL:\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "Response:",
      "language": "unknown"
    },
    {
      "code": "### 2. Enable (update) a job\n\nTo enable a job, make a `PUT` request to the Logpush jobs endpoint. You will use the job ID returned from the previous step in the URL and send `{\"enabled\": true}` in the request body.\n\nExample request using cURL:\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "Response:",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Enable IBM QRadar  Cloudflare Logs docs\ndescription: \"To configure a QRadar/Cloudflare integration you have the option\n  to use one of the following methods:\"\nlastUpdated: 2025-07-21T15:07:21.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/ibm-qradar/\n  md: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/ibm-qradar/index.md\n---\n\nTo configure a QRadar/Cloudflare integration you have the option to use one of the following methods:\n\n* [HTTP Receiver protocol](https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/ibm-qradar/#http-receiver-protocol)\n* [Amazon AWS S3 Rest API](https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/ibm-qradar/#amazon-aws-s3-rest-api)\n\n## HTTP Receiver Protocol\n\nTo send Cloudflare logs to QRadar you need to create a [Logpush job to HTTP endpoints](https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/http/) via API. Below you can find two curl examples of how to send Cloudflare Firewall events and Cloudflare HTTP events to QRadar.\n\n### Cloudflare Firewall events\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "### Cloudflare HTTP events\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "Cloudflare checks the accessibility of the IP address, port, and validates the certificate of the HTTP Receive log source. If all parameters are valid, a Logpush is created, and starts to send events to HTTP Receiver log source.\n\n## Amazon AWS S3 Rest API\n\nWhen you use the Amazon S3 REST API protocol, IBM QRadar collects Cloudflare Log events from an Amazon S3 bucket. To use this option, you need to:\n\n1. Create an [Amazon S3 bucket](https://docs.aws.amazon.com/AmazonS3/latest/userguide/creating-bucket.html) to store your Cloudflare Logs. Make a note of the bucket name and the AWS access key ID and secret access key with sufficient permissions to write to the bucket.\n2. [Enable a Logpush to Amazon S3](https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/aws-s3/).\n3. In the AWS Management Console, go to the Amazon S3 service. Create a bucket endpoint to allow Cloudflare to send logs directly to the S3 bucket.\n4. Follow the steps in [Integrate Cloudflare Logs with QRadar by using the Amazon AWS S3 REST API protocol](https://www.ibm.com/docs/en/dsm?topic=configuration-cloudflare-logs).\n5. Test the configuration by generating some logs in Cloudflare and ensuring that they are delivered to the S3 bucket and subsequently forwarded to QRadar.\n\n</page>\n\n<page>\n---\ntitle: Enable Amazon Kinesis  Cloudflare Logs docs\ndescription: Logpush supports Amazon Kinesis as a destination for all datasets.\n  Each Kinesis record that Logpush sends will contain a batch of GZIP-compressed\n  data in newline-delimited JSON format (by default), or in the format specified\n  in the output_options parameter when the job was created.\nlastUpdated: 2025-10-02T09:29:06.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/kinesis/\n  md: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/kinesis/index.md\n---\n\nLogpush supports [Amazon Kinesis](https://aws.amazon.com/kinesis/) as a destination for all datasets. Each Kinesis record that Logpush sends will contain a batch of GZIP-compressed data in newline-delimited JSON format (by default), or in the format specified in the [`output_options`](https://developers.cloudflare.com/logs/logpush/logpush-job/log-output-options/) parameter when the job was created.\n\n## Configure Kinesis using STS Assume Role (recommended)\n\n1. Create an IAM Role for Cloudflare Logpush to Assume with the following trust relationship:",
      "language": "unknown"
    },
    {
      "code": "1. Ensure that the IAM role has permissions to perform the `PutRecord` action on your Kinesis stream. Replace `<AWS_REGION>`, `<YOUR_AWS_ACCOUNT_ID>` and `<STREAM_NAME>` with your own values:",
      "language": "unknown"
    },
    {
      "code": "1. Create a Logpush job, using the following format for the `destination_conf` field:",
      "language": "unknown"
    },
    {
      "code": "1. (optional) When using STS Assume Role, you can include `sts-external-id` as a `destination_conf` parameter so it is included in your Logpush job's requests to Kinesis. Refer to [Securely Using External ID for Accessing AWS Accounts Owned by Others](https://aws.amazon.com/blogs/apn/securely-using-external-id-for-accessing-aws-accounts-owned-by-others/) for more information.",
      "language": "unknown"
    },
    {
      "code": "### STS Assume Role example",
      "language": "unknown"
    },
    {
      "code": "## Configure Kinesis using IAM Access Keys\n\nWhen configuring your Logpush job using IAM Access Keys, ensure that the IAM user has permission to perform the `PutRecord` action on your Kinesis stream:",
      "language": "unknown"
    },
    {
      "code": "### IAM Access Key example",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Enable Logpush to New Relic  Cloudflare Logs docs\ndescription: Cloudflare Logpush supports pushing logs directly to New Relic via\n  the Cloudflare dashboard or via API.\nlastUpdated: 2025-10-10T13:43:07.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/new-relic/\n  md: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/new-relic/index.md\n---\n\nCloudflare Logpush supports pushing logs directly to New Relic via the Cloudflare dashboard or via API.\n\n## Manage via the Cloudflare dashboard\n\n1. In the Cloudflare dashboard, go to the **Logpush** page at the account or or domain (also known as zone) level.\n\n   For account: [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/logs)\n\n   For domain (also known as zone): [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/:zone/analytics/logs)\n\n2. Depending on your choice, you have access to [account-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/account/) and [zone-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/zone/), respectively.\n\n3. Select **Create a Logpush job**.\n\n1) In **Select a destination**, choose **New Relic**.\n\n2) Enter the **New Relic Logs Endpoint**:\n\n* US\n\n  * `\"https://log-api.newrelic.com/log/v1?Api-Key=<NR_LICENSE_KEY>&format=cloudflare\"`\n\n* EU\n\n  * `\"https://log-api.eu.newrelic.com/log/v1?Api-Key=<NR_LICENSE_KEY>&format=cloudflare\"`\n\nUse the region that matches the one that has been set on your New Relic account. The **License key** field can be found on the New Relic dashboard. It can be retrieved by following [these steps](https://docs.newrelic.com/docs/apis/intro-apis/new-relic-api-keys/#manage-license-key).\n\nWhen you are done entering the destination details, select **Continue**.\n\n1. Select the dataset to push to the storage service.\n\n2. In the next step, you need to configure your logpush job:\n\n   * Enter the **Job name**.\n   * Under **If logs match**, you can select the events to include and/or remove from your logs. Refer to [Filters](https://developers.cloudflare.com/logs/logpush/logpush-job/filters/) for more information. Not all datasets have this option available.\n   * In **Send the following fields**, you can choose to either push all logs to your storage destination or selectively choose which logs you want to push.\n\n3. In **Advanced Options**, you can:\n\n   * Choose the format of timestamp fields in your logs (`RFC3339`(default),`Unix`, or `UnixNano`).\n   * Select a [sampling rate](https://developers.cloudflare.com/logs/logpush/logpush-job/api-configuration/#sampling-rate) for your logs or push a randomly-sampled percentage of logs.\n   * Enable redaction for `CVE-2021-44228`. This option will replace every occurrence of `${` with `x{`.\n\n4. Select **Submit** once you are done configuring your logpush job.\n\n## Manage via API\n\nEnsure **Log Share** permissions are enabled, before attempting to read or configure a Logpush job. For more information refer to the [Roles section](https://developers.cloudflare.com/logs/logpush/permissions/#roles).\n\n### 1. Create a job\n\nTo create a job, make a `POST` request to the Logpush jobs endpoint with the following fields:\n\n* **name** (optional) - Use your domain name as the job name.\n\n* **output\\_options** (optional) - To configure fields, sample rate, and timestamp format, refer to [Log Output Options](https://developers.cloudflare.com/logs/logpush/logpush-job/log-output-options/).\n\n  Note\n\n  To query Cloudflare logs, New Relic requires fields to be sent as a UNIX timestamp.\n\n* **destination\\_conf** - A log destination consisting of an endpoint URL, a license key and a format in the string format below.\n\n  * `<NR_ENDPOINT_URL>`: The New Relic HTTP logs intake endpoint, which is `https://log-api.newrelic.com/log/v1` for US or `https://log-api.eu.newrelic.com/log/v1` for the EU, depending on the region that has been set on your New Relic account.\n\n  * `<NR_LICENSE_KEY>`: This key can be found on the New Relic dashboard and it can be retrieved by following [these steps](https://docs.newrelic.com/docs/apis/intro-apis/new-relic-api-keys/#manage-license-key).\n\n  * `format`: The format is `cloudflare`.\n\n    US: `\"https://log-api.newrelic.com/log/v1?Api-Key=<NR_LICENSE_KEY>&format=cloudflare\"`\n\n    EU: `\"https://log-api.eu.newrelic.com/log/v1?Api-Key=<NR_LICENSE_KEY>&format=cloudflare\"`\n\n* **max\\_upload\\_records** (optional) - The maximum number of log lines per batch. This must be at least 1,000 lines or more. Note that there is no way to specify a minimum number of log lines per batch. This means that log files may contain many fewer lines than specified.\n\n* **max\\_upload\\_bytes** (optional) - The maximum uncompressed file size of a batch of logs. This must be at least 5 MB. Note that there is no way to set a minimum file size. This means that log files may be much smaller than this batch size. Nevertheless, it is recommended to set this parameter to 5,000,000.\n\n* **dataset** - The category of logs you want to receive. Refer to [Datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/) for the full list of supported datasets.\n\nExample request using cURL:\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "Response:",
      "language": "unknown"
    },
    {
      "code": "### 2. Enable (update) a job\n\nTo enable a job, make a `PUT` request to the Logpush jobs endpoint. You will use the job ID returned from the previous step in the URL and send `{\"enabled\": true}` in the request body.\n\nExample request using cURL:\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "Response:",
      "language": "unknown"
    },
    {
      "code": "Note\n\nTo analyze and visualize Cloudflare metrics using the Cloudflare Network Logs quickstart, follow the steps in the [New Relic Analytics integration page](https://developers.cloudflare.com/analytics/analytics-integrations/new-relic/).\n\n</page>\n\n<page>\n---\ntitle: Enable Logpush to other providers  Cloudflare Logs docs\ndescription: Cloudflare Logpush supports pushing logs to a limited set of\n  services providers. However, you can configure Logpush via API.\nlastUpdated: 2025-08-20T20:59:04.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/other-providers/\n  md: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/other-providers/index.md\n---\n\nCloudflare Logpush supports pushing logs to a limited set of services providers. However, you can configure Logpush via API.\n\n## Manage via the Cloudflare dashboard\n\nRefer to [Enable destinations](https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/) for the list of services you can configure to use with Logpush through the Cloudflare dashboard. Interested in a different service? Take this [survey](https://docs.google.com/forms/d/e/1FAIpQLScwOSabROywVajpMX2ZYCVl3saYs11cP4NIC8QR-wmOAnxOtA/viewform).\n\n## Manage via API\n\nThe Cloudflare Logpush API allows you to configure and manage jobs via create, retrieve, update, and delete operations (CRUD).\n\nWith Logpush, you can create a job to upload logs of the metadata Cloudflare collects in batches as soon as possible to your cloud service provider. The default number of jobs that you can setup per dataset per domain is four, but you can setup more jobs depending on your plan and subscriptions.\n\nEnsure **Log Share** permissions are enabled, before attempting to read or configure a Logpush job. For more information refer to the [Roles section](https://developers.cloudflare.com/logs/logpush/permissions/#roles).\n\n\n\nTo get started:\n\n1. Set up a storage provider and grant Cloudflare access. Your storage provider may request your Cloudflare API credentials and other information including:\n\n   * Email address\n   * Cloudflare API key\n   * Zone ID\n   * Destination access details for your cloud service provider\n\n2. Configure your Logpush job. For more information on how to configure a Logpush job, refer to [API configuration](https://developers.cloudflare.com/logs/logpush/logpush-job/api-configuration/).\n\n</page>\n\n<page>\n---\ntitle: Enable Cloudflare R2  Cloudflare Logs docs\ndescription: Cloudflare Logpush supports pushing logs directly to R2. You can do\n  so via the automatic setup (Cloudflare creates an R2 bucket for you), or you\n  can create your own R2 bucket with the custom setup. The automatic setup is\n  ideal for quickly setting up a bucket or for testing purposes. Instead, use\n  the custom setup if you need full control over the configuration.\nlastUpdated: 2025-12-17T14:09:11.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/r2/\n  md: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/r2/index.md\n---\n\nCloudflare Logpush supports pushing logs directly to R2. You can do so via the automatic setup (Cloudflare creates an R2 bucket for you), or you can create your own R2 bucket with the custom setup. The automatic setup is ideal for quickly setting up a bucket or for testing purposes. Instead, use the custom setup if you need full control over the configuration.\n\nFor more information about R2, refer to the [Cloudflare R2](https://developers.cloudflare.com/r2/) documentation.\n\nNote\n\nIf you want to set up R2 as destination for a zone on [FedRAMP High](https://www.cloudflare.com/cloudflare-for-government/), you need to use an [S3-compatible endpoint](https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/s3-compatible-endpoints/) with the following `Endpoint URL`: `<ACCOUNT_ID>.r2.fed.cloudflarestorage.com`\n\n## Automatic setup\n\nIf you want to use the automatic setup for your logpush job:\n\n1. In the Cloudflare dashboard, go to the **Logpush** page at the account or or domain (also known as zone) level.\n\n   For account: [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/logs)\n\n   For domain (also known as zone): [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/:zone/analytics/logs)\n\n2. Depending on your choice, you have access to [account-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/account/) and [zone-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/zone/), respectively.\n\n3. Select **Create a Logpush job**.\n\n1) Select **R2 Object Storage - automatic** as destination.\n\n2) Next, select the dataset and the storage region you want to use.\n\n3) To finalize, select **Create Logpush job**.\n\nYour setup should now be complete. If you require full control over the configuration, consider using the custom setup instead.\n\n## Custom setup\n\nCloudflare Logpush supports pushing logs directly to R2 via the Cloudflare dashboard or via API.\n\nBefore getting started:\n\n* Create an R2 bucket and set up R2 API tokens.\n\n  1. Go to the R2 UI > **Create bucket**.\n\n  2. Select **Manage R2 API Tokens**.\n\n  3. Select **Create API token**.\n\n  4. Under **Permission**, select **Edit** permissions for your token.\n\n  5. Copy the Secret Access Key and Access Key ID. You will need these when setting up your Logpush job.\n\n* Ensure that you have the following permissions:\n\n  * R2 write, Logshare Edit.\n\n### Manage via the Cloudflare dashboard\n\n1. In the Cloudflare dashboard, go to the **Logpush** page at the account or or domain (also known as zone) level.\n\n   For account: [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/logs)\n\n   For domain (also known as zone): [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/:zone/analytics/logs)\n\n2. Depending on your choice, you have access to [account-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/account/) and [zone-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/zone/), respectively.\n\n3. Select **Create a Logpush job**.\n\n1) In **Select a destination**, choose **R2 Object Storage**.\n\n2) Enter or select the following destination details:\n\n   * **Bucket** - R2 bucket name\n   * **Path** - bucket location, for example, `cloudflare-logs/http_requests/example.com`\n   * **Organize logs into daily subfolders** (recommended)\n   * Under **Authentication** add your **R2 Access Key ID** and **R2 Secret Access Key**. Refer to [Manage R2 API tokens](https://dash.cloudflare.com/b54f07a6c269ecca2fa60f1ae4920c99/r2/api-tokens) for more information.\n\nWhen you are done entering the destination details, select **Continue**.\n\n1. Select the dataset to push to the storage service.\n\n2. In the next step, you need to configure your logpush job:\n\n   * Enter the **Job name**.\n   * Under **If logs match**, you can select the events to include and/or remove from your logs. Refer to [Filters](https://developers.cloudflare.com/logs/logpush/logpush-job/filters/) for more information. Not all datasets have this option available.\n   * In **Send the following fields**, you can choose to either push all logs to your storage destination or selectively choose which logs you want to push.\n\n3. In **Advanced Options**, you can:\n\n   * Choose the format of timestamp fields in your logs (`RFC3339`(default),`Unix`, or `UnixNano`).\n   * Select a [sampling rate](https://developers.cloudflare.com/logs/logpush/logpush-job/api-configuration/#sampling-rate) for your logs or push a randomly-sampled percentage of logs.\n   * Enable redaction for `CVE-2021-44228`. This option will replace every occurrence of `${` with `x{`.\n\n4. Select **Submit** once you are done configuring your logpush job.\n\n### Manage via API\n\nTo create a job, make a `POST` request to the Logpush jobs endpoint with the following fields:\n\n* **name** (optional) - Use your domain name as the job name.\n* **destination\\_conf** - A log destination consisting of bucket path, account ID, R2 access key ID and R2 secret access key.\n\nNote\n\nWe recommend adding the `{DATE}` parameter in the `destination_conf` to separate your logs into daily subfolders.",
      "language": "unknown"
    },
    {
      "code": "* **dataset** - The category of logs you want to receive. Refer to [Datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/) for the full list of supported datasets.\n* **output\\_options** (optional) - To configure fields, sample rate, and timestamp format, refer to [API configuration options](https://developers.cloudflare.com/logs/logpush/logpush-job/api-configuration/#options).\n\nExample request using cURL:\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "## Download logs from R2\n\nOnce your logs are stored in R2, you can download them using various methods:\n\n### Dashboard\n\n1. In the Cloudflare dashboard, go to the **R2** page.\n\n   [Go to **Overview**](https://dash.cloudflare.com/?to=/:account/r2/overview)\n\n2. Select your bucket.\n\n3. From your bucket's page, locate the desired log file.\n\n4. Select on the **...** icon next to the file to download it.\n\n![Log files list](https://developers.cloudflare.com/_astro/logs-r2.BSx83Q8__1kO7si.webp)\n\n### AWS CLI\n\nCloudflare R2 is S3-compatible, so you can use the AWS CLI to interact with it.\n\n* Configure the AWS CLI with your R2 credentials.\n* Use the `aws s3 cp` command to download the log file:",
      "language": "unknown"
    },
    {
      "code": "Replace `<bucket-name>`, `<path-to-log-file>`, and `<local-destination>` with your specific details.\n\nDownloaded files are gzipped so they must be decompressed before you can open them in a text editor.\n\n</page>\n\n<page>\n---\ntitle: Enable Logpush to SentinelOne  Cloudflare Logs docs\ndescription: The HTTP Event Collector (HEC) is a reliable method to send log\n  data to SentinelOne Singularity Data Lake. Cloudflare Logpush supports pushing\n  logs directly to SentinelOne HEC via the Cloudflare dashboard or API.\nlastUpdated: 2025-12-02T14:57:33.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/sentinelone/\n  md: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/sentinelone/index.md\n---\n\nThe HTTP Event Collector (HEC) is a reliable method to send log data to SentinelOne Singularity Data Lake. Cloudflare Logpush supports pushing logs directly to SentinelOne HEC via the Cloudflare dashboard or API.\n\n## Manage via the Cloudflare dashboard\n\n1. In the Cloudflare dashboard, go to the **Logpush** page at the account or or domain (also known as zone) level.\n\n   For account: [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/logs)\n\n   For domain (also known as zone): [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/:zone/analytics/logs)\n\n2. Depending on your choice, you have access to [account-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/account/) and [zone-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/zone/), respectively.\n\n3. Select **Create a Logpush job**.\n\n1) In **Select a destination**, choose **SentinelOne**.\n\n2) Enter or select the following destination information:\n\n   * **SentinelOne HEC URL**\n   * **Auth Token** - Event Collector token.\n   * **Source Type** - For example, `marketplace-cloudflare-latest`.\n\nWhen you are done entering the destination details, select **Continue**.\n\n1. Select the dataset to push to the storage service.\n\n2. In the next step, you need to configure your logpush job:\n\n   * Enter the **Job name**.\n   * Under **If logs match**, you can select the events to include and/or remove from your logs. Refer to [Filters](https://developers.cloudflare.com/logs/logpush/logpush-job/filters/) for more information. Not all datasets have this option available.\n   * In **Send the following fields**, you can choose to either push all logs to your storage destination or selectively choose which logs you want to push.\n\n3. In **Advanced Options**, you can:\n\n   * Choose the format of timestamp fields in your logs (`RFC3339`(default),`Unix`, or `UnixNano`).\n   * Select a [sampling rate](https://developers.cloudflare.com/logs/logpush/logpush-job/api-configuration/#sampling-rate) for your logs or push a randomly-sampled percentage of logs.\n   * Enable redaction for `CVE-2021-44228`. This option will replace every occurrence of `${` with `x{`.\n\n4. Select **Submit** once you are done configuring your logpush job.\n\n## Manage via API\n\nTo set up a SentinelOne Logpush job:\n\n1. Create a job with the appropriate endpoint URL and authentication parameters.\n2. Enable the job to begin pushing logs.\n\nNote\n\nUnlike configuring Logpush jobs for AWS S3, GCS, or Azure, there is no ownership challenge when configuring Logpush to SentinelOne.\n\nEnsure **Log Share** permissions are enabled, before attempting to read or configure a Logpush job. For more information refer to the [Roles section](https://developers.cloudflare.com/logs/logpush/permissions/#roles).\n\n### 1. Create a job\n\nTo create a job, make a `POST` request to the Logpush jobs endpoint with the following fields:\n\n* **name** (optional) - Use your domain name as the job name.\n\n* **destination\\_conf** - A log destination consisting of an endpoint URL, source type, authorization header in the string format below.\n\n  * **SENTINELONE\\_ENDPOINT\\_URL**: The SentinelOne raw HTTP Event Collector URL with port. For example: `sentinelone://ingest.us1.sentinelone.net/services/collector/raw`. Cloudflare expects the SentinelOne endpoint to be `/services/collector/raw` while configuring and setting up the Logpush job.\n  * **SENTINELONE\\_AUTH\\_TOKEN**: The SentinelOne authorization token that is URL-encoded. For example: `Bearer 0e6d94e8c-5792-4ad1-be3c-29bcaee0197d`.\n  * **SOURCE\\_TYPE**: The SentinelOne source type. For example: `marketplace-cloudflare-latest`.",
      "language": "unknown"
    },
    {
      "code": "* **dataset** - The category of logs you want to receive. Refer to [Datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/) for the full list of supported datasets.\n\n* **output\\_options** (optional) - To configure fields, sample rate, and timestamp format, refer to [Log Output Options](https://developers.cloudflare.com/logs/logpush/logpush-job/log-output-options/). For timestamp, Cloudflare recommends using `timestamps=rfc3339`.\n\nExample request using cURL:\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "Response:",
      "language": "unknown"
    },
    {
      "code": "### 2. Enable (update) a job\n\nTo enable a job, make a `PUT` request to the Logpush jobs endpoint. Use the job ID returned from the previous step in the URL and send `{\"enabled\": true}` in the request body.\n\nExample request using cURL:\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "Response:",
      "language": "unknown"
    },
    {
      "code": "Refer to the [Logpush FAQ](https://developers.cloudflare.com/logs/faq/logpush/) for troubleshooting information.\n\n</page>\n\n<page>\n---\ntitle: Enable Logpush to S3-compatible endpoints  Cloudflare Logs docs\ndescription: \"Cloudflare Logpush supports pushing logs to S3-compatible\n  destinations via the Cloudflare dashboard or via API, including:\"\nlastUpdated: 2025-10-10T13:43:07.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/s3-compatible-endpoints/\n  md: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/s3-compatible-endpoints/index.md\n---\n\nCloudflare Logpush supports pushing logs to S3-compatible destinations via the Cloudflare dashboard or via API, including:\n\n* [Alibaba Cloud OSS](https://www.alibabacloud.com/help/doc-detail/64919.htm#title-37m-7gl-xy2)\n* [Backblaze B2](https://www.backblaze.com/b2/docs/s3_compatible_api.html)\n* [DigitalOcean Spaces](https://www.digitalocean.com/docs/spaces/)\n* [IBM Cloud Object Storage](https://cloud.ibm.com/apidocs/cos/cos-compatibility)\n* [JD Cloud Object Storage Service](https://docs.jdcloud.com/en/object-storage-service/introduction-2)\n* [Linode Object Storage](https://www.linode.com/products/object-storage/)\n* [Oracle Cloud Object Storage](https://docs.cloud.oracle.com/en-us/iaas/Content/Object/Tasks/s3compatibleapi.htm)\n* On-premise [Ceph Object Gateway](https://docs.ceph.com/en/latest/radosgw/s3/)\n\nFor more information about Logpush and the current production APIs, refer to [Cloudflare Logpush](https://developers.cloudflare.com/logs/logpush/) documentation.\n\n## Manage via the Cloudflare dashboard\n\n1. In the Cloudflare dashboard, go to the **Logpush** page at the account or or domain (also known as zone) level.\n\n   For account: [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/logs)\n\n   For domain (also known as zone): [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/:zone/analytics/logs)\n\n2. Depending on your choice, you have access to [account-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/account/) and [zone-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/zone/), respectively.\n\n3. Select **Create a Logpush job**.\n\n1) In **Select a destination**, choose **S3-Compatible**.\n\n2) Enter or select the following destination information:\n\n   * **Bucket** - S3 Compatible bucket name\n   * **Path** - bucket location within the storage container\n   * **Organize logs into daily subfolders** (recommended)\n   * **Endpoint URL** - The URL without the bucket name or path. Example, `sfo2.digitaloceanspaces.com`.\n   * **Bucket region**\n   * **Access Key ID**\n   * **Secret Access Key**\n\nWhen you are done entering the destination details, select **Continue**.\n\n1. Select the dataset to push to the storage service.\n\n2. In the next step, you need to configure your logpush job:\n\n   * Enter the **Job name**.\n   * Under **If logs match**, you can select the events to include and/or remove from your logs. Refer to [Filters](https://developers.cloudflare.com/logs/logpush/logpush-job/filters/) for more information. Not all datasets have this option available.\n   * In **Send the following fields**, you can choose to either push all logs to your storage destination or selectively choose which logs you want to push.\n\n3. In **Advanced Options**, you can:\n\n   * Choose the format of timestamp fields in your logs (`RFC3339`(default),`Unix`, or `UnixNano`).\n   * Select a [sampling rate](https://developers.cloudflare.com/logs/logpush/logpush-job/api-configuration/#sampling-rate) for your logs or push a randomly-sampled percentage of logs.\n   * Enable redaction for `CVE-2021-44228`. This option will replace every occurrence of `${` with `x{`.\n\n4. Select **Submit** once you are done configuring your logpush job.\n\n## Manage via API\n\nTo set up S3-compatible endpoints:\n\n1. Create a job with the appropriate endpoint URL and authentication parameters.\n2. Enable the job to begin pushing logs.\n\nNote\n\nUnlike Logpush jobs to Amazon S3, there is no ownership challenge with S3-compatible APIs.\n\nEnsure **Log Share** permissions are enabled, before attempting to read or configure a Logpush job. For more information refer to the [Roles section](https://developers.cloudflare.com/logs/logpush/permissions/#roles).\n\n### 1. Create a job\n\nTo create a job, make a `POST` request to the Logpush jobs endpoint with the following fields:\n\n* **name** (optional) - Use your domain name as the job name.\n* **destination\\_conf** - A log destination consisting of an endpoint name, bucket name, bucket path, region, access-key-id, and secret-access-key in the following string format:",
      "language": "unknown"
    },
    {
      "code": "Note\n\n`<ENDPOINT_URL>` is the URL without the bucket name or path. For example: `endpoint=sfo2.digitaloceanspaces.com`.\n\n* **dataset** - The category of logs you want to receive. Refer to [Datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/) for the full list of supported datasets.\n* **output\\_options** (optional) - To configure fields, sample rate, and timestamp format, refer to [Log Output Options](https://developers.cloudflare.com/logs/logpush/logpush-job/log-output-options/).\n\nExample request using cURL:\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "Response:",
      "language": "unknown"
    },
    {
      "code": "### 2. Enable (update) a job\n\nTo enable a job, make a `PUT` request to the Logpush jobs endpoint. You will use the job ID returned from the previous step in the URL, and send `{\"enabled\": true}` in the request body.\n\nExample request using cURL:",
      "language": "unknown"
    },
    {
      "code": "Response:",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Enable Logpush to Splunk  Cloudflare Logs docs\ndescription: The HTTP Event Collector (HEC) is a reliable method to receive data\n  from Splunk Enterprise or Splunk Cloud Platform. Cloudflare Logpush supports\n  pushing logs directly to Splunk HEC via the Cloudflare dashboard or API.\nlastUpdated: 2025-11-05T14:24:33.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/splunk/\n  md: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/splunk/index.md\n---\n\nThe [HTTP Event Collector (HEC)](https://dev.splunk.com/enterprise/docs/devtools/httpeventcollector/) is a reliable method to receive data from Splunk Enterprise or Splunk Cloud Platform. Cloudflare Logpush supports pushing logs directly to Splunk HEC via the Cloudflare dashboard or API.\n\n## Manage via the Cloudflare dashboard\n\n1. In the Cloudflare dashboard, go to the **Logpush** page at the account or or domain (also known as zone) level.\n\n   For account: [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/logs)\n\n   For domain (also known as zone): [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/:zone/analytics/logs)\n\n2. Depending on your choice, you have access to [account-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/account/) and [zone-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/zone/), respectively.\n\n3. Select **Create a Logpush job**.\n\n1) In **Select a destination**, choose **Splunk**.\n\n2) Enter or select the following destination information:\n\n   * **Splunk HEC URL**\n   * **Channel ID** - This is a random GUID that you can generate using [guidgenerator.com](https://guidgenerator.com/).\n   * **Auth Token** - Event Collector token prefixed with the word `Splunk`. For example: `Splunk 1234EXAMPLEKEY`.\n   * **Source Type** - For example, `cloudflare:json`. If you are using the [Cloudflare App for Splunk](https://splunkbase.splunk.com/app/4501), refer to the appropriate source type for the corresponding datasets under the **Details** section. For instance, for Zero Trust Access requests logs, the source type is `cloudflare:access`.\n   * **Use insecure skip verify option** (not recommended).\n\nWhen you are done entering the destination details, select **Continue**.\n\n1. Select the dataset to push to the storage service.\n\n2. In the next step, you need to configure your logpush job:\n\n   * Enter the **Job name**.\n   * Under **If logs match**, you can select the events to include and/or remove from your logs. Refer to [Filters](https://developers.cloudflare.com/logs/logpush/logpush-job/filters/) for more information. Not all datasets have this option available.\n   * In **Send the following fields**, you can choose to either push all logs to your storage destination or selectively choose which logs you want to push.\n\n3. In **Advanced Options**, you can:\n\n   * Choose the format of timestamp fields in your logs (`RFC3339`(default),`Unix`, or `UnixNano`).\n   * Select a [sampling rate](https://developers.cloudflare.com/logs/logpush/logpush-job/api-configuration/#sampling-rate) for your logs or push a randomly-sampled percentage of logs.\n   * Enable redaction for `CVE-2021-44228`. This option will replace every occurrence of `${` with `x{`.\n\n4. Select **Submit** once you are done configuring your logpush job.\n\n## Manage via API\n\nTo set up a Splunk Logpush job:\n\n1. Create a job with the appropriate endpoint URL and authentication parameters.\n2. Enable the job to begin pushing logs.\n\nNote\n\nUnlike configuring Logpush jobs for AWS S3, GCS, or Azure, there is no ownership challenge when configuring Logpush to Splunk.\n\nEnsure **Log Share** permissions are enabled, before attempting to read or configure a Logpush job. For more information refer to the [Roles section](https://developers.cloudflare.com/logs/logpush/permissions/#roles).\n\n### 1. Create a job\n\nTo create a job, make a `POST` request to the Logpush jobs endpoint with the following fields:\n\n* **name** (optional) - Use your domain name as the job name.\n\n* **destination\\_conf** - A log destination consisting of an endpoint URL, channel id, insecure-skip-verify flag, source type, authorization header in the string format below.\n\n  * **\\<SPLUNK\\_ENDPOINT\\_URL>**: The Splunk raw HTTP Event Collector URL with port. For example: `splunk.cf-analytics.com:8088/services/collector/raw`.\n\n    * Cloudflare expects the Splunk endpoint to be `/services/collector/raw` while configuring and setting up the Logpush job.\n    * Ensure you have enabled HEC in Splunk. Refer to [Splunk Analytics Integrations](https://developers.cloudflare.com/analytics/analytics-integrations/splunk/) for information on how to set up HEC in Splunk.\n    * You may notice an API request failed with a 504 error, when adding an incorrect URL. Splunk Cloud endpoint URL usually contains `http-inputs-` or similar text before the hostname.\n\n  * **\\<SPLUNK\\_CHANNEL\\_ID>**: A unique channel ID. This is a random GUID that you can generate by:\n\n    * Using an online tool like the [GUID generator](https://www.guidgenerator.com/).\n    * Using the command line. For example: `python -c 'import uuid; print(uuid.uuid4())'`.\n\n  * **\\<INSECURE\\_SKIP\\_VERIFY>**: Boolean value. Cloudflare recommends setting this value to `false`. Setting this value to `true` is equivalent to using the `-k` option with `curl` as shown in Splunk examples and is **not** recommended. Only set this value to `true` when HEC uses a self-signed certificate.\n\n  Note\n\n  Cloudflare highly recommends setting this value to `false`. Refer to the [Logpush FAQ](https://developers.cloudflare.com/logs/faq/logpush/) for more information.\n\n  * **\\<SOURCE\\_TYPE>**: The Splunk source type. For example: `cloudflare:json`.\n  * **\\<SPLUNK\\_AUTH\\_TOKEN>**: The Splunk authorization token that is URL-encoded and must be prefixed with the word `Splunk`. For example: `Splunk e6d94e8c-5792-4ad1-be3c-29bcaee0197d`.",
      "language": "unknown"
    },
    {
      "code": "* **dataset** - The category of logs you want to receive. Refer to [Datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/) for the full list of supported datasets.\n\n* **output\\_options** (optional) - To configure fields, sample rate, and timestamp format, refer to [Log Output Options](https://developers.cloudflare.com/logs/logpush/logpush-job/log-output-options/). For timestamp, Cloudflare recommends using `timestamps=rfc3339`.\n\nExample request using cURL:\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "Response:",
      "language": "unknown"
    },
    {
      "code": "### 2. Enable (update) a job\n\nTo enable a job, make a `PUT` request to the Logpush jobs endpoint. Use the job ID returned from the previous step in the URL and send `{\"enabled\": true}` in the request body.\n\nExample request using cURL:\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Logs Write`",
      "language": "unknown"
    },
    {
      "code": "Response:",
      "language": "unknown"
    },
    {
      "code": "Refer to the [Logpush FAQ](https://developers.cloudflare.com/logs/faq/logpush/) for troubleshooting information.\n\n### 3. Create WAF custom rule for Splunk HEC endpoint (optional)\n\nIf your logpush destination hostname is proxied through Cloudflare, and you have the Cloudflare Web Application Firewall (WAF) turned on, you may be challenged or blocked when Cloudflare makes a request to Splunk HTTP Event Collector (HEC). To make sure this does not happen, you have to create a [custom rule](https://developers.cloudflare.com/waf/custom-rules/) that allows Cloudflare to bypass the HEC endpoint.\n\n* Old dashboard\n\n  1. Log in to the [Cloudflare dashboard](https://dash.cloudflare.com/) and select your account. Go to **Security** > **WAF** > **Custom rules**.\n\n  2. Select **Create rule** and enter a descriptive name for it (for example, `Splunk`).\n\n  3. Under **When incoming requests match**, use the **Field**, **Operator**, and **Value** dropdowns to create a rule. After finishing each row, select **And** to create the next row of rules. Refer to the table below for the values you should input:\n\n     | Field | Operator | Value |\n     | - | - | - |\n     | Request Method | `equals` | `POST` |\n     | Hostname | `equals` | Your Splunk endpoint hostname. For example: `splunk.cf-analytics.com` |\n     | URI Path | `equals` | `/services/collector/raw` |\n     | URI Query String | `contains` | `channel` |\n     | AS Num | `equals` | `132892` |\n     | User Agent | `equals` | `Go-http-client/2.0` |\n\n  4. After inputting the values as shown in the table, you should have an Expression Preview with the values you added for your specific rule. The example below reflects the hostname `splunk.cf-analytics.com`.",
      "language": "unknown"
    },
    {
      "code": "5. Under the **Then** > **Choose an action** dropdown, select *Skip*.\n\n  6. Under **WAF components to skip**, select *All managed rules*.\n\n  7. Select **Deploy**.\n\n* New dashboard\n\n  1. In the Cloudflare dashboard, go to the **Security rules** page.\n\n     [Go to **Security rules**](https://dash.cloudflare.com/?to=/:account/:zone/security/security-rules)\n\n  2. Select **Create rule** > **Custom rules**.\n\n  3. Enter a descriptive name for the rule (for example, `Splunk`).\n\n  4. Under **When incoming requests match**, use the **Field**, **Operator**, and **Value** dropdowns to create a rule. After finishing each row, select **And** to create the next row of rules. Refer to the table below for the values you should input:\n\n     | Field | Operator | Value |\n     | - | - | - |\n     | Request Method | `equals` | `POST` |\n     | Hostname | `equals` | Your Splunk endpoint hostname. For example: `splunk.cf-analytics.com` |\n     | URI Path | `equals` | `/services/collector/raw` |\n     | URI Query String | `contains` | `channel` |\n     | AS Num | `equals` | `132892` |\n     | User Agent | `equals` | `Go-http-client/2.0` |\n\n  5. After inputting the values as shown in the table, you should have an Expression Preview with the values you added for your specific rule. The example below reflects the hostname `splunk.cf-analytics.com`.",
      "language": "unknown"
    },
    {
      "code": "6. Under the **Then** > **Choose an action** dropdown, select *Skip*.\n\n  7. Under **WAF components to skip**, select *All managed rules*.\n\n  8. Select **Deploy**.\n\nThe WAF should now ignore requests made to Splunk HEC by Cloudflare.\n\nNote\n\nTo analyze and visualize Cloudflare Logs using the Cloudflare App for Splunk, follow the steps in the [Splunk Analytics integration page](https://developers.cloudflare.com/analytics/analytics-integrations/splunk/).\n\n</page>\n\n<page>\n---\ntitle: Enable Logpush to Sumo Logic  Cloudflare Logs docs\ndescription: Cloudflare Logpush supports pushing logs directly to Sumo Logic via\n  the Cloudflare dashboard or via API.\nlastUpdated: 2025-10-10T13:43:07.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/sumo-logic/\n  md: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/sumo-logic/index.md\n---\n\nCloudflare Logpush supports pushing logs directly to Sumo Logic via the Cloudflare dashboard or via API.\n\n## Manage via the Cloudflare dashboard\n\n1. In the Cloudflare dashboard, go to the **Logpush** page at the account or or domain (also known as zone) level.\n\n   For account: [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/logs)\n\n   For domain (also known as zone): [Go to **Logpush**](https://dash.cloudflare.com/?to=/:account/:zone/analytics/logs)\n\n2. Depending on your choice, you have access to [account-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/account/) and [zone-scoped datasets](https://developers.cloudflare.com/logs/logpush/logpush-job/datasets/zone/), respectively.\n\n3. Select **Create a Logpush job**.\n\n1) In **Select a destination**, choose **Sumo Logic**.\n\n2) Enter the **HTTP Source Address**. To get the HTTP Source Address (URL) configure a [Sumo Logic Hosted Collector](https://help.sumologic.com/docs/send-data/hosted-collectors/) with an [HTTP Logs & Metrics Source](https://help.sumologic.com/docs/send-data/hosted-collectors/http-source/logs-metrics/). Note that the same collector can be used for multiple Logpush jobs, but each job must have a dedicated source. When you are done entering the destination details, select **Continue**.\n\n3) Select the dataset to push to the storage service.\n\n4) In the next step, you need to configure your logpush job:\n\n   * Enter the **Job name**.\n   * Under **If logs match**, you can select the events to include and/or remove from your logs. Refer to [Filters](https://developers.cloudflare.com/logs/logpush/logpush-job/filters/) for more information. Not all datasets have this option available.\n   * In **Send the following fields**, you can choose to either push all logs to your storage destination or selectively choose which logs you want to push.\n\n5) In **Advanced Options**, you can:\n\n   * Choose the format of timestamp fields in your logs (`RFC3339`(default),`Unix`, or `UnixNano`).\n   * Select a [sampling rate](https://developers.cloudflare.com/logs/logpush/logpush-job/api-configuration/#sampling-rate) for your logs or push a randomly-sampled percentage of logs.\n   * Enable redaction for `CVE-2021-44228`. This option will replace every occurrence of `${` with `x{`.\n\n6) Select **Submit** once you are done configuring your logpush job.\n\n## Configure a Hosted Collector\n\nCloudflare can send logs to a Hosted Collector with **HTTP Logs & Metrics** as the source. Once you have set up a collector, you simply provide the HTTP Source Address (a unique URL) to which logs can be posted.\n\nEnsure **Log Share** permissions are enabled, before attempting to read or configure a Logpush job. For more information refer to the [Roles section](https://developers.cloudflare.com/logs/logpush/permissions/#roles).\n\n\n\nTo enable Logpush to Sumo Logic:\n\n1. Configure a Hosted Collector. Refer to [instructions from Sumo Logic](https://help.sumologic.com/docs/send-data/hosted-collectors/configure-hosted-collector/).\n\n2. Configure an HTTP Logs & Metrics Source. Refer to [instructions from Sumo Logic](https://help.sumologic.com/docs/send-data/hosted-collectors/http-source/). The last step indicates how to get the HTTP Source Address (URL).\n\n3. Provide the HTTP Source Address (URL) when prompted by the Logpush API or UI.\n\nNotes\n\n* Logpush will stop working if you regenerate the HTTP Source Address (URL). Refer to [generate a new URL for an HTTP Source from Sumo Logic](https://help.sumologic.com/docs/send-data/hosted-collectors/http-source/generate-new-url/). To use the new URL, you will have to get a new ownership challenge and update the destination for your job.\n\n* Sumo Logic may impose throttling and caps on your log ingestion to prevent your account from using **On-Demand Capacity**. Refer to [manage ingestion](https://help.sumologic.com/docs/manage/ingestion-volume/log-ingestion/).\n\n* To analyze and visualize Cloudflare Logs using the Cloudflare App for Sumo Logic, follow the steps in the Sumo Logic integration documentation to [install the Cloudflare App](https://help.sumologic.com/docs/integrations/saas-cloud/cloudflare/#installing-the-cloudflare-app) and [view the Cloudflare dashboards](https://help.sumologic.com/docs/integrations/saas-cloud/cloudflare/#viewing-the-cloudflare-dashboards).\n\n</page>\n\n<page>\n---\ntitle: Third-party integrations  Cloudflare Logs docs\ndescription: Here you can find a list of partners that have developed\n  integrations with Logpush and have instructions documented.\nlastUpdated: 2025-07-21T15:07:21.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/third-party/\n  md: https://developers.cloudflare.com/logs/logpush/logpush-job/enable-destinations/third-party/index.md\n---\n\nHere you can find a list of partners that have developed integrations with Logpush and have instructions documented.\n\n* [Axiom](https://axiom.co/docs/apps/cloudflare-logpush)\n* [Taegis](https://docs.taegis.secureworks.com/integration/connectCloud/cloudflare/)\n* [Exabeam](https://docs.exabeam.com/en/cloud-connectors/all/configuration/133717-cloudflare-cloud-connector.html)\n* [Sekoia](https://docs.sekoia.io/integration/categories/network/cloudflare-http-requests/)\n\n</page>\n\n<page>\n---\ntitle: Application-aware policies  Cloudflare Magic WAN docs\ndescription: In addition to traffic policies based on network-layer attributes\n  like IP and port ranges, Magic WAN Connector supports the ability to classify\n  traffic based on well-known applications. Application-aware policies provide\n  easier management and more granularity over traffic flows.\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/application-based-policies/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/application-based-policies/index.md\n---\n\nIn addition to traffic policies based on network-layer attributes like IP and port ranges, Magic WAN Connector supports the ability to classify traffic based on well-known applications. Application-aware policies provide easier management and more granularity over traffic flows.\n\nCloudflare's implementation of application awareness leverages the intelligence of our global network, using the same categorization/classification already shared across security tools like our [Secure Web Gateway](https://developers.cloudflare.com/cloudflare-one/traffic-policies/), so IT and security teams can expect consistent behavior across routing and inspection decisions.\n\nFor more information, refer to [Applications and app types](https://developers.cloudflare.com/cloudflare-one/traffic-policies/application-app-types/).\n\nMagic WAN Connector's ability to classify traffic allows you to define which applications should bypass Cloudflare's security filtering, and go directly to the Internet. You can also give some applications a higher priority, and Connector will process them first. This is useful when your network is at capacity, for example.\n\nRefer to the following pages for more information.\n\n* [Breakout traffic](https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/application-based-policies/breakout-traffic/)\n* [Prioritized traffic](https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/application-based-policies/prioritized-traffic/)\n\n</page>\n\n<page>\n---\ntitle: SFP+ port information  Cloudflare Magic WAN docs\ndescription: The hardware version of Magic WAN Connector includes two SFP+ ports\n  that support 10G throughput. These ports can be configured as either a WAN or\n  a LAN port, like all of the 1G RJ45 ports in the machine. Because a 10G WAN\n  uplink will often be bottlenecked by IPsec tunnel speeds, the SFP+ ports are\n  most useful for configuring high speed LANs, and for using fiber connections.\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/configure-hardware-connector/sfp-port-information/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/configure-hardware-connector/sfp-port-information/index.md\n---\n\nThe hardware version of Magic WAN Connector includes two [SFP+ ports](https://en.wikipedia.org/wiki/Small_Form-factor_Pluggable) that support 10G throughput. These ports can be configured as either a WAN or a LAN port, like all of the 1G RJ45 ports in the machine. Because a 10G WAN uplink will often be bottlenecked by IPsec tunnel speeds, the SFP+ ports are most useful for configuring high speed LANs, and for using fiber connections.\n\nVirtual Connector and SFP+ ports\n\nSince you decide and set up the hardware where Virtual Connector runs, you can ignore the information on this page.\n\n## Port configuration\n\nSFP+ ports are next to the regular LAN ports. They are represented as follows in the dashboard:\n\n* SFP+ **port 1** is represented by **port 7** in the dashboard\n* SFP+ **port 2** is represented by **port 8** in the dashboard\n\n![The left port, SFP+ 1, is port 7. The right port, SFP+ 2, is port 8.](https://developers.cloudflare.com/_astro/sfp-ports.B7f8iPPa_ZCE8mL.webp)\n\n*The left port, SFP+ 1, is port 7. The right port, SFP+ 2, is port 8.*\n\n## SFP+ module compatibility\n\nMagic WAN Connector only supports 10Gbps SFP+ modules, including RJ45, DAC, and fiber, among others. Many 1 Gbps modules are incompatible with the Intel driver used internally, and thus are not supported.\n\nCloudflare supports the following SFP+ inputs:\n\n* 10 Gbps Intel-compatible optics using 10GBase-SR, LR, ER. This includes Intel-compatible active optical cables (AOC) cables at 10 Gbps.\n* 10 Gbps DAC Twinax cables, compatible with SFF-8431 v4.1 and SFF-8472 v10.4\n* 10GBASE-T RJ45 converter modules\n\nCloudflare successfully deployed commonly available 10G modules that are also compatible across many vendors:\n\n* StarTech Dell EMC Twinax SFP+ DAC\n* Ubiquiti multi-mode, duplex, 10 Gbps fiber transceiver modules\n\nKeep in mind that SFP+ modules/cables have to be compatible at both ends, that is, both sides of the connection should be 10 Gbps, and it should really be the same module/cable that is compatible with both hardware stacks. The choice of module/optic/cable ultimately depends on your specific interoperability needs, and it is much less of a \"plug and play\" situation as one expects from RJ45.\n\n## Recover from unsupported SFP+ inputs\n\nSFP+ modules should be installed and tested prior to deploying Magic WAN Connector into production usage.\n\nAn unsupported SFP+ input is indicated by the interface failing to come up (that is, the Magic WAN Connector has no status lights), and also by the port (7 or 8) going offline until the hardware is rebooted.\n\nWhen an unsupported module is plugged, the module should be removed and then Magic WAN Connector rebooted by removing power for five seconds. The module should not remain plugged during reboot, or Magic WAN Connector will have to be rebooted again after the module is removed.\n\n</page>\n\n<page>\n---\ntitle: DHCP options  Cloudflare Magic WAN docs\nlastUpdated: 2024-08-30T13:02:26.000Z\nchatbotDeprioritize: true\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/dhcp/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/dhcp/index.md\n---\n\n* [DHCP relay](https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/dhcp/dhcp-relay/)\n* [DHCP server](https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/dhcp/dhcp-server/)\n* [DHCP static address reservation](https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/dhcp/dhcp-static-address-reservation/)\n\n</page>\n\n<page>\n---\ntitle: Enable NAT for a subnet  Cloudflare Magic WAN docs\ndescription: Enable static NAT for subnets in Magic WAN Connector to  re-use\n  address spaces locally.\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/nat-subnet/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/nat-subnet/index.md\n---\n\n## Overview\n\nEach subnet (directly attached or routed) must use a unique address space within the Magic WAN overlay. Many networks already reuse private RFC 1918 space at different sites. To avoid renumbering and still satisfy the Magic WAN uniqueness requirements, you can enable static network address translation (NAT) for a subnet on a Magic WAN Connector.\n\nWith subnet NAT, the Connector performs a static, 1:1 translation between:\n\n* The **local prefix** used inside the site.\n* A **NAT prefix** that is advertised into the Magic WAN overlay.\n\nBecause the mapping is static, the Connector supports both outbound connections from the site and inbound connections from Magic WAN to the site. Connections do not have to be initiated by hosts behind the Magic WAN Connector.\n\n## How subnet NAT works in Magic WAN\n\nNAT is static and 1:1 between equal-sized prefixes. When you enable NAT for a subnet on a Connector:\n\n* The **local prefix** is the subnet on the LAN side of the Connector.\n\n* The **NAT prefix** is a WAN-facing prefix of the same size.\n\n* The Connector translates addresses 1:1 between the two prefixes:\n\n  * For traffic leaving the site towards Magic WAN, it replaces local addresses with the corresponding NAT addresses.\n  * For traffic arriving at the site from Magic WAN, it replaces NAT addresses with the corresponding local addresses.\n\n## Addressing rules\n\nTo avoid overlapping addresses in the overlay, Magic WAN enforces the following rules:\n\n* **Uniqueness within a LAN**\n\n  * The local prefix for each subnet must be unique within that LAN on the Connector.\n  * You can reuse the same local prefix on a different LAN or on a different site.\n\n* **Uniqueness in the Magic WAN overlay**\n\n  * Every **overlay-facing prefix** must be unique across all sites in your Magic WAN deployment.\n  * For a subnet **with NAT enabled**, the overlay-facing prefix is the **NAT prefix**.\n  * For a subnet **without NAT**, the overlay-facing prefix is the **local prefix**.\n\nThese rules allow you to reuse local space at multiple sites, as long as each subnet in the Magic WAN overlay has a unique overlay-facing prefix.\n\n## Example\n\nConsider a subnet that uses the following prefixes:\n\n* **Local prefix**: `192.168.100.0/24`\n* **NAT prefix**: `10.10.100.0/24`\n\nIn this case:\n\n* When a host inside the site with address `192.168.100.13` sends traffic into the Magic WAN overlay, the Connector translates the address to `10.10.100.13`.\n* When traffic from another site, or from the Internet via Magic WAN, targets `10.10.100.13`, the Connector translates the address back to `192.168.100.13`.\n\n## Configure NAT for subnets\n\nYou configure subnet NAT when you create or edit a LAN on a Magic WAN Connector. In the Connector configuration:\n\n* You define the **local prefix** for the subnet on the LAN side.\n* You optionally define a **static NAT prefix** of the same size. When present, this prefix becomes the overlay-facing prefix for that subnet.\n\nFor step-by-step instructions to configure a LAN and supply a static NAT prefix, refer to:\n\n* [Configure hardware Connector](https://developers.cloudflare.com/magic-wan/configuration/connector/configure-hardware-connector/#create-a-lan)\n* [Configure Virtual Connector](https://developers.cloudflare.com/magic-wan/configuration/connector/configure-virtual-connector/#create-a-lan)\n\n</page>\n\n<page>\n---\ntitle: Network segmentation  Cloudflare Magic WAN docs\ndescription: Define policies to define if traffic should flow between your LANs\n  without leaving your local premises, or if traffic should be forwarded to\n  Cloudflare for additional security configurations.\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/network-segmentation/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/network-segmentation/index.md\n---\n\nYou can define policies in your Magic WAN Connector to either allow traffic to flow between your LANs without it leaving your local premises or to forward it via the Cloudflare network where you can add additional security features. The default behavior is to drop all LAN-to-LAN traffic. These policies can be created for specific subnets, and link two LANs.",
      "language": "unknown"
    },
    {
      "code": "*In the above example, the red path shows traffic that stays in the customer's premises (allowing direct communication between LAN 3 and LAN 4), and the orange path shows traffic that goes to Cloudflare before returning to the customer's premises (processing traffic between LAN 1 and LAN 2 in Cloudflare).*\n\n\n\nAs a best practice for security, we recommend sending all traffic through Cloudflare's network for Zero Trust security filtering. Use these policies with care and only for scenarios where you have a hard requirement for LAN-to-LAN traffic flows.\n\nIf you enable LAN to LAN traffic flows, communications can only be initiated from origin to destination  for example, LAN 1 to LAN 2  and not the other way around. This is by design and prevents potential exfiltration of information. This does not mean bidirectional communication on TCP is not possible. It only means that the origin is the only one authorized to initiate communications.\n\nUnidirectional communication can be enabled for UDP and ICMP, but it is not available for TCP, as it would break that protocol.\n\nThe following guide assumes you have already created a site and configured your Magic WAN Connector. To learn how to create a site and configure your Magic WAN Connector, refer to [Configure hardware Connector](https://developers.cloudflare.com/magic-wan/configuration/connector/configure-hardware-connector/) or [Configure Virtual Connector](https://developers.cloudflare.com/magic-wan/configuration/connector/configure-virtual-connector/), depending on the type of Magic WAN Connector you have on your premises.\n\n## Create a policy\n\n* Dashboard\n\n  Follow the steps below to create a new LAN policy to segment your network. Only the fields marked **required** are mandatory.\n\n  1. Go to the **Connector on-ramps** page.\n\n  [Go to **Connector on-ramps**](https://dash.cloudflare.com/?to=/:account/magic-wan/mconn-onramp)\n\n  1. Select the Magic WAN Connector you want to configure > **Edit**.\n  2. Go to **Network Configuration**, and scroll down to **LAN configuration**.\n\n  1) Select **LAN policies** > **Create Policy**.\n\n  2) In **Policy name**, enter a descriptive name for the policy you are creating.\n\n  3) From the drop-down menu **Origin (required)**, select your origin LAN.\n\n  4) Specify a subnet for your first LAN in **Subnets**.\n\n  5) In **Ports** specify the TCP/UDP ports you want to use. Valid ports range from `1` to `65535`. Zero (`0`) is not a valid port number. Add a comma to separate each of the ports or add a port range. For example, `2,5,6,9-14`.\n\n  6) In **Destination (required)**, select the destination LAN and repeat the above process to configure it.\n\n  7) In **Protocols**, select the type of traffic you want to allow. You can choose **TCP**, **UDP**, and **ICMP**. You can also select **Any** to choose all types of traffic.\n\n  8) In **Traffic direction** you can choose between bidirectional traffic (the default) and unidirectional traffic. What you can choose depends on the protocol that you chose for the policy:\n\n     * **Any**: If **Any** is selected and you choose **Unidirectional**, the system will alert you that this will break TCP traffic.\n     * **TCP**: You can only select **Bidirectional**.\n     * **UDP**: The system defaults to **Bidirectional** but you can choose **Unidirectional**.\n     * **ICMP**: The system defaults to **Bidirectional** but you can choose **Unidirectional**.\n\n  9) In **Traffic path**, select **Forwarded via Cloudflare** if you want traffic to be forwarded to Cloudflare to be processed. If you do not select this option, traffic will flow locally, in your premises without passing through Cloudflare.\n\n  10) Select **Save**.\n\n* API\n\n  Note\n\n  You will need your [account ID](https://developers.cloudflare.com/fundamentals/account/find-account-and-zone-ids/) and [API token](https://developers.cloudflare.com/fundamentals/api/get-started/account-owned-tokens/) to use the API.\n\n  Create a `POST` request [using the API](https://developers.cloudflare.com/api/resources/magic_transit/subresources/sites/subresources/acls/methods/create/) to create a network policy.\n\n  Example:\n\n  Required API token permissions\n\n  At least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n  * `Magic WAN Write`\n  * `Magic Transit Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "Take note of the `id` parameter, as you will need it to edit or delete network policies.\n\nThe new policy will ensure that traffic between the specified LANs flows locally, bypassing Cloudflare.\n\n## Edit a policy\n\n* Dashboard\n\n  1. Log in to the [Cloudflare dashboard](https://dash.cloudflare.com/login), and select your account.\n  2. Select **Networking** > **Magic WAN** > **Connector on-ramps (beta)**.\n\n  1) Select the Magic WAN Connector you want to configure > **Edit**.\n  2) Go to **Network Configuration**, and scroll down to **LAN configuration**.\n\n  1. Select **LAN policies**.\n  2. Select the policy you need to edit > **Edit**.\n  3. Make your changes, and select **Update policy**.\n\n* API\n\n  Note\n\n  You will need your [account ID](https://developers.cloudflare.com/fundamentals/account/find-account-and-zone-ids/) and [API token](https://developers.cloudflare.com/fundamentals/api/get-started/account-owned-tokens/) to use the API.\n\n  Create a `PUT` request [using the API](https://developers.cloudflare.com/api/resources/magic_transit/subresources/sites/subresources/acls/methods/update/) to edit a network policy.\n\n  Example:\n\n  Required API token permissions\n\n  At least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n  * `Magic WAN Write`\n  * `Magic Transit Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "## Delete a policy\n\n* Dashboard\n\n  1. Log in to the [Cloudflare dashboard](https://dash.cloudflare.com/login), and select your account.\n  2. Select **Networking** > **Magic WAN** > **Connector on-ramps (beta)**.\n\n  1) Select the Magic WAN Connector you want to configure > **Edit**.\n  2) Go to **Network Configuration**, and scroll down to **LAN configuration**.\n\n  1. Select **LAN policies**.\n  2. Select the policy you need to edit > **Edit**.\n  3. Select **Delete**.\n  4. Select **I understand that deleting a policy is permanent** in the dialog box > **Delete**.\n\n* API\n\n  Note\n\n  You will need your [account ID](https://developers.cloudflare.com/fundamentals/account/find-account-and-zone-ids/) and [API token](https://developers.cloudflare.com/fundamentals/api/get-started/account-owned-tokens/) to use the API.\n\n  Create a `DELETE` request [using the API](https://developers.cloudflare.com/api/resources/magic_transit/subresources/sites/subresources/acls/methods/delete/) to delete a network policy.\n\n  Example:\n\n  Required API token permissions\n\n  At least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n  * `Magic WAN Write`\n  * `Magic Transit Write`",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Routed subnets  Cloudflare Magic WAN docs\ndescription: Learn how to configure routed subnets on a Magic WAN Connector,\n  including setting static routes and next-hop addresses for complex LAN setups.\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/routed-subnets/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/routed-subnets/index.md\n---\n\nEach LAN interface (physical port + VLAN tag) on Magic WAN Connector is part of a *directly-attached subnet*. When you specify a static address for the LAN interface, you indicate both the interface's address as well as the subnet it attaches to. For example, `192.168.100.13/24` means the LAN interface has the IP address `192.168.100.13`, and is part of the subnet `192.168.100.0/24`.\n\nSome LANs are more complex. In addition to the directly-attached subnet, they might have additional subnets sitting behind L3 routers south of the Magic WAN Connector. We call these *routed subnets*.\n\nRefer to the diagram below for an example of how this might work:\n\nNote\n\nBlue represents directly-attached subnets, and red represents routed subnets.",
      "language": "unknown"
    },
    {
      "code": "To add a routed subnet to your LAN, you need:\n\n* **A prefix**: The subnet's CIDR prefix; Cloudflare will automatically install static routes to this prefix in our global network (to forward [packets](https://www.cloudflare.com/learning/network-layer/what-is-a-packet/) for this subnet to the right Magic WAN Connector), and in your Magic WAN Connector (to forward packets for this subnet to the right LAN interface). In the figure above, the routed subnet in the center has the prefix `192.168.200.0/24`.\n* **A next-hop address**: The address of the L3 router to which the Magic WAN Connector should forward packets for this subnet. In the figure, the routed subnet in the center has the next-hop address `192.168.100.10`.\n\nOptionally, you can also [enable NAT for a subnet](https://developers.cloudflare.com/magic-wan/configuration/connector/network-options/nat-subnet/) by providing a static overlay prefix.\n\n## Create routed subnets\n\nFor more information on how to create routed subnets, refer to **Create a LAN**, either in either in [Configure hardware Connector](https://developers.cloudflare.com/magic-wan/configuration/connector/configure-hardware-connector/#create-a-lan) or in [Configure Virtual Connector](https://developers.cloudflare.com/magic-wan/configuration/connector/configure-virtual-connector/#create-a-lan).\n\n</page>\n\n<page>\n---\ntitle: Activate Magic WAN Connector  Cloudflare Magic WAN docs\ndescription: \"Before you can activate your Magic WAN Connector, you need to\n  follow Cloudflare's instructions regarding DHCP. For full instructions on\n  this, refer to:\"\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/activate-connector/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/activate-connector/index.md\n---\n\nBefore you can activate your Magic WAN Connector, you need to follow Cloudflare's instructions regarding DHCP. For full instructions on this, refer to:\n\n* The [hardware version of Magic WAN Connector](https://developers.cloudflare.com/magic-wan/configuration/connector/configure-hardware-connector/#activate-appliance)\n* The [virtual version of Magic WAN Connector](https://developers.cloudflare.com/magic-wan/configuration/connector/configure-virtual-connector/#activate-appliance)\n\n</page>\n\n<page>\n---\ntitle: Add or remove connectors  Cloudflare Magic WAN docs\ndescription: To add a new Magic WAN Connector you first need to remove the one\n  associated with the on-ramps. You can only have more than one Magic WAN\n  Connector if you initially enabled high availability on your on-ramp.\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/add-remove-connectors/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/add-remove-connectors/index.md\n---\n\nTo add a new Magic WAN Connector you first need to remove the one associated with the on-ramps. You can only have more than one Magic WAN Connector if you initially enabled high availability on your on-ramp.\n\n1. Go to the **Connector on-ramps** page.\n\n[Go to **Connector on-ramps**](https://dash.cloudflare.com/?to=/:account/magic-wan/mconn-onramp)\n\n1. Find the Magic WAN Connector that you want to edit > select the three dots next to it > **Edit**.\n2. In **Connectors**, remove the Magic WAN Connector associated with the on-ramp.\n3. Select **Add Connector** to add a different Magic WAN Connector to your on-ramp.\n4. Select **Save**.\n\n</page>\n\n<page>\n---\ntitle: Deactivate Magic WAN Connector  Cloudflare Magic WAN docs\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/deactivate-connector/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/deactivate-connector/index.md\n---\n\n1. In the Cloudflare dash, go to the **Configuration** page.\n\n[Go to **Configuration**](https://dash.cloudflare.com/?to=/:account/magic-wan/configuration)\n\n1. In the **Magic WAN Connector** tab, find the Magic WAN Connector you want to deactivate, select the three dots next to it > **Edit**.\n\n1) In **Status**, select *Deactivated* from the dropdown.\n2) Select **Update**.\n\n</page>\n\n<page>\n---\ntitle: Default password  Cloudflare Magic WAN docs\ndescription: Learn how to edit Magic WAN Connector's default password.\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/default-password/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/default-password/index.md\n---\n\nMagic WAN Connector ships to you with a default password that enables you to access the hardware box or the virtual machine. Cloudflare recommends that you change this password after the first boot.\n\n## Default password to access hardware Magic WAN Connector\n\nThe default password for Magic WAN Connector is the serial number (also known as a Service Tag for Dell devices), all uppercase followed by an `!` (exclamation mark). For example, `A1B2C3D!`\n\n## Default password to access Virtual Connector\n\nThe default password for Virtual Connector is the last seven characters of your license key, all uppercase, plus an `!` (exclamation mark).\n\nFor example, if your license key is `mconn-abcdefghijklmnopqrstuvwxyz`, your default password will be `TUVWXYZ!`.\n\n</page>\n\n<page>\n---\ntitle: Edit basic information  Cloudflare Magic WAN docs\ndescription: In Basic information, you can change the name and description of\n  your Magic WAN Connector.\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/edit-basic-info/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/edit-basic-info/index.md\n---\n\nIn **Basic information**, you can change the name and description of your Magic WAN Connector.\n\n1. Log in to the [Cloudflare dashboard](https://dash.cloudflare.com/) and select your account.\n2. Go to **Networking** > **Magic WAN** > **Connector on-ramps (beta)**.\n\n1) Find the Magic WAN Connector that you want to edit > select the three dots next to it > **Edit**.\n2) In **Basic information** make the necessary changes.\n3) Select **Save**.\n\n</page>\n\n<page>\n---\ntitle: Edit network settings  Cloudflare Magic WAN docs\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/edit-network-settings/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/edit-network-settings/index.md\n---\n\n1. Go to the **Connector on-ramps** page.\n\n[Go to **Connector on-ramps**](https://dash.cloudflare.com/?to=/:account/magic-wan/mconn-onramp)\n\n1. Find the Connector that you want to edit > select the three dots next to it > **Edit**.\n2. Go to **Network configuration** > **WAN configuration** or **LAN configuration**.\n3. Find the WAN/LAN you want to edit > select the three dots next to it > **Edit**.\n4. Make the necessary changes.\n5. Select **Save**.\n\n</page>\n\n<page>\n---\ntitle: Edit sites  Cloudflare Magic WAN docs\nlastUpdated: 2025-10-31T13:37:27.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/edit-sites/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/edit-sites/index.md\n---\n\n1. Go to the **Network overview** page.\n\n[Go to **Network overview**](https://dash.cloudflare.com/?to=/:account/magic-wan/network)\n\n1. Find the site you want to make changes on > select the three dots next to it > **Edit**.\n2. In **Basic information**, make changes to the site's name, description, and geographic coordinates.\n3. In **On-ramps**, add new on-ramps to your site. You can also remove existing ones.\n\n</page>\n\n<page>\n---\ntitle: Edit traffic steering settings  Cloudflare Magic WAN docs\ndescription: \"You can only add or remove applications to Breakout traffic and\n  Prioritized traffic. To add or remove applications:\"\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/edit-traffic-steering-settings/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/edit-traffic-steering-settings/index.md\n---\n\nYou can only add or remove applications to Breakout traffic and Prioritized traffic. To add or remove applications:\n\n1. Go to the **Connector on-ramps** page.\n\n[Go to **Connector on-ramps**](https://dash.cloudflare.com/?to=/:account/magic-wan/mconn-onramp)\n\n1. Find the Connector that you want to edit > select the three dots next to it > **Edit**.\n2. Go to **Traffic steering** > **Breakout traffic** or **Prioritized traffic**.\n3. Select **Add** to add a new application.\n4. To delete an application, find the one you want to delete from **Breakout traffic** or **Prioritized traffic** > select the three dots next to it > **Remove**.\n\n</page>\n\n<page>\n---\ntitle: Heartbeat  Cloudflare Magic WAN docs\ndescription: Magic WAN Connector communicates periodically with Cloudflare via\n  HTTPS. This is also known as a heartbeat, and lets Cloudflare know that the\n  Magic WAN Connector in question is connected to the Internet and reachable.\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/heartbeat/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/heartbeat/index.md\n---\n\nMagic WAN Connector communicates periodically with Cloudflare via HTTPS. This is also known as a heartbeat, and lets Cloudflare know that the Magic WAN Connector in question is connected to the Internet and reachable.\n\nThe heartbeat calls are made to `api.cloudflare.com`. Each Magic WAN Connector has a heartbeat frequency of 10 seconds, independently of the number of WAN interfaces you have running on your device.\n\nThere are three symbols for the heartbeat signal that allow you to quickly check the status of Magic WAN Connector:\n\n* **Blue `i`**: Magic WAN Connector is contacting Cloudflare as expected.\n* **Yellow triangle**: Magic WAN Connector has not yet connected to Cloudflare.\n* **Red triangle**: There is a potential problem with Magic WAN Connector.\n\n### Access Magic WAN Connector's heartbeat\n\n1. Go to the **Configuration** page.\n\n[Go to **Configuration**](https://dash.cloudflare.com/?to=/:account/magic-wan/configuration)\n\n1. In the **Magic WAN Connector** tab, find your Magic WAN Connector, and place your cursor over the icon on the **Status** column to check the timestamp. The timestamp shows you the last time Magic WAN Connector successfully contacted Cloudflare.\n\n</page>\n\n<page>\n---\ntitle: Register a hardware Magic WAN Connector  Cloudflare Magic WAN docs\ndescription: To set up and use the hardware version of Magic WAN Connector, you\n  first need to register it with your account. This is not applicable to Virtual\n  Magic WAN Connector.\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/register-appliance/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/register-appliance/index.md\n---\n\nTo set up and use the hardware version of Magic WAN Connector, you first need to register it with your account. This is not applicable to Virtual Magic WAN Connector.\n\n1. Go to Magic WAN's **Configuration** page.[ Go to **Configuration**](https://dash.cloudflare.com/?to=/:account/magic-wan/configuration)\n2. Under **Connectors**, select **Register your appliance**.\n\n1) In **Appliance details** > **Serial number**, insert the serial number for your device. You can optionally add notes about the Magic WAN Connector you are adding to the dashboard.\n2) (Optional) Select **Add** below **Serial number** to add multiple Magic WAN Connectors at once to your account.\n3) Select **Register appliance**.\n\nYour device is now registered with your account.\n\n</page>\n\n<page>\n---\ntitle: Interrupt window  Cloudflare Magic WAN docs\ndescription: Learn how to set up when Magic WAN Connector can update its systems.\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/interrupt-service-window/\n  md: https://developers.cloudflare.com/magic-wan/configuration/connector/maintenance/interrupt-service-window/index.md\n---\n\nThe Interrupt window defines when Magic WAN Connector can update its systems. When Magic WAN Connector is updating, this may result in an interruption to existing connections. Set up a time window that minimizes disruption to your sites.\n\n1. Go to the **Configuration** page.\n\n[Go to **Configuration**](https://dash.cloudflare.com/?to=/:account/magic-wan/configuration)\n\n1. In the **Magic WAN Connector** tab, select the Magic WAN Connector for which you want to set up the update window > **Edit**.\n\n1) In **Interrupt window**, select the most appropriate time for the Magic WAN Connector to update its systems:\n\n   * **Timezone**: Select the time zone for the Magic WAN Connector to update.\n   * **Start time**: Choose an hour for the Magic WAN Connector to start updating. Cloudflare recommends you choose an hour when there is minimal activity in your network, to avoid potential disruptions.\n   * **Duration**: Duration indicates the time window during which the Magic WAN Connector is scheduled to update. For example, if you configure your Magic WAN Connector to update at `22:00` and specify a **Duration** of `4 hours`, the Magic WAN Connector will attempt to update within the four-hour period following `22:00`.\n\n</page>\n\n<page>\n---\ntitle: Configure Cloudflare source IPs  Cloudflare Magic WAN docs\ndescription: Configure the Cloudflare source IP range used when you receive\n  traffic from Cloudflare services sent to your Cloudflare One private networks.\nlastUpdated: 2025-11-25T17:44:26.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-cloudflare-source-ips/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-cloudflare-source-ips/index.md\n---\n\nYou can configure the source IP address range used by Cloudflare whenever a Cloudflare service, such as Cloudflare Load Balancing, sends traffic to a Cloudflare One private network. This address range is referred to as the Proxy Source IP Prefix (or `cloudflare_source` subnet type in the API).\n\n* IPv4 traffic is sourced from `100.64.0.0/12`. This range is configurable.\n* IPv6 traffic is sourced from `2606:4700:cf1:5000::/64`. This range is not configurable.\n\nCustomers may wish to change the default allocated range to avoid IP conflicts or fit with an existing IP Address Management plan.\n\nYou must configure routes in your network so that response traffic for these source ranges is sent back to Cloudflare over your Cloudflare One connections.\n\n## Prerequisites\n\nBefore you begin, ensure that:\n\n* You have Cloudflare One Unified Routing. If your account is not yet on Unified Routing, contact your account team to discuss migration and availability.\n\n* You have [Cloudflare One Networks Write](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) permission.\n\n* Your desired new network range meets the following requirements:\n\n  * Your network must be defined as a single CIDR with a prefix length of `/12`.\n\n  * Cloudflare One subnets in the same account cannot overlap. Default allocations include:\n\n    * Proxy Source IPs (`100.64.0.0/12`)\n    * Hostname Route Token IPs (`100.80.0.0/16`)\n    * WARP Clients (`100.96.0.0/12`)\n    * Private Load Balancers (`100.112.0.0/16`)\n\n  * The source subnet cannot match or contain any existing route in your Cloudflare One routing table. The source subnet can be within a supernet route.\n\n## Affected Connectors\n\nExcept for Cloudflare Tunnel, all Cloudflare One Connectors (network offramps) see the `cloudflare_source` subnet (default `100.64.0.0/12`) as the source of traffic from a Cloudflare service, such as Cloudflare Load Balancing, to a private network.\n\nThe following Connectors are affected:\n\n* GRE\n* IPsec\n* CNI\n* WARP Connector\n* WARP Client\n\n## Configure source IPs via API\n\nCurrently, you must use the Cloudflare API to configure this setting. To set up your source IPs, send a `PATCH` request to the [Update Cloudflare Source Subnet endpoint](https://developers.cloudflare.com/api/resources/zero_trust/subresources/networks/subresources/subnets/subresources/cloudflare_source/) with your desired network range. The payload must include the network (your new `/12` range), and may include a name and comment.\n\nExample:\n\nRequired API token permissions\n\nAt least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n* `Cloudflare One Networks Write`",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Configure routes  Cloudflare Magic WAN docs\ndescription: Magic WAN uses a static configuration to route your traffic through\n  anycast tunnels from Cloudflare's global network to your locations. If you are\n  connected through Direct CNI you also have access to BGP peering.  Learn how\n  to configure routing.\nlastUpdated: 2025-12-09T10:00:44.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-routes/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-routes/index.md\n---\n\nMagic Networking uses a routing table to steer your traffic from Cloudflare's global network to your connected networks via next-hop. You can add entries to the Magic routing table through static route configuration or routes learned from BGP peering (only available over CNI with Dataplane v2 (beta)).\n\nRefer to [Traffic Steering](https://developers.cloudflare.com/magic-wan/reference/traffic-steering/) for more information about all the technical aspects related to:\n\n* Routes' priorities and weights\n* Regional scoping of traffic to reduce latency\n* BGP peering\n\n- Automatic Return Routing (ARR)\n\n## Configure static routes\n\nThe following IPv4 address ranges are allowed in the Magic Routing table:\n\n* [RFC 1918](https://datatracker.ietf.org/doc/html/rfc1918) address space, specifically `10.0.0.0/8`, `172.16.0.0/12`, and `192.168.0.0/16`.\n\nWhen using Magic WAN and Cloudflare Tunnel together, consider the IP ranges utilized in the static routes of Cloudflare Tunnel when selecting static routes for Magic WAN. For more information, refer to [Cloudflare Tunnel](https://developers.cloudflare.com/magic-wan/zero-trust/cloudflare-tunnel/).\n\nFor prefixes outside RFC 1918, contact your Cloudflare customer service manager.\n\n### Create a static route\n\n* Dashboard\n\n  1. Go to Magic WAN's **Configuration** page.\n\n  [Go to **Configuration**](https://dash.cloudflare.com/?to=/:account/magic-wan/configuration)\n\n  1. From the **Routes** tab, select **Create** to add a new route.\n\n  1) Enter a descriptive name for your route in **Description**.\n\n  2) In **Prefix**, enter your range of IP addresses. For example, `10.10.10.100/24`.\n\n  3) In **Tunnel/Next hop**, select a tunnel for your route from the tunnels you created in [Configure tunnel endpoints](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/).\n\n  4) Choose the **Priority** for your route. Lower numbers have higher priorities.\n\n     Note\n\n     Cloudflare routing applies longest-prefix match. A more specific static route (like `/30`) always takes precedence over a less specific one (like `/29`), regardless of tunnel priority  unless you remove the more specific route.\n\n     Keep this in mind when configuring priorities for your routes. Refer to [Route prioritization](https://developers.cloudflare.com/magic-wan/reference/traffic-steering/#route-prioritization) for more information.\n\n  5) (Optional) Choose a **Weight** for your route. Refer to [Set priority and weights for static routes](https://developers.cloudflare.com/magic-wan/reference/traffic-steering/#set-priority-and-weights-for-static-routes) for examples.\n\n  6) (Optional) If you need to scope your route to a specific region, you can do it in **Region code**.\n\n  7) (Optional) We highly recommend testing your route before adding it by selecting **Test routes**.\n\n  8) Select **Add routes**.\n\n* API\n\n  Note\n\n  You will need your [account ID](https://developers.cloudflare.com/fundamentals/account/find-account-and-zone-ids/) and [API token](https://developers.cloudflare.com/fundamentals/api/get-started/account-owned-tokens/) to use the API.\n\n  Create a `POST` request [using the API](https://developers.cloudflare.com/api/resources/magic_transit/subresources/routes/methods/create/) to create one or more static routes.\n\n  Example:\n\n  Required API token permissions\n\n  At least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n  * `Magic WAN Write`\n  * `Magic Transit Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "### Edit a static route\n\n* Dashboard\n\n  1. In **Routes**, locate the route to modify.\n  2. Select the three dots next to it > **Edit**.\n\n  1) Enter the updated route information.\n  2) (Optional) We highly recommend testing your route before adding it by selecting **Test routes**.\n  3) Select **Edit routes**.\n\n* API\n\n  Note\n\n  You will need your [account ID](https://developers.cloudflare.com/fundamentals/account/find-account-and-zone-ids/) and [API token](https://developers.cloudflare.com/fundamentals/api/get-started/account-owned-tokens/) to use the API.\n\n  Create a `PUT` request [using the API](https://developers.cloudflare.com/api/resources/magic_transit/subresources/routes/methods/update/) to update one or more static routes.\n\n  Example:\n\n  Required API token permissions\n\n  At least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n  * `Magic WAN Write`\n  * `Magic Transit Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "### Delete static route\n\n* Dashboard\n\n  1. In **Routes**, locate the static route to delete.\n  2. Select the three dots next to it > **Delete**.\n\n  1) Confirm the action by selecting the checkbox and select **Delete**.\n\n* API\n\n  Note\n\n  You will need your [account ID](https://developers.cloudflare.com/fundamentals/account/find-account-and-zone-ids/) and [API token](https://developers.cloudflare.com/fundamentals/api/get-started/account-owned-tokens/) to use the API.\n\n  Create a `DELETE` request [using the API](https://developers.cloudflare.com/api/resources/magic_transit/subresources/routes/methods/delete/) to delete a static route.\n\n  Example:\n\n  Required API token permissions\n\n  At least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n  * `Magic WAN Write`\n  * `Magic Transit Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "## Configure Automatic Return Routing (beta)\n\n[Automatic Return Routing (beta)](https://developers.cloudflare.com/magic-wan/reference/traffic-steering/#automatic-return-routing-beta) allows Cloudflare to track network flows from your Magic WAN connected locations, ensuring return traffic is routed back to the connection where it was received without requiring static or dynamic routes. This functionality requires the new [Unified Routing mode](https://developers.cloudflare.com/magic-wan/reference/traffic-steering/#unified-routing-mode).\n\nTo enable ARR:\n\n* Dashboard\n\n  1. Follow the [Add tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels) information to learn how to create an IPsec or GRE tunnel.\n  2. On the tunnel's options, select **Automatic return routing**.\n  3. Select **Add tunnels** to save your changes.\n\n* API\n\n  Create a `POST` request to create an [IPsec](https://developers.cloudflare.com/api/resources/magic_transit/subresources/ipsec_tunnels/methods/create/) or [GRE](https://developers.cloudflare.com/api/resources/magic_transit/subresources/gre_tunnels/methods/create/) tunnel with ARR enabled. For example:\n\n  Required API token permissions\n\n  At least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n  * `Magic WAN Write`\n  * `Magic Transit Write`",
      "language": "unknown"
    },
    {
      "code": "## Configure BGP routes\n\nBGP peering is available when using [CNI with Dataplane v2 (beta)](https://developers.cloudflare.com/network-interconnect/) as an on-ramp.\n\n### Choose an ASN for BGP peering\n\nThe Magic routing table is managed by the customer. You can select both the Cloudflare-side ASN (Autonomous System Number) and the ASN for your customer device. The customer device ASN can be 2-byte or 4-byte.\n\nBy default, each BGP peering session uses the same Cloudflare-side ASN to represent peering with the Magic WAN routing table. This ASN is called the **CF Account ASN** and is set to `13335`. You can configure this to a private 2-byte ASN (any value between `64512` and `65534`, such as `65000`).\n\nTo set this ASN:\n\n1. Go to Magic WAN's **Configuration** page.\n\n[Go to **Configuration**](https://dash.cloudflare.com/?to=/:account/magic-wan/configuration)\n\n1. Go to **BGP configuration**.\n2. In **CF Account ASN**, enter Cloudflare's ASN.\n3. Select **Update**.\n\nMagic WAN customers should also be aware of the following:\n\n* The customer chooses their device ASN, which must be different from the Cloudflare-side ASN.\n\n* The Cloudflare side ASN will be included in the `AS_PATH` of announced routes to any BGP enabled interconnect.\n\n* The customer-announced `AS_PATH` is transitive between interconnects  meaning the origin (customer) ASN is visible in the `AS_PATH` of routes received from Cloudflare via BGP. Due to default BGP loop prevention mechanisms, a router will reject any route that contains its own ASN in the `AS_PATH`. For example, if two Magic WAN-connected sites both use `ASN 65000`, site A will not accept routes from site B, and vice versa, because each site sees its own ASN in the advertised `AS_PATH`.\\\n  To enable routing between private networks over Magic WAN, you should either:\n\n  * Assign a unique ASN to each site/network, or\n  * Configure your edge CPE to accept BGP routes that include its own ASN in the `AS_PATH`.\n\n### Set up BGP peering\n\nWarning\n\nBGP peering is only available to Magic WAN customers with CNI with Dataplane v2 (beta) as an on-ramp. If your network is set up with GRE or IPsec tunnels, you cannot use BGP peering.\n\nYou need to configure two ASNs:\n\n* The Cloudflare [account-scoped ASN](#choose-an-asn-for-bgp-peering) named **CF Account ASN**.\n* One ASN for each interconnect you want to configure with BGP.\n\nIf you have already set up your Cloudflare account ASN, skip steps two and three below.\n\n1. In the Cloudflare dashboard, go to Magic WAN's **Configuration** page.\n\n[Go to **Configuration**](https://dash.cloudflare.com/?to=/:account/magic-wan/configuration)\n\n1. Go to **BGP configuration**.\n2. In **CF Account ASN**, enter Cloudflare's ASN.\n3. Go to **Interconnects**.\n\n1) Locate the CNI interconnect with Dataplane v2 (beta) to configure with BGP > select the **three dots** next to it > **Configure BGP**.\n\n2) In **Customer device ASN**, enter the ASN for your network.\n\n   Note\n\n   Multiple interconnects with the same ASN will not exchange routes if standard BGP loop prevention is enabled. Consider using a different ASN per session, or enabling duplicate ASNs (like Cisco's `allowas-in` feature) to exchange routes between networks.\n\n3) In **MD5 key**, you can optionally enter the key for your network. Note that this is meant to prevent accidental misconfigurations, and is not a security mechanism.\n\n4) (Optional) In **Advertised prefix list**, input the additional prefixes automatically assigned by Cloudflare during the creation of the CNI interconnect. These prefixes advertise alongside your existing routes. Leave this blank if you do not want to advertise extra routes.\\\n   Typical prefixes to configure here include:\n\n   * A route to `0.0.0.0/0`, the default route  to attract all Internet-bound traffic if using Magic WAN with Gateway.\n   * A route to `100.96.0.0/12`, the portion of CGNAT space [used by default with WARP clients](https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/private-net/warp-connector/user-to-site/#add-ip-route-to-router).\n\n5) Select **Save**.\n\n## Next steps\n\nNow that you have configured your tunnels and routes, the next step is to create a site.\n\nSites represent the local network of a data center, office, or other physical location, and combine all on-ramps available there. Sites also allow you to check, at a glance, the state of your on-ramps and set up health alert settings so that Cloudflare notifies you when there are issues with the site's on-ramps.\n\nRefer to [Set up a site](https://developers.cloudflare.com/magic-wan/configuration/common-settings/sites/) for more information.\n\n</page>\n\n<page>\n---\ntitle: Configure tunnel endpoints  Cloudflare Magic WAN docs\ndescription: Cloudflare recommends two tunnels for each ISP and network location\n  router combination, one per Cloudflare endpoint. Learn how to configure IPsec\n  or GRE tunnels.\nlastUpdated: 2025-12-09T10:00:44.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/index.md\n---\n\nCloudflare recommends two tunnels for each ISP and network location router combination, one per Cloudflare endpoint. Shortly after your onboarding kickoff call, Cloudflare will assign two Cloudflare endpoint addresses that you can use as the tunnel destinations on your network location's routers/endpoints.\n\nTo configure the tunnels between Cloudflare and your locations, you must provide the following data for each tunnel:\n\n* **Tunnel name**: For both GRE and IPsec tunnels, the name cannot contain spaces or special characters, and cannot be shared with other tunnels.\n\n* **Cloudflare endpoint address**: The public IP address of the Cloudflare side of the tunnel.\n\n* **Customer endpoint**: A public Internet routable IP address which is outside of the prefixes that Cloudflare will advertise on your behalf. These are generally IP addresses provided by your ISP. If you intend to use a physical or virtual connection like [Cloudflare Network Interconnect](https://developers.cloudflare.com/network-interconnect/), you do not need to provide endpoints because Cloudflare will provide them.\\\n  This value is not required for IPsec tunnels, unless your router is using an Internet Key Exchange (IKE) ID of type `ID_IPV4_ADDR`.\n\n* **Interface address**: A 31-bit (recommended) or 30-bit subnet (`/31` or `/30` in CIDR notation) supporting two hosts, one for each side of the tunnel. Select the subnet from the following private IP space:\n\n  * `10.0.0.0/8`\n\n  * `172.16.0.0/12`\n\n  * `192.168.0.0/16`\n\n  * `169.254.240.0/20` (this address space is also a link-local address)\n\n    Warning\n\n    Make sure the prefixes are always within the allowed Cloudflare ranges, especially for cloud service providers that might automatically generate prefixes for you. Otherwise, the tunnel will not work.\n\n* **TTL**: Time to Live (TTL) in number of hops for the GRE tunnel. The default value is 64.\n\n* **MTU**: Maximum transmission unit (MTU) in bytes for the GRE tunnel. The default value is 1476.\n\n## Ways to onboard traffic to Cloudflare\n\n### GRE and IPsec tunnels\n\nYou can use GRE or IPsec tunnels to onboard your traffic to Magic WAN, and set them up through the Cloudflare dashboard or the API. If you use the API, you need your [account ID](https://developers.cloudflare.com/fundamentals/account/find-account-and-zone-ids/) and [API key](https://developers.cloudflare.com/fundamentals/api/get-started/keys/#view-your-global-api-key).\n\n#### IPsec supported ciphers\n\nRefer to [Tunnels and encapsulation](https://developers.cloudflare.com/magic-wan/reference/gre-ipsec-tunnels/) to learn more about the technical requirements for GRE and IPsec tunnels used in Magic WAN. In that page, you can also find the [supported ciphers for IPsec](https://developers.cloudflare.com/magic-wan/reference/gre-ipsec-tunnels/#supported-configuration-parameters).\n\nNote\n\nIPsec tunnels only support Internet Key Exchange version 2 (IKEv2).\n\n#### Anti-replay protection\n\nIf you use Magic WAN and anycast IPsec tunnels, we recommend disabling anti-replay protection. Cloudflare disables this setting by default. However, you can enable it through the API or the Cloudflare dashboard for devices that do not support disabling it, including Cisco Meraki, Velocloud, and AWS VPN Gateway.\n\nRefer to [Anti-replay protection](https://developers.cloudflare.com/magic-wan/reference/anti-replay-protection/) for more information on this topic, or [Add IPsec tunnels](#add-tunnels) to learn how to enable this feature.\n\n### Network Interconnect (CNI)\n\nBeyond GRE and IPsec tunnels, you can also use Network Interconnect (CNI) to onboard your traffic to Magic WAN. Refer to [Network Interconnect (CNI)](https://developers.cloudflare.com/magic-wan/network-interconnect/) for more information.\n\n## Add tunnels\n\nWarning\n\nMagic Firewall rules apply to Internet Control Message Protocol (ICMP) traffic. If you enable Magic Firewall, ensure your rules allow ICMP traffic sourced from Cloudflare public IPs. Otherwise, health checks will fail. Refer to [Magic Firewall rules](https://developers.cloudflare.com/magic-firewall/about/ruleset-logic/#magic-firewall-rules-and-magic-transit-endpoint-health-checks) for more information.\n\n* Dashboard\n\n  1. Go to Magic WAN's **Configuration** page.\n\n  [Go to **Configuration**](https://dash.cloudflare.com/?to=/:account/magic-wan/configuration)\n\n  1. From the **Tunnels** tab, select **Create**.\n  2. On the **Add tunnels** page, choose either a **GRE tunnel** or **IPsec tunnel**.\n\n  GRE tunnel\n\n  1. In **Name**, give your tunnel a descriptive name. This name must be unique, and must not contain spaces or special characters. Hover over `i` in the dashboard for more information.\n  2. Give your tunnel a description in **Description**. You do not have character restrictions here.\n  3. In **IPv4 Interface address**, enter the internal IP address for your tunnel along with the interface's prefix length (either `/31` or `/30`). This is used to route traffic through the tunnel on the Cloudflare side. We recommend using an RFC1918 address scheme with a `/31` netmask, as it provides the most efficient use of IP address space.\n  4. In **Customer GRE endpoint**, enter your router's public IP address. You do not need this value if you use a physical or virtual connection like Cloudflare Network Interconnect because Cloudflare provides it.\n  5. In **Cloudflare GRE endpoint**, enter the anycast address you received from your account team.\n  6. Leave the default values for **TTL** and **MTU**.\n  7. *(Optional)* **Tunnel health checks** are enabled by default. If you disable Tunnel health checks, your tunnels appear 100% down in your [tunnel health dashboard](https://developers.cloudflare.com/magic-wan/configuration/common-settings/check-tunnel-health-dashboard/) even when working. Cloudflare keeps sending traffic through the tunnel without the means to detect if the tunnel goes down. You must set up your own system to detect down tunnels, as Cloudflare cannot warn you about down tunnels. Refer to [Tunnel health checks](https://developers.cloudflare.com/magic-wan/reference/tunnel-health-checks/) for more information.\n  8. *(Optional)* If you keep **Tunnel health checks** enabled, choose a [health check rate](https://developers.cloudflare.com/magic-wan/configuration/common-settings/update-tunnel-health-checks-frequency/) for your tunnel. Available options are *Low*, *Medium*, and *High*.\n  9. The **Health check type** defaults to *Reply* and to creating an ICMP (Internet Control Message Protocol) reply. If your firewall drops this type of packet because it assumes the packet is an attack, change this option to *Request* which creates an ICMP request. Refer to [Tunnel health checks](https://developers.cloudflare.com/magic-wan/reference/tunnel-health-checks/) for more information.\n  10. The **Health check direction** defaults to **bidirectional** for Magic WAN. Refer to [Bidirectional vs unidirectional health checks](#bidirectional-vs-unidirectional-health-checks) for more details.\n  11. *(Optional)* **Health check target** is the customer end of the tunnel. This field is only visible when the **Health check direction** is set to *Unidirectional*.\n  12. *(Optional)* We recommend you test your tunnel before officially adding it. To test the tunnel, select **Test tunnels**.\n\n  1) (Optional) Select **Automatic return routing** if you are setting up this tunnel for a site that only needs to send traffic to and receive responses from Cloudflare, and does not need to receive traffic from other sites in your WAN. Refer to [Configure Automatic Return Routing](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-routes/#configure-automatic-return-routing-beta) for more information.\n\n  1. To add multiple tunnels, select **Add GRE tunnel** for each new tunnel.\n\n  1) After adding your tunnel information, select **Add tunnels**.\n\n  IPsec tunnel\n\n  1. In **Name**, give your tunnel a descriptive name. This name must be unique, and must not contain spaces or special characters. Hover over `i` in the dashboard for more information.\n\n  2. Give your tunnel a description in **Description**. You do not have character restrictions here.\n\n  3. In **IPv4 Interface address**, enter the internal IP address for your tunnel along with the interface's prefix length (either `/31` or `/30`). This is used to route traffic through the tunnel on the Cloudflare side. We recommend using an RFC1918 address scheme with a `/31` netmask, as it provides the most efficient use of IP address space.\n\n  4. In **Customer endpoint**, enter your router's public IP address. This value is only required if your router uses an IKE (Internet Key Exchange) ID of type `ID_IPV4_ADDR`.\n\n  5. In **Cloudflare endpoint**, enter the anycast address you received from your account team.\n\n  6. *(Optional)* **Tunnel health checks** are enabled by default. If you disable Tunnel health checks, your tunnels appear 100% down in your [tunnel health dashboard](https://developers.cloudflare.com/magic-wan/configuration/common-settings/check-tunnel-health-dashboard/) even when working. Cloudflare keeps sending traffic through the tunnel without the means to detect if the tunnel goes down. You must set up your own system to detect down tunnels, as Cloudflare cannot warn you about down tunnels. Refer to [Tunnel health checks](https://developers.cloudflare.com/magic-wan/reference/tunnel-health-checks/) for more information.\n\n  7. *(Optional)* If you keep **Tunnel health checks** enabled, choose a [health check rate](https://developers.cloudflare.com/magic-wan/configuration/common-settings/update-tunnel-health-checks-frequency/) for your tunnel. Available options are *Low*, *Medium* and *High*.\n\n  8. *(Optional)* The **Health check type** defaults to *Reply* and to creating an ICMP reply. If your firewall drops this type of packet because it assumes the packet is an attack, change this option to *Request* which creates an ICMP request. Refer to [Tunnel health checks](https://developers.cloudflare.com/magic-wan/reference/tunnel-health-checks/) for more information.\n\n  9. *(Optional)* The **Health check direction** defaults to **bidirectional** for Magic WAN. Refer to [Bidirectional vs unidirectional health checks](#bidirectional-vs-unidirectional-health-checks) for more details.\n\n  10. *(Optional)* **Health check target** is the customer end of the tunnel. This field is only visible when the **Health check direction** is set to *Unidirectional*.\n\n      Note\n\n      IPsec tunnels will not function without a pre-shared key (PSK).\n\n  11. If you do not have a pre-shared key yet:\n\n      1. Select **Add pre-shared key later**.\n      2. *(Optional)* We recommend you test your tunnel configuration before officially adding it. To test the tunnel, select **Test tunnels**.\n      3. Select **Add tunnels**.\n      4. The Cloudflare dashboard loads the list of tunnels you have configured. The IPsec tunnel you just created displays a warning triangle icon to indicate it is not yet functional. Select **Edit**.\n      5. Choose **Generate a new pre-shared key** > **Update and generate a pre-shared key**. Save the key to a safe place, and select **Done**.\n\n  12. If you already have a pre-shared key:\n\n      1. Select **Use my own pre-shared key**.\n      2. Paste your key in **Your pre-shared key**.\n      3. *(Optional)* We recommend you test your tunnel before officially adding it. To test the tunnel, select **Test tunnels**.\n      4. Select **Add tunnels**.\n\n  13. (Optional) Enable **Replay protection** if you have devices that do not support disabling it. Refer to [Anti-replay protection](https://developers.cloudflare.com/magic-wan/reference/anti-replay-protection/) for more information.\n\n  1) (Optional) Select **Automatic return routing** if you are setting up this tunnel for a site that only needs to send traffic to and receive responses from Cloudflare, and does not need to receive traffic from other sites in your WAN. Refer to [Configure Automatic Return Routing](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-routes/#configure-automatic-return-routing-beta) for more information.\n\n  1. To add multiple tunnels, select **Add IPsec tunnel** for each new tunnel.\n\n  1) After adding your tunnel information, select **Add tunnels**.\n\n* API\n\n  Note\n\n  You will need your [account ID](https://developers.cloudflare.com/fundamentals/account/find-account-and-zone-ids/) and [API token](https://developers.cloudflare.com/fundamentals/api/get-started/account-owned-tokens/) to use the API.\n\n  GRE tunnel\n\n  Create a `POST` request [using the API](https://developers.cloudflare.com/api/resources/magic_transit/subresources/gre_tunnels/methods/create/) to create a GRE tunnel.\n\n  Required API token permissions\n\n  At least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n  * `Magic WAN Write`\n  * `Magic Transit Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "IPsec tunnel\n\n  1. Create a `POST` request [using the API](https://developers.cloudflare.com/api/resources/magic_transit/subresources/ipsec_tunnels/methods/create/) to create an IPsec tunnel.\n\n     Note that in the example, replay protection is disabled by default. You can enable it with the flag `\"replay_protection\": true` for each IPsec tunnel, if the devices you use do not support disabling this feature. If you have already created IPsec tunnels, update them with a [`PUT` request](https://developers.cloudflare.com/api/resources/magic_transit/subresources/ipsec_tunnels/methods/update/). Refer to [Anti-replay protection](https://developers.cloudflare.com/magic-wan/reference/anti-replay-protection/) for more information on this topic.\n\n     Required API token permissions\n\n     At least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n     * `Magic WAN Write`\n     * `Magic Transit Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "Take note of the tunnel `id` value. We will use it to generate a pre-shared key (PSK).\n\n  2. Create a `POST` [request](https://developers.cloudflare.com/api/resources/magic_transit/subresources/ipsec_tunnels/methods/psk_generate/) to generate a PSK. Use the tunnel `id` value you received from the previous command.\n\n     Required API token permissions\n\n     At least one of the following [token permissions](https://developers.cloudflare.com/fundamentals/api/reference/permissions/) is required:\n\n     * `Magic WAN Write`\n     * `Magic Transit Write`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "Take note of your `psk` value.\n\n  3. Create a `PUT` [request](https://developers.cloudflare.com/api/resources/magic_transit/subresources/ipsec_tunnels/methods/update/) to update your IPsec tunnel with the PSK.",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "1. Use the `psk` value from step 3 to configure the IPsec tunnel on your equipment as well.\n\n  Configure bidirectional health checks\n\n  Bidirectional health checks are available for GRE and IPsec tunnels. For Magic WAN this option defaults to bidirectional.\n\n  You can change this setting via the API with `\"bidirectional\"` or `\"unidirectional\"`:",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "## Bidirectional vs unidirectional health checks\n\nTo check for tunnel health, Cloudflare sends a [health check probe](https://developers.cloudflare.com/magic-wan/reference/tunnel-health-checks/) consisting of ICMP (Internet Control Message Protocol) reply [packets](https://www.cloudflare.com/learning/network-layer/what-is-a-packet/) to your network. Cloudflare needs to receive these probes to know if your tunnel is healthy.\n\nCloudflare defaults to bidirectional health checks for Magic WAN, and unidirectional health checks for Magic Transit (direct server return). However, routing unidirectional ICMP reply packets over the Internet to Cloudflare is sometimes subject to drops by intermediate network devices, such as stateful firewalls. Magic Transit customers with egress traffic can modify this setting to bidirectional.\n\n### Legacy bidirectional health checks\n\nFor customers using the legacy health check system with a public IP range, Cloudflare recommends:\n\n* Configuring the tunnel health check target IP address to one within the `172.64.240.252/30` prefix range.\n* Applying a policy-based route that matches [packets](https://www.cloudflare.com/learning/network-layer/what-is-a-packet/) with a source IP address equal to the configured tunnel health check target (for example `172.64.240.253/32`), and route them over the tunnel back to Cloudflare.\n\n## Next steps\n\n* Now that you have set up your tunnel endpoints you need to configure routes to route your traffic through Cloudflare. Refer to [Configure routes](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-routes/) to learn more about static routing and BGP peering (only available through CNI with Dataplane v2 (beta) connection).\n* After configuring either static routes or BGP routing, you need to [set up a site](https://developers.cloudflare.com/magic-wan/configuration/common-settings/sites/).\n\n</page>\n\n<page>\n---\ntitle: Run traceroute  Cloudflare Magic WAN docs\ndescription: Learn what settings you need to change to perform a useful\n  `traceroute` to an endpoint behind a Cloudflare Tunnel.\nlastUpdated: 2025-11-04T17:07:51.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/traceroute/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/traceroute/index.md\n---\n\nIf you have a Magic WAN client connected through [GRE](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/), [IPsec](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/), [CNI](https://developers.cloudflare.com/network-interconnect/) or [WARP](https://developers.cloudflare.com/magic-wan/zero-trust/warp/) and want to perform a `traceroute` to an endpoint behind a [Cloudflare Tunnel](https://developers.cloudflare.com/magic-wan/zero-trust/cloudflare-tunnel/), the following settings must be applied for the command to return useful information.\n\n## Inherited TTL value\n\nOn the machine where the `traceroute` client is executed, make sure the tunnel device does not inherit the TTL value of the inner packet. This is the default behavior on Linux and can result in unhelpful `traceroute` results:",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "Setting the TTL explicitly returns much better results:",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "## WARP client\n\nSome Linux distributions default to a very strict setting for [reverse path filtering](https://sysctl-explorer.net/net/ipv4/rp_filter/). This strict setting attempts to drop fake traffic as a security measure. Performing a `traceroute` with this setting on can unintentionally drop `traceroute` packets. If you use WARP on Linux, set a less strict policy before attempting to perform a `traceroute`:",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Alibaba Cloud VPN Gateway  Cloudflare Magic WAN docs\ndescription: This tutorial provides information on how to connect Alibaba Cloud\n  infrastructure to Magic WAN through IPsec tunnels. For more information\n  regarding Alibaba Cloud technology, refer to Alibaba's documentation.\nlastUpdated: 2025-10-31T13:37:27.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/alibaba-cloud/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/alibaba-cloud/index.md\n---\n\nThis tutorial provides information on how to connect Alibaba Cloud infrastructure to Magic WAN through IPsec tunnels. For more information regarding Alibaba Cloud technology, refer to [Alibaba's documentation](https://www.alibabacloud.com/help/en/vpn-gateway).\n\n## Alibaba Cloud\n\n### 1. Create a VPC\n\n1. Log in to your Alibaba Cloud account.\n2. Go to **VPC** > **VPN Gateways**, and select **Create VPC** to create a new virtual private cloud.\n3. Give your VPC a descriptive name. For example, `Cloudflare-Magic-WAN`.\n4. Choose the **Region** that aligns with where your servers are located.\n5. In **IPv4 CIDR block**, choose from one of the recommended IP blocks. For example, `192.168.20.0/24`. Take note of the IP block you choose, as you will need it to create a static route in Magic WAN.\n\n### 2. Create a VPN gateway\n\n1. Still in your Alibaba Cloud account, go to **VPC** > **VPN Gateway**, and select **Create VPN Gateway**.\n2. Give your VPN Gateway a descriptive name. For example, `VPN-Gateway-Magic-WAN`.\n3. In **Region**, choose the server that is best for your geographic region. For example, **US (Silicon Valley)**.\n4. For **Gateway Type**, choose **Standard**.\n5. In **Network Type**, choose **Public**.\n6. For **Tunnels**, select **Single-tunnel**.\n7. In the **VPC** dropdown menu, choose the name of the VPC you created before for Magic WAN. For example, `Cloudflare-Magic-WAN`.\n8. In the **VSwitch** dropdown menu, choose the VSwith you created previously. For example, `VSwitch-CF`.\n9. For options such as **Maximum Bandwidth**, **Traffic**, and **Duration**, select the options that best suit your use case.\n10. In **IPsec-VPN**, select **Enable**.\n11. For **SSL-VPN**, select **Disable**.\n12. When you are finished configuring your VPN gateway, return to the main VPN Gateway window.\n13. Select the VPN gateway you have just created, and then select **Destination-based Routing**.\n14. Select **Add Route Entry**, and enter whatever subnets are needed to reach the required destinations. You can, for example, just add a default route to send all traffic through your Magic WAN tunnel.\n15. When you are finished, return to the main window.\n16. Select **Publish** > **OK** to publish the route.\n\n### 3. Create IPsec connections\n\n1. Go to **VPC** > **Customer Gateways** > **Create Customer Gateway**.\n\n2. Create a customer gateway with the Cloudflare anycast IP address given to you by your account team. Typically starts with `162.xx.xx.xx`.\n\n3. Now, go to **VPC** > **IPsec Connections** > **Create IPsec Connection**.\n\n4. Create an IPsec connection with the following settings:\n\n   1. **Name**: give it a descriptive name, like `CF-Magic-WAN-IPsec`.\n   2. **Associate Resource**: **VPN Gateway**.\n   3. **VPN Gateway**: From the dropdown menu, choose the VPN gateway you created previously. In our example, `VPN-Gateway-Magic-WAN`.\n   4. **Customer Gateway**: Select the customer gateway you created above for Magic WAN.\n   5. **Routing Mode**: **Destination Routing Mode**.\n   6. **Effective Immediately**: **Yes**.\n   7. **Pre-Shared Key**: This is the pre-shared key (PSK) you will have to use in the Magic WAN IPsec tunnel. If you do not specify one here, the Alibaba system will generate a random PSK for you.\n\n5. Go to **Advanced Settings**, and expand the **Encryption Configuration** settings.\n\n6. In **IKE Configurations**, select the following settings to configure the IPsec connection. These settings have to match the supported configuration parameters for [Magic WAN IPsec tunnels](https://developers.cloudflare.com/magic-wan/reference/gre-ipsec-tunnels/#supported-configuration-parameters):\n\n   1. **Version**: *ikev2*\n   2. **Negotiation Mode**: *main*\n   3. **Encryption Algorithm**: *aes256*\n   4. **Authentication Algorithm**: *sha256*\n   5. **DH Group**: *group20*\n   6. **Localid**: This is the customer endpoint. These are generally IP addresses provided by your ISP. For example, `47.xxx.xxx.xxx`.\n\n## Magic WAN\n\n### 1. IPsec tunnels\n\n1. Follow the [Add tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels) instructions to create the required IPsec tunnels with the following options:\n\n   1. **Tunnel name**: Give your tunnel a descriptive name, like `Alibaba`.\n   2. **Interface address**: Choose from the subnet in your Alibaba Cloud configuration. For example, if your Alibaba default configuration is `169.xx.xx.1/30`, you might want to choose `169.xx.xx.2/30` for your Magic WAN side of the IPsec tunnel.\n   3. **Customer endpoint**: This is the IP address you entered for **Locali** in Alibaba's IPsec connection. For example, `47.xxx.xxx.xxx`.\n   4. **Cloudflare endpoint**: Enter the same anycast IP address provided by Cloudflare you have entered for Alibaba's Customer Gateway. Typically starts with `162.xx.xx.xx`.\n   5. **Pre-shared key**: Select **Use my own pre-shared key**, and enter the PSK key from your Alibaba Cloud IPsec tunnel.\n   6. **Replay protection**: **Enabled**.\n\n2. Select **Add tunnels** when you are done.\n\n### 2. Static route\n\n1. Follow the [Configure static routes](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-routes/#create-a-static-route) instructions to create a static route.\n2. In **Prefix**, enter the IP CIDR you used to create your virtual private cloud in the Alibaba Cloud interface. In our example we used `192.168.20.0/24`.\n\n</page>\n\n<page>\n---\ntitle: Aruba EdgeConnect Enterprise  Cloudflare Magic WAN docs\ndescription: Cloudflare partners with Aruba's EdgeConnect SD-WAN solution to\n  provide users with an integrated solution. The EdgeConnect appliances manage\n  subnets associated with branch offices or retail locations. Anycast tunnels\n  are set up between the EdgeConnect appliances and Cloudflare to securely route\n  traffic.\nlastUpdated: 2025-10-31T13:37:27.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/aruba-edgeconnect/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/aruba-edgeconnect/index.md\n---\n\nCloudflare partners with Aruba's EdgeConnect SD-WAN solution to provide users with an integrated solution. The EdgeConnect appliances manage subnets associated with branch offices or retail locations. Anycast tunnels are set up between the EdgeConnect appliances and Cloudflare to securely route traffic.\n\nThis tutorial describes how to configure the EdgeConnect device for both east-west (branch to branch) and north-south (Internet-bound) use cases.\n\nWarning\n\nNote that north-south traffic routed through Cloudflare's Secure Web Gateway is an optional add-on feature set and requires a Cloudflare Zero Trust account.\n\n### Prerequisites\n\nBefore setting up a connection between EdgeConnect and Cloudflare, you must have:\n\n* A contract that includes Magic WAN and Secure Web Gateway.\n* Received two Cloudflare endpoints (anycast IP address).\n* Determined a private static /31 IP pair to use with each tunnel. The /31 pairs should be from a different private subnet, separate from the private subnets used behind each EdgeConnect appliance.\n* The EdgeConnect devices used in this tutorial and on v9.0.\n\n## Example scenario\n\nGRE tunnel configuration\n\nFor the purpose of this tutorial, the integration will refer to a scenario with two branch offices, each with distinct subnets.\n\nThere are 2 branch offices each with distinct subnets.\n\n* The east branch office has a `10.3.0.0/16` network with an EdgeConnect terminating the anycast GRE tunnel.\n* The west branch office has a `10.30.0.0/16` network with an EdgeConnect terminating the anycast GRE tunnel.\n\n![Table of branch subnet information](https://developers.cloudflare.com/_astro/branch-subnets.DXU4G0d8_1RaRSA.webp)\n\nBelow is an example of the **east\\_branch** deployment on the Orchestrator.\n\n![GCP East deployment configuration](https://developers.cloudflare.com/_astro/east-branch-deployment.C2wtem9-_2v3k5n.webp)\n\nThe Deployment screenshot displays several different IP addresses and interfaces. From left to right:\n\n* **Next Hop 10.3.0.1** - This example uses Google Cloud. This IP defines the default gateway IP for the subnet and is built into GCP.\n* **IP/Mask (LAN) 10.3.0.2/24** - This defines the LAN0 interface IP of the EdgeConnect appliance.\n* **IP/Mask (WAN) 10.2.0.2/24** - This defines the WAN0 interface IP of the EdgeConnect appliance.\n* **Next Hop 10.2.0.1** - This example uses Google Cloud. This IP defines the default gateway IP for the subnet and is built into GCP.\n\nIPsec tunnel configuration\n\nFor the purpose of this tutorial, the integration will refer to a scenario with two branch offices, each with distinct subnets.\n\nThe central branch office has a `10.22.0.0/24` network with an EdgeConnect terminating the anycast IPsec tunnel.\n\nThe west branch office has a `10.77.0.0/24` network with an EdgeConnect terminating the anycast IPsec tunnel.\n\n![IPsec tunnel values for east and west branches](https://developers.cloudflare.com/_astro/central-west-branch-ipsec.CsmmyLAQ_1gveqI.webp)\n\nBelow is an example of the **central\\_branch** deployment on the Orchestrator.\n\n![Values for central branch configuration within Orchestrator](https://developers.cloudflare.com/_astro/orchestrator-ipsec.BroLLE2X_2jelXM.webp)\n\nThe Deployment screenshot displays several different IP addresses and interfaces. From left to right:\n\n* **Next Hop 10.22.0.1** - This example uses Google Cloud. This IP defines the default gateway IP for the subnet and is built into GCP.\n* **IP/Mask (LAN) 10.22.0.2/24** - This defines the LAN0 interface IP of the EdgeConnect appliance.\n* **IP/Mask (WAN) 10.32.0.2/24** - This defines the WAN0 interface IP of the EdgeConnect appliance.\n* **Next Hop 10.32.0.1** - This example uses Google Cloud. This IP defines the default gateway IP for the subnet and is built into GCP.\n\n## 1. Define a common site on the Orchestrator\n\nFor all EdgeConnect devices using Cloudflare, modify the devices to put them on the same site. This disables automatic IPsec tunnel creation between the EdgeConnect devices using the same labels for the WAN interfaces in use.\n\nThis step is only required if Cloudflare is used for east-west traffic routing.\n\n## 2. Configure overlay policies\n\nWe use Aruba Orchestrator's Business Intent Overlays to create intuitive policies which automatically identify and steer application traffic to Cloudflare. Two Business Intent Overlay (BIO) policies are created in this example.\n\nGRE tunnel configuration\n\nCloudflare's [tunnel health checks](https://developers.cloudflare.com/magic-wan/reference/tunnel-health-checks/) are ping reply packets encapsulated in GRE packets. The source IP is the Edgeconnect WAN interface used to establish a tunnel, and the destination IP is Cloudflare servers. These packets need to be sent directly from the WAN interface and not through the established tunnels.\n\nTo create the overlay policy:\n\n1. Create a compound application, which is a combination of all [Cloudflare public IPs](https://www.cloudflare.com/ips/) and ICMP packets.\n\n![Application definition screen with IP values](https://developers.cloudflare.com/_astro/app-definition.rcGh7Hqx_JhsFK.webp)\n\n1. Create a breakout Business Intent Overlay (BIO) to bypass the GRE tunnel as the first policy and use this newly created application as the match criteria.\n\n2. Define at least one additional overlay policy and the traffic you want to send to Cloudflare over the GRE tunnels.\n\nThe service name used to send traffic through the tunnel created in the next step is **Cloudflare\\_GRE**. The example uses **Match Everything** to send all other traffic through the established tunnel (both private east-west traffic & Internet bound north-south traffic through Cloudflare's Secure Web Gateway).\n\n![Business Intent Overlay screen with breakout and CF overlays](https://developers.cloudflare.com/_astro/biz-intent-overlay.BKoZhAig_10ARsk.webp)\n\nIPsec tunnel configuration\n\nCloudflare's [tunnel health checks](https://developers.cloudflare.com/magic-wan/reference/tunnel-health-checks/) are ping reply packets encapsulated in IPsec packets. The source IP is the Edgeconnect WAN interface used to establish a tunnel, and the destination IP is Cloudflare servers. These packets need to be sent directly from the WAN interface and not through the established tunnels.\n\nTo create the overlay policy:\n\n1. Create a compound application, which is a combination of all [Cloudflare public IPs](https://www.cloudflare.com/ips/) and ICMP packets.\n\n![Application definition screen with IP values](https://developers.cloudflare.com/_astro/app-definition.rcGh7Hqx_JhsFK.webp)\n\n1. Create a breakout Business Intent Overlay (BIO) to bypass the IPsec tunnel as the first policy and use this newly created application as the match criteria.\n\n2. Define at least one additional overlay policy and the traffic you want to send to Cloudflare over the IPsec tunnels.\n\nThe service name used to send traffic through the tunnel created in the next step is **Cloudflare\\_IPsec**. The example uses **Match Everything** to send all other traffic through the established tunnel (both private east-west traffic and Internet bound north-south traffic through Cloudflare's Secure Web Gateway).\n\n![Business Intent Overlay screen with breakout and CF overlays for IPsec](https://developers.cloudflare.com/_astro/biz-intent-overlay-ipsec.3QFGazIP_dafR.webp)\n\n## 3. Create tunnels on Cloudflare and EdgeConnect\n\nGRE tunnel configuration\n\n![Diagram of GCP, Aruba Orchestratror, and Cloudflare products](https://developers.cloudflare.com/_astro/gcp-edgeconnect-diagram.K9bkvdja_19dWwF.webp)\n\n1. Create a tunnel on the EdgeConnect using Cloudflare's assigned public anycast IP and the service used in the overlay policy in the [previous step](#2-configure-overlay-policies).\n2. Create a Virtual Tunnel Interface (VTI) using the private IP pair shared with CF GRE tunnel endpoint and the passthrough tunnel to match the newly created tunnel alias (**CF\\_GRE\\_east** in our example).\n\n![Modify Passthrough Tunnel screen](https://developers.cloudflare.com/_astro/modify-passthrough._Sp9J4KQ_ZkjeDa.webp)\n\n![Edit Virtual Tunnel Interface screen](https://developers.cloudflare.com/_astro/edit-vti.BFWttrT1_NxkOo.webp)\n\n1. Define a GRE tunnel on the Cloudflare dashboard using the EdgeConnect appliance's public IP and the private IP pair /31 shared with the appliance.\n\n![GRE tunnels information for each branch](https://developers.cloudflare.com/_astro/gre-tunnels-edgeconnect.CPxCqhiR_dQp8a.webp)\n\nIPsec tunnel configuration\n\n![Diagram of GCP, Aruba Orchestratror, and Cloudflare products for IPsec tunnels](https://developers.cloudflare.com/_astro/gcp-edgeconnect-diagram-ipsec.CZWCUCOA_1Qfzux.webp)\n\nFor additional information on creating IPsec tunnels, refer to [API documentation for IPsec tunnels](https://developers.cloudflare.com/api/resources/magic_transit/subresources/ipsec_tunnels/methods/create/).\n\n* `X-Auth-Email`: Your Cloudflare email ID\n* `X-Auth-Key`: Seen in the URL (`dash.cloudflare.com/<X-Auth-Key>/....`)\n* `Account key`: Global API token in Cloudflare dashboard\n\n1. Test new IPsec tunnel creation",
      "language": "unknown"
    },
    {
      "code": "1. Create a new IPsec tunnel",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "1. Generate Pre Shared Key (PSK) for tunnel\n\nUse the tunnel ID from the response in Step 2. Save the pre-shared key generated in this step as you will need it to set up tunnels on the Orchestrator.",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "**Create an IPsec tunnel on EdgeConnect**\n\nYou can create a tunnel after the Business Intent Overlay policies have been defined. Use the correct policy or service created in [configure overlay policy](#2-configure-overlay-policies). The local IP is the local WAN interface of the EdgeConnect device, and the remote IP is the Cloudflare public IP assigned as the tunnel endpoint.\n\n![Modify Passthrough Tunnel dialog with General values](https://developers.cloudflare.com/_astro/general-modify-passthrough.3ViqT0DH_Z1CHaiN.webp)\n\n![Modify Passthrough Tunnel dialog with IKE values](https://developers.cloudflare.com/_astro/ike-modify-passthrough.BbQLufk__BXURg.webp)\n\n![Modify Passthrough Tunnel dialog with IPsec values](https://developers.cloudflare.com/_astro/ipsec-modify-passthrough.gtfn_fS__Z90jp1.webp)\n\n**Create a Virtual Tunnel Interface (VTI) on the EdgeConnect appliance**\n\n![Values for Edit VTI Interface](https://developers.cloudflare.com/_astro/vti-interface-ipsec.R28dnfpw_Z1EQNdC.webp)\n\n## 4. Create static routes on Cloudflare and EdgeConnect\n\nGRE tunnel configuration\n\n1. Define static routes on the Cloudflare dashboard for the LAN subnet(s) attached to the EdgeConnect appliance. Use the private IP pair for the EdgeConnect tunnel endpoint.\n\n   In the example below, the traffic to subnet `10.3.0.0/16` attached to the **east\\_branch** EdgeConnect appliance has a next hop of `10.40.8.10`.\n\n![Static route information for each branch](https://developers.cloudflare.com/_astro/static-routes-cf.7x1mHyLW_wg3qp.webp)\n\n1. Define static routes on the Orchestrator so Cloudflare can route traffic between sites.\n\n   In the example below, we create a route for the subnet `10.30.0.0/24` on the **west\\_branch** to be routed via the established GRE tunnel between the EdgeConnect appliance and Cloudflare.\n\n![Static route information for each branch](https://developers.cloudflare.com/_astro/static-routes-edgeconnect.UNNAmHeW_18j552.webp)\n\nIPsec tunnel configuration\n\n![Static route values from Cloudflare dashboard](https://developers.cloudflare.com/_astro/static-routes-ipsec.QCWLampc_gKkPv.webp)\n\n**Static routes for central branch on EdgeConnect**\n\n![Static route values from EdgeConnect for central branch](https://developers.cloudflare.com/_astro/static-routes-central-ipsec.DXXq0rMA_24j8QC.webp)\n\n**Static routes for west branch on EdgeConnect**\n\n![Static route values from EdgeConnect for west branch](https://developers.cloudflare.com/_astro/static-routes-west-ipsec.DEkt69AP_103xKH.webp)\n\n## 5. Validate traffic flow\n\nGRE tunnel configuration\n\n**Validate Secure Web Gateway**\n\nTo validate traffic flow from the local subnet through Cloudflare's Secure Web Gateway, perform a curl as show in the example below.\n\n![Curl example for validating Secure Web Gateway](https://developers.cloudflare.com/_astro/validate-swg-curl.K6-tj_O9_Z1QbWM8.webp)\n\nYou can validate the request went through Gateway with the presence of the `Cf-Team` response header, or by looking at the logs in the dashboard under **Logs** > **Gateway** > **HTTP**.\n\n![Dashboard example for validating Secure Web Gateway](https://developers.cloudflare.com/_astro/dash-validate-swg.CyAEktkx_87B87.webp)\n\n**Validate east-west traffic**\n\nTo validate east-west traffic flow, perform a traceroute as shown in the example.\n\n![Traceroute example for verifying east-west traffic](https://developers.cloudflare.com/_astro/validate-traceroute.B1qfKEZn_Z14GqQm.webp)\n\nThe example shows a client in GCP East (`10.3.0.3`), which can ping the private IP of a client in GCP West (`10.30.0.4`).\n\nThe traceroute shows the path going from the client (`10.3.0.3`) to:\n\n* the GCP East lan0 IP on the EdgeConnect (`10.3.0.2`)\n* the Cloudflare private GRE endpoint IP (`10.4.8.11`)\n* the GCP West lan0 IP on the West EdgeConnect (`10.30.0.3`)\n* the GCP West client (`10.30.0.4`)\n\nThis validates the east-west traffic flow through Cloudflare Magic WAN.\n\nIPsec tunnel configuration\n\n**Validate Secure Web Gateway**\n\nTo validate traffic flow from the local subnet through Cloudflare's Secure Web Gateway, perform a cURL as shown in the example below.\n\n![cURL example for validating traffic](https://developers.cloudflare.com/_astro/static-routes-west-ipsec.DEkt69AP_103xKH.webp)\n\nYou can validate the request was sent through Secure Web Gateway with the presence of the `Cf-Team` response header or by looking at the logs in the dashboard under **Logs** > **Gateway** > **HTTP**.\n\n![Dashboard example for validating Secure Web Gateway](https://developers.cloudflare.com/_astro/dash-validation-ipsec.5ZgrnH6b_Z1NpSYA.webp)\n\n**Validate east-west traffic**\n\nTo validate east-west traffic flow, perform a traceroute as shown in the example.\n\n![Traceroute example for IPsec validation](https://developers.cloudflare.com/_astro/traceroute-ipsec.DIQvLqN1_Z1ccpF4.webp)\n\nThe example shows a client in GCP Central (`10.22.0.9`), which can ping the private IP of a client in GCP West (`10.77.0.10`).\n\nThe traceroute shows the path going from the client (`10.22.0.9`) to:\n\n* the GCP Central lan0 IP on the EdgeConnect (`10.22.0.2`)\n* the Cloudflare private IPsec endpoint IP (`192.168.10.11`)\n* the GCP West EdgeConnect private IPsec endpoint IP (`192.168.15.10`)\n* the GCP West client (`10.77.0.10`)\n\nThis validates the east-west traffic flow through Cloudflare Magic WAN.\n\n## 6. Cloudflare policies\n\nAt this point, the GRE or IPsec tunnels should be connected from the EdgeConnect appliances to Cloudflare's global network, and traffic is scoped to route over the tunnels using the EdgeConnect Business Intent Overlays.\n\nTo begin filtering traffic and gathering analytics, refer to the [Magic Firewall documentation](https://developers.cloudflare.com/magic-firewall/) to learn how to create filters for east-west inter-branch traffic and the [Secure Web Gateway documentation](https://developers.cloudflare.com/cloudflare-one/traffic-policies/) to learn how to configure Gateway policies if you decide to send traffic from your local private subnets to the Internet through Cloudflare Gateway.\n\n</page>\n\n<page>\n---\ntitle: Amazon AWS Transit Gateway  Cloudflare Magic WAN docs\ndescription: This tutorial provides information and examples of how to configure\n  IPsec VPN between Cloudflare Magic WAN with an AWS Transit Gateway.\nlastUpdated: 2025-10-31T13:37:27.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/aws/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/aws/index.md\n---\n\nThis tutorial provides information and examples of how to configure IPsec VPN between Cloudflare Magic WAN with an AWS Transit Gateway.\n\n## Prerequisites\n\nYou need to have an AWS transit gateway created in your AWS account. This is needed to route traffic between your AWS virtual private cloud (VPC) and Cloudflare Magic WAN. Refer to the [AWS documentation](https://docs.aws.amazon.com/vpc/latest/tgw/tgw-getting-started.html) to learn more about creating a transit gateway.\n\nAdditionally, you also need to configure the necessary route table entries for the virtual machine (VM) in your AWS virtual private cloud, as well the route table entries for the transit gateway. Otherwise, connectivity between your VM and another VM routed via Magic WAN will not work. Refer to the [AWS documentation](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Route_Tables.html) to learn more about routing tables.\n\n## AWS\n\n### Create AWS transit gateway VPN attachment\n\n1. Go to **Transit gateways** > **Transit gateway attachments**, and select **Create transit gateway attachment**.\n\n2. Select the **Transit gateway ID** that you created previously from the dropdown.\n\n3. For **Attachment type**, select *VPN*.\n\n4. Under VPN attachment, select the following settings (you can leave settings not mentioned here with their default values):\n\n   1. **Customer Gateway**: Select **New**.\n   2. **IP Address**: Enter your Cloudflare anycast IP address.\n   3. **Routing options**: Select **Static**.\n\n5. Select **Create transit gateway attachment**.\n\n### Configure the VPN connection\n\n1. Select the VPN connection you created > **Download configuration**.\n\n2. This action downloads a text file. Search for the IP range that the AWS Transit Gateway assigned your tunnel. The first IP range should be the one used by the AWS Transit Gateway. Use the second IP range to configure your [Interface address](#ipsec-tunnels) in Magic WAN.\n\n3. Select the VPN connection you created > **Actions** > **Modify VPN tunnel options**.\n\n4. From the **VPN tunnel outside IP address** drop-down menu, choose one of tunnels.\n\n5. Take note of the **IP address** you chose, as this corresponds to the customer endpoint IP that you will need to configure on the Cloudflare side of the IPsec tunnel.\n\n6. The number of options for the VPN connection will expand. Take note of the **Pre-shared key**. You will need it to create the IPsec tunnel on Cloudflare's side.\n\n7. In **Inside IPv4 CIDR**, AWS enforces that only a `/30` block within the `169.254.0.0/16` range can be used. To accommodate this, Cloudflare supports a subset of this IP block. Namely, Cloudflare supports `169.254.240.0/20` to be assigned as the IPsec tunnel's (internal) interface IPs. This example will use `169.254.244.0/30` as the CIDR block for the IPsec tunnel: `169.254.244.1` for the AWS side of the tunnel, and `169.254.244.2` for the Cloudflare side of the tunnel.\n\n   Warning\n\n   Make sure you input an IP address supported by Cloudflare. If you do not input a value here, AWS will randomly generate an IP address that might not be supported by Cloudflare.\n\n8. Configure the following settings for the IPsec tunnel. Note that the **Startup action** needs to be set to **Start**, which means the AWS side will initiate IPsec negotiation. Settings not mentioned here can be left at their default settings:\n\n   * **Phase 1 encryption algorithms**: `AES256-GCM-16`\n   * **Phase 2 encryption algorithms**: `AES256-GCM-16`\n   * **Phase 1 integrity algorithms**: `SHA2-256`\n   * **Phase 2 integrity algorithms**: `SHA2-256`\n   * **Phase 1 DH group numbers**: `20`\n   * **Phase 2 DH group numbers**: `20`\n   * **IKE Version**: `ikev2`\n   * **Startup action**: **Start**\n   * **DPD timeout action**: `Restart`\n\n9. Select **Save changes**.\n\n10. Repeat the steps above to configure the second VPN connection. Use the second outside IP address, and make the appropriate changes to IP addresses as well when configuring Cloudflare's side of the tunnel.\n\nNote\n\nECMP over two VPN tunnels is not supported with a static routing configuration. You will need to configure dynamic routing for the VPN between the transit gateway and the customer gateway device. Refer to [AWS documentation](https://docs.aws.amazon.com/vpc/latest/tgw/tgw-transit-gateways.html) for more information.\n\n## Magic WAN\n\nAfter configuring the AWS transit gateway VPN connection and the tunnel as mentioned above, go to the Cloudflare dashboard and create the corresponding IPsec tunnel and static routes on the Magic WAN side.\n\n### IPsec tunnels\n\n1. Refer to [Add tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels) to learn how to add an IPsec tunnel. When creating your IPsec tunnel, make sure you define the following settings:\n\n   * **Tunnel name**: `tunnel01`\n   * **Interface address**: The `/30`CIDR block enforced by AWS (first usable IP is for the AWS side). For example, `169.254.244.2`.\n   * **Customer endpoint**: The IP address from AWS's VPN tunnel outside IP address. For example, `35.xx.xx.xx`.\n   * **Cloudflare endpoint**: Enter the first of your two anycast IPs.\n   * **Pre-shared key**: Choose **Use my own pre-shared key**, and enter the PSK you created for the AWS VPN tunnel.\n   * **Health check type**: Choose **Request**\n   * **Health check direction**: Choose **Bidirectional**\n   * **Replay protection**: Select **Enabled**.\n\n2. Select **Save**.\n\n3. Repeat the above steps for `tunnel02`. Chose the same prefix, but select the second IPsec tunnel for **Tunnel/Next hop**.\n\n### Static routes\n\nThe static route in Magic WAN should point to the appropriate virtual machine (VM) subnet you created inside your AWS virtual private cloud. For example, if your VM has a subnet of `192.168.192.0/26`, you should use it as the prefix for your static route.\n\nTo create a static route:\n\n1. Refer to [Create a static route](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-routes/#create-a-static-route) to learn how to create one.\n2. In **Prefix**, enter the subnet for your VM. For example, `192.xx.xx.xx/24`.\n3. For the **Tunnel/Next hop**, choose the IPsec tunnel you created in the previous step.\n4. Repeat the steps above for the second IPsec tunnel you created.\n\n</page>\n\n<page>\n---\ntitle: Microsoft Azure  Cloudflare Magic WAN docs\ndescription: \"Microsoft Azure integration guides currently available:\"\nlastUpdated: 2025-01-29T15:37:29.000Z\nchatbotDeprioritize: true\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/azure/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/azure/index.md\n---\n\nMicrosoft Azure integration guides currently available:\n\n* [Microsoft Azure Virtual WAN](https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/azure/azure-virtual-wan/)\n* [Microsoft Azure VPN Gateway](https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/azure/azure-vpn-gateway/)\n\n</page>\n\n<page>\n---\ntitle: Cisco IOS XE  Cloudflare Magic WAN docs\ndescription: This tutorial contains a configuration example for setting up an\n  IPsec tunnel between Cisco IOS XE and Cloudflare. For this tutorial, the\n  tested Cisco IOS XE software was version 17.03.07.\nlastUpdated: 2025-10-17T13:46:10.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/cisco-ios-xe/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/cisco-ios-xe/index.md\n---\n\nThis tutorial contains a configuration example for setting up an IPsec tunnel between Cisco IOS XE and Cloudflare. For this tutorial, the tested Cisco IOS XE software was version 17.03.07.\n\nYou should replace peer addresses with the anycast IP addresses assigned to your account. For example:\n\n* **Anycast 01**: `162.159.###.###`\n* **Anycast 02**: `172.64.###.###`\n\n## Cisco IOS XE configuration example",
      "language": "unknown"
    },
    {
      "code": "### Establish IPsec behind a NAT or CGNAT with port `4500`\n\nIf your Cisco router is behind a NAT or CGNAT and you need to establish a connection on port `4500`, you can use the `nat force-encap`command.\n\nAdd the `nat force-encap`command when setting up the `crypto ikev2 profile` for your tunnels:",
      "language": "unknown"
    },
    {
      "code": "## Diagnostic output: show crypto session detail",
      "language": "unknown"
    },
    {
      "code": "## Diagnostic output: show crypto session remote `<ANYCAST 01>` detail",
      "language": "unknown"
    },
    {
      "code": "## Diagnostic output: show crypto session remote `<ANYCAST 02>` detail",
      "language": "unknown"
    },
    {
      "code": "## Troubleshooting\n\nIf you notice connectivity issues after rebooting your Cisco router, your IPsec Security Associations (SAs) might be out of sync. Cisco recommends that you enable the Invalid Security Parameter Index (SPI) recovery feature to solve this issue. To do so, add the following lines to your configuration file:",
      "language": "unknown"
    },
    {
      "code": "Refer to [Cisco's documentation](https://www.cisco.com/c/en/us/support/docs/security-vpn/ipsec-negotiation-ike-protocols/115801-technote-iosvpn-00.html) for more information.\n\n</page>\n\n<page>\n---\ntitle: Furukawa Electric FITELnet  Cloudflare Magic WAN docs\ndescription: This tutorial describes how to configure the Furukawa Electric's\n  FITELnet F220 and F70 devices to connect to Cloudflare Magic WAN via IPsec\n  tunnels. The use cases described in this tutorial are for both east-west\n  (branch to branch) and north-south (Internet-bound).\nlastUpdated: 2025-10-31T13:37:27.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/fitelnet/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/fitelnet/index.md\n---\n\nThis tutorial describes how to configure the Furukawa Electric's FITELnet F220 and F70 devices to connect to Cloudflare Magic WAN via IPsec tunnels. The use cases described in this tutorial are for both east-west (branch to branch) and north-south (Internet-bound).\n\n## Testing environment\n\nThese configurations were tested on FITELnet F220 and F70 series with the following firmware versions:\n\n* **F220 series**: Version 01.11(00)\n* **F70 series**: Version 01.09(00)\n\n## IPsec configuration\n\n### Magic WAN configuration\n\n1. Follow the [Add tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels) instructions to create the required IPsec tunnels with the following options:\n\n2. For the first IPsec tunnel, ensure the following settings are defined:\n\n   * **Tunnel name**: `FITEL-tunnel-1`\n   * **Interface address**: Enter `10.0.0.1/31` for your first tunnel.\n   * **Customer endpoint**: This setting is not required unless your router is using an IKE ID of [type `ID_IPV4_ADDR`](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/).\n   * **Cloudflare endpoint**: The Cloudflare anycast IP assigned to you by your account team.\n   * **Pre-shared key**: Create a pre-shared key for your first tunnel.\n\n3. For the second IPsec tunnel, make the same changes as you did for the first tunnel, and ensure these additional setting is defined:\n\n   * **Tunnel name**: `FITEL-tunnel-2`\n   * **Interface address**: Enter `10.0.0.3/31` for your second tunnel.\n   * **Customer endpoint**: This setting is not required unless your router is using an IKE ID of [type `ID_IPV4_ADDR`](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/).\n   * **Cloudflare endpoint**: The Cloudflare anycast IP assigned to you by your account team.\n   * **Pre-shared key**: Create a pre-shared key for your second tunnel.\n\n### FITELnet router configuration\n\n#### Router 1 settings\n\nUse the CLI to configure these settings:",
      "language": "unknown"
    },
    {
      "code": "#### Router 2 settings\n\nUse the CLI to configure these settings:",
      "language": "unknown"
    },
    {
      "code": "## Static route configuration\n\nTo configure routes for east-west (branch to branch) connections, refer to the following settings.\n\n### Magic WAN\n\n1. Follow the [Configure static routes](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-routes/#create-a-static-route) instructions to create a static route.\n2. For the first route, ensure the following settings are defined:\n\n* **Prefix**: `192.168.0.0/24`\n* **Tunnel/Next hop**: *FITEL-tunnel-1 / 10.0.0.0*\n\n1. For the second route, ensure the following settings are defined:\n\n* **Prefix**: `192.168.1.0/24`\n* **Tunnel/Next hop**: *FITEL-tunnel-2 / 10.0.0.2*\n\n### FITELnet router configuration\n\n#### Router 1\n\nUse the CLI to configure these settings:",
      "language": "unknown"
    },
    {
      "code": "#### Router 2\n\nUse the CLI to configure these settings:",
      "language": "unknown"
    },
    {
      "code": "## Connection test\n\n### IPsec status\n\nIn the FITELnet router CLI, you can run `show crypto sa` to check the status of the IPsec security associations (SAs). `Total number of ISAKMP/IPSEC SA` shows the number of established SAs.",
      "language": "unknown"
    },
    {
      "code": "### Route Status\n\nIn the FITELnet router CLI, you can run `show ip route` to check the route information. A `*` in the route information indicates that the route information is valid.",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Fortinet  Cloudflare Magic WAN docs\ndescription: This tutorial provides information and examples of how to configure\n  Cloudflare Magic WAN with IPsec tunnels in conjunction with Fortinet FortiGate\n  firewalls.\nlastUpdated: 2025-10-31T13:37:27.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/fortinet/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/fortinet/index.md\n---\n\nThis tutorial provides information and examples of how to configure Cloudflare Magic WAN with IPsec tunnels in conjunction with Fortinet FortiGate firewalls.\n\nThe FortiGate configuration settings presented here support [bidirectional health checks](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels) as required by Cloudflare Magic WAN. However, they do not factor in any other traffic flows outside of the tunnel health checks. The configuration may need to be adjusted based on your current FortiGate configuration.\n\n## Testing Environment\n\nThe FortiGate configuration was tested on two different FortiGate firewalls:\n\n* FortiGate Virtual Appliance version 7.0.8, running on VMware ESXi 6.5\n* FortiGate FG80F, version 7.0.12\n\n## Magic WAN configuration\n\nThe first step to setting up Magic WAN is to add IPsec tunnels and Magic static routes to your Cloudflare account via the dashboard or API.\n\nBefore proceeding, ensure that you have the anycast IPs associated with your account. Check with your Cloudflare account team if you do not yet have them.\n\n### Magic IPsec Tunnels\n\nCloudflare recommends customers configure two Magic IPsec tunnels per firewall/router - one to each of the two anycast IP addresses.\n\n1. Follow the [Add tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels) instructions to create the required IPsec tunnels with the following options:\n\n   * **Health check type**: Change to *Request*.\n   * **Replay Protection**: Do not change from the default setting.\n\n### Magic static routes\n\nAdd two Magic static routes to define the IP address space that exists behind the Magic IPsec tunnels - one to each of the two Magic IPsec tunnels defined in the previous section.\n\nBy default, the Magic static routes are defined with the priority set to `100`. Cloudflare leverages [Equal Cost Multipath Routing (ECMP)](https://developers.cloudflare.com/magic-wan/reference/traffic-steering/#equal-cost-multi-path-routing) and will load balance the traffic equally across the two tunnels. If you prefer to use an Active/Passive model, you can leave the default value for the first route set to `100`, and set the value for the second tunnel to `150` (higher value is a lower priority).\n\n1. Follow the [Configure static routes](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-routes/#create-a-static-route) instructions to create a static route.\n\n2. For the first route, ensure the following settings are defined:\n\n   * **Prefix**: Specify the [RFC1918](https://datatracker.ietf.org/doc/html/rfc1918) subnet that exists behind the first Magic IPsec tunnel you have defined in the previous section.\n   * **Tunnel/Next hop**: Select your first tunnel (Tunnel 01 of 02).\n\n3. For the second route, ensure the following settings are defined:\n\n   * **Prefix**: Specify the [RFC1918](https://datatracker.ietf.org/doc/html/rfc1918) subnet that exists behind the second Magic IPsec tunnel defined in the previous section.\n   * **Tunnel/Next hop**: Select your second tunnel (Tunnel 02 of 02).\n\n## Fortinet FortiGate configuration\n\n### Enable asymmetric routing\n\nTo ensure health checks work as expected, enable asymmetric routing for ICMP. This option is required. Otherwise, the tunnel health checks which are critical for proper Magic WAN functionality will not work as designed.\n\nNote that enabling asymmetric routing will affect FortiGate behavior. To learn more, refer to [How FortiGate behaves when asymmetric routing is enabled](https://community.fortinet.com/t5/FortiGate/Technical-Note-How-the-FortiGate-behaves-when-asymmetric-routing/ta-p/198575).",
      "language": "unknown"
    },
    {
      "code": "### Configure NAT-T (optional)\n\nIf you have NAT traversal (NAT-T) on your network, you need to enable this feature and initiate IKE communications on port `4500`.\n\nTo set the IKE port, add the following to your system settings:",
      "language": "unknown"
    },
    {
      "code": "To enable NAT-T, add `set nattraversal enable` to the IPsec tunnels you are configuring.",
      "language": "unknown"
    },
    {
      "code": "Refer to [Fortinet's documentation](https://community.fortinet.com/t5/FortiGate/Technical-Tip-IPSec-VPN-NAT-traversal/ta-p/197873) for more details.\n\n### Disable anti-replay protection\n\nFor route-based IPsec configurations, you will need to disable anti-replay protection. The command below disables anti-replay protection globally, but you can also do this per firewall policy. Refer to Fortinet's documentation on [anti-replay support per policy](https://community.fortinet.com/t5/FortiGate/Technical-Tip-Anti-Replay-option-support-per-policy/ta-p/191435) to learn more.",
      "language": "unknown"
    },
    {
      "code": "### IPsec tunnels\n\nMagic IPsec tunnels leverage a route-based site-to-site VPN model. This model relies on the use of virtual tunnel interfaces and routing to define the traffic that flows across the IPsec tunnels.\n\nConfigure two IPsec tunnels using the `phase1-interface` and `phase2-interface` objects.\n\nNote\n\nRefer to the Cloudflare Magic WAN dashboard to obtain the FQDN ID value when specifying the `localid` attribute/value pair in the `phase1-interface` configuration. To find this value go to **Tunnels** in the Cloudflare dashboard. Then, find your IPsec tunnel and expand it to reveal all the information associated to it.\n\n[Go to **Configuration**](https://dash.cloudflare.com/?to=/:account/magic-wan/configuration)\n\nThe following examples assume `wan1` is the external/egress interface of the FortiGate firewall.\n\n#### Add Phase 1 interfaces\n\n`MWAN_IPsec_Tun1` corresponds to Tunnel 01 of 02 added earlier in the Cloudflare section of the configuration. `MWAN_IPsec_Tun2` corresponds to Tunnel 02 of 02 added earlier in the Cloudflare section of the configuration.",
      "language": "unknown"
    },
    {
      "code": "#### Add Phase 2 interfaces\n\nAdd two `phase2-interfaces` - one for each of the two `phase1-interfaces` as follows:",
      "language": "unknown"
    },
    {
      "code": "### Network interfaces\n\n#### Virtual tunnel interfaces\n\nConfigure the virtual tunnel interfaces that were automatically added when specifying the `set net-device enable` within the `phase1-interface` settings.\n\nThese are the only settings that should need to be added to the virtual tunnel interfaces:\n\n* `ip`: The local IP address (specify with a `/32` netmask - `255.255.255.255`).\n* `remote-ip`: The value associated with the interface address specified earlier in the Magic IPsec tunnels section (specify with a `/31` netmask - `255.255.255.254`).\n* `alias`: This value is optional.\n\nThe following examples assume `wan1` is the external/egress interface of the FortiGate firewall.",
      "language": "unknown"
    },
    {
      "code": "### Validate communication across virtual tunnel interfaces\n\nOnce the virtual tunnel interfaces have been configured, you should be able to ping the IP address associated with the `remote-ip` attribute.\n\nBelow you have examples of a successful result from pinging across both of the virtual tunnel interfaces configured in the previous section:\n\n#### MWAN\\_IPsec\\_Tun1",
      "language": "unknown"
    },
    {
      "code": "#### MWAN\\_IPsec\\_Tun2",
      "language": "unknown"
    },
    {
      "code": "### Zone objects (optional)\n\nThis sample configuration assumes there are three zones configured on the FortiGate firewall. These zone objects are used in the policies referenced later in this document:\n\n* `Trust_Zone`: Contains the LAN interface(s).\n* `Untrust_Zone`: Contains the WAN interface.\n* `Cloudflare_Zone`: Contains both IPsec Tunnel interfaces.",
      "language": "unknown"
    },
    {
      "code": "### Create Address Objects\n\nCreate Address Objects to represent the [Cloudflare IPv4 address space](https://www.cloudflare.com/ips) as well as objects for the bidirectional health check anycast IPs:",
      "language": "unknown"
    },
    {
      "code": "### Configure Address Group Object\n\nCreate an Address Object that contains all of the Cloudflare IPv4 subnets as specified in the previous section. You can copy/paste the CLI commands below into an SSH terminal and the objects will get created automatically:",
      "language": "unknown"
    },
    {
      "code": "### Add security policy\n\nAdd a firewall rule to permit the ICMP traffic associated with the reply style bidirectional health checks.\n\nNote\n\nThis example assumes this rule is the second rule in the firewall policy (`edit 2`). If you opt to copy/paste the example into an SSH session, edit the numeric value associated with the rule position accordingly.",
      "language": "unknown"
    },
    {
      "code": "### Policy-based routing\n\nPolicy-based routing rules are required to ensure the traffic associated with the bidirectional health checks received over a Magic IPsec tunnel is sent back across the same Magic IPsec tunnel.\n\nAdd two policy-based routing rules, one for each of the two Magic IPsec tunnels.\n\nNote\n\nThis example assumes the rules below are the first and second rules respectively (`edit 1` and `edit 2`). If you opt to copy/paste the example into an SSH session, edit the numeric value associated with the rule position accordingly.",
      "language": "unknown"
    },
    {
      "code": "## Monitor Cloudflare Magic IPsec tunnel health checks\n\nThe Cloudflare dashboard monitors the health of all anycast tunnels on your account that route traffic from Cloudflare to your origin network. Refer to [Check tunnel health in the dashboard](https://developers.cloudflare.com/magic-wan/configuration/common-settings/check-tunnel-health-dashboard/) for more information.\n\n## Troubleshooting\n\n### Packet Capture\n\nPacket captures allow you to determine whether or not the policy-based routing rules are working as expected.\n\nNote\n\nDue to the nature of the reply-style tunnel health checks, you will see ICMP Reply packets in both the ingress and egress direction. This is expected behavior.\n\nThe expected behavior should look like the examples below - traffic ingressing Tunnel 01 of 02 should egress the same tunnel.",
      "language": "unknown"
    },
    {
      "code": "Conversely, traffic ingressing Tunnel 02 of 02 should egress the same tunnel:",
      "language": "unknown"
    },
    {
      "code": "### Flow Debugging\n\nFlow debugging can be helpful when it comes to determining whether or not traffic is ingressing/egressing the firewall via the expected path. It takes steps much further than the sniffer packet captures in the previous section, but it creates a tremendous amount of logging and should only be enabled when absolutely necessary.\n\nAdditionally, customers will likely need to contact Fortinet technical support for assistance with interpreting the flow debug logs, as well as to obtain recommendations in terms of how to configure FortiGate to ensure flows are routed correctly based on the application's requirements.",
      "language": "unknown"
    },
    {
      "code": "### Disable Flow Debugging\n\nThe typical use of `CTR + C` will not stop Flow Debugging.\n\nYou can disable Flow Debugging simply by typing the following at any point while the debug logs are scrolling by:",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Google Cloud VPN  Cloudflare Magic WAN docs\ndescription: This tutorial provides information and examples of how to configure\n  IPsec VPN between Cloudflare Magic WAN with a GCP Cloud VPN.\nlastUpdated: 2025-10-31T13:37:27.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/google/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/google/index.md\n---\n\nThis tutorial provides information and examples of how to configure IPsec VPN between Cloudflare Magic WAN with a GCP Cloud VPN.\n\n## Prerequisites\n\nYou need to have a GCP VPN gateway created in your GCP account. This is needed to route traffic between your GCP virtual private cloud (VPC) and Cloudflare Magic WAN. Refer to the [GCP documentation](https://cloud.google.com/network-connectivity/docs/vpn/how-to/creating-static-vpns) to learn more about creating a Cloud VPN gateway.\n\nA Classic VPN Gateway is required to support static routing. Route tables will also need to be manually configured to allow the routing between the VPN and Cloudflare Magic WAN to work. Refer to [GCP routing options](https://cloud.google.com/network-connectivity/docs/vpn/concepts/choosing-networks-routing#ts-tun-routing) to learn more about GCP VPC routing.\n\n## Google Cloud Platform\n\n### Create a GCP Cloud VPN Gateway\n\n1. Go to **Network Connectivity** > **VPN**.\n2. Select the **Cloud VPN Gateways** tab > **Create VPN Gateway**.\n3. Give your gateway a descriptive name.\n4. Choose the network you want to connect to with this Cloud VPN Gateway (VPC).\n5. Select a region where this Cloud VPN Gateway should be located.\n6. Choose **IPv4** as the IP traffic type that will flow through this Gateway.\n\nNote\n\nCloudflare Magic WAN does not yet support private routing via IPv6.\n\n### Configure the VPN connection\n\n1. Go to **Network Connectivity** > **VPN**.\n2. Select the **Cloud VPN Tunnels** tab > **Create VPN Tunnel**.\n3. Select the VPN Gateway you have created > **Continue**.\n4. Give your tunnel a descriptive name.\n5. For **Remote Peer IP Address**, use one of the public anycast Magic WAN IPs given to you by your account team.\n6. In **IKE version**, select **IKEv2**.\n7. You can generate an IKE pre-shared key, or add one you already own. If you generate one during this set up, keep it somewhere safe since you will need it in other steps to finish setting up Magic WAN and GCP.\n8. Choose **Route-based** as routing option.\n9. In **Remote network IP range** define the network you are going to expose to GCP via Cloudflare Magic WAN.\n\nNote\n\nYou can add new IP ranges once the VPN object is created. They will need to be created as VPC routes using this VPN connection (refer to the **Static Routes** section).\n\n1. Repeat the same process using your second Cloudflare anycast IP.\n\n### Static Routes\n\nStatic routing is necessary to route traffic between your VPN and Cloudflare Magic WAN. Follow these steps to create them for your VPC. Refer to [VPN route documentation](https://cloud.google.com/vpc/docs/routes) to learn more about VPN routing.\n\n1. Go to **VPN Network** > **Routes**.\n2. Select **Route Management**.\n3. Create a route.\n4. Choose the VPC network you want to use for that route.\n5. In **Route type** select **Static Routing**.\n6. In **IP Version** select **IPv4**.\n7. Configure the network you want to expose to your VPN in the **Destination IPv4 Range**.\n8. Choose a priority for your static route.\n9. (Optional) You can link that route to a specific instance tag, so only impacted instances will use that route.\n10. In **Next hop** select the VPN tunnel you created previously.\n11. Select **Create**.\n\n## Magic WAN\n\nAfter configuring the Cloud VPN gateway VPN and the tunnels as mentioned above, go to the Cloudflare dashboard and create the corresponding IPsec tunnels and static routes on the Magic WAN side.\n\n### IPsec tunnels\n\n1. Refer to [Add tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels) to learn how to add an IPsec tunnel. When creating your IPsec tunnel, make sure you define the following settings:\n\n   * **Tunnel name**: `tunnel01`\n   * **Interface address**: The IPsec tunnel inner `/30`CIDR block. For example, `169.254.244.2`.\n   * **Customer endpoint**: The IP address from GCP VPN tunnel outside IP address. For example, `35.xx.xx.xx`.\n   * **Cloudflare endpoint**: Enter the first of your two anycast IPs.\n   * **Pre-shared key**: Choose **Use my own pre-shared key**, and enter the PSK you created for the GCP VPN tunnel.\n   * **Health check type**: Choose **Reply**\n   * **Health check destination**: Choose **custom** and set the IP corresponding to the interface address for the tunnel\n   * **Health check direction**: Choose **Bidirectional**\n   * **Replay protection**: Select **Enabled**.\n\n2. Select **Save**.\n\n3. Repeat the above steps for `tunnel02`. Chose the same prefix, but select the second IPsec tunnel for **Tunnel/Next hop**.\n\nNote\n\nDo not forget to create a route in the corresponding GCP VPC covering for the healthcheck configuration of the tunnel. The route subnet should match the interface address CIDR of the Magic WAN tunnel (`169.254.244.2` in the example above).\n\nRefer to the **Static Routes** section for more detail on how to create a VPC route leading to your newly created tunnel.\n\n### Static routes\n\nThe static route in Magic WAN should point to the appropriate virtual machine (VM) subnet you created inside your GCP virtual private cloud. For example, if your VM has a subnet of `192.168.192.0/26`, you should use it as the prefix for your static route.\n\nTo create a static route:\n\n1. Refer to [Create a static route](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-routes/#create-a-static-route) to learn how to create one.\n2. In **Prefix**, enter the subnet for your VM. For example, `192.xx.xx.xx/24`.\n3. For the **Tunnel/Next hop**, choose the IPsec tunnel you created in the previous step.\n4. Repeat the steps above for the second IPsec tunnel you created.\n\n</page>\n\n<page>\n---\ntitle: Juniper Networks SRX Series Firewalls  Cloudflare Magic WAN docs\ndescription: This tutorial provides information and examples of how to configure\n  Juniper Networks SRX Series Firewalls with Magic WAN.\nlastUpdated: 2025-10-31T13:37:27.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/juniper/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/juniper/index.md\n---\n\nThis tutorial provides information and examples of how to configure Juniper Networks SRX Series Firewalls with Magic WAN.\n\nThe configuration settings in this document are based on JUNOS 23.4R2.13.\n\n## Prerequisites\n\nConfirm that you have two Cloudflare anycast IPs allocated to your account. You will establish IPsec tunnels to the two anycast IPs irrespective of the location of your Juniper SRX devices (from now on referred to as endpoint)  traffic will be naturally attracted to the closest Cloudflare colocation facility via BGP anycast.\n\nCloudflare recommends that customers configure two IPsec tunnels (one to each of the two anycast IPs allocated to you Cloudflare account) per Internet service provider per endpoint. This provides tunnel redundancy.\n\nEqual-cost multi-path routing (ECMP) ensures traffic is load-balanced across the tunnels, and you can control traffic steering across the tunnels through route prioritization.\n\nCloudflare supports route-based site-to-site IPsec tunnels, which require the creation of virtual tunnel interfaces (VTIs). We recommend you select one subnet per Magic IPsec tunnel with either a `/30` or `/31` netmask.\n\nUsing a `/31` netmask is a more efficient use of IP addresses as it doubles the number of available subnets compared to a `/30`netmask. This is possible because with a `/31`netmask there is no need to reserve IP addresses for the subnet and broadcast addresses, as there would be if you opt to use a `/30` netmask. Additional details can be found in [RFC 3021 - Using 31-Bit Prefixes on IPv4 Point-to-Point Links](https://datatracker.ietf.org/doc/html/rfc3021).\n\n## Cloudflare Magic WAN configuration\n\nThis section of the document will cover the configuration of:\n\n* Magic IPsec tunnels\n* Magic static routes\n\n### Magic WAN topology\n\nThis documentation assumes there are two locations connected via Magic WAN:\n\n| Site | Local/Remote | Security Zone | Subnet |\n| - | - | - | - |\n| A | Local | trust | `10.1.20.0/24` |\n| B | Remote | Cloudflare | `10.1.100.0/24` |\n\n### Magic IPsec tunnels\n\n1. Start by [creating the IPsec tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels) in the Cloudflare dashboard with the following values:\n\n   * **Tunnel name**: Up to 15 characters (no spaces).\n   * **Description** (Optional).\n   * **Interface address**: This is the Virtual Tunnel Interface (VTI = `st0.x`) RFC 1918 address  the IP address specified in this dialog box is the address on the Cloudflare side of the tunnel.\n   * **Customer endpoint**: Specify the Internet IP address on the untrust side of the SRX firewall.\n   * **Cloudflare endpoint**: One of the two Cloudflare anycast IP addresses.\n   * **Pre-shared key**: Choose **Add pre-shared key later**.\n\n2. Select **Add IPsec Tunnel** and fill in the values for the second tunnel to the same Juniper SRX:\n\n   * Ensure you use a unique RFC 1918 IP address for the Interface Address (`/31` or `/30`).\n   * Once again, specify the Internet IP address on the untrust side of the SRX firewall for the **Customer Endpoint**.\n   * The **Cloudflare Endpoint** for the second tunnel will be the second Cloudflare anycast IP provisioned for your account.\n\n3. Select **Add Tunnels**. We also recommend selecting **Test Tunnels** to ensure that the settings do not conflict with any other tunnels defined in your account and that you specified the correct anycast IP addresses.\n\n4. You will see a warning indicator next to the tunnel names after creating them because we chose to add a pre-shared key later. This is expected behavior and indicates that a pre-shared key has not been generated yet for the associated tunnel.\n\n5. Select **Edit** next to one of the tunnels to generate a pre-shared key.\n\n6. Select **Generate a new pre-shared key** > **Update and generate a pre-shared key**. Make a note of the pre-shared key and store it somewhere safe.\n\n   Note\n\n   You can update the pre-shared key at any time by repeating this step. Just make sure to add the new value of the new pre-shared key to the corresponding tunnel configuration on the Juniper device.\n\n7. Repeat the previous step for the second tunnel.\n\n8. Expand the first tunnel's properties and note the **Tunnel ID** and **FQDN ID** values.\n\n9. Repeat the previous steps for the second tunnel.\n\n   Note\n\n   The **Tunnel ID** and **FQDN ID** values are unique per tunnel and remain unchanged unless you delete and recreate the tunnel. Generating a new Pre-Shared Key will not change the values.\n\n### Magic static routes\n\nRefer to the Magic WAN Topology section above for more details on the IP subnet scheme.\n\n[Magic static routes](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-routes/#create-a-static-route) effectively tell Magic WAN which tunnels to route traffic destined for a given Magic WAN site.\n\nSince two tunnels are configured to each endpoint, it is necessary to configure two static routes.\n\nCloudflare leverages [equal-cost multi-path](https://developers.cloudflare.com/magic-wan/reference/traffic-steering/) routing to control traffic steering across the tunnels. The default priority for each route is 100  traffic will be load-balanced across the two tunnels equally via ECMP. You can modify the priorities as needed, however best practices dictate leaving the default values in place.\n\n1. Create a static route with the following values. Make sure you select the first tunnel in **Tunnel/Next hop**:\n\n   * **Description:** The description for the static route assigned to your first tunnel.\n   * **Prefix**: Enter the destination subnet for which this route is intended. For this example, it is `10.1.20.0/24` as stated above.\n   * **Tunnel/Next hop**: Choose your first tunnel from the drop-down menu.\n   * **Priority**: The default value is `100`.\n   * **Region code**: Leave set to **All Regions** unless otherwise specified.\n\n2. Select **Add Static Route** to add a second route for the same subnet. Make sure the second tunnel is selected in **Tunnel/Next hop**.\n\n3. Select **Test Routes** to ensure the settings are accepted, then select **Add Routes**.\n\n4. Confirm the routes were added correctly in **Magic WAN** > **Configuration** > **Static Routes**.\n\n## Juniper SRX configuration\n\nThere may be some differences in the syntax of the commands in the version on your SRX devices. However, the principles are the same. Refer to the Juniper product documentation for more information.\n\nThe interface naming convention for VTI interfaces (also known as Secure Tunnel Interfaces) in Junos is `st0.x`.\n\n[Secure Tunnel Interface in a Virtual Router - Juniper IPsec VPN User Guide](https://www.juniper.net/documentation/us/en/software/junos/vpn-ipsec/topics/topic-map/security-secure-tunnel-interface-in-a-virtual-router.html)\n\nThe following elements will be configured on the Juniper SRX firewall(s):\n\n* Ensure the LAN interface is in the `trust` zone\n* Add virtual tunnel Interfaces (`st0.0` and `st0.1`)\n* Assign tunnel interfaces to the `cloudflare` security zone\n* Allow required protocols to both the tunnel and untrust security zones\n* IKE configuration\n* IPsec configuration\n* Policy-based routing (filter-based forwarding)\n* Security policies\n\n### Tunnel interfaces\n\n1. Add two tunnel interfaces:",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "### Security Zone (Cloudflare) - tunnel interfaces\n\nDefine a security zone and add both tunnel interfaces to it. At a minimum, the interfaces should allow `ping`, but this zone only contains point-to-point connections between the firewall and the customer network namespace. Setting it to `all` for system-services and protocols should be fine.",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "### Security zone (untrust) - `host-inbound-traffic`\n\nAdd `ping` and `ike` to the security zone containing the external interface used to establish the IPsec tunnels to Cloudflare.",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "### IKE - Phase 1\n\n#### IKE proposal\n\nAdd an IKE proposal that specifies the [Phase 1 Configuration Parameters](https://developers.cloudflare.com/magic-wan/reference/gre-ipsec-tunnels/#supported-configuration-parameters):",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "#### IKE policies\n\nDefine two IKE policies - one for each of the two Magic IPsec tunnels:\n\n\\***Tunnel 1 (SRX300\\_IPSEC\\_01)**",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "**Tunnel 2 (SRX300\\_IPSEC\\_02)**",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "#### IKE gateways\n\nDefine two IKE gateways  one for each of the two Magic IPsec tunnels. In the examples below, note the use of the **FQDN ID** value obtained from the Cloudflare dashboard in the `local-identity` hostname setting.\n\n**Tunnel 1 (SRX300\\_IPSEC\\_01)**",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "**Tunnel 2 (SRX300\\_IPSEC\\_02)**",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "### Phase 2 - IPsec\n\n#### IPsec proposal\n\nAdd an IPsec proposal that specifies the [Phase 2 Configuration Parameters](https://developers.cloudflare.com/magic-wan/reference/gre-ipsec-tunnels/#supported-configuration-parameters):",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "#### IPsec Policy\n\nDefine one IPsec policy  reference the IPsec proposal created above.",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "#### IPsec VPN tunnels\n\nDefine two IPsec policies - one for each of the two Magic IPsec tunnels. It is crucial to ensure that:\n\n* [Anti-replay](https://developers.cloudflare.com/magic-wan/reference/anti-replay-protection/) protection is disabled.\n  * Use the [`no-anti-replay`](https://www.juniper.net/documentation/us/en/software/junos/interfaces-adaptive-services/topics/ref/statement/no-anti-replay-edit-services.html) option.\n\n* The SRX is the tunnel initiator:\n\n  * Cloudflare will not instantiate the tunnel\n  * If the SRX does not initiate the tunnel, then the tunnel will not be established until there is an attempt to connect to resources through the tunnel\n  * Use [`establish-tunnels immediately`](https://www.juniper.net/documentation/us/en/software/junos/interfaces-adaptive-services/topics/ref/statement/establish-tunnels-edit-services-ipsec-vpn.html) to ensure the SRX is the tunnel initiator.\n\n**VPN Tunnel 1 (cf\\_magic\\_wan\\_ipsec\\_tun\\_01)**",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "**VPN Tunnel 2 (cf\\_magic\\_wan\\_ipsec\\_tun\\_02)**",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "### Policy-Based Routing\n\nThe SRX platform provides policy-based routing functionality, which Juniper refers to as [filter-based forwarding](https://www.juniper.net/documentation/us/en/software/junos/routing-policy/topics/concept/firewall-filter-option-filter-based-forwarding-overview.html).\n\nFilter-based forwarding is implemented by configuring the following:\n\n1. **Routing Instance**: Specify the routing table(s) to which a packet is forwarded and the destination to which the packet is forwarded at the \\[edit routing-instances] hierarchy level.\n2. **Firewall Filter**: Use a stateless firewall filter to specify the source and destination addresses in conjunction with a routing instance that forwards traffic across the Magic IPsec tunnels, then bind the firewall filter to the ingress interface (trust zone).\n3. **RIB Group**: Share interface routes with the forwarding routing instances used in filter-based forwarding (FBF).\n\nNote\n\nFirewall filters must incorporate at least two terms:\n\n* **Term 1**: Classify the traffic to forward to Magic WAN\n* **Term 2**: Permit all other traffic  otherwise, the firewall filters will discard any traffic not intended for Magic WAN destinations.\n\nThis configuration only factors in one local site (`10.1.20.0/24`). In this example, we assume devices in the trust zone must route traffic to a remote subnet at another Magic WAN-protected site (`10.1.100.0/24`).\n\nDefine a static route on the SRX to route traffic to `10.1.100.0/24` with redundant routes referencing each of the two tunnels.\n\n**Routing Instance:**\n\n[Routing Instances](https://www.juniper.net/documentation/us/en/software/junos/routing-overview/topics/concept/routing-instances-overview.html) effectively add additional routing tables to the SRX platform.\n\nAs mentioned earlier, any traffic destined for other Magic WAN protected sites must be routed over the Magic IPsec tunnels.\n\nThe example includes two static routes - one to each of the two VTIs on the Cloudflare side of the Magic IPsec Tunnels (`10.252.2.20` and `10.252.2.22`).\n\nWhile it is possible to be more prescriptive in terms of the destination subnets, we simply use `0.0.0.0/0` as the firewall filter ensures only traffic destined for `10.1.100.0/24` will be forwarded to the routing instance. Any other traffic not destined for `10.1.100.0/24` will continue to the primary routing table (`inet.0`) as it falls outside the scope of the firewall filter configured in the next section below.\n\nLeaving the destination subnet as `0.0.0.0/0` eases some administrative burden as you only need to modify the firewall filter to specify which traffic is destined for Magic WAN.",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "**Firewall Filter:**\n\nIn this step, we create a stateless firewall filter to ensure only packets from `10.1.20.0/24` destined for `10.1.100.0/24` are sent to the `MAGIC_WAN_RI` routing instance.\n\n* **Term 1** - `MAGIC_WAN_NETS` ensures only packets from `10.1.20.0/24` destined for `10.1.100.0/24` are sent to the `MAGIC_WAN_RI` routing instance. Take note of the `count` statement defined in this term. [Count](https://www.juniper.net/documentation/us/en/software/junos/routing-policy/topics/example/firewall-filter-stateless-example-act-on-sampling.html) allows you to view how many packets are processed by this term in the firewall filter. An example of how to view the Counter is included below.\n* **Term 2** - `ALLOW_EVERYTHING_ELSE` ensures all other traffic continues to the primary routing table (`inet.0`).",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "**View Firewall Filter Counters**\n\nTo view the firewall filter counter:",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "**Bind Firewall Filter to the interface in the** **trust** **zone:**",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "**RIB Group:**\n\nRIB Groups allow you to concatenate the contents of multiple routing tables into a routing table group.\n\nThe primary routing table in the RIB group should be `inet.0` followed by the secondary routing table `MAGIC_WAN_RI.inet.0` which is the `MAGIC_WAN_RI` routing-instance created above.\n\n[Interface Routes](https://www.juniper.net/documentation/us/en/software/junos/cli-reference/topics/ref/statement/interface-routes-edit-routing-options.html) referenced below by the `interface-routes` statement determines which interfaces and Routing Instances are bound to the RIB Group.",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "### Security policies\n\nDefine security policies to permit traffic flows destined for Magic WAN-protected resources. The source/destination zones must incorporate the zone containing the tunnel interfaces.\n\nThere are two very simple rules to allow traffic bidirectionally  it is generally recommended to start with a similar policy and then add more stringent rules once general connectivity is established successfully.\n\n**From Zone:** *Cloudflare* **To Zone:** *trust*",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "**From Zone:** *trust* **To Zone:** *Cloudflare*",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "## Troubleshooting\n\n### Validate tunnel connectivity\n\nThere are several diagnostic commands available to view the status of IPsec tunnels.\n\n#### Ping across virtual tunnel interfaces\n\nUse ping to test connectivity from the SRX side of the tunnel to the Cloudflare side of the tunnel. Ensure you use the source option to specify the IP address associated with tunnel interfaces `st0.0` and `st0.1`, respectively:\n\n**Tunnel 1** - `st0.0 - 10.252.2.21`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "**Tunnel 2** - `st0.1 - 10.252.2.23`",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "#### Phase 1 - View Active Peers\n\n[`show security ike active-peer`](https://www.juniper.net/documentation/us/en/software/junos/cli-reference/topics/ref/command/show-security-ike-active-peer.html)",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "#### Phase 1 - View IKE Security Associations\n\n[`show security ike security-associations`](https://www.juniper.net/documentation/us/en/software/junos/cli-reference/topics/ref/command/show-security-ike-security-associations.html)",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "#### Phase 2 - View IPsec Security Associations\n\n[`show security ipsec security-associations`](https://www.juniper.net/documentation/us/en/software/junos/vpn-ipsec/topics/ref/command/show-security-ipsec-security-associations.html)",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "### IKE `traceoptions`\n\nIt can be very helpful to enable debug logging via traceoptions while setting up the tunnels. The log data can help determine if there are issues and, if so, where they might be occurring.\n\nPlease note that some errors in the log are benign. The types of errors to look for are those related to authentication or encryption/integrity (that is, no proposal chosen).\n\n#### Enable IKE `traceoptions`\n\n[traceoptions (Security IKE)](https://www.juniper.net/documentation/us/en/software/junos/cli-reference/topics/ref/statement/security-edit-traceoptions-ike.html)",
      "language": "unknown"
    },
    {
      "code": "The log file can be viewed by doing the following:\n\n1. From an operational mode, run **start shell**.\n\n2. Use the `tail` command to view the contents of the log file in real-time:",
      "language": "unknown"
    },
    {
      "code": "3. Press `CTRL + C` when finished.\n\n4. Type `exit` to return to the operational mode prompt.\n\nEither deactivate `traceoptions` or delete `traceoptions` once debugging is complete.\n\n#### Deactivate IKE `traceoptions`",
      "language": "unknown"
    },
    {
      "code": "Confirm `traceoptions` is deactivated with:",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "### IPsec `traceoptions`\n\nRefer to [traceoptions (Security IPsec)](https://www.juniper.net/documentation/us/en/software/junos/cli-reference/topics/ref/statement/security-edit-traceoptions-ipsec.html) for more information on this topic.\n\n#### Enable IPsec `traceoptions`",
      "language": "unknown"
    },
    {
      "code": "To view the log file:\n\n1. From an operational mode, run `start shell`.\n2. Use the tail command to view the contents of the log file in real time: `tail -f /var/log/ipsec-debug.log`\n3. Press `CTRL + C` when finished.\n4. Type `exit` to return to the operational mode prompt.\n\nEither deactivate `traceoptions` or delete `traceoptions` once debugging is complete.\n\n#### Delete IPsec `traceoptions`",
      "language": "unknown"
    },
    {
      "code": "#### Deactivate IPsec `traceoptions`",
      "language": "unknown"
    },
    {
      "code": "Confirm `traceoptions` is deactivated:",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Oracle Cloud  Cloudflare Magic WAN docs\ndescription: This tutorial provides information and examples of how to configure\n  IPsec between Cloudflare Magic WAN and an Oracle Cloud Site-to-site VPN.\nlastUpdated: 2025-10-31T13:37:27.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/oracle/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/oracle/index.md\n---\n\nThis tutorial provides information and examples of how to configure IPsec between Cloudflare Magic WAN and an Oracle Cloud Site-to-site VPN.\n\n## Prerequisites\n\nYou need a pre-shared key to establish the IPsec tunnel. You can use the following code to create a random key:",
      "language": "unknown"
    },
    {
      "code": "Warning\n\nThe code above is an example of how you might generate a random key. However, make sure you generate a key that is strong enough to comply with your security needs.\n\nYou can try this code in the [Workers playground](https://workers.cloudflare.com/playground#LYVwNgLglgDghgJwgegGYHsHALQBM4RwDcABAEbogB2+CAngLzbPYDqApmQNJQQBimYACFKNRHSoBzAB4ArAEoBBANYR5AEVYAJAOJCAagA0AXCxYduvAVhHVaEmQpVrNug4YCwAKADC6KhDsAdjqUADOMOhhvFD+xiQYWHgExCRUcMDsDABEUDTs0gB0smHZpKhQYEEZWbn5RSXZ3n4BQRDYACp0MOzxcDAwYFAAxgSxVMiycABucGHDCLAQANTA6Ljg7N7eBZFIJLjsqHDgECQA3l4AkHMSwwnsEMMAFgAUAJQXXtdXw-5hZzgJAYaXYAHcSABVPIQAAcigQCDgdFeABZYe8iD8Ft0IOhCpJHvI4DR0MB9HAwCB2GFXnBMT8qmcyHN2AA2VEAZQgiykwPIeLgr25vMkhVQCDJPmeiD8h0K-UGKKo4DAABoSPSGT8WWF2VyeXlJPzdfqRUbCgh2IM4MN2K9kAAdZbISQagDk7vePyuvr9JADlutYFt9qdyFdHq9Pr9voDJCDNrtDoYkZInu1vr+VABCTylPNfJBpo5hbFYRAZABoteAAYNQBmABMmauVogIAQVFBEPkNMiOftFXSYDLGsufue7DghwQYXiE792WzgWCEG67Gy8WygWkKGeEGAYGyap9AF9T76zwyrhevGesd4zMwLDx+IJbGJ6FI5EpVBptD0Ixmn8Vd2lCCIohiOIEkEZJCFIdJMhyTJCHwQgyjzKokNqMgwHQMgml8UC2k6Dc+gGIZRmgfxJjCfxti8c5lzJeBoDISpeDoAB9dDN2MbIm1rJtUWwWsGzEgB2E8WOANioA4oZ1241AQ0kUpjAAbWyKh1nYEpuL+OSCGyABdNVsmAOA8m4tYNiqLc6kOBpSjPJ9n1fKwP1Eewfycf9XCAwxmG8IA).\n\n## Oracle Cloud\n\n### 1. Create Oracle Cloud customer-premises equipment\n\n1. Go to **Networking** > **Customer connectivity**, and select **Customer-premises equipment**.\n\n2. Select **Create CPE**.\n\n3. Select the following settings (you can leave settings not mentioned here with their default values):\n\n   * **Name**: Enter a name.\n   * **IP Address**: Enter your Cloudflare anycast IP address.\n   * **CPE vendor information**: Select **Other**.\n\n4. Select **Create CPE**.\n\n### 2. Create Oracle Cloud dynamic routing gateways\n\n1. Go to **Networking** > **Customer connectivity**, and select **Dynamic routing gateways**.\n2. Select **Create Dynamic routing gateways**.\n3. Select the following settings (you can leave settings not mentioned here with their default values):\n   * **Name**: Enter a name.\n4. Select **Create Dynamic routing gateways**.\n\n### 3. Create an IPsec connection\n\n1. Go to **Networking** > **Customer connectivity**, and select **Site-to-Site VPN**.\n\n2. Select **Create IPsec connection**.\n\n3. Select the following settings (you can leave settings not mentioned here with their default values):\n\n   * **Name**: Enter a name.\n\n   * **Customer-premises equipment**: Select the CPE you have created in step 1.\n\n   * **Dynamic routing gateways**: Select the DRG you have created in step 2.\n\n   * **Routes to your on-premises network**: Enter a CIDR range you want to route to Magic WAN.\n\n   * **Tunnel 1**\n\n     * **Name**: Enter a name.\n\n     * Select **Provide custom shared secret**.\n\n     * Enter the **pre-shared key** you created in the Prerequisites section.\n\n     * **IKE version**: **IKEv2**\n\n     * **Routing type**: **Static routing**\n\n     * **IPv4 inside tunnel interface - CPE**: Enter the internal tunnel IP on the Cloudflare side of the IPsec tunnel. In this example, it is `10.200.1.0/31`.\n\n     * **IPv4 inside tunnel interface - Oracle**: Enter the internal tunnel IP on the Oracle side of the IPsec tunnel. In this example, it is `10.200.1.1/31`. This matches with the Cloudflare side for this tunnel.\n\n       1. Select **Show advanced options**\n\n       2. Select **Phase one (ISAKMP) configuration**\n\n          * Select **Set custom configurations**\n          * **Custom encryption algorithm**: **AES\\_256\\_CBC**\n          * **Custom authentication algorithm**: **SHA2\\_256**\n          * **Custom Diffie-Hellman group**: **GROUP20**\n          * **IKE session key lifetime in seconds**: **86400**\n\n       3. Select **Phase two (IPsec) configuration**\n\n          * Select **Set custom configurations**\n          * **Custom encryption algorithm**: **AES\\_256\\_CBC**\n          * **HMAC\\_SHA2\\_256\\_128**: **HMAC\\_SHA2\\_256\\_128**\n          * **IPsec session key lifetime in seconds**: **28800**\n          * **Perfect forward secrecy Diffie-Hellman group**: **GROUP20**\n\n   * **Tunnel 2**\n     * Repeat the above steps for Tunnel 2. Select the right IP for **IPv4 inside tunnel interface - CPE**: `10.200.2.0/31` and **IPv4 inside tunnel interface - Oracle**: `10.200.2.1/31`\n\n4. Select **Create IPsec connection**\n\n## Magic WAN\n\nAfter configuring the Oracle Site-to-site VPN connection and the tunnels as mentioned above, go to the Cloudflare dashboard and create the corresponding IPsec tunnel and static routes on the Magic WAN side.\n\n### IPsec tunnels\n\n1. Refer to [Add tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels) to learn how to add an IPsec tunnel. When creating your IPsec tunnel, make sure you define the following settings:\n\n   * **Tunnel name**: Enter a name.\n   * **Interface address**: Enter the internal tunnel IP on the Cloudflare side of the IPsec tunnel. In this example, it is `10.200.1.0/31`.\n   * **Customer endpoint**: The Oracle VPN public IP address.\n   * **Cloudflare endpoint**: Enter your Cloudflare anycast IP address.\n   * **Health check type**: **Request**\n   * **Health check direction**: **Unidirectional**\n   * **Health check target**: **Default**\n   * **Pre-shared key**: Choose **Use my own pre-shared key**, and enter the pre-shared key you created in the Prerequisites section.\n   * **Replay protection**: **Enabled**.\n\n2. Select **Add tunnels**.\n\n3. Repeat the above steps for Tunnel 2. Chose the same Cloudflare anycast IP address and select the right IP for **Interface address**: `10.200.2.0/31`\n\n### Static routes\n\nThe static route in Magic WAN should point to the appropriate virtual machine (VM) subnet you created inside your Oracle Virtual Cloud Network (VCN). For example, if your VM has a subnet of `192.168.192.0/26`, you should use it as the prefix for your static route.\n\nTo create a static route:\n\n1. Refer to [Create a static route](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-routes/#create-a-static-route) to learn how to create one.\n2. In **Prefix**, enter the subnet for your VM. For example, `192.xx.xx.xx/24`.\n3. For the **Tunnel/Next hop**, choose the IPsec tunnel you created in the previous step.\n4. Repeat the steps above for the second IPsec tunnel you created.\n\n</page>\n\n<page>\n---\ntitle: Palo Alto Networks Next-Generation Firewall  Cloudflare Magic WAN docs\ndescription: This tutorial includes the steps required to configure IPsec\n  tunnels to connect a Palo Alto Networks Next-Generation Firewall (NGFW) to\n  Cloudflare Magic WAN through a Layer 3 deployment.\nlastUpdated: 2025-10-31T13:37:27.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/palo-alto/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/palo-alto/index.md\n---\n\nThis tutorial includes the steps required to configure IPsec tunnels to connect a Palo Alto Networks Next-Generation Firewall (NGFW) to Cloudflare Magic WAN through a Layer 3 deployment.\n\n## Software version tested\n\n* PAN-OS 9.1.14-h4\n\n## Use Cases\n\n* **Magic WAN**: Connecting two or more locations with [RFC-1918](https://datatracker.ietf.org/doc/html/rfc1918) private non-routable address space.\n* **Magic WAN with Cloudflare Zero Trust (Gateway egress)**: Same as Magic WAN, with the addition of outbound Internet access from Magic WAN protected sites egressing the Cloudflare edge network.\n\n## Prerequisites\n\nThis tutorial assumes you have a standalone NGFW with two network interfaces:\n\n* One in a trust security zone (`Trust_L3_Zone`) with an [RFC-1918](https://datatracker.ietf.org/doc/html/rfc1918) non-Internet routable IP address (internal network);\n* And the other in an untrust security zone (`Untrust_L3_Zone`) with a legally routable IP address (Internet facing).\n\nAdditionally, there must be a default gateway set on the Virtual Router (default) pointing to the router of your Internet service provider(s).\n\n## Environment\n\nThe following IP addresses are used throughout this tutorial. Any legally routable IP addresses have been replaced with IPv4 Address Blocks Reserved for Documentation ([RFC5737](https://datatracker.ietf.org/doc/html/rfc5737)) addresses within the `203.0.113.0/24` subnet.\n\n| Description | Address | Address |\n| - | - | - |\n| NGFW external interface | `203.0.113.254/24` | |\n| NGFW internal interface | `10.1.100.254/24` | |\n| Local trust subnet (LAN) | `10.1.100.0/24` | |\n| NGFW tunnel interface 01 | `10.252.2.26/31` (Cloudflare side) | `10.252.2.27/31` (NGFW side) |\n| NGFW tunnel interface 02 | `10.252.2.28/31` (Cloudflare side) | `10.252.2.29/31` (NGFW side) |\n| Magic WAN anycast IP | `162.159.66.164` | `172.64.242.164` |\n| Magic WAN health check anycast IP | `172.64.240.253` | `172.64.240.254` |\n| VLAN0010 - remote Magic WAN site | `10.1.10.0/24` | |\n| VLAN0020 - remote Magic WAN site | `10.1.20.0/24` | |\n\n## Cloudflare Magic WAN\n\n### Magic IPsec Tunnels\n\nUse the Cloudflare dashboard or API to [configure two IPsec Tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels). The settings mentioned in [Add IPsec tunnels](#add-ipsec-tunnels) below are used for the IPsec tunnels referenced throughout the remainder of this guide.\n\nThese are the target IP addresses for bidirectional tunnel health checks:\n\n* `172.64.240.253`: Use with the primary IPsec tunnel.\n* `172.64.240.254`: Use with the secondary IPsec tunnel.\n\nWarning\n\nYou need to [configure bidirectional health checks](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels) with Magic WAN. The settings must include custom target IP addresses for each tunnel. Additionally, Cloudflare recommends that you lower the rate at which health check probes are sent.\n\n#### Add IPsec tunnels\n\n1. Follow the [Add tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/) instructions to create the required IPsec tunnels with the following options:\n\n   * **Tunnel name**: `SFO_IPSEC_TUN01`\n   * **Interface address**: `10.252.2.96/31`\n   * **Customer endpoint**: `203.0.113.254`\n   * **Cloudflare endpoint**: `162.159.66.164`\n   * **Health check rate**: *Low* (default value is *Medium*)\n   * **Health check type**: *Reply*\n   * **Health check target**: *Custom* (default is *Default*)\n   * **Target address**: `172.64.240.253`\n\n2. Select **Add pre-shared key later** > **Add tunnels**.\n\n3. Repeat the process to create a second IPsec tunnel with the following options:\n\n   * **Tunnel name**: `SFO_IPSEC_TUN02`\n   * **Interface address**: `10.252.2.98/31`\n   * **Customer endpoint**: `203.0.113.254`\n   * **Cloudflare endpoint**: `172.64.242.164`\n   * **Health check rate**: *Low* (default value is *Medium*)\n   * **Health check type**: *Reply*\n   * **Health check target**: *Custom* (default is *Default*)\n   * **Target address**: `172.64.240.254`\n\n#### Generate Pre-shared keys\n\nWhen you create IPsec tunnels with the option **Add pre-shared key later**, the Cloudflare dashboard will show you a warning indicator:\n\n![Magic IPsec Tunnels - No PSK](https://developers.cloudflare.com/_astro/03_magic_ipsec_tun_no_psk.BtN-GBSa_aKP0c.webp)\n\n1. Select **Edit** to edit the properties of each tunnel.\n2. Select **Generate a new pre-shared key** > **Update and generate pre-shared key**. ![Generatre a new pre-shared key for each of your IPsec tunnels](https://developers.cloudflare.com/_astro/04_magic_ipsec_tun_01_gen_psk.DmjWjXn7_16iC2z.webp)\n3. Copy the pre-shared key value for each of your IPsec tunnels, and save these values somewhere safe. Then, select **Done**. ![Take note of your pre-shared key, and keep it in a safe place](https://developers.cloudflare.com/_astro/05_magic_ipsec_tun_01_show_psk.hKhA9tvM_ZSIU09.webp)\n\n#### IPsec identifier - FQDN (Fully Qualified Domain Name)\n\nAfter creating your IPsec tunnels, the Cloudflare dashboard will list them under the **Tunnels** tab. Select the arrow (**>**) on each of your IPsec tunnel to collect the FQDN ID value from each of them. The FQDN ID value will be required when configuring IKE Phase 1 on the Palo Alto Networks Next-Generation Firewall.\n\n![Take note of the FQDN ID value for each of your IPsec tunnels](https://developers.cloudflare.com/_astro/08_magic_ipsec_tun_01_fqdn.C7qdzNJI_dLAfU.webp)\n\n### Magic Static Routes\n\nIf you refer to the [Environment section](#environment), you will notice there is one subnet within `Trust_L3_Zone`: `10.1.100.0/24`.\n\nCreate a [static route](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-routes/#create-a-static-route) for each of the two IPsec tunnels configured in the previous section, with the following settings (settings not mentioned here can be left with their default settings):\n\n#### Tunnel 01\n\n* **Description**: `SFO_VLAN100_01`\n* **Prefix**: `10.1.100.0/24`\n* **Tunnel/Next hop**: `SFO_IPSEC_TUN01`\n\n#### Tunnel 02\n\n* **Description**: `SFO_VLAN100_02`\n* **Prefix**: `10.1.100.0/24`\n* **Tunnel/Next hop**: `SFO_IPSEC_TUN02`\n\n![Add static routes for each of the IPsec tunnels you created in the previous step](https://developers.cloudflare.com/_astro/10_magic_ipsec_static_routes.CJCRbqXL_Z1yuHVG.webp)\n\n## Palo Alto Networks Next-Generation Firewall\n\n### Tags\n\nWhile [Tags are optional](https://docs.paloaltonetworks.com/pan-os/9-1/pan-os-admin/policy/use-tags-to-group-and-visually-distinguish-objects/create-and-apply-tags), they can greatly improve object and policy visibility. The following color scheme was implemented in this configuration:\n\n| Tag | Color |\n| - | - |\n| `Trust_L3_Zone` | Green |\n| `Untrust_L3_Zone` | Red |\n| `Cloudflare_L3_Zone` | Orange |\n\nUse the Palo Alto Networks Next-Generation Firewall command-Line to set the tags:",
      "language": "unknown"
    },
    {
      "code": "### Objects\n\nThe use of **Address** and **Address Group** objects wherever possible is strongly encouraged. These objects ensure that configuration elements that reference them are defined accurately and consistently.\n\nAny configuration changes should be applied to the objects and will automatically be applied throughout the remainder of the configuration.\n\n#### Address Objects\n\nNote\n\nAny objects without a netmask specified are `/32`.\n\n| Name | Type | Address | Tags |\n| - | - | - | - |\n| `CF_Health_Check_Anycast_01` | IP Netmask | `172.64.240.253` | `Cloudflare_L3_Zone` |\n| `CF_Health_Check_Anycast_02` | IP Netmask | `172.64.240.254` | `Cloudflare_L3_Zone` |\n| `CF_Magic_WAN_Anycast_01` | IP Netmask | `162.159.66.164` | `Cloudflare_L3_Zone` |\n| `CF_Magic_WAN_Anycast_02` | IP Netmask | `172.64.242.164` | `Cloudflare_L3_Zone` |\n| `CF_MWAN_IPsec_VTI_01_Local` | IP Netmask | `10.252.2.27/31` | `Cloudflare_L3_Zone` |\n| `CF_MWAN_IPsec_VTI_01_Remote` | IP Netmask | `10.252.2.26` | `Cloudflare_L3_Zone` |\n| `CF_MWAN_IPsec_VTI_02_Local` | IP Netmask | `10.252.2.29/31` | `Cloudflare_L3_Zone` |\n| `CF_MWAN_IPsec_VTI_02_Remote` | IP Netmask | `10.252.2.28` | `Cloudflare_L3_Zone` |\n| `CF_WARP_Client_Prefix` | IP Netmask | `100.96.0.0/12` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_01` | IP Netmask | `173.245.48.0/20` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_02` | IP Netmask | `103.21.244.0/22` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_03` | IP Netmask | `103.22.200.0/22` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_04` | IP Netmask | `103.31.4.0/22` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_05` | IP Netmask | `141.101.64.0/18` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_06` | IP Netmask | `108.162.192.0/18` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_07` | IP Netmask | `190.93.240.0/20` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_08` | IP Netmask | `188.114.96.0/20` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_09` | IP Netmask | `197.234.240.0/22` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_10` | IP Netmask | `198.41.128.0/17` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_11` | IP Netmask | `162.158.0.0/15` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_12` | IP Netmask | `104.16.0.0/13` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_13` | IP Netmask | `104.24.0.0/14` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_14` | IP Netmask | `172.64.0.0/13` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_15` | IP Netmask | `131.0.72.0/22` | `Cloudflare_L3_Zone` |\n| `Internet_L3_203-0-113-254--24` | IP Netmask | `203.0.113.254/24` | `Untrust_L3_Zone` |\n| `VLAN0010_10-1-10-0--24` | IP Netmask | `10.1.10.0/24` | `Cloudflare_L3_Zone` |\n| `VLAN0020_10-1-20-0--24` | IP Netmask | `10.1.20.0/24` | `Cloudflare_L3_Zone` |\n| `VLAN0100_10-1-100-0--24` | IP Netmask | `10.1.100.0/24` | `Trust_L3_Zone` |\n| `VLAN0100_L3_10-1-100-254--24` | IP Netmask | `10.1.10.254/24` | `Trust_L3_Zone` |\n\nUse the Palo Alto Networks Next-Generation Firewall command-Line to set the objects:",
      "language": "unknown"
    },
    {
      "code": "#### Address Group object\n\nThe **Address Group** object used in this configuration provides a single object representation of the entire Cloudflare IPv4 public address space.\n\n| Name | Type | Addresses | Tags |\n| - | - | - | - |\n| `Cloudflare_IPv4_Static_Grp` | Static | `Cloudflare_IPv4_01` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_Static_Grp` | Static | `Cloudflare_IPv4_02` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_Static_Grp` | Static | `Cloudflare_IPv4_03` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_Static_Grp` | Static | `Cloudflare_IPv4_04` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_Static_Grp` | Static | `Cloudflare_IPv4_05` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_Static_Grp` | Static | `Cloudflare_IPv4_06` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_Static_Grp` | Static | `Cloudflare_IPv4_07` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_Static_Grp` | Static | `Cloudflare_IPv4_08` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_Static_Grp` | Static | `Cloudflare_IPv4_09` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_Static_Grp` | Static | `Cloudflare_IPv4_10` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_Static_Grp` | Static | `Cloudflare_IPv4_11` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_Static_Grp` | Static | `Cloudflare_IPv4_12` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_Static_Grp` | Static | `Cloudflare_IPv4_13` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_Static_Grp` | Static | `Cloudflare_IPv4_14` | `Cloudflare_L3_Zone` |\n| `Cloudflare_IPv4_Static_Grp` | Static | `Cloudflare_IPv4_15` | `Cloudflare_L3_Zone` |\n\nUse the Palo Alto Networks Next-Generation Firewall command-Line to set the address group object:",
      "language": "unknown"
    },
    {
      "code": "Note\n\nWhile not covered by this tutorial, it is also possible to use External Dynamic Lists to automatically obtain the most current list of Cloudflare IPv4 addresses by periodically polling <https://www.cloudflare.com/ips-v4>.\n\n### Interface Mgmt - Network Profiles\n\n**Interface Mgmt** profiles control what traffic is allowed *to* the firewall, as opposed to *through* the firewall.\n\nAdding an Interface Mgmt profile to the tunnel interfaces will provide the ability to ping the Virtual Tunnel Interface on your firewall(s).\n\n#### Set up via dashboard\n\nYou can define an Interface Management Profile to allow ping from the dashboard:\n\n1. Go to **Network Profiles** > **Interface Mgmt**.\n2. In the **Network** tab select **Add**.\n3. Create profiles to allow Ping, and in the **Network Services** group select **Ping**.\n\n![Interface Mgmt Profile](https://developers.cloudflare.com/_astro/01_int_mgmt_prof.YUAT08zt_Z2ruNjF.webp) ![Interface Mgmt Profile](https://developers.cloudflare.com/_astro/02_int_mgmt_prof.Ciz0_Zwm_Z1d8wtW.webp)\n\n#### Set up via command line\n\nYou can also use the command line to allow ping:",
      "language": "unknown"
    },
    {
      "code": "### Network Interfaces\n\nPalo Alto Networks Next-Generation Firewall (NGFW) is configured with two Ethernet interfaces:\n\n| Interface | Interface Type | IP Address | Virtual Router |\n| - | - | - | - |\n| ethernet1/1 | Layer3 | `10.1.100.254/24` | default |\n| ethernet1/2 | Layer3 | `203.0.113.254/24` | default |\n\n#### Set up via dashboard\n\nFollow the guidance on the images below to set up the Ethernet interfaces through the dashboard.\n\n##### ethernet1/1: `Trust_L3_Zone`\n\n| Name | Option | Value |\n| - | - | - |\n| **ethernet1/1** | Interface Type | *Layer3* |\n| | Netflow Profile | *None* |\n| **Config tab** | Virtual Router | *default* |\n| | Security Zone | *Trust\\_L3\\_Zone* |\n| **IPv4 tab** | Type | **Static** |\n| | IP | `VLAN0100_L3_10-1-100-254--24` address object |\n| **Advanced tab** | Management Profile | *Mgmt\\_Services* |\n\n![Set up ethernet1/1 on the dashboard](https://developers.cloudflare.com/_astro/01_ethernet-1-1_page1.1VA7M8cP_FgL8P.webp)![Set up ethernet1/1 on the dashboard](https://developers.cloudflare.com/_astro/02_ethernet-1-1_page2.7jxa3xfp_jcLoB.webp)![Set up ethernet1/1 on the dashboard](https://developers.cloudflare.com/_astro/03_ethernet-1-1_page3.CokR1vvm_2QT9f.webp)\n\n##### ethernet1/2: `Untrust_L3_Zone`\n\n| Name | Option | Value |\n| - | - | - |\n| **ethernet1/2** | Interface Type | *Layer3* |\n| | Netflow Profile | *None* |\n| **Config tab** | Virtual Router | *default* |\n| | Security Zone | *Untrust\\_L3\\_Zone* |\n| **IPv4 tab** | Type | **Static** |\n| | IP | `Internet_L3_203-0-113-254--24` address object |\n| **Advanced tab** | Management Profile | *Allow\\_Ping* |\n| | MTU | `576 - 1500` |\n| | Adjust TCP MSS | **Enable** |\n| | IPv4 MSS Adjustment | `64` |\n\n![Set up ethernet1/2 on the dashboard](https://developers.cloudflare.com/_astro/04_ethernet-1-2_page1.By0-oLRS_ZafJek.webp)![Set up ethernet1/2 on the dashboard](https://developers.cloudflare.com/_astro/05_ethernet-1-2_page2.BUQ0TYrt_1uRhr1.webp)![Set up ethernet1/2 on the dashboard](https://developers.cloudflare.com/_astro/06_ethernet-1-2_page3.lN-Y3jvL_ZHX3aI.webp)\n\nAfter setting up your Ethernet interfaces, they should show up on the overview page:\n\n![Ethernet Interfaces - Overview](https://developers.cloudflare.com/_astro/07_ethernet_interfaces_overview.B03fT-27_1UC97w.webp)\n\n#### Set up via command line\n\nYou can also use the command line to set up the Ethernet interfaces.",
      "language": "unknown"
    },
    {
      "code": "### Tunnel interfaces\n\nEstablishing IPsec Tunnels to Cloudflare Magic WAN requires two tunnel interfaces - one to each of the two Cloudflare anycast IP addresses. You also have to ensure that `Allow_Ping` is bound to both tunnel adapters in **Advanced** > **Managementt Profile**.\n\nReview the images below for more information.\n\nNote\n\nMTU is set to `1450`. This value may need to be adjusted for optimal performance on your network.\n\n#### Set up via dashboard\n\n##### tunnel.1 - `Cloudflare_L3_Zone`\n\n| Name | Option | Value |\n| - | - | - |\n| **tunnel.1** | Netflow Profile | *None* |\n| **Config tab** | Virtual Router | *default* |\n| | Security Zone | *Cloudflare\\_L3\\_Zone* |\n| **IPv4 tab** | IP | `CF_MWAN_IPsec_VTI_01_Local` address object |\n| **Advanced tab** | Management Profile | *Allow\\_Ping* |\n| | MTU | `1450` |\n\n![Set up tunnel 1](https://developers.cloudflare.com/_astro/01_tunnel_1_page1.CeB5lZ8G_OiV2A.webp)![Set up tunnel 1](https://developers.cloudflare.com/_astro/02_tunnel_1_page2.DTmX2oQG_Z251Mqn.webp)![Set up tunnel 1](https://developers.cloudflare.com/_astro/03_tunnel_1_page3.B-KN29cx_Z22Q2rq.webp)\n\n##### tunnel.2 - `Cloudflare_L3_Zone`\n\n| Name | Option | Value |\n| - | - | - |\n| **tunnel.2** | Netflow Profile | *None* |\n| **Config tab** | Virtual Router | *default* |\n| | Security Zone | *Cloudflare\\_L3\\_Zone* |\n| **IPv4 tab** | IP | `CF_MWAN_IPsec_VTI_02_Local` address object |\n| **Advanced tab** | Management Profile | *Allow\\_Ping* |\n| | MTU | `1450` |\n\n![Set up tunnel 2](https://developers.cloudflare.com/_astro/04_tunnel_2_page1.ChXQsll2_2cS7Dq.webp)![Set up tunnel 2](https://developers.cloudflare.com/_astro/05_tunnel_2_page2.5MNYKPA6_wuF87.webp)![Set up tunnel 2](https://developers.cloudflare.com/_astro/06_tunnel_2_page3.Dv0L63U8_E4Yub.webp)\n\nAfter setting up your Tunnel interfaces, they should show up on the overview page:\n\n![Tunnel Interfaces - Overview](https://developers.cloudflare.com/_astro/07_tunnel_interfaces_overview.CNcfvGAr_24K2FG.webp)\n\n#### Set up via command line\n\nYou can also set up your tunnels in the command line:",
      "language": "unknown"
    },
    {
      "code": "### Zones\n\nThe Palo Alto Networks Next-Generation Firewall (NGFW) used to create this tutorial includes the following zones and corresponding network interfaces:\n\n| Zone | Interface | Interface |\n| - | - | - |\n| `Trust_L3_Zone` | ethernet1/1 | |\n| `Untrust_L3_Zone` | ethernet1/2 | |\n| `Cloudflare_L3_Zone` | tunnel.1 | tunnel.2 |\n\nThe tunnel interfaces are placed in a separate zone to facilitate the configuration of more granular security policies. The use of any other zone for the tunnel interfaces will require adapting the configuration accordingly.\n\nNote\n\nAny Magic WAN protected networks that are not local should be considered part of the `Cloudflare_L3_Zone`.\n\n#### Set up via dashboard\n\n##### `Trust_L3_zone`\n\n| Name | Option | Value |\n| - | - | - |\n| `Trust_L3_zone` | Log setting | *None* |\n| | Type | *Layer3* |\n| | Interfaces | **ethernet1/1** |\n| | Zone Protection Profile | *None* |\n\n![The Palo Alto interface showing the Trust\\_L3\\_Zone](https://developers.cloudflare.com/_astro/01_trust_zone.CtMShlqH_Z2ib2xD.webp)\n\n##### `Untrust_L3_zone`\n\n| Name | Option | Value |\n| - | - | - |\n| `Untrust_L3_zone` | Log setting | *None* |\n| | Type | *Layer3* |\n| | Interfaces | **ethernet1/2** |\n| | Zone Protection Profile | *Untrust\\_Zone\\_Prof* |\n\n![The Palo Alto interface showing the Untrust\\_L3\\_Zone](https://developers.cloudflare.com/_astro/02_untrust_zone.BFBnvKrn_Z1VVK2X.webp)\n\n##### `Cloudflare_L3_zone`\n\n| Name | Option | Value |\n| - | - | - |\n| `Cloudflare_L3_zone` | Log setting | *None* |\n| | Type | *Layer3* |\n| | Interfaces | **tunnel.1** **tunnel.2** |\n| | Zone Protection Profile | *None* |\n\n![The Palo Alto interface showing the Cloudflare\\_L3\\_Zone](https://developers.cloudflare.com/_astro/03_cloudflare_zone.UclPW1ul_zAunJ.webp)![The Palo Alto interface showing the Tunnel Interfaces overview section](https://developers.cloudflare.com/_astro/04_zones_overview.CePNdHuU_1QWC0n.webp)\n\n#### Set up via command line\n\nYou can also use the command line to associate zones and interfaces:",
      "language": "unknown"
    },
    {
      "code": "### Apply Changes\n\nThis would be a good time to save and commit the configuration changes made so far. Once complete, make sure you test basic connectivity to and from the firewall.\n\n### IKE crypto profile Phase 1\n\nAdd a new IKE crypto profile to support the required parameters for Phase 1.\n\nMultiple DH groups and authentication settings are defined in the desired order. Palo Alto Networks Next-Generation Firewall (NGFW) will automatically negotiate the optimal settings based on specified values.\n\n#### Set up via dashboard\n\n| Name | Option | Value |\n| - | - | - |\n| `CF_IKE_Crypto_CBC` | DH Group | **group20** |\n| | Authentication | **sha512** **sha384** **sha256** |\n| | Encryption | **aes-256-cbc** |\n| | Key Lifetime | 24 hours |\n| | IKEv2 Authentication Multiple | `0` |\n\n#### Set up via command line\n\nYou can also set up the crypto profile for Phase 1 via the command line:",
      "language": "unknown"
    },
    {
      "code": "### IPsec crypto profile Phase 2\n\nAdd a new IPsec crypto profile to support the required parameters for Phase 2.\n\nMultiple Authentication settings are defined in the desired order. Palo Alto Networks Next-Generation Firewall (NGFW) will automatically negotiate the optimal settings based on specified values.\n\n#### Set up via dashboard\n\n| Name | Option | Value |\n| - | - | - |\n| `CF_IPsec_Crypto_CBC` | Encryption | **aes-256-cbc** |\n| | Authentication | **sha256** **sha1** |\n| | DH Group | **group20** |\n| | Lifetime | 8 hours |\n\n#### Set up via command line\n\nYou can also set up the IPsec crypto profile for Phase 2 via the command line:",
      "language": "unknown"
    },
    {
      "code": "### IKE Gateways\n\nNote\n\nAny other settings not specified should be left at their default values. Any deviation may lead to undesirable behavior and are not supported.\n\nDefine two IKE Gateways to establish the two IPsec tunnels to Cloudflare. Make sure to define the following values:\n\n#### Set up via dashboard\n\n##### Tunnel 1 settings: `CF_Magic_WAN_IKE_01`\n\nNote\n\nMake sure you select `CF_IKE_Crypto_CBC` as the IKE Crypto profile.\n\n| Tab | Option | Value |\n| - | - | - |\n| **General tab** | Name | `CF_Magic_WAN_IKE_01` |\n| | Version | *IKEv2 only mode*. Make sure both IKE Gateways are based only on this setting. |\n| | Local IP Address | `Internet_L3_203-0-113-254--24` |\n| | Peer address | `CF_Magic_WAN_Anycast_01` |\n| | Pre-Shared Key | This value can be obtained from the Cloudflare dashboard - value is unique per tunnel. |\n| | Local Identification | *FQDN (hostname)*. You can obtain this value from the Cloudflare Dashboard - value is unique per tunnel. |\n| | Peer Identification | *None* |\n| **Advanced tab** | IKE Crypto Profile | *CF\\_IKE\\_Crypto\\_CBC* |\n| | Liveness Check | The default value (five seconds) is sufficient. This setting is used to periodically determine if there are any underlying connectivity issues that may adversely affect the creation of Phase 1 Security Associations. |\n\n![IKE gateway settings for tunnel 1](https://developers.cloudflare.com/_astro/03_ike_gw01_page1.DTZw4kT3_ZVe0NF.webp)![IKE gateway settings for tunnel 1](https://developers.cloudflare.com/_astro/04_ike_gw01_page2.CP3dTmKi_ZhRnTt.webp)\n\n##### Tunnel 2 settings: `CF_Magic_WAN_IKE_02`\n\nNote\n\nMake sure you select `CF_IKE_Crypto_CBC` as the IKE Crypto profile.\n\n| Tab | Option | Value |\n| - | - | - |\n| **General tab** | Name | `CF_Magic_WAN_IKE_02` |\n| | Version | *IKEv2 only mode*. Make sure both IKE Gateways are based only on this setting. |\n| | Local IP Address | `Internet_L3_203-0-113-254--24` |\n| | Peer address | `CF_Magic_WAN_Anycast_02` |\n| | Pre-Shared Key | This value can be obtained from the Cloudflare dashboard - value is unique per tunnel. |\n| | Local Identification | *FQDN (hostname)*. You can obtain this value from the Cloudflare Dashboard - value is unique per tunnel. |\n| | Peer Identification | *None* |\n| **Advanced tab** | IKE crypto profile | *CF\\_IKE\\_Crypto\\_CBC* |\n| | Liveness Check | The default value (five seconds) is sufficient. This setting is used to periodically determine if there are any underlying connectivity issues that may adversely affect the creation of Phase 1 Security Associations. |\n\n![IKE gateway settings for tunnel 2](https://developers.cloudflare.com/_astro/05_ike_gw02_page1.DhdWpbT6_Z20Ew4A.webp)![IKE gateway settings for tunnel 2](https://developers.cloudflare.com/_astro/06_ike_gw02_page2.B0Jsctzf_whU04.webp)\n\n#### Set up via command line\n\n##### Tunnel 1 settings: `CF_Magic_WAN_IKE_01`",
      "language": "unknown"
    },
    {
      "code": "##### Tunnel 2 settings: `CF_Magic_WAN_IKE_02`",
      "language": "unknown"
    },
    {
      "code": "### IPsec Tunnels\n\nWith the IKE Gateways defined, the next step is to configure two IPsec Tunnels - one corresponding to each of the two IKE Gateways configured in the previous section.\n\n#### Prerequisites\n\nThere are a few prerequisites you should be aware of before continuing:\n\n* Do not configure Proxy IDs. Magic WAN IPsec tunnels are based on the route-based VPN model. Proxy IDs are used with policy-based VPNs.\n* Disable Replay Protection, under the Advanced Options.\n* Disable Tunnel Monitor. It can cause undesirable results. Tunnel Monitor is a Palo Alto Networks proprietary feature that assumes there are Palo Alto Networks Next-Generation Firewall devices on both sides of the IPsec tunnel. Also, Tunnel Monitor is intended for use with IPsec tunnels based on IKEv1 (Magic WAN IPsec tunnels are based on IKEv2).\n\n#### Set up via dashboard\n\n##### Tunnel 1 settings: `CF_Magic_WAN_IPsec_01`\n\n| Name | Option | Value |\n| - | - | - |\n| `CF_Magic_WAN_IPsec_01` | Tunnel interface | tunnel.1 |\n| | IKE Gateway | *CF\\_Magic\\_WAN\\_IKE\\_01* |\n| | IPsec crypto profile | *CF\\_IKE\\_Crypto\\_CBC* |\n| | Enable Replay Protection | **Disable** |\n\n![Set up the IPsec tunnel](https://developers.cloudflare.com/_astro/07_ipsec_tun01_page1.CGxYzIX1_1r6TCG.webp)![Set up the IPsec tunnel](https://developers.cloudflare.com/_astro/08_ipsec_tun01_page2.BlnyIOG4_ZLzPzU.webp)\n\n##### Tunnel 2 settings: `CF_Magic_WAN_IPsec_02`\n\n| Name | Option | Value |\n| - | - | - |\n| `CF_Magic_WAN_IPsec_02` | Tunnel interface | tunnel.2 |\n| | IKE Gateway | *CF\\_Magic\\_WAN\\_IKE\\_02* |\n| | IPsec crypto profile | *CF\\_IKE\\_Crypto\\_CBC* |\n| | Enable Replay Protection | **Disable** |\n\n![Set up the IPsec tunnel](https://developers.cloudflare.com/_astro/09_ipsec_tun02_page1.BcU-8MkR_2m7wHw.webp)![Set up the IPsec tunnel](https://developers.cloudflare.com/_astro/10_ipsec_tun02_page2.DjeZ2TKf_Z1UAtRP.webp)\n\n#### Set up via command line\n\n##### Tunnel 1 settings: `CF_Magic_WAN_IPsec_01`",
      "language": "unknown"
    },
    {
      "code": "##### Tunnel 2 settings: `CF_Magic_WAN_IPsec_02`",
      "language": "unknown"
    },
    {
      "code": "### Apply Changes\n\nThis would be a good time to save and commit the configuration changes made thus far. Once complete, make sure you test basic connectivity across the IPsec tunnels.\n\n### IPsec tunnel connectivity tests\n\nThis is a good time to ensure the IPsec tunnels are established and to validate basic connectivity.\n\nNote\n\nTunnel health checks will not function until security policies and policy-based forwarding are configured. This series of tests is focused on testing IPsec connectivity exclusively.\n\n#### Verify IKE Phase 1 Communications\n\nThe first step is to verify IKE Phase 1 completed successfully:\n\n##### Syntax",
      "language": "unknown"
    },
    {
      "code": "##### Example for `CF_Magic_WAN_IKE_01`",
      "language": "unknown"
    },
    {
      "code": "##### Example for `CF_Magic_WAN_IKE_02`",
      "language": "unknown"
    },
    {
      "code": "#### Troubleshooting IKE Phase 1 Communications\n\nMagic WAN IPsec tunnels expect the customer device will initiate the IPsec tunnels. The tunnels may not establish if there is no traffic that would traverse the tunnel under normal conditions. In this case, it may be necessary to force IKE Phase 1.\n\n##### Syntax",
      "language": "unknown"
    },
    {
      "code": "##### Example for `CF_Magic_WAN_IKE_01`",
      "language": "unknown"
    },
    {
      "code": "##### Example for `CF_Magic_WAN_IKE_02`",
      "language": "unknown"
    },
    {
      "code": "Repeat these commands for the respective tunnel to ensure the IKE SA(s) display as expected.\n\n#### Verify IPsec Phase 2 Communications\n\nTo ensure the IPsec tunnels are established, ping the remote Virtual Tunnel Interface (Cloudflare side) from the command line on the Palo Alto Networks Next-Generation Firewall. Ensure you specify the source IP address of the ping from the local side of the Virtual Tunnel Interface:\n\n##### Syntax",
      "language": "unknown"
    },
    {
      "code": "##### Example for `CF_Magic_WAN_IPsec_01`",
      "language": "unknown"
    },
    {
      "code": "##### Example for `CF_Magic_WAN_IPsec_02`",
      "language": "unknown"
    },
    {
      "code": "#### Troubleshooting IPsec Phase 2 Communications\n\nMagic WAN IPsec tunnels expect the customer device will initiate the IPsec tunnels. The tunnels may not establish if there is no traffic that would traverse the tunnel under normal conditions. In this case, it may be necessary to force IPsec Phase 2. This is typically unnecessary as once IKE Phase 1 negotiates successfully, IPsec Phase 2 automatically establishes the tunnel. The test is still worth performing.\n\n##### Syntax",
      "language": "unknown"
    },
    {
      "code": "##### Example for `CF_Magic_WAN_IPsec_01`",
      "language": "unknown"
    },
    {
      "code": "##### Example for `CF_Magic_WAN_IPsec_02`",
      "language": "unknown"
    },
    {
      "code": "Repeat these commands for the respective tunnel to ensure the IPsec SA(s) display as expected.\n\n#### Ping Remote Virtual Tunnel interfaces\n\nUse ping to source traffic from the IP address of the Virtual Tunnel interface on Palo Alto Networks Next-Generation Firewall (NGFW) to the IP address of the Virtual Tunnel Interface on the Cloudflare side of the IPsec tunnel.\n\nNote\n\nThe interface address is defined with a `/31` netmask. There have been isolated cases where NGFW exhibited issues when using ping to verify connectivity between the local and remote Virtual Tunnel interfaces. This behavior can vary depending on the version of PAN-OS installed on the firewall. If you encounter this issue, either switch to a `/30` netmask, or contact Palo Alto Networks support for assistance.\n\n##### Syntax",
      "language": "unknown"
    },
    {
      "code": "##### Example for Tunnel 1",
      "language": "unknown"
    },
    {
      "code": "##### Example for Tunnel 2",
      "language": "unknown"
    },
    {
      "code": "### Virtual Router\n\nWhile we will leverage policy-based forwarding to implement policy-based routing, it is still a good idea to configure routing on the Virtual Router.\n\nCloudflare Magic WAN implements [equal-cost multi-path (ECMP) routing](https://developers.cloudflare.com/magic-wan/reference/traffic-steering/#equal-cost-multi-path-routing) to steer traffic across IPsec tunnels. The default behavior is to load balance traffic equally across both tunnels.\n\nNote\n\nECMP is disabled on the Palo Alto Networks Next-Generation Firewall by default. Enabling ECMP will force the Virtual Router to restart. While a restart of the Virtual Router is much faster than restarting the entire firewall, it is still recommended that you make this change during a scheduled maintenance window.\n\n#### Enable ECMP\n\nFirst, ensure the General tab displays both the Ethernet and tunnel interfaces. If any of the interfaces are not displayed, either use **Add** to specify the missing interface(s), or visit the Interfaces menu to ensure the relevant Virtual Router is selected.\n\n![Make sure the Ethernet and tunnel interfaces show up in Virtual Router](https://developers.cloudflare.com/_astro/01_virtual_router_interfaces.CKKz8rSw_ZGTEpL.webp)\n\n1. Open the **Router settings** for the default Virtual Router and select the **ECMP** tab.\n2. Select the checkboxes next to **Enable**, **Symmetric Return**, and **Strict Source Path** (all three checkboxes should be selected).\n3. Under **Load Balance**, change the **Method** from *IP Modulo* to *Weighted Round Robin* and add both tunnel interfaces. Ensure the weights match the weights defined in Magic WAN Static Routes (reference the Cloudflare Dashboard).\n\n![Make sure all checkboxes are selected](https://developers.cloudflare.com/_astro/02_virtual_router_ecmp.Dg9F5MXo_ZYIPL3.webp)\n\nYou can also use the command line to make these changes:",
      "language": "unknown"
    },
    {
      "code": "#### Add static routes\n\nAdd two static routes for each Magic WAN Protected Network - one for each of the two tunnel interfaces.\n\nNote\n\nPalo Alto Networks Next-Generation Firewall will not allow for configuring two routes to the same destination with equal metrics - even if they reference different interfaces and ECMP is enabled. The examples provided here use Metric 10 for the route via interface tunnel.1 and Metric 11 for the route via interface tunnel.2.\n\nThe environment used for this tutorial assumes two Magic WAN Protected Networks:\n\n* **VLAN0010**: `10.1.10.0/24`\n* **VLAN0020**: `10.1.20.0/24`\n\n##### VLAN0010 (`10.1.10.0/24`) via tunnel.1\n\n| Name | Option | Value |\n| - | - | - |\n| `Magic_WAN_VLAN0010_Tun01` | Destination | *VLAN0010\\_10-1-10-0--24* |\n| | Interface | *tunnel.1* |\n| | Next hop | *IP Address* |\n| | | *CF\\_MWAN\\_IPsec\\_VTI\\_01\\_Remote* |\n| | Metric | `10` |\n| | Route Table | *Unicast* |\n| | BFD Profile | *Disable BFD* |\n\n![Static Route - VLAN0010 (10.1.10.0/24 via tunnel.1)](https://developers.cloudflare.com/_astro/03_virtual_router_static_vlan0010_tun01.BeoPOPsP_Z227Pyc.webp)\n\n##### VLAN0010 (`10.1.10.0/24`) via tunnel.2\n\n| Name | Option | Value |\n| - | - | - |\n| `Magic_WAN_VLAN0010_Tun02` | Destination | *VLAN0010\\_10-1-10-0--24* |\n| | Interface | *tunnel.2* |\n| | Next hop | *IP Address* |\n| | | *CF\\_MWAN\\_IPsec\\_VTI\\_02\\_Remote* |\n| | Metric | `11` |\n| | Route Table | *Unicast* |\n| | BFD Profile | *Disable BFD* |\n\n![Static Route - VLAN0010 (10.1.10.0/24 via tunnel.2)](https://developers.cloudflare.com/_astro/04_virtual_router_static_vlan0010_tun02.BfU79pNf_1muFYD.webp)\n\n##### VLAN0020 (`10.1.20.0/24`) via tunnel.1\n\n| Name | Option | Value |\n| - | - | - |\n| `Magic_WAN_VLAN0020_Tun01` | Destination | *VLAN0020\\_10-1-20-0--24* |\n| | Interface | *tunnel.1* |\n| | Next hop | *IP Address* |\n| | | *CF\\_MWAN\\_IPsec\\_VTI\\_01\\_Remote* |\n| | Metric | `10` |\n| | Route Table | *Unicast* |\n| | BFD Profile | *Disable BFD* |\n\n![Static Route - VLAN0020 (10.1.20.0/24 via tunnel.1)](https://developers.cloudflare.com/_astro/05_virtual_router_static_vlan0020_tun01.u8FPv6T8_1bzIlq.webp)\n\n##### VLAN0020 (`10.1.20.0/24`) via tunnel.2\n\n| Name | Option | Value |\n| - | - | - |\n| `Magic_WAN_VLAN0020_Tun02` | Destination | *VLAN0020\\_10-1-20-0--24* |\n| | Interface | *tunnel.2* |\n| | Next hop | *IP Address* |\n| | | *CF\\_MWAN\\_IPsec\\_VTI\\_02\\_Remote* |\n| | Metric | `11` |\n| | Route Table | *Unicast* |\n| | BFD Profile | *Disable BFD* |\n\n![Static Route - VLAN0020 (10.1.20.0/24 via tunnel.1)](https://developers.cloudflare.com/_astro/06_virtual_router_static_vlan0020_tun02.BnhXyIho_VN9BU.webp)\n\nYou can also configure these settings via command line:\n\n##### VLAN0010 - `10.1.10.0/24`",
      "language": "unknown"
    },
    {
      "code": "##### VLAN0020 - `10.1.20.0/24`",
      "language": "unknown"
    },
    {
      "code": "### Magic health checks\n\nCloudflare crafts ICMP probes which are sent through the IPsec tunnels from random servers across Cloudflare's global anycast network. These ICMP probes are unique because an ICMP reply packet is sent (as opposed to an ICMP Request).\n\nNote\n\nThe construct of the security policies may seem counter-intuitive - this is due to the use of ICMP reply probes. As long as you adhere to the recommended policies in this documentation, the bi-directional health checks will work as expected.\n\nCloudflare Magic WAN customers must configure IPsec tunnels to use custom anycast IP addresses for the health check endpoints:\n\n* **CF\\_Health\\_Check\\_Anycast\\_01**: `172.64.240.253`\n* **CF\\_Health\\_Check\\_Anycast\\_02**: `172.64.240.254`\n\n#### Security Policy - Tunnel health checks\n\nYou must define a rule to allow the ICMP reply probes as Palo Alto Networks Next-Generation Firewall's default behavior will drop the health checks.\n\nNote\n\nCloudflare health checks are sent from random servers across Cloudflare's global network and can originate from any addresses within the Cloudflare IPv4 address space represented by the `Cloudflare_IPv4_Static_Grp`.\n\n##### Setup via dashboard\n\n| Name | Option | Value |\n| - | - | - |\n| `Cloudflare_Tunnel_Bidirect_HC` | Rule Type | *universal (default)* |\n| | Description | `Permit bidirectional HCs` |\n| | Group Rules By Tag | *None* |\n| **Source tab** | Source Zone | **Cloudflare\\_L3\\_Zone** |\n| | Source Address | **CF\\_Health\\_Check\\_Anycast\\_01** **CF\\_Health\\_Check\\_Anycast\\_02** |\n| **Destination tab** | Destination Zone | **Cloudflare\\_L3\\_Zone** |\n| | Destination Address | **Cloudflare\\_IPv4\\_Static\\_Grp** |\n| **Application tab** | Applications | **icmp** **ping** |\n| **Actions tab** | Action | *Allow* |\n| | Log Setting | **Log at Session End** |\n| | Profile type | *None* |\n| | Schedule | *None* |\n| | QoS Marking | *None* |\n\n![Bidirectional Health Check Rule - General](https://developers.cloudflare.com/_astro/01_bidirect_hc_general.Jesbnt_L_ZwaAHv.webp)![Bidirectional Health Check Rule - Source](https://developers.cloudflare.com/_astro/02_bidirect_hc_source.D5_oto5__rVAcl.webp)![Bidirectional Health Check Rule - Destination](https://developers.cloudflare.com/_astro/03_bidirect_hc_dest.fLuLEdbu_Z1Xym35.webp)![Bidirectional Health Check Rule - Apps](https://developers.cloudflare.com/_astro/04_bidirect_hc_apps.BS9-zTeJ_xF5tA.webp)![Bidirectional Health Check Rule - Service/URL Category](https://developers.cloudflare.com/_astro/05_bidirect_hc_service-url.BO7RsvHM_2qBy1a.webp)![Bidirectional Health Check Rule - Action](https://developers.cloudflare.com/_astro/06_bidirect_hc_action.BepoEJ0K_PKo4h.webp)\n\n##### Setup via command line",
      "language": "unknown"
    },
    {
      "code": "Note\n\nLogging is enabled on the rule to permit heath checks. While the amount of bandwidth consumed by health checks is negligible, the flows generate a significant number of log entries. You may want to disable logging on this rule once in production, and only enable it if any troubleshooting becomes necessary.\n\n#### Policy-based forwarding - tunnel health checks\n\nTraffic matching the Security Rule defined in the last step must be routed symmetrically across the tunnel the ingress traffic was received through. Two policy-based forwarding rules ensure the traffic is routed accordingly.\n\nEnsure have the following:\n\n* **Source Zone**: `Cloudflare_L3_Zone`\n* **Source Addresses**: `CF_Health_Check_Anycast_01` and `CF_Health_Check_Anycast_02`\n* **Destination Zone**: `Cloudflare_L3_Zone`\n* **Destination Addresses**: `Cloudflare_IPv4_Static_Grp`\n* **Application**: `icmp` and `ping`\n\n##### Set up via dashboard tunnel.1\n\n| Name | Option | Value |\n| - | - | - |\n| `PBF_Cloudflare_Health_Check_01` | Tags | *Cloudflare\\_L3\\_Zone* |\n| | Group Rules By Tag | *None* |\n| **Source tab** | Type | *Zone* |\n| | Zone | **Cloudflare\\_L3\\_Zone** |\n| | Source Address | **CF\\_Health\\_Check\\_Anycast\\_01** |\n| **Destination/Application/Service tab** | Destination Address | **Cloudflare\\_IPv4\\_Static\\_Grp** |\n| **Forwarding tab** | Action | *Forward* |\n| | Egress interface | *tunnel.1* |\n| | Next Hop | *IP Address* |\n| | | *CF\\_MWAN\\_IPsec\\_VTI\\_01\\_Remote* |\n\n![Bidirectional Health Checks via tunnel.1 - General](https://developers.cloudflare.com/_astro/01_pbf_hc_01_general.BvF5tM5Y_ZoiF5V.webp)![Bidirectional Health Checks via tunnel.1 - Source](https://developers.cloudflare.com/_astro/02_pbf_hc_01_source.sLm5lJYK_Z1LxGXo.webp)![Bidirectional Health Checks via tunnel.1 - Destination](https://developers.cloudflare.com/_astro/03_pbf_hc_01_dest-app-service.B7G6nLZp_kIjoa.webp)![Bidirectional Health Checks via tunnel.1 - Forwarding](https://developers.cloudflare.com/_astro/04_pbf_hc_01_forwarding.Ceb7zhxs_Z23rdea.webp)\n\n##### Set up via dashboard tunnel.2\n\n| Name | Option | Value |\n| - | - | - |\n| `PBF_Cloudflare_Health_Check_02` | Tags | *Cloudflare\\_L3\\_Zone* |\n| | Group Rules By Tag | *None* |\n| **Source tab** | Type | *Zone* |\n| | Zone | **Cloudflare\\_L3\\_Zone** |\n| | Source Address | **CF\\_Health\\_Check\\_Anycast\\_02** |\n| **Destination/Application/service tab** | Destination Address | **Cloudflare\\_IPv4\\_Static\\_Grp** |\n| **Forwarding tab** | Action | *Forward* |\n| | Egress interface | *tunnel.2* |\n| | Next Hop | *IP Address* |\n| | | *CF\\_MWAN\\_IPsec\\_VTI\\_02\\_Remote* |\n\n![Bidirectional Health Checks via tunnel.2 - General](https://developers.cloudflare.com/_astro/05_pbf_hc_02_general.VE6FLgMw_2IX50.webp)![Bidirectional Health Checks via tunnel.2 - Source](https://developers.cloudflare.com/_astro/06_pbf_hc_02_source.CAlZ5-Oc_Zw0see.webp)![Bidirectional Health Checks via tunnel.2 - Destination](https://developers.cloudflare.com/_astro/07_pbf_hc_02_dest-app-service.Bijf-cAH_xdf5i.webp)![Bidirectional Health Checks via tunnel.2 - Forwarding](https://developers.cloudflare.com/_astro/08_pbf_hc_02_forwarding.DQQYjV92_ZeUQkC.webp)\n\n##### Set up via command line tunnel.1",
      "language": "unknown"
    },
    {
      "code": "##### Set up via command line tunnel.2",
      "language": "unknown"
    },
    {
      "code": "### Troubleshooting tunnel health checks\n\n#### Security Policy\n\nUse the Traffic log viewer to ensure that the health check traffic is allowed. Start by adding a rule to filter the logs based on the name of the Security Policy rule permitting the applicable traffic.\n\n##### Filter by rule name",
      "language": "unknown"
    },
    {
      "code": "![Bidirectional health check logging - Filter by rule name](https://developers.cloudflare.com/_astro/02_logging_tunnel_hc_filter_rulename.CpyoLiq5_1xYukE.webp)\n\nIf you do not see any traffic matching the filter, replace the filter with one that displays log entries based on the addresses associated with the `CF_Health_Check_Anycast_01` and `CF_Health_Check_Anycast_02` Address objects.\n\n##### Filter by health check anycast IPs",
      "language": "unknown"
    },
    {
      "code": "![Bidirectional health check logging - filter by health check anycast IPs](https://developers.cloudflare.com/_astro/01_logging_tunnel_hc_filter_ip.DY1yUwDH_1tjcOR.webp)\n\n#### Policy-based forwarding\n\nTroubleshooting policy-based forwarding can be a bit challenging. The ideal way to determine if traffic is flowing through the intended path is to select the detailed view for a log entry.\n\n1. Select the magnifying glass next to one of the log entries with source IP address `172.64.240.253`.\n\n2. Traffic originating from `CF_Health_Check_Anycast_01` (`172.64.240.253`) should ingress and egress interface tunnel.1.\n\n![Bidirectional Health Check Logging - tunnel.1](https://developers.cloudflare.com/_astro/03_logging_tunnel_hc_tun01.aWSnG56V_ZVDsIW.webp)\n\n1. Select the magnifying glass next to one of the log entries with source IP address `172.64.240.254`.\n\n2. Traffic originating from `CF_Health_Check_Anycast_02` (`172.64.240.254`) should ingress and egress interface tunnel.2.\n\n![Bidirectional Health Check Logging - tunnel.2](https://developers.cloudflare.com/_astro/04_logging_tunnel_hc_tun02.D1f2hkGw_ZhmTi3.webp)\n\nIf the traffic is not ingressing/egressing the same interface, you likely have an issue with the policy-based forwarding rule(s) not matching.\n\n### Security Policies - Production Traffic\n\nAs mentioned earlier, this tutorial includes examples for two different use-cases:\n\n* **Magic WAN**: permit traffic between two or more locations with [RFC-1918](https://datatracker.ietf.org/doc/html/rfc1918) private non-routable address space.\n* **Magic WAN with Cloudflare Zero Trust (Gateway egress)**: same as Magic WAN with the addition of outbound Internet access from Magic WAN protected sites egressing the Cloudflare edge network.\n\n#### Magic WAN only\n\nRules must be defined to facilitate traffic from the trust network to the Magic WAN protected sites. While it may be possible to define one rule for traffic in both directions, this example includes two rules:\n\n* From Trust to Magic WAN protected sites.\n\n* From Magic WAN protected sites to Trust.\n\n##### Trust to Magic WAN dashboard\n\n| Name | Option | Value |\n| - | - | - |\n| `Trust_to_Cloudflare_Magic_WAN_Allow` | Rule Type | *universal (default)* |\n| | Group Rules by Tag | *None* |\n| **Source tab** | Source Zone | **Trust\\_L3\\_Zone** |\n| | Source Address | **VLAN0100\\_10-1-100-0--24** |\n| **Destination tab** | Destination Zone | **Cloudflare\\_L3\\_Zone** |\n| | Destination Address | **VLAN0010\\_10-1-10-0--24** **VLAN0020\\_10-1-20-0--24** |\n| **Actions tab** | Action | *Allow* |\n| | Log Setting | **Log at Session End** |\n| | Profile type | *None* |\n| | Schedule | *None* |\n| | QoS Marking | *None* |\n\n![Trust to Magic WAN - General](https://developers.cloudflare.com/_astro/07_trust_to_mwan_general.34vAITJy_Z2bxubM.webp)![Trust to Magic WAN - Source](https://developers.cloudflare.com/_astro/08_trust_to_mwan_source.BpuRH05s_Z1Da7xK.webp)![Trust to Magic WAN - Destination](https://developers.cloudflare.com/_astro/09_trust_to_mwan_dest.De2xwcdy_Z46hvV.webp)![Trust to Magic WAN - Applications](https://developers.cloudflare.com/_astro/10_trust_to_mwan_apps.DQXUeCED_Z1gOFzh.webp)![Trust to Magic WAN - Services/URL Categories](https://developers.cloudflare.com/_astro/11_trust_to_mwan_service-url.DHjD72HI_1GOl6B.webp)![Trust to Magic WAN - Action](https://developers.cloudflare.com/_astro/12_trust_to_mwan_action.DDnplEF5_Zzn72E.webp)\n\n##### Trust to Magic WAN command line",
      "language": "unknown"
    },
    {
      "code": "##### Magic WAN to Trust dashboard\n\n| Name | Option | Value |\n| - | - | - |\n| `Cloudflare_Magic_WAN_to_Trust_Allow` | Rule Type | *universal (default)* |\n| | Group Rules by Tag | *None* |\n| Source tab | Source Zone | **Cloudflare\\_L3\\_Zone** |\n| | Source Address | **VLAN0010\\_10-1-10-0--24** **VLAN0020\\_10-1-20-0--24** |\n| Destination tab | Destination Zone | **Trust\\_L3\\_Zone** |\n| | Destination Address | **VLAN0100\\_10-1-100-0--24** |\n| Actions tab | Action | *Allow* |\n| | Log Setting | **Log at Session End** |\n| | Profile type | *None* |\n| | Schedule | *None* |\n| | QoS Marking | *None* |\n\n![Magic WAN to Trust - General](https://developers.cloudflare.com/_astro/13_mwan_to_trust_general.CLIPMgLb_yamF1.webp)![Magic WAN to Trust - Source](https://developers.cloudflare.com/_astro/14_mwan_to_trust_source.GRgD0hWh_1y0ghh.webp)![Magic WAN to Trust - Destination](https://developers.cloudflare.com/_astro/15_mwan_to_trust_dest.1rnkUqIF_Hh5SA.webp)![Magic WAN to Trust - Applications](https://developers.cloudflare.com/_astro/16_mwan_to_trust_apps.BktgyY-4_Z1UXrP2.webp)![Magic WAN to Trust - Services/URL Categories](https://developers.cloudflare.com/_astro/17_mwan_to_trust_service-url.bKUMWAET_1pdt9i.webp)![Magic WAN to Trust - Action](https://developers.cloudflare.com/_astro/18_mwan_to_trust_action.FJTlsp2v_Z28V9DR.webp)\n\n##### Magic WAN to Trust command line",
      "language": "unknown"
    },
    {
      "code": "### Policy-based forwarding - production traffic\n\nWhether traffic ingresses or egresses Palo Alto Networks Next-Generation Firewall, it is important to ensure that traffic is routed symmetrically. This is accomplished through the use of policy-based forwarding.\n\nPolicy-based forwarding rules are only required for egress traffic.\n\nAny traffic destined for Magic WAN protected sites or Magic WAN protected sites with Gateway egress must be routed across the IPsec tunnels.\n\nNote\n\nSecurity rules match traffic flows based on source and destination zone. Policy-based forwarding rules are applied per interface. Therefore, two policy-based forwarding rules are required for every one security rule - one for tunnel.1 and one for tunnel.2.\n\n#### Dashboard policy-based forwarding - Magic WAN production traffic via tunnel.1\n\n| Name | Option | Value |\n| - | - | - |\n| `PBF_Magic_WAN_Sites_01` | Group Rules by Tag | *None* |\n| **Source tab** | Type | *Zone* |\n| | Zone | **Trust\\_L3\\_Zone** |\n| | Source Address | **VLAN0100\\_10-1-100-0--24** |\n| **Destination/Application/Service tab** | Destination Address | **VLAN0010\\_10-1-10-0--24** **VLAN0020\\_10-1-20-0--24** |\n| **Forwarding tab** | Action | *Forward* |\n| | Egress Interface | *tunnel.1* |\n| | Next hop | *IP Address* |\n| | | *CF\\_MWAN\\_IPsec\\_VTI\\_01\\_Remote* |\n\n![PBF: Trust to Magic WAN via tunnel.1 - General](https://developers.cloudflare.com/_astro/09_pbf_mwan_sites_tun01_general.B9Ui-2D4_Zq2mV.webp)![PBF: Trust to Magic WAN via tunnel.1 - Source](https://developers.cloudflare.com/_astro/10_pbf_mwan_sites_tun01_source.C7svyFEp_Z2nliv2.webp)![PBF: Trust to Magic WAN via tunnel.1 - Destinations](https://developers.cloudflare.com/_astro/11_pbf_mwan_sites_tun01_dest-app-service.BVIzYk7i_2idXF4.webp)![PBF: Trust to Magic WAN via tunnel.1 - Forwarding](https://developers.cloudflare.com/_astro/12_pbf_mwan_sites_tun01_forwarding.BgfRalCp_nD0x0.webp)\n\n#### Command line policy-based forwarding - Magic WAN production traffic via tunnel.1",
      "language": "unknown"
    },
    {
      "code": "#### Dashboard policy-based forwarding - Magic WAN production traffic via tunnel.2\n\n| Name | Option | Value |\n| - | - | - |\n| `PBF_Magic_WAN_sites_02` | Group Rules by Tag | *None* |\n| **Source tab** | Type | *Zone* |\n| | Zone | **Trust\\_L3\\_Zone** |\n| | Source Address | **VLAN0100\\_10-1-100-0--24** |\n| **Destination/Application/Service tab** | Destination Address | **VLAN0010\\_10-1-10-0--24** **VLAN0020\\_10-1-20-0--24** |\n| **Forwarding tab** | Action | *Forward* |\n| | Egress Interface | *tunnel.2* |\n| | Next hop | *IP Address* |\n| | | *CF\\_MWAN\\_IPsec\\_VTI\\_02\\_Remote* |\n\n![PBF: Trust to Magic WAN via tunnel.2 - General](https://developers.cloudflare.com/_astro/13_pbf_mwan_sites_tun02_general.CStSssKo_Mp5iG.webp)![PBF: Trust to Magic WAN via tunnel.2 - Source](https://developers.cloudflare.com/_astro/14_pbf_mwan_sites_tun02_source.ATjxgSnK_Z1Vr1xa.webp)![PBF: Trust to Magic WAN via tunnel.2 - Destinations](https://developers.cloudflare.com/_astro/15_pbf_mwan_sites_tun02_dest-app-service.CM_mCD4L_25ONr3.webp)![PBF: Trust to Magic WAN via tunnel.2 - Forwarding](https://developers.cloudflare.com/_astro/16_pbf_mwan_sites_tun02_forwarding.DMjVsrud_23KJuA.webp)\n\n#### Command line policy-based forwarding - tunnel.2",
      "language": "unknown"
    },
    {
      "code": "## Magic WAN with Cloudflare Zero Trust (Gateway egress)\n\nThis section covers adding in support for the use of Cloudflare Gateway. Adding Cloudflare Gateway allows you to set up policies to inspect outbound traffic to the Internet through DNS, network, HTTP and egress filtering.\n\nThis use case can be supported in one of two ways:\n\n* **Option 1**\n\n  * **Security Rule**: Extend the scope of the `Trust_to_Cloudflare_Magic_WAN_Allow` rule to allow any destination address.\n  * **Policy-Based Forwarding**: Extend the scope of `PBF_Magic_WAN_Sites_01` and `PBF_Magic_WAN_Sites_02` to allow any destination address.\n\n* **Option 2**\n\n  * **Security Rule**: Add a new rule below `Trust_to_Cloudflare_Magic_WAN_Allow` called `Trust_to_MWAN_Gateway_Egress_Allow` to allow traffic to any destination address except for the Magic WAN Protected Sites (using the Negate option).\n  * **Policy-Based Forwarding**: Add a new rule below `PBF_Magic_WAN_Sites_01` and `PBF_Magic_WAN_Sites_02` to allow any destination address except for the Magic WAN Protected Sites (using the Negate option).\n\nThe following examples are based on Option 2.\n\nNote\n\nThis example assumes the security rules and policy-based forwarding rules from the previous sections have been configured and are directly above the rules configured in this section.\n\nAlso, traffic from Trust to the Internet would typically be defined as `Trust_L3_Zone` to `Untrust_L3_Zone`. However, since egress Internet traffic will be routed through the Magic IPsec tunnels, the rule must reference `Trust_L3_Zone` to `Cloudflare_L3_Zone`.\n\n### Security Rule: Trust to Gateway Egress\n\n#### Dashboard\n\n| Name | Option | Value |\n| - | - | - |\n| `Trust_to_MWAN_Gateway_Egress_Allow` | Rule Type | *universal (default)* |\n| | Group Rules By Tag | *None* |\n| **Source tab** | Source Zone | **Trust\\_L3\\_Zone** |\n| **Destination tab** | Destination Zone | **Cloudflare\\_L3\\_Zone** |\n| | Destination Address | **VLAN0010\\_10-1-10-0--24** **VLAN0020\\_10-1-20-0--24** **Negate** |\n| **Actions tab** | Action | *Allow* |\n| | Log Setting | **Log at Session End** |\n| | Profile Type | *None* |\n| | Schedule | *None* |\n| | QoS Marking | *None* |\n\n![Trust to MWAN Egress - General](https://developers.cloudflare.com/_astro/01_trust_mwan_egress_general.Biz7B17n_Z1iTO1c.webp)![Trust to MWAN Egress - Source](https://developers.cloudflare.com/_astro/02_trust_mwan_egress_source.B7t96mux_psyKK.webp)![Trust to MWAN Egress - Destination](https://developers.cloudflare.com/_astro/03__trust_mwan_egress_destination.BrBr5PhZ_ZAfkD9.webp)![Trust to MWAN Egress - Applications](https://developers.cloudflare.com/_astro/04_trust_mwan_egress_apps.GpW02LW6_Z1BsSvi.webp)![Trust to MWAN Egress - Services/URL Categories](https://developers.cloudflare.com/_astro/05_trust_mwan_egress_service-url.CkJbZtLv_pPHzW.webp)![Trust to MWAN Egress - Action](https://developers.cloudflare.com/_astro/06_trust_mwan_egress_actions.D64ZOSoI_7pVv7.webp)\n\n#### Command line",
      "language": "unknown"
    },
    {
      "code": "### Policy-based forwarding: Trust to Gateway egress via tunnel.1\n\n#### Dashboard\n\n| Name | Option | Value |\n| - | - | - |\n| `PBF_MWAN_Egress01` | Group Rules By Tag | *None* |\n| **Source tab** | Source Zone | **Trust\\_L3\\_Zone** |\n| **Destination/Application/Service tab** | Destination Address | **VLAN0010\\_10-1-10-0--24** **VLAN0020\\_10-1-20-0--24** **Negate** |\n| **Forwarding tab** | Action | *Forward* |\n| | Egress Interface | *tunnel.1* |\n| | Next Hop | *IP Address* |\n| | | *CF\\_MWAN\\_IPsec\\_VTI\\_01\\_Remote* |\n\n![PBF: Trust to Magic WAN Egress via tunnel.1 - General](https://developers.cloudflare.com/_astro/07_pbf_trust_mwan_egress_tun01_general.DanIxwjJ_yI2si.webp)![PBF: Trust to Magic WAN via tunnel.1 - Source](https://developers.cloudflare.com/_astro/02_trust_mwan_egress_source.B7t96mux_psyKK.webp)![PBF: Trust to Magic WAN via tunnel.1 - Destinations](https://developers.cloudflare.com/_astro/09_pbf_trust_mwan_egress_tun01_dest.D3-eCYMo_ZVN6p1.webp)![PBF: Trust to Magic WAN via tunnel.1 - Forwarding](https://developers.cloudflare.com/_astro/10_pbf_trust_mwan_egress_tun01_forward.w-i02GXK_ZQhurD.webp)\n\n#### Command line",
      "language": "unknown"
    },
    {
      "code": "### Policy-based forwarding: Trust to Gateway egress via tunnel.2\n\n#### Dashboard\n\n| Name | Option | Value |\n| - | - | - |\n| `PBF_MWAN_Egress02` | Group Rules By Tag | *None* |\n| **Source tab** | Source Zone | **Trust\\_L3\\_Zone** |\n| | Source Address | **VLAN0100\\_10-1-100-0--24** |\n| **Destination/Application/Service tab** | Destination Address | **VLAN0010\\_10-1-10-0--24** **VLAN0020\\_10-1-20-0--24** **Negate** |\n| **Forwarding tab** | Action | *Forward* |\n| | Egress Interface | *tunnel.2* |\n| | Next Hop | *IP Address* |\n| | | *CF\\_MWAN\\_IPsec\\_VTI\\_02\\_Remote* |\n\n![PBF: Trust to Magic WAN Egress via tunnel.2 - General](https://developers.cloudflare.com/_astro/11_pbf_trust_mwan_egress_tun02_general.D8ffa0E__1uYVDt.webp)![PBF: Trust to Magic WAN via tunnel.2 - Source](https://developers.cloudflare.com/_astro/12_pbf_trust_mwan_egress_tun02_source.UqvzUgLo_Z1jErHU.webp)![PBF: Trust to Magic WAN via tunnel.2 - Destinations](https://developers.cloudflare.com/_astro/13_pbf_trust_mwan_egress_tun02_dest.DYJd_Nm6_2vWn7D.webp)![PBF: Trust to Magic WAN via tunnel.2 - Forwarding](https://developers.cloudflare.com/_astro/14_pbf_trust_mwan_egress_tun02_forward.CDTxDSWp_1HHKof.webp)\n\n#### Command line",
      "language": "unknown"
    },
    {
      "code": "## Troubleshooting\n\nCloudflare recommends you consult [PAN-OS 9.1 Administrators Guide - Interpret VPN Error Messages](https://docs.paloaltonetworks.com/pan-os/9-1/pan-os-admin/vpns/set-up-site-to-site-vpn/interpret-vpn-error-messages) and [PAN-OS 10.2 Administrators Guide - Interpret VPN Error Messages](https://docs.paloaltonetworks.com/pan-os/10-2/pan-os-admin/vpns/set-up-site-to-site-vpn/interpret-vpn-error-messages) for general troubleshooting.\n\n</page>\n\n<page>\n---\ntitle: pfSense  Cloudflare Magic WAN docs\ndescription: This tutorial includes the steps required to configure IPsec\n  tunnels to connect a pfSense firewall to Cloudflare Magic WAN.\nlastUpdated: 2025-10-31T13:37:27.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/pfsense/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/pfsense/index.md\n---\n\nThis tutorial includes the steps required to configure IPsec tunnels to connect a pfSense firewall to Cloudflare Magic WAN.\n\n## Software tested\n\n| Manufacturer | Firmware revision |\n| - | - |\n| pfSense | 24.03 |\n\n## Prerequisites\n\nFor this tutorial, you will need to know the following information:\n\n* Your Anycast IP addresses (given to you by Cloudflare)\n* External IP addresses\n* Internal IP address ranges\n* Inside tunnel `/31` ranges\n\n## Example scenario\n\nThe following IP addresses are used throughout this tutorial. Any legally routable IP addresses have been replaced with IPv4 Address Blocks Reserved for Documentation ([RFC 5737](https://datatracker.ietf.org/doc/html/rfc5737)) addresses within the `203.0.113.0/24` subnet.\n\n| Tunnel name | `PF_TUNNEL_01` | `PF_TUNNEL_02` |\n| - | - | - |\n| Interface address | `10.252.2.26/31` | `10.252.2.28/31` |\n| Customer endpoint | `203.0.113.254` | `203.0.113.254` |\n| Cloudflare endpoint | `<YOUR_ANYCAST_IP_ADDRESS_1>` | `<YOUR_ANYCAST_IP_ADDRESS_2>` |\n| Pfsense IPsec Phase 2 Local IP | `10.252.2.27` | `10.252.2.29` |\n| Pfsense IPsec Phase 2 Remote IP | `10.252.2.26` | `10.252.2.28` |\n| Magic WAN static routes - Prefix | `10.1.100.0/24` | `10.1.100.0/24` |\n| Magic WAN static routes - Next hop | `PF_TUNNEL_01` | `PF_TUNNEL_02` |\n\n## 1. Configure Magic WAN IPsec tunnels\n\nUse the Cloudflare dashboard or API to [configure two IPsec tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels). The settings mentioned below are used for the IPsec tunnels referenced throughout the remainder of this guide.\n\n### Add IPsec tunnels\n\n1. Follow the [Add tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels) instructions to create the required IPsec tunnels with the following options:\n\n   * **Tunnel name**: `PF_TUNNEL_01`\n   * **Interface address**: `10.252.2.26/31`\n   * **Customer endpoint**: `203.0.113.254`\n   * **Cloudflare endpoint**: Enter the Anycast IP address provided by Cloudflare.\n   * **Health check rate**: *Medium*\n   * **Health check type**: *Request*\n   * **Health check direction**: *Bidirectional*\n   * **Turn on replay protection**: Enable\n\n2. Select **Add pre-shared key later** > **Add tunnels**.\n\n3. Repeat the process to create a second IPsec tunnel with the following options:\n\n   * **Tunnel name**: `PF_TUNNEL_02`\n   * **Interface address**: `10.252.2.28/31`\n   * **Customer endpoint**: `203.0.113.254`\n   * **Cloudflare endpoint**: Enter the Anycast IP address provided by Cloudflare.\n   * **Health check rate**: *Medium*\n   * **Health check type**: *Request*\n   * **Health check direction**: *Bidirectional*\n   * **Turn on replay protection**: Enable\n\n4. Select **Add pre-shared key later** > **Add tunnels**.\n\nNote\n\nIf site-to-site traffic is a requirement for your use case, you need to enable replay protection. Refer to [Add tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels) > IPsec tunnel to learn how to enable this feature.\n\n### Generate pre-shared keys\n\nWhen you create IPsec tunnels with the option **Add pre-shared key later**, the Cloudflare dashboard will show you a warning indicator.\n\n1. Select **Edit** to edit the properties of each IPsec tunnel you have created.\n2. Select **Generate a new pre-shared key** > **Update and generate pre-shared key**.\n3. Copy the pre-shared key value for each of your IPsec tunnels, and save these values somewhere safe. Then, select **Done**.\n\nNote\n\nTake note of your pre-shared keys, and keep them in a safe place to use later in pfSense.\n\n### IPsec identifier - User ID\n\nAfter creating your IPsec tunnels, the Cloudflare dashboard will list them under **Tunnels**. To retrieve your IPsec tunnel's user ID:\n\n1. Go to **Tunnels** in the Cloudflare dashboard.\n\n   [Go to **Configuration**](https://dash.cloudflare.com/?to=/:account/magic-wan/configuration)\n\n2. Select the IPsec tunnel.\n\n3. Scroll to **User ID** and copy the string. For example, `ipsec@long_string_of_letters_and_numbers`.\n\nThe User ID will be required when configuring IKE Phase 1 on the pfSense firewall.\n\n## 2. Create Magic WAN static routes\n\nCreate a [static route](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-routes/#create-a-static-route) for each of the two IPsec tunnels configured in the previous section, with the following settings (settings not mentioned here can be left with their default values):\n\n### Tunnel 01\n\n* **Description**: `PF_TUNNEL_01`\n* **Prefix**: `10.1.100.0/24`\n* **Tunnel/Next hop**: `PF_TUNNEL_01`\n\n### Tunnel 02\n\n* **Description**: `PF_TUNNEL_02`\n* **Prefix**: `10.1.100.0/24`\n* **Tunnel/Next hop**: `PF_TUNNEL_02`\n\n## 3. Configure the pfSense firewall\n\nInstall pfSense and boot up. Then, assign and set LAN and WAN interfaces, as well as IP addresses. For example:\n\n* **LAN**: `203.0.113.254`\n* **WAN**: `<YOUR_WAN_ADDRESS>`\n\n### Configure IPsec Phase 1\n\nAdd a new IPsec tunnel [Phase 1 entry](https://docs.netgate.com/pfsense/en/latest/vpn/ipsec/configure-p1.html), with the following settings:\n\n* **General Information**\n  * **Description**: `CF1_IPsec_P1`\n\n* **IKE Endpoint Configuration**\n\n  * **Key exchange version**: *IKE\\_v2*\n  * **Internet Protocol**: *IPv4*\n  * **Interface**: *WAN*\n  * **Remote gateway**: Enter your Cloudflare Anycast IP address.\n\n* **Phase 1 Proposal (Authentication)**\n\n  * **Authentication method**: *Mutual PSK*\n  * **My identifier**: *User Fully qualified domain name* > `ipsec@long_string_of_letters_and_numbers`\\\n    (You can get this identifier from your Cloudflare IPsec tunnel configuration > **User ID**)\n  * **Peer identifier**: *Peer IP Address* (your Cloudflare Anycast IP)\n  * **Pre-Shared Key**: Enter the PSK you have on your Cloudflare IPsec tunnel.\n\n* **Phase 1 proposal (Encryption algorithm)**\n\n  * **Encryption algorithm**: *AES 256 bits*\n  * **Key length**: *256 bits*\n  * **Hash algorithm**: *SHA256*\n  * **DH key group**: *20*\n  * **Lifetime**: `86400`\n\n### Configure IPsec Phase 2\n\nAdd a new IPsec tunnel [Phase 2 entry](https://docs.netgate.com/pfsense/en/latest/vpn/ipsec/configure-p2.html), with the following settings. You need to create an entry for tunnel 1 and 2, making the appropriate changes for the IP addresses for local and remote network:\n\n* **General Information**\n\n  * **Description**: `CF1_IPsec_P2`\n  * **Mode**: *Routed (VTI)*\n\n* **Networks**\n\n  * **Local Network**: *Address* > Upper IP address in the `/31` assigned in Cloudflare tunnel. For example, `10.252.2.27` for tunnel 1 and `10.252.2.29` for tunnel 2.\n  * **Remote Network**: *Address* > Lower IP address in the `/31` for Cloudflare side. For example, `10.252.2.26` for tunnel 1, and `10.252.2.28` for tunnel 2.\n\n* **Phase 2 Proposal (SA/Key Exchange)**\n\n  * **Protocol**: *ESP*\n  * **Encryption algorithm**: *AES 256 bits*\n  * **Hash algorithm**: *SHA256*\n  * **DH key group**: *20*\n  * **Lifetime**: `28800`\n\nWhen you are finished, apply your changes. If you go to **Status** > **IPsec**, you should be able to check that both Phase 1 and Phase 2 are connected.\n\n![pfSense IPsec overview](https://developers.cloudflare.com/_astro/ipsec-overview.B7tL0kto_Nzl7V.webp)\n\n### Interface assignments\n\nIn **Interfaces** > **Assignments** > **Add**, create a new interface to assign to the first IPsec tunnel, with the following settings:\n\n* **General configuration**\n\n  * **Description**: `CF1_IPsec_1`\n  * **MSS**: `1446`\n\n* **Interface Assignments**\n\n  * **WAN**: Add your WAN interface. For example, `vnet1`.\n  * **LAN**: Add your LAN interface. For example, `vnet0`.\n  * Add your **CF\\_IPsec\\_1** that you have created above for Phase 1.\n\nSelect **Save** when you are finished.\n\n![Assign a new interface to the first IPsec tunnel](https://developers.cloudflare.com/_astro/interfaces.COkbEEZi_Z1qEfaY.webp)\n\n![Configuring interface assignments](https://developers.cloudflare.com/_astro/interface-assignments.CblqhRKO_Zsid2F.webp)\n\n### Gateway\n\nIn **System** > **Routing** > **Gateways** there should already be a gateway. For this example, it is named `CF1_IPSEC_1_VTIV4`.\n\n![There should already be a gateway configured in the interface](https://developers.cloudflare.com/_astro/gateways.BWYSJrzk_2rCe1d.webp)\n\n### Firewall Rules IPsec\n\n1. In **Firewall Rules** > **IPsec interface**, allow any type of traffic.\n\n![Allow all traffic for IPsec](https://developers.cloudflare.com/_astro/firewall-ipsec.CgXaJWLX_Z1pCizW.webp)\n\n1. Navigate to **Status** > **Gateways**. `CF1_IPSEC_1_VTIV4` should now be online.\n\n![The gateway should now be online](https://developers.cloudflare.com/_astro/status-gateways.CAqgLr_K_a1bVv.webp)\n\n### Firewall Rules LAN\n\n1. In **Firewall** > **Rules** > **LAN**, allow any type of traffic.\n2. Expand the **Advanced** section.\n3. Change the Gateway to `CF1_IPSEC_1_VTIV4`.\n\n![Change the gateway in the firewall rules for LAN traffic](https://developers.cloudflare.com/_astro/firewall-lan.DduZnf_o_1jVj2x.webp)\n\n</page>\n\n<page>\n---\ntitle: SonicWall  Cloudflare Magic WAN docs\ndescription: \"This tutorial shows you how to use Magic WAN with the following\n  versions of the SonicWall appliances:\"\nlastUpdated: 2025-10-31T13:37:27.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/sonicwall/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/sonicwall/index.md\n---\n\nThis tutorial shows you how to use Magic WAN with the following versions of the SonicWall appliances:\n\n* **Hardware tested**:\n\n  * SonicWall NSv 470\n  * SonicWal 3700\n\n* **Software versions tested**:\n  * SonicOS 7.0.1\n\nYou can connect your SonicWall appliance through [IPsec tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/) to Magic WAN. Generic Routing Encapsulation (GRE) is not supported on SonicWall.\n\n## Topology\n\n![Topology diagram showing how to connect SonicWall appliances to Magic WAN](https://developers.cloudflare.com/_astro/topology.Qe7r1Gcs_Z2cR4HM.webp)\n\nThe following instructions show how to setup an IPsec connection on your SonicWall device. We will use the IP ranges from the above topology example to create the connections needed. Settings not explicitly mentioned can be left with their default values.\n\n## 1. Create an IPsec tunnel on your Cloudflare account\n\n1. Start by [creating your IPsec tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels) on Cloudflare. Name and describe the tunnels as needed, and add the following settings:\n\n   * **Interface address**: Enter the internal tunnel IP on the Cloudflare side of the IPsec tunnel. In this example, it is `10.200.1.0/31`.\n   * **Customer endpoint**: Enter the WAN IP address of your SonicWall device. In our example, this is `198.51.100.2`.\n   * **Cloudflare endpoint**: Enter the IP address provided by Cloudflare. In our example, this is `1.2.3.4`.\n   * **Pre-shared key**: Select **Use my own pre-shared key** and paste a secure key of your own.\n\n2. Select **Add tunnels** when you are finished.\n\n3. After you create your tunnel, Cloudflare dashboard will load a list of tunnels set up for your account. Select the arrow to expand the tunnels you have just created, and check the following settings:\n\n   * **Customer endpoint**: Refers to the SonicWall WAN IP that the VPN policy is bound to (in red).\n   * **Cloudflare endpoint**: Refers to the anycast IP provided by Cloudflare (in blue).\n   * **FQDN ID**: The ID used in the VPN policy for the SonicWall's Local IKE ID. Copy this ID and save it. You will need it when configuring the tunnel on your SonicWall (in green).\n\n   ![An example of what your IPsec tunnel should look like](https://developers.cloudflare.com/_astro/step3.BQqYLGGy_Z1omATt.webp)\n\nNote\n\nThe interface address on the Cloudflare side of the tunnel is `10.200.1.0/31`. You will need to use `10.200.1.1/31` on the SonicWall side of the tunnel.\n\n## 2. Create static routes on Cloudflare dashboard\n\nStatic routes are required for any networks that will be reached via the IPsec tunnel. In our example, there are two networks: `172.31.3.0/24` and the tunnel network `10.200.1.0/31`.\n\n1. [Create your static routes](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-routes/#create-a-static-route). Name and describe them as needed, and add the following settings:\n\n   * **First tunnel**: Following our example, add `10.200.1.0/31` as the **Prefix** and `10.200.1.1` for the **Tunnel/Next hop**.\n   * **Second tunnel**: Following our example, add `172.31.3.0/24` as the **Prefix** and `10.200.1.1` for the **Tunnel/Next hop**.\n\n2. Select **Add routes** when you are finished.\n\n## 3. Add a VPN configuration in SonicWall\n\n1. Go to **Network** > **IPsec VPN** > **Rules and Settings**.\n\n2. Select **Add**.\n\n3. In **General** > **Security Policy** group, add the following settings:\n\n   * **Authentication Method**: *IKE Using Preshared Secret*.\n   * **IPsec Primary Gateway Name or Address**: Enter Cloudflare's anycast IP address for the primary gateway (in blue).\n\n4. In the **IKE Authentication** group, add the following settings:\n\n   * **Shared secret**: Paste the pre-shared key you use to create the IPsec tunnel in step 1 (in purple).\n   * **Local IKE ID**: Select *Domain name* from the dropdown menu, and paste here the **FQDN ID** you saved from step 1, after creating the IPsec tunnel (in green).\n   * **Peer IKE IDE**: Select *IPv4* Address from the dropdown menu, and enter the Cloudflare anycast IP address (in blue).\n\n![Configure a VPN policy on your SonicWall device](https://developers.cloudflare.com/_astro/3-vpn-config.D7Z_hEIs_2mY6og.webp)\n\n1. Select **Proposals**. VPN Policy is somewhat flexible. Adjust these settings to match your organization's preferred security policy. As an example, you can use the settings in the examples below.\n\n2. In the **IKE (Phase 1) Proposal** group, select the following settings:\n\n   * **Exchange**: *IKEv2 Mode*\n   * **DH Group**: *Group 20*\n   * **Encryption**: *AES-256*\n   * **Authentication**: *SHA256*\n   * **Life Time (seconds)**: `86400`\n\n3. In the **IPsec (Phase 2) Proposal** group, add the following settings:\n\n   * **Protocol**: *ESP*\n   * **Encryption**: *AESGCM16-256*\n   * **Authentication**: *None*\n   * **Enable Perfect Forward Secrecy**: Enabled\n   * **DH Group**: *Group 20*\n   * **Life Time (seconds)**: `28800`\n\n4. Select **Advanced**.\n\n5. Enable **Disable IPsec Anti-Replay**.\n\n6. In **VPN Policy bound to** select your WAN interface from the dropdown menu, to bind it to your VPN.\n\n7. Select **Save**.\n\n![Enable anti-replay on your SonicWall device](https://developers.cloudflare.com/_astro/5-anti-replay.Dth4Gt_P_ZwYCWu.webp)\n\n## 4. Add a VPN tunnel interface\n\nSonicOS requires a VPN tunnel interface to route traffic via Magic WAN. When creating the interface, use the prefix `10.200.1.1/31`. This matches with the Cloudflare side for this tunnel, which is `10.200.1.0`.\n\nNote\n\nYou will need to use a different IP pair for each tunnel/site.\n\n1. Go to **Network** > **System** > **Interfaces**.\n2. Select **Add interface** > **VPN Tunnel Interface**.\n3. For IP Address, use `10.200.1.1`.\n4. Enable **Ping**. This is required so the interface can be pinged for debugging and Magic WAN health checks.\n\n![Enable ping to that your interface can be pinged for debugging and Magic WAN health checks](https://developers.cloudflare.com/_astro/6-vpn-ping.C-1HHDpJ_Z18xDRn.webp)\n\n1. Select **Advanced**.\n2. Enable the **Enable Asymmetric Route Support** option. This is required for the Magic WAN tunnel health check.\n\n![Enable Asymmetric Route Support. It is required for Magic WAN health checks](https://developers.cloudflare.com/_astro/6-vpn-assymetric.z4MOIOv3_fuABl.webp)\n\n1. Select **OK**.\n\n## 5. Add address object(s)\n\nAddress objects are necessary for route policies. In our example, we have one other site that will be reached via Magic WAN. First, you need to create address objects for each network. Then, you need to create an address group that contains all the remote networks. This address group will be used in the next step to create the correct route policies.\n\nTo add an address object:\n\n1. Select **Object** > **Match Objects** > **Addresses**.\n2. Select **Address Objects** > **Add**.\n3. Enter the information for your address object - refer to the topology image for the examples this tutorial is using. Since the addresses are in the VPN zone, set the **Zone Assignment** for the object to *VPN*.\n4. Select **Save**. The window will stay on to facilitate multiple entries. Select **X** to close it.\n\n![Enter the appropriate settings for you object](https://developers.cloudflare.com/_astro/7-address-objects-settings.Dym3UpvD_bLprj.webp)\n\n1. Select **Address Groups** > **Add** to add a new address group.\n2. Enter a **Name** for your address group.\n3. Select the individual network objects you have created on the left menu, and add them to the group by selecting the right-facing arrow in the middle column.\n4. Select **Save**.\n\n![Copy the individual network objects and add them to your group](https://developers.cloudflare.com/_astro/7-add-objects-group.CYauQpR7_Z4W5mb.webp)\n\n## 6. Set up routing\n\nAdd a route using the address object or group just created as the destination.\n\n1. Select **Policy** > **Rules and Policies** > **Routing Rules**.\n2. Select **Add** to add your route policy.\n3. The **Next Hop** should be the VPN tunnel interface that was previously created in the interface panel.\n\n## 7. Add access rule for health checks\n\nAn additional access rule is required for Magic WAN health checks to work properly. This will enable the WAN IP to receive ICMP pings via the tunnel, and return them over the WAN.\n\n1. Select **Policy** > **Rules and Policies**.\n2. Select **Access Rules** > **Add**.\n3. Enter a descriptive name for your policy.\n4. In **Source / Destination** > **Destination > Port/Services**, select *ICMP* from the dropdown.\n5. Select **Optional Settings**.\n6. In **Others**, enable **Allow Management traffic**.\n\n## 8. Setup health checks\n\nYou have to [configure Magic WAN health checks](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels) correctly. Here is an example of how to set up health checks:",
      "language": "unknown"
    },
    {
      "code": "Health checks might take some time to stabilize after the configuration is changed.\n\n## 9. Verify tunnel status on Cloudflare dashboard\n\nThe Cloudflare dashboard monitors the health of all anycast tunnels on your account that route traffic from Cloudflare to your origin network. Refer to [Check tunnel health in the dashboard](https://developers.cloudflare.com/magic-wan/configuration/common-settings/check-tunnel-health-dashboard/) for more information.\n\n</page>\n\n<page>\n---\ntitle: Sophos Firewall  Cloudflare Magic WAN docs\ndescription: \"This tutorial shows you how to use Magic WAN with the following\n  versions of the Sophos Firewall:\"\nlastUpdated: 2025-10-31T13:37:27.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/sophos-firewall/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/sophos-firewall/index.md\n---\n\nThis tutorial shows you how to use Magic WAN with the following versions of the Sophos Firewall:\n\n* **Sophos form factor tested:**\n\n  * Sophos Firewall XGS and XG series hardware\n  * Sophos Firewall virtual appliance on VMware\n\n* **Sophos software versions tested:**\n\n  * SFOS Version 19.0 MR2-Build 472\n  * SFOS Version 19.5.1 MR1-Build 278\n\nYou can connect through[ Generic Routing Encapsulation (GRE) or IPsec tunnels](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/) to Magic WAN.\n\n## IPsec connection\n\nThe following instructions show how to setup an IPsec connection on your Sophos Firewall device. Settings not explicitly mentioned can be left with their default values.\n\n### 1. Add an IPsec profile\n\n1. Go to **System** > **Profiles**.\n\n2. In **IPsec profiles**, select **Add**.\n\n3. In the **General settings** group, make sure you have the following settings:\n\n   * **Name**: Give your profile a descriptive name.\n   * **Key exchange**: **IKEv2**\n   * **Authentication mode**: **Main mode**\n\n4. In the **Phase 1** group, make sure you have the following settings:\n\n   * **DH group (key group)**: *20*\n   * **Encryption**: *AES256*\n   * **Authentication**: *SHA2 256*\n\n5. In the **Phase 2** group, select the following:\n\n   * **PFS group (DH group)**: *Same as phase-1*\n   * **Key life**: *28800*\n   * **Encryption**: *AES256*\n   * **Authentication**: *SHA2 256*\n\n6. Enable **Dead Peer Detection**.\n\n7. In **When peer unreachable**, select *Re-initiate*.\n\n8. Select **Save**.\n\n### 2. Create IPsec connection tunnel\n\nThe next step involves configuring a site-to-site IPsec VPN connection on your Sophos Firewall device.\n\n1. Go to **Configure** > **Site-to-site VPN**.\n\n2. In **IPsec**, select **Add**.\n\n3. In the **General settings** group, make sure you have the following settings:\n\n   * **Name**: Give your site-to-site VPN a descriptive name.\n   * **Connection type**: *Tunnel interface*\n   * **Gateway type**: *Initiate the connection*\n\n4. In the **Encryption** group, make sure you have the following settings:\n   * **Authentication type**: **Preshared key**\n\n5. In **Gateway settings**, make sure you have the following settings:\n\n   * **Gateway address**: Enter your Cloudflare anycast IP address provided by Cloudflare.\n   * **Local ID type**: Add the [IKE ID](https://developers.cloudflare.com/magic-wan/reference/gre-ipsec-tunnels/#supported-ike-id-formats) provided by Cloudflare.\n\n![Configure an IPsec tunnel.](https://developers.cloudflare.com/_astro/2-ipsec-tunnel.EuRwmMGh_wIMKi.webp)\n\nAfter setting up your IPsec tunnel, it will show up on the IPsec connections list with an **Active** status.\n\n![The IPsec tunnel should show up on the IPsec connections list.](https://developers.cloudflare.com/_astro/2b-ipsec-tunnel.DcLZdCzX_2gDzJX.webp)\n\n### 3. Assign the XFRM interface address\n\nYou must use an interface address from the `/31` subnet required to [configure tunnel endpoints](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/) on Magic WAN.\n\n1. Go to **Configure** > **Network**.\n2. In **Interfaces**, select the corresponding interface to the IPsec tunnel you created in [step 2](#2-create-ipsec-connection-tunnel).\n3. Edit the interface to assign an address from the `/31` subnet required to [configure tunnel endpoints](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/). When you are finished, it should look similar to the following:\n\n![Configure a XFRM interface.](https://developers.cloudflare.com/_astro/3-xfrm-interface.Dks8X1E8_ZPYrQT.webp)\n\n### 4. Add a firewall rule\n\n1. Go to **Protect** > **Rules and policies**.\n2. In **Firewall rules**, create a firewall rule with the criteria and security policies from your company that allows traffic to flow between Sophos and Magic WAN.\n\n![Create a firewall rule with the criteria and security policies from your company](https://developers.cloudflare.com/_astro/4-firewall-rule.CfVt6IDY_Z1zkMRq.webp)\n\n### 5. Disable IPsec anti-replay\n\nYou will have to disable IPsec Anti-Replay on your Sophos Firewall. Changing the anti-replay settings restarts the IPsec service, which causes tunnel-flap for all IPsec tunnels. This will also disable IPsec anti-replay protection for all VPN connections globally. Plan these changes accordingly.\n\nBelow are instruction on how to achieve this on SFOS version 19 and SFOS version 19.5:\n\n#### SFOS 19.0 MR2-Build 472 or 19.5 MR1-Build278 or later versions:\n\n1. Sign in to the CLI.\n\n2. Enter **4** to choose **Device console**, and enter the following command:",
      "language": "unknown"
    },
    {
      "code": "![Access the CLI to disable anti-replay](https://developers.cloudflare.com/_astro/5-sfos-19.CmXNwDG8_Z2sQ13W.webp)\n\n#### Older SFOS versions\n\nContact Sophos support.\n\n## GRE connection\n\n### 1. Configure a GRE tunnel between SFOS and Cloudflare\n\nStart by configuring a GRE tunnel between SFOS and the Cloudflare anycast IP address.\n\n1. Sign in to the CLI.\n\n2. Enter **4** to choose **Device console**, and enter the following command:",
      "language": "unknown"
    },
    {
      "code": "![Access the CLI to configure a GRE tunnel](https://developers.cloudflare.com/_astro/1-gre-connection.BwxtP6sM_Z12PvdG.webp)\n\n   For more details, refer to the [Sophos Firewall knowledge base](https://support.sophos.com/support/s/article/KB-000035813?language=en_US).\n\n### 2. Add a GRE or SD-WAN route to redirect traffic through the GRE tunnel\n\nThe detailed information on how to add a GRE or SD-WAN route to redirect traffic through the GRE tunnel, is in the next section ([Traffic redirection mechanism on Sophos Firewall](#traffic-redirection-mechanism-on-sophos-firewall)).\n\n### 3. Add a firewall rule for LAN/DMZ to VPN\n\nCreate a firewall rule with the criteria and security policies from your company that allows traffic to flow between Sophos and Magic WAN. This firewall rule should include the required networks and services.\n\n1. Go to **Protect** > **Rules and policies**.\n2. In **Firewall rules**, select **IPv4** > **Add firewall rule**.\n\n![Create a firewall rule with the criteria and security policies from your company](https://developers.cloudflare.com/_astro/4-firewall-rule.CfVt6IDY_Z1zkMRq.webp)\n\n## Traffic redirection mechanism on Sophos Firewall\n\nTo redirect traffic, you can add a static or an SD-WAN route.\n\n### IPsec\n\n#### Static route\n\nGo to **Configure** > **Routing** > **Static routes** to add an XFRM interface-based route. The interface will be automatically created when you set up a tunnel interface based on IPsec (such as the Cloudflare\\_MWAN example from above).\n\n![Go to static routes to add an XFRM interface-based route](https://developers.cloudflare.com/_astro/static-route.Cv8cjbPi_blRdV.webp)\n\n#### SD-WAN route\n\n1. Go to **Configure** > **Routing** > **Gateways** to create a custom gateway on the XFRM interface. The interface will be automatically created when you set up a tunnel interface based on IPsec (such as the Cloudflare\\_MWAN example from above).\n\n![Go to Gateways to add an XFRM interface-based route](https://developers.cloudflare.com/_astro/1-sd-wan-gateway.B-zYNWQF_Z2x4Oc6.webp)\n\n1. In **Configure** > **Routing** > **SD-WAN routes**, select **Add** to add the desired networks and services in the route to redirect traffic to Cloudflare. Enter a descriptive name for your connection, and the IP addresses you set up for your IPsec tunnels in **Incoming interface** and **Source networks**. Do not forget to choose the correct **Primary gateway** option.\n\n![Go to SD-WAN to add the desired networks and services in the route.](https://developers.cloudflare.com/_astro/2-sd-wan-routes.ZK7MHrV6_ZEhQ4a.webp)\n\n### GRE\n\nAdd a GRE or SD-WAN route or both.\n\n#### GRE route\n\nAdd the route on the CLI.\n\n1. Sign in to the CLI.\n2. Enter **4** to choose **Device console**, and enter the following command to create the tunnel:",
      "language": "unknown"
    },
    {
      "code": "![Add the route on the CLI.](https://developers.cloudflare.com/_astro/gre-route-cli.eRcqLJze_1WI8vl.webp)\n\n#### SD-WAN route\n\n1. Add a custom gateway on GRE with the peer IP address (from the `/31` subnet you chose earlier) as the Gateway IP address, and disable **Health check**.\n\n![Add a custom gateway on GRE.](https://developers.cloudflare.com/_astro/sd-wan-1-gre.CApTTOXu_Z2uMYKP.webp)\n\n1. Add an SD-WAN route with the desired networks and services in the route to redirect traffic to Cloudflare.\n\n![Add an SD-WAN route.](https://developers.cloudflare.com/_astro/2-sd-wan-routes.ZK7MHrV6_ZEhQ4a.webp)\n\n## Verify tunnel status on Cloudflare dashboard\n\nThe Cloudflare dashboard monitors the health of all anycast tunnels on your account that route traffic from Cloudflare to your origin network. Refer to [Check tunnel health in the dashboard](https://developers.cloudflare.com/magic-wan/configuration/common-settings/check-tunnel-health-dashboard/) for more information.\n\n### Make Cloudflare health checks work\n\n1. The ICMP probe packet from Cloudflare must be the type ICMP request, with anycast source IP. In the following example, we have used `172.64.240.252` as a target example:",
      "language": "unknown"
    },
    {
      "code": "1. Go to **Configure** > **Network** > **Interfaces** > **Add alias**. Add the IP address provided by Cloudflare for the ICMP probe traffic. This is needed to prevent Sophos firewall from dropping them as spoof packets. This is not the same IP used to create VPN. This is the special IP address for probe traffic only.\n\n![Add the IP address provided by Cloudflare to prevent the probe from being dropped by the firewall.](https://developers.cloudflare.com/_astro/2-icmp-probe-firewall.BD1XaeDb_ZpN0sB.webp)\n\n1. ICMP reply from SFOS should go back via the same tunnel on which the probe packets are received. You will need to create an additional SD-WAN policy route.\n\n![Configure an SD-WAN route so the ICMP reply goes back to Cloudflare via the same tunnel.](https://developers.cloudflare.com/_astro/3-icmp-probe-reply.CX60fYHN_Z9vF1H.webp)\n\nPacket flow will look like the following:",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "## Verify tunnel status on Sophos Firewall dashboard\n\n### IPsec\n\nWhen the tunnel is working, its **Status** will be green.\n\n![If the tunnel is working, it will show up with a green status.](https://developers.cloudflare.com/_astro/2b-ipsec-tunnel.DcLZdCzX_2gDzJX.webp)\n\nThe corresponding XFRM interface will also show a **Connected** status.\n\n![The XFRM interface will also show a connected status.](https://developers.cloudflare.com/_astro/1-sd-wan-gateway.B-zYNWQF_Z2x4Oc6.webp)\n\n### GRE\n\nAccess the CLI and type `system gre tunnel show` to check the status of a GRE tunnel. When the tunnel is working, its Status will show up as **Enabled**.\n\n![The GRE tunnel will show a status of Enabled when working.](https://developers.cloudflare.com/_astro/gre-status-enabled.CkTEu5BC_ZlXB2y.webp) ![The GRE tunnel will show a status of Enabled when working.](https://developers.cloudflare.com/_astro/gre-status-enabled-b.D8-vH0Du_vfstx.webp)\n\n## Troubleshooting\n\nIf a tunnel shows a connected status at both ends, but is not established:\n\n* Check if the IPsec profile configuration is correct.\n* Make sure the corresponding tunnel interfaces are up.\n* Make sure routing configuration and route precedence are correctly set on SFOS.\n* Make sure a static back route is added on Cloudflare.\n* Firewall rules for specific zones and host or service must be added in SFOS. GRE and IPsec belong to the VPN zone.\n* Perform `tcpdump` to check if packets are going through the VPN or GRE tunnel as expected.\n* Perform a packet capture on Cloudflare to see if traffic is reaching the Cloudflare platform.\n\n</page>\n\n<page>\n---\ntitle: strongSwan  Cloudflare Magic WAN docs\ndescription: This tutorial explains how to set up strongSwan along with Magic\n  WAN. You will learn how to configure strongSwan, configure an IPsec tunnel and\n  create a Policy Based Routing.\nlastUpdated: 2025-10-31T13:37:27.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/strongswan/\n  md: https://developers.cloudflare.com/magic-wan/configuration/manually/third-party/strongswan/index.md\n---\n\nThis tutorial explains how to set up strongSwan along with Magic WAN. You will learn how to configure strongSwan, configure an IPsec tunnel and create a Policy Based Routing.\n\n## 1. Health checks configuration\n\nStart by configuring the [bidirectional health checks](https://developers.cloudflare.com/magic-wan/configuration/manually/how-to/configure-tunnel-endpoints/#add-tunnels) target for Magic WAN. For this particular tutorial, we are using `172.64.240.252` as the target IP address, and `type` as the request.\n\nThis can be set up [with the API](https://developers.cloudflare.com/api/resources/magic_transit/subresources/ipsec_tunnels/methods/update/). For example:",
      "language": "unknown"
    },
    {
      "code": "## 2. Configure StrongSwan\n\n1. Start by [installing StrongSwan](https://docs.strongswan.org/docs/5.9/install/install.html). For example, open the console and run:",
      "language": "unknown"
    },
    {
      "code": "1. After StrongSwan finishes installing, go to `/etc/strongswan.conf` to edit the configuration file and add the following settings:",
      "language": "unknown"
    },
    {
      "code": "## 3. Configure IPsec file\n\n1. Go to `/etc/ipsec.conf` and add the following settings:",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Enable Logpush Job in Cloudflare",
      "id": "enable-logpush-job-in-cloudflare"
    },
    {
      "level": "h2",
      "text": "Enable the Integration in Elastic",
      "id": "enable-the-integration-in-elastic"
    },
    {
      "level": "h2",
      "text": "View Dashboards",
      "id": "view-dashboards"
    },
    {
      "level": "h2",
      "text": "Manage via the Cloudflare dashboard",
      "id": "manage-via-the-cloudflare-dashboard"
    },
    {
      "level": "h2",
      "text": "Create and get access to a GCS bucket",
      "id": "create-and-get-access-to-a-gcs-bucket"
    },
    {
      "level": "h2",
      "text": "Manage via the Cloudflare dashboard",
      "id": "manage-via-the-cloudflare-dashboard"
    },
    {
      "level": "h2",
      "text": "Manage via API",
      "id": "manage-via-api"
    },
    {
      "level": "h2",
      "text": "Example curl request",
      "id": "example-curl-request"
    },
    {
      "level": "h2",
      "text": "Manage via the Cloudflare dashboard",
      "id": "manage-via-the-cloudflare-dashboard"
    },
    {
      "level": "h2",
      "text": "Manage via API",
      "id": "manage-via-api"
    },
    {
      "level": "h3",
      "text": "1. Create a job",
      "id": "1.-create-a-job"
    },
    {
      "level": "h3",
      "text": "2. Enable (update) a job",
      "id": "2.-enable-(update)-a-job"
    },
    {
      "level": "h2",
      "text": "HTTP Receiver Protocol",
      "id": "http-receiver-protocol"
    },
    {
      "level": "h3",
      "text": "Cloudflare Firewall events",
      "id": "cloudflare-firewall-events"
    },
    {
      "level": "h3",
      "text": "Cloudflare HTTP events",
      "id": "cloudflare-http-events"
    },
    {
      "level": "h2",
      "text": "Amazon AWS S3 Rest API",
      "id": "amazon-aws-s3-rest-api"
    },
    {
      "level": "h2",
      "text": "Configure Kinesis using STS Assume Role (recommended)",
      "id": "configure-kinesis-using-sts-assume-role-(recommended)"
    },
    {
      "level": "h3",
      "text": "STS Assume Role example",
      "id": "sts-assume-role-example"
    },
    {
      "level": "h2",
      "text": "Configure Kinesis using IAM Access Keys",
      "id": "configure-kinesis-using-iam-access-keys"
    },
    {
      "level": "h3",
      "text": "IAM Access Key example",
      "id": "iam-access-key-example"
    },
    {
      "level": "h2",
      "text": "Manage via the Cloudflare dashboard",
      "id": "manage-via-the-cloudflare-dashboard"
    },
    {
      "level": "h2",
      "text": "Manage via API",
      "id": "manage-via-api"
    },
    {
      "level": "h3",
      "text": "1. Create a job",
      "id": "1.-create-a-job"
    },
    {
      "level": "h3",
      "text": "2. Enable (update) a job",
      "id": "2.-enable-(update)-a-job"
    },
    {
      "level": "h2",
      "text": "Manage via the Cloudflare dashboard",
      "id": "manage-via-the-cloudflare-dashboard"
    },
    {
      "level": "h2",
      "text": "Manage via API",
      "id": "manage-via-api"
    },
    {
      "level": "h2",
      "text": "Automatic setup",
      "id": "automatic-setup"
    },
    {
      "level": "h2",
      "text": "Custom setup",
      "id": "custom-setup"
    },
    {
      "level": "h3",
      "text": "Manage via the Cloudflare dashboard",
      "id": "manage-via-the-cloudflare-dashboard"
    },
    {
      "level": "h3",
      "text": "Manage via API",
      "id": "manage-via-api"
    },
    {
      "level": "h2",
      "text": "Download logs from R2",
      "id": "download-logs-from-r2"
    },
    {
      "level": "h3",
      "text": "Dashboard",
      "id": "dashboard"
    },
    {
      "level": "h3",
      "text": "AWS CLI",
      "id": "aws-cli"
    },
    {
      "level": "h2",
      "text": "Manage via the Cloudflare dashboard",
      "id": "manage-via-the-cloudflare-dashboard"
    },
    {
      "level": "h2",
      "text": "Manage via API",
      "id": "manage-via-api"
    },
    {
      "level": "h3",
      "text": "1. Create a job",
      "id": "1.-create-a-job"
    },
    {
      "level": "h3",
      "text": "2. Enable (update) a job",
      "id": "2.-enable-(update)-a-job"
    },
    {
      "level": "h2",
      "text": "Manage via the Cloudflare dashboard",
      "id": "manage-via-the-cloudflare-dashboard"
    },
    {
      "level": "h2",
      "text": "Manage via API",
      "id": "manage-via-api"
    },
    {
      "level": "h3",
      "text": "1. Create a job",
      "id": "1.-create-a-job"
    },
    {
      "level": "h3",
      "text": "2. Enable (update) a job",
      "id": "2.-enable-(update)-a-job"
    },
    {
      "level": "h2",
      "text": "Manage via the Cloudflare dashboard",
      "id": "manage-via-the-cloudflare-dashboard"
    },
    {
      "level": "h2",
      "text": "Manage via API",
      "id": "manage-via-api"
    },
    {
      "level": "h3",
      "text": "1. Create a job",
      "id": "1.-create-a-job"
    },
    {
      "level": "h3",
      "text": "2. Enable (update) a job",
      "id": "2.-enable-(update)-a-job"
    },
    {
      "level": "h3",
      "text": "3. Create WAF custom rule for Splunk HEC endpoint (optional)",
      "id": "3.-create-waf-custom-rule-for-splunk-hec-endpoint-(optional)"
    },
    {
      "level": "h2",
      "text": "Manage via the Cloudflare dashboard",
      "id": "manage-via-the-cloudflare-dashboard"
    },
    {
      "level": "h2",
      "text": "Configure a Hosted Collector",
      "id": "configure-a-hosted-collector"
    },
    {
      "level": "h2",
      "text": "Port configuration",
      "id": "port-configuration"
    },
    {
      "level": "h2",
      "text": "SFP+ module compatibility",
      "id": "sfp+-module-compatibility"
    },
    {
      "level": "h2",
      "text": "Recover from unsupported SFP+ inputs",
      "id": "recover-from-unsupported-sfp+-inputs"
    },
    {
      "level": "h2",
      "text": "Overview",
      "id": "overview"
    },
    {
      "level": "h2",
      "text": "How subnet NAT works in Magic WAN",
      "id": "how-subnet-nat-works-in-magic-wan"
    },
    {
      "level": "h2",
      "text": "Addressing rules",
      "id": "addressing-rules"
    },
    {
      "level": "h2",
      "text": "Example",
      "id": "example"
    },
    {
      "level": "h2",
      "text": "Configure NAT for subnets",
      "id": "configure-nat-for-subnets"
    },
    {
      "level": "h2",
      "text": "Create a policy",
      "id": "create-a-policy"
    },
    {
      "level": "h2",
      "text": "Edit a policy",
      "id": "edit-a-policy"
    },
    {
      "level": "h2",
      "text": "Delete a policy",
      "id": "delete-a-policy"
    },
    {
      "level": "h2",
      "text": "Create routed subnets",
      "id": "create-routed-subnets"
    },
    {
      "level": "h2",
      "text": "Default password to access hardware Magic WAN Connector",
      "id": "default-password-to-access-hardware-magic-wan-connector"
    },
    {
      "level": "h2",
      "text": "Default password to access Virtual Connector",
      "id": "default-password-to-access-virtual-connector"
    },
    {
      "level": "h3",
      "text": "Access Magic WAN Connector's heartbeat",
      "id": "access-magic-wan-connector's-heartbeat"
    },
    {
      "level": "h2",
      "text": "Prerequisites",
      "id": "prerequisites"
    },
    {
      "level": "h2",
      "text": "Affected Connectors",
      "id": "affected-connectors"
    },
    {
      "level": "h2",
      "text": "Configure source IPs via API",
      "id": "configure-source-ips-via-api"
    },
    {
      "level": "h2",
      "text": "Configure static routes",
      "id": "configure-static-routes"
    },
    {
      "level": "h3",
      "text": "Create a static route",
      "id": "create-a-static-route"
    },
    {
      "level": "h3",
      "text": "Edit a static route",
      "id": "edit-a-static-route"
    },
    {
      "level": "h3",
      "text": "Delete static route",
      "id": "delete-static-route"
    },
    {
      "level": "h2",
      "text": "Configure Automatic Return Routing (beta)",
      "id": "configure-automatic-return-routing-(beta)"
    },
    {
      "level": "h2",
      "text": "Configure BGP routes",
      "id": "configure-bgp-routes"
    },
    {
      "level": "h3",
      "text": "Choose an ASN for BGP peering",
      "id": "choose-an-asn-for-bgp-peering"
    },
    {
      "level": "h3",
      "text": "Set up BGP peering",
      "id": "set-up-bgp-peering"
    },
    {
      "level": "h2",
      "text": "Next steps",
      "id": "next-steps"
    },
    {
      "level": "h2",
      "text": "Ways to onboard traffic to Cloudflare",
      "id": "ways-to-onboard-traffic-to-cloudflare"
    },
    {
      "level": "h3",
      "text": "GRE and IPsec tunnels",
      "id": "gre-and-ipsec-tunnels"
    },
    {
      "level": "h3",
      "text": "Network Interconnect (CNI)",
      "id": "network-interconnect-(cni)"
    },
    {
      "level": "h2",
      "text": "Add tunnels",
      "id": "add-tunnels"
    },
    {
      "level": "h2",
      "text": "Bidirectional vs unidirectional health checks",
      "id": "bidirectional-vs-unidirectional-health-checks"
    },
    {
      "level": "h3",
      "text": "Legacy bidirectional health checks",
      "id": "legacy-bidirectional-health-checks"
    },
    {
      "level": "h2",
      "text": "Next steps",
      "id": "next-steps"
    },
    {
      "level": "h2",
      "text": "Inherited TTL value",
      "id": "inherited-ttl-value"
    },
    {
      "level": "h2",
      "text": "WARP client",
      "id": "warp-client"
    },
    {
      "level": "h2",
      "text": "Alibaba Cloud",
      "id": "alibaba-cloud"
    },
    {
      "level": "h3",
      "text": "1. Create a VPC",
      "id": "1.-create-a-vpc"
    },
    {
      "level": "h3",
      "text": "2. Create a VPN gateway",
      "id": "2.-create-a-vpn-gateway"
    },
    {
      "level": "h3",
      "text": "3. Create IPsec connections",
      "id": "3.-create-ipsec-connections"
    },
    {
      "level": "h2",
      "text": "Magic WAN",
      "id": "magic-wan"
    },
    {
      "level": "h3",
      "text": "1. IPsec tunnels",
      "id": "1.-ipsec-tunnels"
    },
    {
      "level": "h3",
      "text": "2. Static route",
      "id": "2.-static-route"
    },
    {
      "level": "h3",
      "text": "Prerequisites",
      "id": "prerequisites"
    },
    {
      "level": "h2",
      "text": "Example scenario",
      "id": "example-scenario"
    },
    {
      "level": "h2",
      "text": "1. Define a common site on the Orchestrator",
      "id": "1.-define-a-common-site-on-the-orchestrator"
    },
    {
      "level": "h2",
      "text": "2. Configure overlay policies",
      "id": "2.-configure-overlay-policies"
    },
    {
      "level": "h2",
      "text": "3. Create tunnels on Cloudflare and EdgeConnect",
      "id": "3.-create-tunnels-on-cloudflare-and-edgeconnect"
    },
    {
      "level": "h2",
      "text": "4. Create static routes on Cloudflare and EdgeConnect",
      "id": "4.-create-static-routes-on-cloudflare-and-edgeconnect"
    },
    {
      "level": "h2",
      "text": "5. Validate traffic flow",
      "id": "5.-validate-traffic-flow"
    },
    {
      "level": "h2",
      "text": "6. Cloudflare policies",
      "id": "6.-cloudflare-policies"
    },
    {
      "level": "h2",
      "text": "Prerequisites",
      "id": "prerequisites"
    },
    {
      "level": "h2",
      "text": "AWS",
      "id": "aws"
    },
    {
      "level": "h3",
      "text": "Create AWS transit gateway VPN attachment",
      "id": "create-aws-transit-gateway-vpn-attachment"
    },
    {
      "level": "h3",
      "text": "Configure the VPN connection",
      "id": "configure-the-vpn-connection"
    },
    {
      "level": "h2",
      "text": "Magic WAN",
      "id": "magic-wan"
    },
    {
      "level": "h3",
      "text": "IPsec tunnels",
      "id": "ipsec-tunnels"
    },
    {
      "level": "h3",
      "text": "Static routes",
      "id": "static-routes"
    },
    {
      "level": "h2",
      "text": "Cisco IOS XE configuration example",
      "id": "cisco-ios-xe-configuration-example"
    },
    {
      "level": "h3",
      "text": "Establish IPsec behind a NAT or CGNAT with port `4500`",
      "id": "establish-ipsec-behind-a-nat-or-cgnat-with-port-`4500`"
    },
    {
      "level": "h2",
      "text": "Diagnostic output: show crypto session detail",
      "id": "diagnostic-output:-show-crypto-session-detail"
    },
    {
      "level": "h2",
      "text": "Diagnostic output: show crypto session remote `<ANYCAST 01>` detail",
      "id": "diagnostic-output:-show-crypto-session-remote-`<anycast-01>`-detail"
    },
    {
      "level": "h2",
      "text": "Diagnostic output: show crypto session remote `<ANYCAST 02>` detail",
      "id": "diagnostic-output:-show-crypto-session-remote-`<anycast-02>`-detail"
    },
    {
      "level": "h2",
      "text": "Troubleshooting",
      "id": "troubleshooting"
    },
    {
      "level": "h2",
      "text": "Testing environment",
      "id": "testing-environment"
    },
    {
      "level": "h2",
      "text": "IPsec configuration",
      "id": "ipsec-configuration"
    },
    {
      "level": "h3",
      "text": "Magic WAN configuration",
      "id": "magic-wan-configuration"
    },
    {
      "level": "h3",
      "text": "FITELnet router configuration",
      "id": "fitelnet-router-configuration"
    },
    {
      "level": "h2",
      "text": "Static route configuration",
      "id": "static-route-configuration"
    },
    {
      "level": "h3",
      "text": "Magic WAN",
      "id": "magic-wan"
    },
    {
      "level": "h3",
      "text": "FITELnet router configuration",
      "id": "fitelnet-router-configuration"
    },
    {
      "level": "h2",
      "text": "Connection test",
      "id": "connection-test"
    },
    {
      "level": "h3",
      "text": "IPsec status",
      "id": "ipsec-status"
    },
    {
      "level": "h3",
      "text": "Route Status",
      "id": "route-status"
    },
    {
      "level": "h2",
      "text": "Testing Environment",
      "id": "testing-environment"
    },
    {
      "level": "h2",
      "text": "Magic WAN configuration",
      "id": "magic-wan-configuration"
    },
    {
      "level": "h3",
      "text": "Magic IPsec Tunnels",
      "id": "magic-ipsec-tunnels"
    },
    {
      "level": "h3",
      "text": "Magic static routes",
      "id": "magic-static-routes"
    },
    {
      "level": "h2",
      "text": "Fortinet FortiGate configuration",
      "id": "fortinet-fortigate-configuration"
    },
    {
      "level": "h3",
      "text": "Enable asymmetric routing",
      "id": "enable-asymmetric-routing"
    },
    {
      "level": "h3",
      "text": "Configure NAT-T (optional)",
      "id": "configure-nat-t-(optional)"
    },
    {
      "level": "h3",
      "text": "Disable anti-replay protection",
      "id": "disable-anti-replay-protection"
    },
    {
      "level": "h3",
      "text": "IPsec tunnels",
      "id": "ipsec-tunnels"
    },
    {
      "level": "h3",
      "text": "Network interfaces",
      "id": "network-interfaces"
    },
    {
      "level": "h3",
      "text": "Validate communication across virtual tunnel interfaces",
      "id": "validate-communication-across-virtual-tunnel-interfaces"
    },
    {
      "level": "h3",
      "text": "Zone objects (optional)",
      "id": "zone-objects-(optional)"
    },
    {
      "level": "h3",
      "text": "Create Address Objects",
      "id": "create-address-objects"
    },
    {
      "level": "h3",
      "text": "Configure Address Group Object",
      "id": "configure-address-group-object"
    },
    {
      "level": "h3",
      "text": "Add security policy",
      "id": "add-security-policy"
    },
    {
      "level": "h3",
      "text": "Policy-based routing",
      "id": "policy-based-routing"
    },
    {
      "level": "h2",
      "text": "Monitor Cloudflare Magic IPsec tunnel health checks",
      "id": "monitor-cloudflare-magic-ipsec-tunnel-health-checks"
    },
    {
      "level": "h2",
      "text": "Troubleshooting",
      "id": "troubleshooting"
    },
    {
      "level": "h3",
      "text": "Packet Capture",
      "id": "packet-capture"
    },
    {
      "level": "h3",
      "text": "Flow Debugging",
      "id": "flow-debugging"
    },
    {
      "level": "h3",
      "text": "Disable Flow Debugging",
      "id": "disable-flow-debugging"
    },
    {
      "level": "h2",
      "text": "Prerequisites",
      "id": "prerequisites"
    },
    {
      "level": "h2",
      "text": "Google Cloud Platform",
      "id": "google-cloud-platform"
    },
    {
      "level": "h3",
      "text": "Create a GCP Cloud VPN Gateway",
      "id": "create-a-gcp-cloud-vpn-gateway"
    },
    {
      "level": "h3",
      "text": "Configure the VPN connection",
      "id": "configure-the-vpn-connection"
    },
    {
      "level": "h3",
      "text": "Static Routes",
      "id": "static-routes"
    },
    {
      "level": "h2",
      "text": "Magic WAN",
      "id": "magic-wan"
    },
    {
      "level": "h3",
      "text": "IPsec tunnels",
      "id": "ipsec-tunnels"
    },
    {
      "level": "h3",
      "text": "Static routes",
      "id": "static-routes"
    },
    {
      "level": "h2",
      "text": "Prerequisites",
      "id": "prerequisites"
    },
    {
      "level": "h2",
      "text": "Cloudflare Magic WAN configuration",
      "id": "cloudflare-magic-wan-configuration"
    },
    {
      "level": "h3",
      "text": "Magic WAN topology",
      "id": "magic-wan-topology"
    },
    {
      "level": "h3",
      "text": "Magic IPsec tunnels",
      "id": "magic-ipsec-tunnels"
    },
    {
      "level": "h3",
      "text": "Magic static routes",
      "id": "magic-static-routes"
    },
    {
      "level": "h2",
      "text": "Juniper SRX configuration",
      "id": "juniper-srx-configuration"
    },
    {
      "level": "h3",
      "text": "Tunnel interfaces",
      "id": "tunnel-interfaces"
    },
    {
      "level": "h3",
      "text": "Security Zone (Cloudflare) - tunnel interfaces",
      "id": "security-zone-(cloudflare)---tunnel-interfaces"
    },
    {
      "level": "h3",
      "text": "Security zone (untrust) - `host-inbound-traffic`",
      "id": "security-zone-(untrust)---`host-inbound-traffic`"
    },
    {
      "level": "h3",
      "text": "IKE - Phase 1",
      "id": "ike---phase-1"
    },
    {
      "level": "h3",
      "text": "Phase 2 - IPsec",
      "id": "phase-2---ipsec"
    },
    {
      "level": "h3",
      "text": "Policy-Based Routing",
      "id": "policy-based-routing"
    },
    {
      "level": "h3",
      "text": "Security policies",
      "id": "security-policies"
    },
    {
      "level": "h2",
      "text": "Troubleshooting",
      "id": "troubleshooting"
    },
    {
      "level": "h3",
      "text": "Validate tunnel connectivity",
      "id": "validate-tunnel-connectivity"
    },
    {
      "level": "h3",
      "text": "IKE `traceoptions`",
      "id": "ike-`traceoptions`"
    },
    {
      "level": "h2",
      "text": "## inactive: security ike traceoptions",
      "id": "##-inactive:-security-ike-traceoptions"
    },
    {
      "level": "h2",
      "text": "file ike-debug.log size 1m files 3 world-readable;",
      "id": "file-ike-debug.log-size-1m-files-3-world-readable;"
    },
    {
      "level": "h3",
      "text": "IPsec `traceoptions`",
      "id": "ipsec-`traceoptions`"
    },
    {
      "level": "h2",
      "text": "## inactive: security ipsec traceoptions",
      "id": "##-inactive:-security-ipsec-traceoptions"
    },
    {
      "level": "h2",
      "text": "file ipsec-debug.log size 1m files 3 world-readable;",
      "id": "file-ipsec-debug.log-size-1m-files-3-world-readable;"
    },
    {
      "level": "h2",
      "text": "Prerequisites",
      "id": "prerequisites"
    },
    {
      "level": "h2",
      "text": "Oracle Cloud",
      "id": "oracle-cloud"
    },
    {
      "level": "h3",
      "text": "1. Create Oracle Cloud customer-premises equipment",
      "id": "1.-create-oracle-cloud-customer-premises-equipment"
    },
    {
      "level": "h3",
      "text": "2. Create Oracle Cloud dynamic routing gateways",
      "id": "2.-create-oracle-cloud-dynamic-routing-gateways"
    },
    {
      "level": "h3",
      "text": "3. Create an IPsec connection",
      "id": "3.-create-an-ipsec-connection"
    },
    {
      "level": "h2",
      "text": "Magic WAN",
      "id": "magic-wan"
    },
    {
      "level": "h3",
      "text": "IPsec tunnels",
      "id": "ipsec-tunnels"
    },
    {
      "level": "h3",
      "text": "Static routes",
      "id": "static-routes"
    },
    {
      "level": "h2",
      "text": "Software version tested",
      "id": "software-version-tested"
    },
    {
      "level": "h2",
      "text": "Use Cases",
      "id": "use-cases"
    },
    {
      "level": "h2",
      "text": "Prerequisites",
      "id": "prerequisites"
    },
    {
      "level": "h2",
      "text": "Environment",
      "id": "environment"
    },
    {
      "level": "h2",
      "text": "Cloudflare Magic WAN",
      "id": "cloudflare-magic-wan"
    },
    {
      "level": "h3",
      "text": "Magic IPsec Tunnels",
      "id": "magic-ipsec-tunnels"
    },
    {
      "level": "h3",
      "text": "Magic Static Routes",
      "id": "magic-static-routes"
    },
    {
      "level": "h2",
      "text": "Palo Alto Networks Next-Generation Firewall",
      "id": "palo-alto-networks-next-generation-firewall"
    },
    {
      "level": "h3",
      "text": "Tags",
      "id": "tags"
    },
    {
      "level": "h3",
      "text": "Objects",
      "id": "objects"
    },
    {
      "level": "h3",
      "text": "Interface Mgmt - Network Profiles",
      "id": "interface-mgmt---network-profiles"
    },
    {
      "level": "h3",
      "text": "Network Interfaces",
      "id": "network-interfaces"
    },
    {
      "level": "h3",
      "text": "Tunnel interfaces",
      "id": "tunnel-interfaces"
    },
    {
      "level": "h3",
      "text": "Zones",
      "id": "zones"
    },
    {
      "level": "h3",
      "text": "Apply Changes",
      "id": "apply-changes"
    },
    {
      "level": "h3",
      "text": "IKE crypto profile Phase 1",
      "id": "ike-crypto-profile-phase-1"
    },
    {
      "level": "h3",
      "text": "IPsec crypto profile Phase 2",
      "id": "ipsec-crypto-profile-phase-2"
    },
    {
      "level": "h3",
      "text": "IKE Gateways",
      "id": "ike-gateways"
    },
    {
      "level": "h3",
      "text": "IPsec Tunnels",
      "id": "ipsec-tunnels"
    },
    {
      "level": "h3",
      "text": "Apply Changes",
      "id": "apply-changes"
    },
    {
      "level": "h3",
      "text": "IPsec tunnel connectivity tests",
      "id": "ipsec-tunnel-connectivity-tests"
    },
    {
      "level": "h3",
      "text": "Virtual Router",
      "id": "virtual-router"
    },
    {
      "level": "h3",
      "text": "Magic health checks",
      "id": "magic-health-checks"
    },
    {
      "level": "h3",
      "text": "Troubleshooting tunnel health checks",
      "id": "troubleshooting-tunnel-health-checks"
    },
    {
      "level": "h3",
      "text": "Security Policies - Production Traffic",
      "id": "security-policies---production-traffic"
    },
    {
      "level": "h3",
      "text": "Policy-based forwarding - production traffic",
      "id": "policy-based-forwarding---production-traffic"
    },
    {
      "level": "h2",
      "text": "Magic WAN with Cloudflare Zero Trust (Gateway egress)",
      "id": "magic-wan-with-cloudflare-zero-trust-(gateway-egress)"
    },
    {
      "level": "h3",
      "text": "Security Rule: Trust to Gateway Egress",
      "id": "security-rule:-trust-to-gateway-egress"
    },
    {
      "level": "h3",
      "text": "Policy-based forwarding: Trust to Gateway egress via tunnel.1",
      "id": "policy-based-forwarding:-trust-to-gateway-egress-via-tunnel.1"
    },
    {
      "level": "h3",
      "text": "Policy-based forwarding: Trust to Gateway egress via tunnel.2",
      "id": "policy-based-forwarding:-trust-to-gateway-egress-via-tunnel.2"
    },
    {
      "level": "h2",
      "text": "Troubleshooting",
      "id": "troubleshooting"
    },
    {
      "level": "h2",
      "text": "Software tested",
      "id": "software-tested"
    },
    {
      "level": "h2",
      "text": "Prerequisites",
      "id": "prerequisites"
    },
    {
      "level": "h2",
      "text": "Example scenario",
      "id": "example-scenario"
    },
    {
      "level": "h2",
      "text": "1. Configure Magic WAN IPsec tunnels",
      "id": "1.-configure-magic-wan-ipsec-tunnels"
    },
    {
      "level": "h3",
      "text": "Add IPsec tunnels",
      "id": "add-ipsec-tunnels"
    },
    {
      "level": "h3",
      "text": "Generate pre-shared keys",
      "id": "generate-pre-shared-keys"
    },
    {
      "level": "h3",
      "text": "IPsec identifier - User ID",
      "id": "ipsec-identifier---user-id"
    },
    {
      "level": "h2",
      "text": "2. Create Magic WAN static routes",
      "id": "2.-create-magic-wan-static-routes"
    },
    {
      "level": "h3",
      "text": "Tunnel 01",
      "id": "tunnel-01"
    },
    {
      "level": "h3",
      "text": "Tunnel 02",
      "id": "tunnel-02"
    },
    {
      "level": "h2",
      "text": "3. Configure the pfSense firewall",
      "id": "3.-configure-the-pfsense-firewall"
    },
    {
      "level": "h3",
      "text": "Configure IPsec Phase 1",
      "id": "configure-ipsec-phase-1"
    },
    {
      "level": "h3",
      "text": "Configure IPsec Phase 2",
      "id": "configure-ipsec-phase-2"
    },
    {
      "level": "h3",
      "text": "Interface assignments",
      "id": "interface-assignments"
    },
    {
      "level": "h3",
      "text": "Gateway",
      "id": "gateway"
    },
    {
      "level": "h3",
      "text": "Firewall Rules IPsec",
      "id": "firewall-rules-ipsec"
    },
    {
      "level": "h3",
      "text": "Firewall Rules LAN",
      "id": "firewall-rules-lan"
    },
    {
      "level": "h2",
      "text": "Topology",
      "id": "topology"
    },
    {
      "level": "h2",
      "text": "1. Create an IPsec tunnel on your Cloudflare account",
      "id": "1.-create-an-ipsec-tunnel-on-your-cloudflare-account"
    },
    {
      "level": "h2",
      "text": "2. Create static routes on Cloudflare dashboard",
      "id": "2.-create-static-routes-on-cloudflare-dashboard"
    },
    {
      "level": "h2",
      "text": "3. Add a VPN configuration in SonicWall",
      "id": "3.-add-a-vpn-configuration-in-sonicwall"
    },
    {
      "level": "h2",
      "text": "4. Add a VPN tunnel interface",
      "id": "4.-add-a-vpn-tunnel-interface"
    },
    {
      "level": "h2",
      "text": "5. Add address object(s)",
      "id": "5.-add-address-object(s)"
    },
    {
      "level": "h2",
      "text": "6. Set up routing",
      "id": "6.-set-up-routing"
    },
    {
      "level": "h2",
      "text": "7. Add access rule for health checks",
      "id": "7.-add-access-rule-for-health-checks"
    },
    {
      "level": "h2",
      "text": "8. Setup health checks",
      "id": "8.-setup-health-checks"
    },
    {
      "level": "h2",
      "text": "9. Verify tunnel status on Cloudflare dashboard",
      "id": "9.-verify-tunnel-status-on-cloudflare-dashboard"
    },
    {
      "level": "h2",
      "text": "IPsec connection",
      "id": "ipsec-connection"
    },
    {
      "level": "h3",
      "text": "1. Add an IPsec profile",
      "id": "1.-add-an-ipsec-profile"
    },
    {
      "level": "h3",
      "text": "2. Create IPsec connection tunnel",
      "id": "2.-create-ipsec-connection-tunnel"
    },
    {
      "level": "h3",
      "text": "3. Assign the XFRM interface address",
      "id": "3.-assign-the-xfrm-interface-address"
    },
    {
      "level": "h3",
      "text": "4. Add a firewall rule",
      "id": "4.-add-a-firewall-rule"
    },
    {
      "level": "h3",
      "text": "5. Disable IPsec anti-replay",
      "id": "5.-disable-ipsec-anti-replay"
    },
    {
      "level": "h2",
      "text": "GRE connection",
      "id": "gre-connection"
    },
    {
      "level": "h3",
      "text": "1. Configure a GRE tunnel between SFOS and Cloudflare",
      "id": "1.-configure-a-gre-tunnel-between-sfos-and-cloudflare"
    },
    {
      "level": "h3",
      "text": "2. Add a GRE or SD-WAN route to redirect traffic through the GRE tunnel",
      "id": "2.-add-a-gre-or-sd-wan-route-to-redirect-traffic-through-the-gre-tunnel"
    },
    {
      "level": "h3",
      "text": "3. Add a firewall rule for LAN/DMZ to VPN",
      "id": "3.-add-a-firewall-rule-for-lan/dmz-to-vpn"
    },
    {
      "level": "h2",
      "text": "Traffic redirection mechanism on Sophos Firewall",
      "id": "traffic-redirection-mechanism-on-sophos-firewall"
    },
    {
      "level": "h3",
      "text": "IPsec",
      "id": "ipsec"
    },
    {
      "level": "h3",
      "text": "GRE",
      "id": "gre"
    },
    {
      "level": "h2",
      "text": "Verify tunnel status on Cloudflare dashboard",
      "id": "verify-tunnel-status-on-cloudflare-dashboard"
    },
    {
      "level": "h3",
      "text": "Make Cloudflare health checks work",
      "id": "make-cloudflare-health-checks-work"
    },
    {
      "level": "h2",
      "text": "Verify tunnel status on Sophos Firewall dashboard",
      "id": "verify-tunnel-status-on-sophos-firewall-dashboard"
    },
    {
      "level": "h3",
      "text": "IPsec",
      "id": "ipsec"
    },
    {
      "level": "h3",
      "text": "GRE",
      "id": "gre"
    },
    {
      "level": "h2",
      "text": "Troubleshooting",
      "id": "troubleshooting"
    },
    {
      "level": "h2",
      "text": "1. Health checks configuration",
      "id": "1.-health-checks-configuration"
    },
    {
      "level": "h2",
      "text": "2. Configure StrongSwan",
      "id": "2.-configure-strongswan"
    },
    {
      "level": "h2",
      "text": "3. Configure IPsec file",
      "id": "3.-configure-ipsec-file"
    }
  ],
  "url": "llms-txt#expected:-error-code:-1020",
  "links": []
}