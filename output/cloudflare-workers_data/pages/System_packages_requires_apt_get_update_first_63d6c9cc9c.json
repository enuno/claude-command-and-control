{
  "title": "System packages (requires apt-get update first)",
  "content": "apt-get update && apt-get install -y redis-server\ntypescript\nawait sandbox.writeFile('/workspace/app.py', 'print(\"Hello\")');\nawait sandbox.writeFile('/tmp/cache.json', '{}');\nawait sandbox.exec('ls -la /workspace');\ntypescript\nconst result = await sandbox.exec('npm test');\n// Waits for completion, returns output\ntypescript\nconst process = await sandbox.startProcess('node server.js');\n// Returns immediately, process runs in background\nbash\ncurl https://api.example.com/data\npip install requests\nnpm install express\ntypescript\nconst { hostname } = new URL(request.url);\nawait sandbox.startProcess('python -m http.server 8000');\nconst exposed = await sandbox.exposePort(8000, { hostname });\nconsole.log(exposed.exposedAt); // Public URL\nbash\nredis-server &      # Start server\nredis-cli ping      # Connect locally\ntypescript\nconst sandbox = getSandbox(env.Sandbox, `user-${userId}`);\ntypescript\n// Extract hostname from request\nconst { hostname } = new URL(request.url);\n\nawait sandbox.startProcess(\"python -m http.server 8000\");\nconst exposed = await sandbox.exposePort(8000, { hostname });\n\nconsole.log(exposed.exposedAt);\n// Production: https://8000-abc123.yourdomain.com\n// Local dev: http://localhost:8787/...\ntypescript\n// Problem scenario\nconst sandbox = getSandbox(env.Sandbox, 'MyProject-123');\n// Durable Object ID: \"MyProject-123\"\nawait sandbox.exposePort(8080, { hostname });\n// Preview URL: 8000-myproject-123.yourdomain.com\n// Routes to: \"myproject-123\" (different DO - doesn't exist!)\ntypescript\nconst sandbox = getSandbox(env.Sandbox, 'MyProject-123', {\n  normalizeId: true\n});\n// Durable Object ID: \"myproject-123\" (lowercased)\n// Preview URL: 8000-myproject-123.yourdomain.com\n// Routes to: \"myproject-123\" (same DO - works!)\ntypescript\nimport { proxyToSandbox, getSandbox } from \"@cloudflare/sandbox\";\n\nexport { Sandbox } from \"@cloudflare/sandbox\";\n\nexport default {\n  async fetch(request, env) {\n    // Handle preview URL routing first\n    const proxyResponse = await proxyToSandbox(request, env);\n    if (proxyResponse) return proxyResponse;\n\n// Your application routes\n    // ...\n  },\n};\ntypescript\n// Extract hostname from request\nconst { hostname } = new URL(request.url);\n\nawait sandbox.startProcess(\"node api.js\"); // Port 3000\nawait sandbox.startProcess(\"node admin.js\"); // Port 3001\n\nconst api = await sandbox.exposePort(3000, { hostname, name: \"api\" });\nconst admin = await sandbox.exposePort(3001, { hostname, name: \"admin\" });\n\n// Each gets its own URL:\n// https://3000-abc123.yourdomain.com\n// https://3001-abc123.yourdomain.com\ntypescript\n// Extract hostname from request\nconst { hostname } = new URL(request.url);\n\n// Start a WebSocket server\nawait sandbox.startProcess(\"bun run ws-server.ts 8080\");\nconst { exposedAt } = await sandbox.exposePort(8080, { hostname });\n\n// Clients connect using WebSocket protocol\n// Browser: new WebSocket('wss://8080-abc123.yourdomain.com')\n\n// Your Worker routes automatically\nexport default {\n  async fetch(request, env) {\n    const proxyResponse = await proxyToSandbox(request, env);\n    if (proxyResponse) return proxyResponse;\n  },\n};\npython\nfrom flask import Flask, request, abort\n\napp = Flask(__name__)\n\n@app.route('/data')\ndef get_data():\n    # Check for your own authentication token\n    auth_token = request.headers.get('Authorization')\n    if auth_token != 'Bearer your-secret-token':\n        abort(401)\n    return {'data': 'protected'}\ntypescript\n// 1. Is service running?\nconst processes = await sandbox.listProcesses();\n\n// 2. Is port exposed?\nconst ports = await sandbox.getExposedPorts();\n\n// 3. Is service binding to 0.0.0.0 (not 127.0.0.1)?\n// Good:\napp.run((host = \"0.0.0.0\"), (port = 3000));\n\n// Bad (localhost only):\napp.run((host = \"127.0.0.1\"), (port = 3000));\ndockerfile\nFROM docker.io/cloudflare/sandbox:0.3.3",
  "code_samples": [
    {
      "code": "## Filesystem\n\nThe container provides a standard Linux filesystem. You can read and write anywhere you have permissions.\n\n**Standard directories**:\n\n* `/workspace` - Default working directory for user code\n* `/tmp` - Temporary files\n* `/home` - User home directory\n* `/usr/bin`, `/usr/local/bin` - Executable binaries\n\n**Example**:",
      "language": "unknown"
    },
    {
      "code": "## Process management\n\nProcesses run as you'd expect in a regular Linux environment.\n\n**Foreground processes** (`exec()`):",
      "language": "unknown"
    },
    {
      "code": "**Background processes** (`startProcess()`):",
      "language": "unknown"
    },
    {
      "code": "## Network capabilities\n\n**Outbound connections** work:",
      "language": "unknown"
    },
    {
      "code": "**Inbound connections** require port exposure:",
      "language": "unknown"
    },
    {
      "code": "Local development\n\nWhen using `wrangler dev`, you must add `EXPOSE` directives to your Dockerfile for each port. See [Local development with ports](https://developers.cloudflare.com/sandbox/guides/expose-services/#local-development).\n\n**Localhost** works within sandbox:",
      "language": "unknown"
    },
    {
      "code": "## Security\n\n**Between sandboxes** (isolated):\n\n* Each sandbox is a separate container\n* Filesystem, memory and network are all isolated\n\n**Within sandbox** (shared):\n\n* All processes see the same files\n* Processes can communicate with each other\n* Environment variables are session-scoped\n\nTo run untrusted code, use separate sandboxes per user:",
      "language": "unknown"
    },
    {
      "code": "## Limitations\n\n**Cannot**:\n\n* Load kernel modules or access host hardware\n* Run nested containers (no Docker-in-Docker)\n\n## Related resources\n\n* [Architecture](https://developers.cloudflare.com/sandbox/concepts/architecture/) - How containers fit in the system\n* [Security model](https://developers.cloudflare.com/sandbox/concepts/security/) - Container isolation details\n* [Sandbox lifecycle](https://developers.cloudflare.com/sandbox/concepts/sandboxes/) - Container lifecycle management\n\n</page>\n\n<page>\n---\ntitle: Preview URLs · Cloudflare Sandbox SDK docs\ndescription: Preview URLs provide public HTTPS access to services running inside\n  sandboxes. When you expose a port, you get a unique URL that proxies requests\n  to your service.\nlastUpdated: 2025-11-18T19:18:00.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/sandbox/concepts/preview-urls/\n  md: https://developers.cloudflare.com/sandbox/concepts/preview-urls/index.md\n---\n\nProduction requires custom domain\n\nPreview URLs work in local development without configuration. For production, you need a custom domain with wildcard DNS routing. See [Production Deployment](https://developers.cloudflare.com/sandbox/guides/production-deployment/).\n\nPreview URLs provide public HTTPS access to services running inside sandboxes. When you expose a port, you get a unique URL that proxies requests to your service.",
      "language": "unknown"
    },
    {
      "code": "## URL Format\n\n**Production**: `https://{port}-{sandbox-id}.yourdomain.com`\n\n* Port 8080: `https://8080-abc123.yourdomain.com`\n* Port 3000: `https://3000-abc123.yourdomain.com`\n\n**Local development**: `http://localhost:8787/...`\n\nPreview URLs remain stable while a port is exposed and can be shared during that time. However, if you unexpose and re-expose a port, a new random token is generated and the URL changes. For persistent URLs, keep ports exposed for the duration you need them accessible.\n\n## ID Case Sensitivity\n\nPreview URLs extract the sandbox ID from the hostname to route requests. Since hostnames are case-insensitive (per RFC 3986), they're always lowercased: `8080-MyProject-123.yourdomain.com` becomes `8080-myproject-123.yourdomain.com`.\n\n**The problem**: If you create a sandbox with `\"MyProject-123\"`, it exists as a Durable Object with that exact ID. But the preview URL routes to `\"myproject-123\"` (lowercased from the hostname). These are different Durable Objects, so your sandbox is unreachable via preview URL.",
      "language": "unknown"
    },
    {
      "code": "**The solution**: Use `normalizeId: true` to lowercase IDs when creating sandboxes:",
      "language": "unknown"
    },
    {
      "code": "Without `normalizeId: true`, `exposePort()` throws an error when the ID contains uppercase letters.\n\n**Best practice**: Use lowercase IDs from the start (`'my-project-123'`). See [Sandbox options - normalizeId](https://developers.cloudflare.com/sandbox/configuration/sandbox-options/#normalizeid) for details.\n\n## Request Routing\n\nYou must call `proxyToSandbox()` first in your Worker's fetch handler to route preview URL requests:",
      "language": "unknown"
    },
    {
      "code": "Requests flow: Browser → Your Worker → Durable Object (sandbox) → Your Service.\n\n## Multiple Ports\n\nExpose multiple services simultaneously:",
      "language": "unknown"
    },
    {
      "code": "## What Works\n\n* HTTP/HTTPS requests\n* WebSocket connections\n* Server-Sent Events\n* All HTTP methods (GET, POST, PUT, DELETE, etc.)\n* Request and response headers\n\n## What Does Not Work\n\n* Raw TCP/UDP connections\n* Custom protocols (must wrap in HTTP)\n* Ports outside range 1024-65535\n* Port 3000 (used internally by the SDK)\n\n## WebSocket Support\n\nPreview URLs support WebSocket connections. When a WebSocket upgrade request hits an exposed port, the routing layer automatically handles the connection handshake.",
      "language": "unknown"
    },
    {
      "code": "For custom routing scenarios where your Worker needs to control which sandbox or port to connect to based on request properties, see `wsConnect()` in the [Ports API](https://developers.cloudflare.com/sandbox/api/ports/#wsconnect).\n\n## Security\n\nWarning\n\nPreview URLs are publicly accessible by default, but require a valid access token that is generated when you expose a port.\n\n**Built-in security**:\n\n* **Token-based access** - Each exposed port gets a unique token in the URL (for example, `https://8080-sandbox-abc123token.yourdomain.com`)\n* **HTTPS in production** - All traffic is encrypted with automatic TLS\n* **Unpredictable URLs** - Tokens are randomly generated and difficult to guess\n\n**Add application-level authentication**:\n\nFor additional security, implement authentication within your application:",
      "language": "unknown"
    },
    {
      "code": "This adds a second layer of security on top of the URL token.\n\n## Troubleshooting\n\n### URL Not Accessible\n\nCheck if service is running and listening:",
      "language": "unknown"
    },
    {
      "code": "### Production Errors\n\nFor custom domain issues, see [Production Deployment troubleshooting](https://developers.cloudflare.com/sandbox/guides/production-deployment/#troubleshooting).\n\n### Local Development\n\nLocal development limitation\n\nWhen using `wrangler dev`, you must expose ports in your Dockerfile:",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Filesystem",
      "id": "filesystem"
    },
    {
      "level": "h2",
      "text": "Process management",
      "id": "process-management"
    },
    {
      "level": "h2",
      "text": "Network capabilities",
      "id": "network-capabilities"
    },
    {
      "level": "h2",
      "text": "Security",
      "id": "security"
    },
    {
      "level": "h2",
      "text": "Limitations",
      "id": "limitations"
    },
    {
      "level": "h2",
      "text": "Related resources",
      "id": "related-resources"
    },
    {
      "level": "h2",
      "text": "URL Format",
      "id": "url-format"
    },
    {
      "level": "h2",
      "text": "ID Case Sensitivity",
      "id": "id-case-sensitivity"
    },
    {
      "level": "h2",
      "text": "Request Routing",
      "id": "request-routing"
    },
    {
      "level": "h2",
      "text": "Multiple Ports",
      "id": "multiple-ports"
    },
    {
      "level": "h2",
      "text": "What Works",
      "id": "what-works"
    },
    {
      "level": "h2",
      "text": "What Does Not Work",
      "id": "what-does-not-work"
    },
    {
      "level": "h2",
      "text": "WebSocket Support",
      "id": "websocket-support"
    },
    {
      "level": "h2",
      "text": "Security",
      "id": "security"
    },
    {
      "level": "h2",
      "text": "Troubleshooting",
      "id": "troubleshooting"
    },
    {
      "level": "h3",
      "text": "URL Not Accessible",
      "id": "url-not-accessible"
    },
    {
      "level": "h3",
      "text": "Production Errors",
      "id": "production-errors"
    },
    {
      "level": "h3",
      "text": "Local Development",
      "id": "local-development"
    }
  ],
  "url": "llms-txt#system-packages-(requires-apt-get-update-first)",
  "links": []
}