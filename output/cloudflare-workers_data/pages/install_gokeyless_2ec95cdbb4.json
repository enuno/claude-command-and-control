{
  "title": "install gokeyless",
  "content": "sudo apt-get update && sudo apt-get install gokeyless\nsh\nsudo yum makecache\nsudo yum-config-manager --add-repo https://pkg.cloudflare.com/gokeyless.repo && sudo yum-config-manager --setopt=gokeyless-stable.gpgkey=https://pkg.cloudflare.com/cloudflare-ascii-pubkey.gpg --save\nsudo yum install gokeyless\nsh\nsudo dnf install dnf-plugins-core && dnf clean all\nsudo dnf config-manager --add-repo https://pkg.cloudflare.com/gokeyless.repo\nsudo dnf install gokeyless\nsh\nls -l /etc/keyless/keys\nsh\n-r-------- 1 keyless keyless 1675 Nov 18 16:44 example.com.key\ntxt\nkeyserver$ openssl x509 -pubkey -noout -in certificate.pem > pubkey.pem\ntxt\nkeyserver$ /opt/cloudhsm/bin/key_mgmt_util\nCommand: loginHSM -u CU -s patrick -p donahue\nCommand: genSymKey -t 31 -s 16 -sess -l import-wrapping-key\n...\nSymmetric Key Created.  Key Handle: 658\n...\ntxt\nCommand: importPrivateKey -f privkey.pem -l mykey -id 1 -w 658\n...\nCfm3WrapHostKey returned: 0x00 : HSM Return: SUCCESS\nCfm3CreateUnwrapTemplate returned: 0x00 : HSM Return: SUCCESS\nCfm3UnWrapKey returned: 0x00 : HSM Return: SUCCESS\n...\nPrivate Key Unwrapped.  Key Handle: 658\n\nCommand: importPubKey -f pubkey.pem -l mykey -id 1\nCfm3CreatePublicKey returned: 0x00 : HSM Return: SUCCESS\n...\nPublic Key Handle: 941\n\nCommand: logoutHSM\nCommand: exit\nyaml\nprivate_key_stores:\n  - dir: /etc/keyless/keys\nyaml\n- uri: pkcs11:token=cavium;object=mykey?module-path=/opt/cloudhsm/lib/libcloudhsm_pkcs11_standard.so&pin-value=patrick:donahue&max-sessions=1\nsh\nsudo systemctl restart gokeyless.service\nsudo systemctl status gokeyless.service -l\ntxt\nvm$ ssh tenantadmin@hsm\n\n[local_host] lunash:>hsm login\n  Please enter the HSM Administrators' password:\n  > ********\n\n'hsm login' successful.\n\nCommand Result : 0 (Success)\n\n[local_host] lunash:>partition create -partition KeylessSSL\n\nType 'proceed' to create the partition, or\n          'quit' to quit now.\n          > proceed\n'partition create' successful.\n\nCommand Result : 0 (Success)\nbash\n[local_host] lunash:>client assignpartition -client azure-keyless -partition KeylessSSL\n\n'client assignPartition' successful.\n\nCommand Result : 0 (Success)\ntxt\nvm$ lunacm\nlunacm (64-bit) v7.2.0-220. Copyright (c) 2018 SafeNet. All rights reserved.\n\nSlot Id ->              0\n  Label ->\n  Serial Number ->        XXXXXXXXXXXXX\n  Model ->                LunaSA 7.2.0\n  Firmware Version ->     7.0.3\n  Configuration ->        Luna User Partition With SO (PW) Signing With Cloning Mode\n  Slot Description ->     Net Token Slot\n\nlunacm:>partition init -label KeylessSSL -domain cloudflare\n\nEnter password for Partition SO: ********\n\nRe-enter password for Partition SO: ********\n\nYou are about to initialize the partition.\n  All contents of the partition will be destroyed.\n\nAre you sure you wish to continue?\n\nType 'proceed' to continue, or 'quit' to quit now ->proceed\n\nCommand Result : No Error\ntxt",
  "code_samples": [
    {
      "code": "#### RHEL/CentOS packages\n\nUse either of the following examples to install the `gokeyless` package for RHEL or CentOS.\n\n**Option 1**",
      "language": "unknown"
    },
    {
      "code": "**Option 2**",
      "language": "unknown"
    },
    {
      "code": "Note\n\nAmazon Linux customers may need to update their final installation command to be something similar to `sudo yum install rsyslog shadow-utils && sudo yum install gokeyless`.\n\n### Configure\n\nAdd your Cloudflare account details to the configuration file located at `/etc/keyless/gokeyless.yaml`:\n\n1. Set the hostname of the key server, for example, `11aa40b4a5db06d4889e48e2f.example.com`. This is also the value you entered when you uploaded your keyless certificate and is the hostname of your key server that holds the key for this certificate.\n2. Set the Zone ID (found on **Overview** tab of the Cloudflare dashboard).\n3. [Set the Origin CA API key](https://developers.cloudflare.com/fundamentals/api/get-started/ca-keys).\n\n### Populate keys\n\nInstall your private keys in `/etc/keyless/keys/` and set the user and group to keyless with 400 permissions. Keys must be in PEM or DER format and have an extension of `.key`:",
      "language": "unknown"
    },
    {
      "code": "",
      "language": "unknown"
    },
    {
      "code": "When running multiple key servers, make sure all required keys are distributed to each key server. Customers typically will either use a configuration management tool such as Salt or Puppet to distribute keys or mount `/etc/keyless/keys` to a network location accessible only by your key servers. Keys are read on boot into memory, so a network path must be accessible during the gokeyless process start/restart.\n\n### Activate\n\nTo activate, restart your keyless instance:\n\n* systemd: `sudo service gokeyless restart`\n* upstart/sysvinit: `sudo /etc/init.d/gokeyless restart`\n\nIf this command fails, try troubleshooting by [checking the logs](https://developers.cloudflare.com/ssl/keyless-ssl/troubleshooting/).\n\n### Allow incoming connections from Cloudflare\n\nDuring TLS handshakes, Cloudflare's keyless client will initiate connections to the key server hostname or IP address you specify during certificate upload. By default, the keyless client will use a destination TCP port of 2407, but this can be changed during certificate upload or by editing the certificate details after upload.\n\nCreate WAF custom rules that allow your key server to accept connections from only Cloudflare. You can get Cloudflare's IPv4 and IPv6 addresses via the [IP details API endpoint](https://developers.cloudflare.com/api/resources/ips/methods/list/).\n\n</page>\n\n<page>\n---\ntitle: AWS cloud HSM · Cloudflare SSL/TLS docs\ndescription: Learn how to use Keyless SSL with AWS CloudHSM.\nlastUpdated: 2025-10-09T15:47:46.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/aws-cloud-hsm/\n  md: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/aws-cloud-hsm/index.md\n---\n\nNote\n\nThis example imports an existing key pair, but you may prefer to [generate your key on the HSM](https://docs.aws.amazon.com/cloudhsm/latest/userguide/manage-keys.html).\n\n***\n\n## Before you start\n\nMake sure you have:\n\n* Provisioned an [AWS CloudHSM cluster](https://docs.aws.amazon.com/cloudhsm/latest/userguide/getting-started.html) .\n* Installed the [appropriate software library for PKCS#11](https://docs.aws.amazon.com/cloudhsm/latest/userguide/pkcs11-library-install.html).\n\n***\n\n## 1. Import the public and private key to the HSM\n\nBefore importing the public key, extract it from the certificate provided by your CA. Place the contents of your private key in `privkey.pem` and then run the following (replacing certificate.pem with your actual certificate) to populate `pubkey.pm`.",
      "language": "unknown"
    },
    {
      "code": "Log in to the CloudHSM using a previously created [crypto user](https://docs.aws.amazon.com/cloudhsm/latest/userguide/hsm-users.html#crypto-user) (CU) account and generate a key encryption key that will be used to import your private key.",
      "language": "unknown"
    },
    {
      "code": "Referencing the key handle returned above, import the private and public key and then log out of the HSM:",
      "language": "unknown"
    },
    {
      "code": "***\n\n## 2. Modify the gokeyless config file and restart the service\n\nNow that the keys are in place, we need to modify the configuration file that the key server will read on startup. Change the `object=mykey` and `pin-value=username:password` values to match the key label you provided and CU user you created.\n\nOpen `/etc/keyless/gokeyless.yaml` and immediately after:",
      "language": "unknown"
    },
    {
      "code": "add:",
      "language": "unknown"
    },
    {
      "code": "With the config file saved, restart `gokeyless` and verify it started successfully.",
      "language": "unknown"
    },
    {
      "code": "</page>\n\n<page>\n---\ntitle: Azure Dedicated HSM · Cloudflare SSL/TLS docs\ndescription: Learn how to use Keyless SSL with Azure Dedicated HSM.\nlastUpdated: 2025-10-09T15:47:46.000Z\nchatbotDeprioritize: false\nsource_url:\n  html: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/azure-dedicated-hsm/\n  md: https://developers.cloudflare.com/ssl/keyless-ssl/hardware-security-modules/azure-dedicated-hsm/index.md\n---\n\nThis tutorial uses [Azure Dedicated HSM](https://azure.microsoft.com/en-us/services/azure-dedicated-hsm/) — a FIPS 140-2 Level 3 certified implementation based on the Gemalto SafeNet Luna a790.\n\n***\n\n## Before you start\n\nMake sure you have:\n\n* Followed Microsoft's [tutorial](https://docs.microsoft.com/en-us/azure/dedicated-hsm/tutorial-deploy-hsm-powershell) for deploying HSMs into an existing virtual network using PowerShell\n* Installed the [SafeNet client software](https://cpl.thalesgroup.com/node/11350)\n\n***\n\n## 1. Create, assign, and initialize a new partition\n\nThe first step is creating an HSM partition, which can be thought of as an independent logical HSM within your Azure Dedicated HSM device.",
      "language": "unknown"
    },
    {
      "code": "Next, the partition needs to be assigned to the client, in this case your key server.",
      "language": "unknown"
    },
    {
      "code": "After the partition has been assigned, run `lunacm` from your virtual server and initialize the partition.",
      "language": "unknown"
    },
    {
      "code": "***\n\n## 2. Generate a RSA key pair and certificate signing request (CSR)\n\nBefore running the commands below, check with your information security and/or cryptography team to confirm the approved key creation procedures for your organization.",
      "language": "unknown"
    }
  ],
  "headings": [
    {
      "level": "h3",
      "text": "Configure",
      "id": "configure"
    },
    {
      "level": "h3",
      "text": "Populate keys",
      "id": "populate-keys"
    },
    {
      "level": "h3",
      "text": "Activate",
      "id": "activate"
    },
    {
      "level": "h3",
      "text": "Allow incoming connections from Cloudflare",
      "id": "allow-incoming-connections-from-cloudflare"
    },
    {
      "level": "h2",
      "text": "Before you start",
      "id": "before-you-start"
    },
    {
      "level": "h2",
      "text": "1. Import the public and private key to the HSM",
      "id": "1.-import-the-public-and-private-key-to-the-hsm"
    },
    {
      "level": "h2",
      "text": "2. Modify the gokeyless config file and restart the service",
      "id": "2.-modify-the-gokeyless-config-file-and-restart-the-service"
    },
    {
      "level": "h2",
      "text": "Before you start",
      "id": "before-you-start"
    },
    {
      "level": "h2",
      "text": "1. Create, assign, and initialize a new partition",
      "id": "1.-create,-assign,-and-initialize-a-new-partition"
    },
    {
      "level": "h2",
      "text": "2. Generate a RSA key pair and certificate signing request (CSR)",
      "id": "2.-generate-a-rsa-key-pair-and-certificate-signing-request-(csr)"
    }
  ],
  "url": "llms-txt#install-gokeyless",
  "links": []
}