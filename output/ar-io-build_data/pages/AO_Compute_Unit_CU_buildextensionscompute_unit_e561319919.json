{
  "title": "AO Compute Unit (CU) (/build/extensions/compute-unit)",
  "content": "An AO Compute Unit (CU) is a critical component in the AO ecosystem responsible for executing AO processes and maintaining their state. CUs serve as the computational backbone of the AO network by:\n\n- **Processing Messages**: CUs receive and process messages sent to AO processes\n- **Executing WASM Modules**: CUs run the WebAssembly (WASM) code that defines process behavior\n- **Maintaining State**: CUs track and update the state of AO processes\n- **Creating Checkpoints**: CUs periodically save process state to the Arweave network as checkpoints\n\nRunning a CU alongside your gateway allows you to:\n\n1. Process AO requests locally rather than relying on external services\n2. Improve response times for AO-related queries\n3. Contribute computational resources to the AO network\n4. Ensure your gateway has reliable access to AO functionality\n\nFor more detailed information about Compute Units, please refer to the [AO Cookbook: Units](https://cookbook_ao.arweave.net/concepts/units.html#summary).\n\n## System Requirements\n\nBefore deploying a CU, ensure your system meets the following requirements:\n\n- **Recommended**: At least 16GB RAM for optimal CU operation\n- **Minimum**: 4GB RAM is possible with adjusted memory limits (see resource allocation settings)\n- At least 100GB disk space dedicated to CU operation\n- These requirements are separate from your gateway requirements\n\nRunning a CU is resource-intensive. Make sure your system has sufficient\n  resources to handle both the gateway and the CU. While you can run a CU with\n  less than the recommended RAM, you'll need to adjust the memory limits\n  accordingly.\n\n## Deploying an AO CU\n\n### Navigate to Gateway Directory\n\nFirst, navigate to the root directory of your gateway:\n\n### Configure Environment Variables\n\nCopy the example environment file:\n\n### Default .env.ao.example Contents\n\nThe default `.env.ao.example` file contains the following settings:\n\nThese default settings are configured to work with a gateway running on the same machine, but you'll need to modify them as described below.\n\nOpen the `.env.ao` file in your preferred text editor:\n\nConfigure the following settings:\n\n1.  **CU_WALLET**: Replace `'[wallet json here]'` with the JSON from an Arweave wallet.\n\nThe entire JSON must be placed on a single line for proper registration.\n\n2.  **PROCESS_CHECKPOINT_TRUSTED_OWNERS**: This is a comma-separated list of trusted wallet addresses:\n\nIf you are uploading your own checkpoints, you should add your own CU wallet address after the default value, separated by a comma:\n\nThis allows your CU to trust checkpoints from both the official source and your own wallet.\n\n3.  **GATEWAY_URL**: By default, this is set to use your own gateway:\n\nA gateway must be set to index all ANS-104 data items from AO or the CU will not operate properly. Most users will want to set this to:\n\n4.  **UPLOADER_URL**: By default, this is set to use a bundler sidecar run by your gateway:\n\nCheckpoints are uploaded to Arweave, so the upload must be paid for. You\n      must ensure your wallet has sufficient funds: - If using\n      `https://up.arweave.net` (recommended), your CU_WALLET must contain Turbo\n      Credits - If using your own bundler or another service, you'll need the\n      appropriate token (AR or other) - Without proper funding, checkpoints will\n      fail to upload and your CU may not function correctly\n\nThe simplest option for most users is to use:\n\nThis requires your CU_WALLET to contain Turbo Credits.\n\n5.  **Optional: Disable Checkpoint Creation**: If you want to disable checkpoint uploads, add:\n\n### Example of a Completed .env.ao File\n\nHere's an example of what your completed `.env.ao` file might look like with common settings:\n\nAfter making your changes, save and exit the nano editor:\n\n1. Press `Ctrl+X` to exit\n2. Press `Y` to confirm saving changes\n3. Press `Enter` to confirm the filename\n\n### Optional Resource Allocation Settings\n\nYou can fine-tune the CU's resource usage by adding these optional environment variables:\n\n1.  **PROCESS_WASM_MEMORY_MAX_LIMIT**: Sets the maximum memory limit (in bytes) for WASM processes.\n\nTo work with the AR.IO process, `PROCESS_WASM_MEMORY_MAX_LIMIT` must be at least `17179869184` (16GB).\n\nNote: This doesn't mean your server needs 16GB of RAM. This is the maximum memory limit the CU will support for processes. Most processes don't use their maximum allocated memory.\n\nYou can set this value to 16GB even if your server only has 4GB of RAM. However, if a process requires more memory than your server has available, the CU will fail when evaluating messages that need more memory.\n\n2.  **WASM_EVALUATION_MAX_WORKERS**: Sets the maximum number of worker threads for WASM evaluation.\n\nThis will default to (available CPUs - 1) if not specified. If you're\n      running a gateway and unbundling on the same server, consider setting this\n      to 2 or less to avoid overloading your CPU.\n\n3.  **PROCESS_WASM_COMPUTE_MAX_LIMIT**: The maximum Compute-Limit, in bytes, supported for ao processes (defaults to 9 billion)\n\n4.  **NODE_OPTIONS**: Sets Node.js memory allocation for the Docker container.\n\nStart with conservative values and monitor performance. You can adjust these\n  settings based on your system's capabilities and the CU's performance.\n\n### Start the CU Container\n\nOnce your environment file is configured, start the CU container:\n\nThis command uses the following flags:\n\n- `--env-file .env.ao`: Specifies the environment file to use\n- `-f docker-compose.ao.yaml`: Specifies the Docker Compose file to use\n- `up`: Creates and starts the containers\n- `-d`: Runs containers in detached mode (background)\n\nTo check the logs of your CU container:\n\nThis command uses the following flags:\n\n- `-f`: Follows the log output (continuous display)\n- `--tail=20`: Shows only the last 20 lines of logs\n\nExit the logs by pressing `Ctrl+C`.\n\n## Connecting Your Gateway to the CU\n\nTo make your gateway use your local CU:\n\n1. Add the following line to your gateway's `.env` file:\n\nThis assumes the CU is running on the same machine as the gateway.\n\n2. Restart your gateway:\n\nA CU won't do anything until requests are being made of it. By connecting your\n  gateway to the CU, you'll start generating these requests.\n\n### Accessing Your CU\n\nOnce properly set up and connected to your gateway, you can access your CU via:\n\nThis endpoint allows you to interact with your CU directly through your gateway's domain.\n\n- **Initial Processing Time**: A CU will need to process AO history before it can give valid responses. This process can take several hours.\n\n- **Gateway Fallback**: A gateway on release 27 or above will fallback to arweave.net if its default CU is not responding quickly enough, so gateway operations will not be significantly impacted during the initial processing.\n\n- **Monitoring Progress**: Check the CU logs after pointing a gateway at it to watch the process of working through AO history:\n\n- **Resource Usage**: Running a CU is resource-intensive. Monitor your system's performance to ensure it can handle both the gateway and CU workloads.\n\n## Useful Docker Commands\n\nMonitor and manage your AO Compute Unit with these commands:",
  "code_samples": [
    {
      "code": "cd /path/to/your/gateway",
      "language": "bash"
    },
    {
      "code": "cp .env.ao.example .env.ao",
      "language": "bash"
    },
    {
      "code": "CU_WALLET='[wallet json here]'\nPROCESS_CHECKPOINT_TRUSTED_OWNERS=fcoN_xJeisVsPXA-trzVAuIiqO3ydLQxM-L4XbrQKzY\nGATEWAY_URL=http://envoy:3000\nUPLOADER_URL=http://envoy:3000/bundler",
      "language": "unknown"
    },
    {
      "code": "nano .env.ao",
      "language": "bash"
    },
    {
      "code": "PROCESS_CHECKPOINT_TRUSTED_OWNERS=fcoN_xJeisVsPXA-trzVAuIiqO3ydLQxM-L4XbrQKzY",
      "language": "unknown"
    },
    {
      "code": "PROCESS_CHECKPOINT_TRUSTED_OWNERS=fcoN_xJeisVsPXA-trzVAuIiqO3ydLQxM-L4XbrQKzY,YOUR_WALLET_ADDRESS_HERE",
      "language": "unknown"
    },
    {
      "code": "GATEWAY_URL=http://envoy:3000",
      "language": "unknown"
    },
    {
      "code": "GATEWAY_URL=https://arweave.net",
      "language": "unknown"
    },
    {
      "code": "UPLOADER_URL=http://envoy:3000/bundler",
      "language": "unknown"
    },
    {
      "code": "UPLOADER_URL=https://up.arweave.net",
      "language": "unknown"
    },
    {
      "code": "DISABLE_PROCESS_CHECKPOINT_CREATION=true",
      "language": "unknown"
    },
    {
      "code": "CU_WALLET='{\"kty\":\"RSA\",\"e\":\"AQAB\",\"n\":\"mYM07...\"}'\nPROCESS_CHECKPOINT_TRUSTED_OWNERS=fcoN_xJeisVsPXA-trzVAuIiqO3ydLQxM-L4XbrQKzY\nGATEWAY_URL=https://arweave.net\nUPLOADER_URL=https://up.arweave.net",
      "language": "unknown"
    },
    {
      "code": "PROCESS_WASM_MEMORY_MAX_LIMIT=17179869184  # 16GB (16 * 1024^3)",
      "language": "unknown"
    },
    {
      "code": "WASM_EVALUATION_MAX_WORKERS=4  # Example: Use 4 worker threads",
      "language": "unknown"
    },
    {
      "code": "PROCESS_WASM_COMPUTE_MAX_LIMIT=9000000000",
      "language": "unknown"
    },
    {
      "code": "NODE_OPTIONS=--max-old-space-size=8192  # Example: 8GB for Node.js heap",
      "language": "unknown"
    },
    {
      "code": "docker compose --env-file .env.ao -f docker-compose.ao.yaml up -d",
      "language": "bash"
    },
    {
      "code": "docker compose -f docker-compose.ao.yaml logs -f --tail=20",
      "language": "bash"
    },
    {
      "code": "AO_CU_URL=http://ao-cu:6363",
      "language": "unknown"
    },
    {
      "code": "docker compose down\n   docker compose up -d",
      "language": "bash"
    },
    {
      "code": "https:///ao/cu",
      "language": "unknown"
    },
    {
      "code": "docker compose -f docker-compose.ao.yaml logs -f --tail=20",
      "language": "bash"
    }
  ],
  "headings": [
    {
      "level": "h2",
      "text": "Overview",
      "id": "overview"
    },
    {
      "level": "h2",
      "text": "System Requirements",
      "id": "system-requirements"
    },
    {
      "level": "h2",
      "text": "Deploying an AO CU",
      "id": "deploying-an-ao-cu"
    },
    {
      "level": "h3",
      "text": "Navigate to Gateway Directory",
      "id": "navigate-to-gateway-directory"
    },
    {
      "level": "h3",
      "text": "Configure Environment Variables",
      "id": "configure-environment-variables"
    },
    {
      "level": "h3",
      "text": "Default .env.ao.example Contents",
      "id": "default-.env.ao.example-contents"
    },
    {
      "level": "h3",
      "text": "Example of a Completed .env.ao File",
      "id": "example-of-a-completed-.env.ao-file"
    },
    {
      "level": "h3",
      "text": "Optional Resource Allocation Settings",
      "id": "optional-resource-allocation-settings"
    },
    {
      "level": "h3",
      "text": "Start the CU Container",
      "id": "start-the-cu-container"
    },
    {
      "level": "h3",
      "text": "Check the Logs",
      "id": "check-the-logs"
    },
    {
      "level": "h2",
      "text": "Connecting Your Gateway to the CU",
      "id": "connecting-your-gateway-to-the-cu"
    },
    {
      "level": "h3",
      "text": "Accessing Your CU",
      "id": "accessing-your-cu"
    },
    {
      "level": "h2",
      "text": "Important Notes",
      "id": "important-notes"
    },
    {
      "level": "h2",
      "text": "Useful Docker Commands",
      "id": "useful-docker-commands"
    }
  ],
  "url": "llms-txt#ao-compute-unit-(cu)-(/build/extensions/compute-unit)",
  "links": []
}