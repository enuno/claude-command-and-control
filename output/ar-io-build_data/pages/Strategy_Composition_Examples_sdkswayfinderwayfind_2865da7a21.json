{
  "title": "Strategy Composition Examples (/sdks/wayfinder/wayfinder-core/(routing-strategies)/strategy-composition-examples)",
  "content": "Here are a few “lego-style” examples showing how existing routing strategies can\nbe composed to suit different use cases. Each strategy implements\n`RoutingStrategy`, so they can be wrapped and combined freely.\n\n#### Random + Ping health checks\n\nPick a random gateway, then verify it responds with a `HEAD` request before\nreturning it.\n\n#### Fastest ping wrapped with a simple cache\n\nFind the lowest-latency gateway and cache the result for five minutes to avoid\nconstant pings.\n\n#### Preferred gateway + network fallback strategy\n\nAttempt to use a favorite gateway, but fallback to a fastest pinging strategy using the ARIO Network if it fails.\n\n#### Round-robin + ping verification\n\nCycle through gateways sequentially, checking each one’s health before use.\n\n#### Cache around any composed strategy\n\nBecause `SimpleCacheRoutingStrategy` accepts any `RoutingStrategy`, you can\ncache more complex compositions too.\n\n#### Complex multi-strategy fallback with CompositeRoutingStrategy\n\nChain multiple strategies together for maximum resilience - try fastest ping first, then fall back to random selection if ping fails.\n\nIn all cases, you can supply the composed strategy to `Wayfinder` (or whatever\nrouter factory you use) and pass in a gateways provider:",
  "code_samples": [
    {
      "code": "import {\n  RandomRoutingStrategy,\n  PingRoutingStrategy,\n} from \"@ar.io/wayfinder-core\";\n\nconst strategy = new PingRoutingStrategy({\n  routingStrategy: new RandomRoutingStrategy(),\n  retries: 2,\n  timeoutMs: 500,\n});",
      "language": "ts"
    },
    {
      "code": "import {\n  FastestPingRoutingStrategy,\n  SimpleCacheRoutingStrategy,\n} from \"@ar.io/wayfinder-core\";\n\nconst strategy = new SimpleCacheRoutingStrategy({\n  routingStrategy: new FastestPingRoutingStrategy({ timeoutMs: 500 }),\n  ttlSeconds: 300,\n});",
      "language": "ts"
    },
    {
      "code": "import {\n  PreferredWithFallbackRoutingStrategy,\n  RandomRoutingStrategy,\n  PingRoutingStrategy,\n  NetworkGatewaysProvider,\n} from \"@ar.io/wayfinder-core\";\n\n// these will be our fallback gateways\nconst gatewayProvider = new NetworkGatewaysProvider({\n  ario: ARIO.mainnet(),\n  sortBy: 'operatorStake',\n  limit: 5,\n});\n\n// this is our fallback strategy if our preferred gateway fails\nconst fastestPingStrategy = new FastestPingRoutingStrategy({\n  timeoutMs: 500,\n  gatewaysProvider: gatewayProvider,\n});\n\n// compose the strategies together, the preferred gateway will be used first, and if it fails, the fallback strategy will be used.\nconst strategy = new PreferredWithFallbackRoutingStrategy({\n  preferredGateway: \"https://my-gateway.example\",\n  fallbackStrategy: fastestPingStrategy,\n});",
      "language": "ts"
    },
    {
      "code": "import {\n  RoundRobinRoutingStrategy,\n  PingRoutingStrategy,\n  NetworkGatewaysProvider,\n} from \"@ar.io/wayfinder-core\";\n\n// use static gateways\nconst strategy = new PingRoutingStrategy({\n  routingStrategy: new RoundRobinRoutingStrategy({\n    gateways: [new URL(\"https://gw1\"), new URL(\"https://gw2\")],\n  }),\n});\n\n// use a dynamic list of gateways from the ARIO Network\nconst strategy2 = new PingRoutingStrategy({\n  routingStrategy: new RoundRobinRoutingStrategy({\n    gatewaysProvider: new NetworkGatewaysProvider({\n      ario: ARIO.mainnet(),\n      sortBy: 'operatorStake',\n      limit: 5,\n    }),\n  }),\n});",
      "language": "ts"
    },
    {
      "code": "import {\n  RandomRoutingStrategy,\n  PingRoutingStrategy,\n  SimpleCacheRoutingStrategy,\n  NetworkGatewaysProvider,\n} from \"@ar.io/wayfinder-core\";\n\n// use a dynamic list of gateways from the ARIO Network\nconst randomStrategy = new RandomRoutingStrategy({\n  gatewaysProvider: new NetworkGatewaysProvider({\n    ario: ARIO.mainnet(),\n    sortBy: 'operatorStake',\n    limit: 20,\n  }),\n});\n\n// wrap the random strategy with a ping strategy\nconst pingRandom = new PingRoutingStrategy({\n  routingStrategy: randomStrategy,\n});\n\n// wrap the ping random strategy with a cache strategy, caching the selected gateway for 10 minutes\nconst cachedStrategy = new SimpleCacheRoutingStrategy({\n  routingStrategy: pingRandom,\n  ttlSeconds: 600,\n});",
      "language": "ts"
    },
    {
      "code": "import {\n  CompositeRoutingStrategy,\n  FastestPingRoutingStrategy,\n  RandomRoutingStrategy,\n  NetworkGatewaysProvider,\n} from \"@ar.io/wayfinder-core\";\n\n// Define gateway provider for both strategies\nconst gatewayProvider = new NetworkGatewaysProvider({\n  ario: ARIO.mainnet(),\n  sortBy: 'operatorStake',\n  limit: 15,\n});\n\n// Create a composite strategy that tries fastest ping first, then random\nconst strategy = new CompositeRoutingStrategy({\n  strategies: [\n    // Try fastest ping first (high performance, but may fail if all gateways are slow)\n    new FastestPingRoutingStrategy({\n      timeoutMs: 500,\n      gatewaysProvider: gatewayProvider,\n    }),\n    // Fallback to random selection (guaranteed to work if gateways exist)\n    new RandomRoutingStrategy({\n      gatewaysProvider: gatewayProvider,\n    }),\n  ],\n});",
      "language": "ts"
    },
    {
      "code": "const router = new Wayfinder({\n  gatewaysProvider: new StaticGatewaysProvider({\n    gateways: [new URL(\"https://gw1\"), new URL(\"https://gw2\")],\n  }),\n  routingStrategy: strategy, // any of the compositions above\n});",
      "language": "ts"
    }
  ],
  "headings": [],
  "url": "llms-txt#strategy-composition-examples-(/sdks/wayfinder/wayfinder-core/(routing-strategies)/strategy-composition-examples)",
  "links": []
}